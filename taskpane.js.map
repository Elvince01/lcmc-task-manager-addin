{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./src/taskpane/taskpane.js"],"sourcesContent":["// Task Manager task pane logic, wired to Excel via Office.js\n// Based on the scaffold in Task Manager Excel/addin/taskpane.js\n\n/* global document, Excel, Office */\n\n(function(){\n  const qs = (s)=>document.querySelector(s);\n  const qsa = (s)=>Array.from(document.querySelectorAll(s));\n  let teamMembersLoaded = false;\n  let hasUnsavedChanges = false;\n\n  // SmartBrief Integration\n  // Email summaries are fetched by VBA macro (SmartBrief.bas) and written to column L\n  // The add-in reads from column L to display summaries (no direct API calls from JS)\n\n  const EMAIL_SUMMARIZER_API_URL = 'http://192.168.1.141:5002';\n  const SMARTBRIEF_MATCH_THRESHOLD = 0.5;\n\n  // Toast notification helper\n  function showToast(message, type = 'success') {\n    const toast = qs('#toast');\n    if (!toast) return;\n    toast.textContent = message;\n    toast.className = 'toast ' + type + ' show';\n    setTimeout(() => {\n      toast.classList.remove('show');\n    }, 3000);\n  }\n\n  // Check for missing fields and return array of missing field names\n  function checkMissingFields() {\n    const missing = [];\n\n    // Check company name\n    const companyName = qs('#companyName');\n    if (!companyName || !companyName.value.trim()) {\n      missing.push('Company Name');\n    }\n\n    // Check task category\n    const selectedCategories = Array.from(document.querySelectorAll('.category-toggle:checked'));\n    if (selectedCategories.length === 0) {\n      missing.push('Task Category');\n    }\n\n    // Check broker lead\n    const brokerLead = qs('#brokerLead');\n    if (!brokerLead || !brokerLead.value) {\n      missing.push('Broker Lead');\n    }\n\n    // Check assignees\n    const selectedAssignees = Array.from(document.querySelectorAll('#assignees input[type=checkbox]:checked'));\n    if (selectedAssignees.length === 0) {\n      missing.push('Assigned To');\n    }\n\n    // Check visible task cards for status and deadline\n    const visibleTaskCards = Array.from(document.querySelectorAll('.task-card')).filter(card => {\n      return card.style.display !== 'none' && card.id !== 'otherTaskCard';\n    });\n\n    visibleTaskCards.forEach(card => {\n      const taskName = card.dataset.task || 'Task';\n      const activeChip = card.querySelector('.chip.active');\n      const deadlineInput = card.querySelector('[data-role=\"deadline\"]');\n\n      if (!activeChip) {\n        missing.push(`${taskName}: Status`);\n      }\n      if (!deadlineInput || !deadlineInput.value) {\n        missing.push(`${taskName}: Deadline`);\n      }\n    });\n\n    // Check \"Other Task\" card if visible\n    const otherTaskCard = qs('#otherTaskCard');\n    if (otherTaskCard && otherTaskCard.style.display !== 'none') {\n      const taskNameInput = qs('#taskName');\n      if (!taskNameInput || !taskNameInput.value.trim()) {\n        missing.push('Other Task: Task Name');\n      }\n      const activeChip = otherTaskCard.querySelector('.chip.active');\n      if (!activeChip) {\n        missing.push('Other Task: Status');\n      }\n      const deadlineInput = otherTaskCard.querySelector('[data-role=\"deadline\"]');\n      if (!deadlineInput || !deadlineInput.value) {\n        missing.push('Other Task: Deadline');\n      }\n    }\n\n    return missing;\n  }\n\n  // Show missing fields warning in a styled popup\n  function showMissingFieldsWarning(missingFields) {\n    // Create overlay\n    const overlay = document.createElement('div');\n    overlay.className = 'confirm-overlay';\n    overlay.id = 'missingFieldsOverlay';\n\n    // Create box\n    const box = document.createElement('div');\n    box.className = 'confirm-box';\n    box.style.maxWidth = '320px';\n    box.style.textAlign = 'left';\n\n    // Title\n    const title = document.createElement('p');\n    title.innerHTML = '<strong style=\"color:#f59e0b;\"> Missing Fields</strong>';\n    title.style.marginBottom = '12px';\n    title.style.textAlign = 'center';\n    box.appendChild(title);\n\n    // Description\n    const desc = document.createElement('p');\n    desc.textContent = 'The following fields are empty:';\n    desc.style.fontSize = '12px';\n    desc.style.color = '#64748b';\n    desc.style.marginBottom = '8px';\n    box.appendChild(desc);\n\n    // List of missing fields\n    const list = document.createElement('ul');\n    list.style.cssText = 'margin:0 0 16px 0;padding-left:20px;font-size:12px;color:#334155;max-height:150px;overflow-y:auto;';\n    missingFields.forEach(field => {\n      const li = document.createElement('li');\n      li.textContent = field;\n      li.style.marginBottom = '4px';\n      list.appendChild(li);\n    });\n    box.appendChild(list);\n\n    // Close button\n    const btnWrap = document.createElement('div');\n    btnWrap.style.textAlign = 'center';\n    const closeBtn = document.createElement('button');\n    closeBtn.textContent = 'Got it';\n    closeBtn.style.cssText = 'padding:8px 24px;font-size:13px;font-weight:500;border:none;border-radius:6px;background:#1e40af;color:#fff;cursor:pointer;';\n    closeBtn.addEventListener('click', () => {\n      overlay.remove();\n    });\n    btnWrap.appendChild(closeBtn);\n    box.appendChild(btnWrap);\n\n    overlay.appendChild(box);\n    document.body.appendChild(overlay);\n  }\n\n  // Unsaved changes indicator\n  function setUnsavedChanges(unsaved) {\n    hasUnsavedChanges = unsaved;\n    const indicator = qs('#unsavedIndicator');\n    if (indicator) {\n      indicator.classList.toggle('visible', unsaved);\n    }\n  }\n\n  // ============== SmartBrief Parsing Helpers ==============\n\n  // Parse participants from SmartBrief summary\n  // Format: \"## PARTICIPANTS\\n- Name (email@domain.com)\\n- Name2 (email2@domain.com)\"\n  function parseParticipantsFromSummary(summaryText) {\n    const participants = [];\n    const participantsMatch = summaryText.match(/## PARTICIPANTS\\n([\\s\\S]*?)(?=\\n## |$)/);\n    if (participantsMatch) {\n      const participantsBlock = participantsMatch[1];\n      const lines = participantsBlock.split('\\n').filter(l => l.trim().startsWith('-'));\n      lines.forEach(line => {\n        // Parse \"- Name (email@domain.com)\" or \"- Name\"\n        const match = line.match(/^-\\s*(.+?)(?:\\s*\\(([^)]+)\\))?\\s*$/);\n        if (match) {\n          const name = match[1].trim();\n          const email = match[2] ? match[2].trim() : '';\n          if (name) {\n            participants.push({ name, email });\n          }\n        }\n      });\n    }\n    return participants;\n  }\n\n  // Parse summary body from SmartBrief (the ## SUMMARY section)\n  function parseSummaryBodyFromSummary(summaryText) {\n    const summaryMatch = summaryText.match(/## SUMMARY\\n([\\s\\S]*?)(?=\\n## |$)/);\n    if (summaryMatch) {\n      return summaryMatch[1].trim();\n    }\n    // Fallback: return everything after the first line\n    const lines = summaryText.split('\\n');\n    return lines.slice(1).join('\\n').trim();\n  }\n\n  // Detect task category from summary text using keywords\n  function detectCategoryFromSummary(summaryText) {\n    const text = summaryText.toLowerCase();\n    \n    // Check for specific keywords\n    if (text.includes('onboarding') || text.includes('new client') || text.includes('new account') || text.includes('account opening')) {\n      return 'Onboarding';\n    }\n    if (text.includes('kyc') || text.includes('know your customer') || text.includes('compliance') || text.includes('documents') || text.includes('documentation')) {\n      return 'KYC update';\n    }\n    if (text.includes('rate') || text.includes('pricing') || text.includes('amendment') || text.includes('amended') || text.includes('fee') || text.includes('commission')) {\n      return 'Amended Product/Rate';\n    }\n    if (text.includes('give-up') || text.includes('giveup') || text.includes('give up')) {\n      return 'Give-up';\n    }\n    \n    return null; // No clear category detected\n  }\n\n  // Match participants to team members (fuzzy match by name)\n  function matchParticipantsToTeamMembers(participants) {\n    const teamCheckboxes = Array.from(document.querySelectorAll('#assignees input[type=checkbox]'));\n    const teamNames = teamCheckboxes.map(cb => cb.value.toLowerCase());\n    const matched = [];\n    \n    participants.forEach(p => {\n      const pNameLower = p.name.toLowerCase();\n      // Try exact match first\n      let idx = teamNames.findIndex(t => t === pNameLower);\n      // Try partial match (first name)\n      if (idx === -1) {\n        const firstName = pNameLower.split(' ')[0];\n        idx = teamNames.findIndex(t => t.startsWith(firstName) || t.includes(firstName));\n      }\n      // Try email prefix match\n      if (idx === -1 && p.email) {\n        const emailPrefix = p.email.split('@')[0].toLowerCase();\n        idx = teamNames.findIndex(t => {\n          const tFirstName = t.split(' ')[0];\n          return emailPrefix.includes(tFirstName) || tFirstName.includes(emailPrefix);\n        });\n      }\n      if (idx !== -1) {\n        matched.push(teamCheckboxes[idx].value);\n      }\n    });\n    \n    return [...new Set(matched)]; // dedupe\n  }\n\n  // Store parsed SmartBrief data for \"Apply to Task\" action\n  let lastParsedSmartBrief = null;\n\n  async function fetchSmartBriefSummaryFromApi(company, initialRequest, introEmail, remindersStart) {\n    const useLocalProxy = typeof window !== 'undefined'\n      && window.location\n      && window.location.hostname === 'localhost'\n      && window.location.protocol === 'https:';\n\n    const baseUrl = useLocalProxy ? '' : EMAIL_SUMMARIZER_API_URL;\n    const url = `${baseUrl}/api/task-manager/summaries/${encodeURIComponent(company)}`;\n\n    try {\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          initial_request: initialRequest,\n          intro_email: introEmail,\n          reminders_start: remindersStart,\n          threshold: SMARTBRIEF_MATCH_THRESHOLD\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Server returned ${response.status}`);\n      }\n\n      const data = await response.json();\n      const summaries = Array.isArray(data.summaries) ? data.summaries : [];\n      if (summaries.length === 0) return '';\n\n      const best = summaries[0] || {};\n      const subject = String(best.subject || 'No subject');\n      const summary = String(best.summary || '').trim();\n      const matchScore = typeof best.match_score === 'number' ? best.match_score : parseFloat(best.match_score);\n      const matchPercent = Number.isFinite(matchScore) ? Math.round(matchScore * 100) : 0;\n\n      if (!summary) return '';\n      return `[${matchPercent}% match] ${subject}\\n\\n${summary}`;\n    } catch (err) {\n      // Common failure modes: mixed content (https add-in calling http API) or CORS\n      const msg = err && err.message ? err.message : String(err);\n      showToast('SmartBrief API error: ' + msg, 'error');\n      return '';\n    }\n  }\n\n  // Track form changes\n  function wireChangeTracking() {\n    const formElements = qsa('input, select, textarea');\n    formElements.forEach(el => {\n      el.addEventListener('change', () => setUnsavedChanges(true));\n      el.addEventListener('input', () => setUnsavedChanges(true));\n    });\n    // Also track chip clicks\n    qsa('.chip').forEach(chip => {\n      chip.addEventListener('click', () => setUnsavedChanges(true));\n    });\n  }\n\n  // Warn before leaving with unsaved changes\n  window.addEventListener('beforeunload', (e) => {\n    if (hasUnsavedChanges) {\n      e.preventDefault();\n      e.returnValue = '';\n      return '';\n    }\n  });\n\n  // Escape HTML helper\n  function escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = String(text || '');\n    return div.innerHTML;\n  }\n\n  // Due date warning helper\n  function getDueDateWarningClass(deadlineStr) {\n    if (!deadlineStr) return '';\n    const deadline = new Date(deadlineStr);\n    if (isNaN(deadline.getTime())) return '';\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    deadline.setHours(0, 0, 0, 0);\n    const diffDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));\n    if (diffDays < 0) return 'overdue';\n    if (diffDays <= 3) return 'warning';\n    return '';\n  }\n\n  function formatDeadlineBadge(deadlineStr) {\n    const warningClass = getDueDateWarningClass(deadlineStr);\n    if (!warningClass) return '';\n    if (warningClass === 'overdue') {\n      return '<span class=\"deadline-badge overdue\"> Overdue</span>';\n    }\n    const deadline = new Date(deadlineStr);\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    deadline.setHours(0, 0, 0, 0);\n    const diffDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));\n    if (diffDays === 0) return '<span class=\"deadline-badge warning\"> Due today</span>';\n    if (diffDays === 1) return '<span class=\"deadline-badge warning\"> Due tomorrow</span>';\n    return `<span class=\"deadline-badge warning\"> ${diffDays} days left</span>`;\n  }\n\n  // Apply deadline warnings to task cards\n  function applyDeadlineWarnings() {\n    qsa('.task-card').forEach(card => {\n      const deadlineInput = card.querySelector('[data-role=\"deadline\"]');\n      if (!deadlineInput) return;\n      const deadline = deadlineInput.value;\n      const warningClass = getDueDateWarningClass(deadline);\n      card.classList.remove('deadline-warning', 'deadline-overdue');\n      if (warningClass === 'overdue') {\n        card.classList.add('deadline-overdue');\n      } else if (warningClass === 'warning') {\n        card.classList.add('deadline-warning');\n      }\n    });\n  }\n\n  const companyNameInput = qs('#companyName');\n  // taskDescriptionEl is now a container with checkboxes, not a select\n  const brokerLeadEl = qs('#brokerLead');\n  const initialRequestInput = qs('#initialRequest');\n  const introEmailInput = qs('#introEmail');\n  const remindersStartInput = qs('#remindersStart');\n  const emailFrequencyEl = qs('#emailFrequency');\n  const extraNoteEl = qs('#extraNote');\n  const auditTextEl = qs('#auditText');\n  const tasksRowEl = qs('#tasksRow');\n  const taskCardsContainer = qs('#taskCards');\n  const taskNameInput = qs('#taskName'); // only for __other__ card\n\n  // Wire Save, New Task, Load Selected, and KYC Portal buttons\n  const saveBtn = qs('#saveBtn');\n  const newTaskBtn = qs('#newTaskBtn');\n  const loadSelectedBtn = qs('#loadSelectedBtn');\n  const openKycPortalBtn = qs('#openKycPortal');\n\n  // Track current row for display\n  let currentRowNum = null;\n\n  if (saveBtn) {\n    saveBtn.addEventListener('click', async () => {\n      try {\n        // Check for missing fields before saving\n        const missingFields = checkMissingFields();\n\n        if (currentRowNum === null || currentRowNum === 'new') {\n          await addNewTask();\n          showToast(' New task added successfully!', 'success');\n        } else {\n          await saveToActiveRow();\n          showToast(' Changes saved to row ' + currentRowNum, 'success');\n        }\n        setUnsavedChanges(false);\n\n        // Show missing fields warning after successful save\n        if (missingFields.length > 0) {\n          setTimeout(() => {\n            showMissingFieldsWarning(missingFields);\n          }, 500); // Delay to let the success toast show first\n        }\n      } catch (e) {\n        console.error('Save error:', e);\n        showToast(' Save failed: ' + e.message, 'error');\n      }\n    });\n  }\n\n  // Load Selected Row button (in By Row tab)\n  if (loadSelectedBtn) {\n    loadSelectedBtn.addEventListener('click', async () => {\n      try {\n        await loadFromActiveRow();\n        showToast(' Loaded row ' + currentRowNum, 'success');\n      } catch (e) {\n        console.error('Load error:', e);\n        showToast(' Failed to load row', 'error');\n      }\n    });\n  }\n\n  if (newTaskBtn) {\n    newTaskBtn.addEventListener('click', () => {\n      clearFormForNewTask();\n    });\n  }\n\n  // Custom confirm dialog (since window.confirm is not supported in Office Add-ins)\n  function showConfirmDialog(message) {\n    return new Promise((resolve) => {\n      const dialog = qs('#confirmDialog');\n      const msgEl = qs('#confirmMessage');\n      const cancelBtn = qs('#confirmCancel');\n      const okBtn = qs('#confirmOk');\n      \n      if (!dialog || !msgEl || !cancelBtn || !okBtn) {\n        resolve(false);\n        return;\n      }\n      \n      msgEl.textContent = message;\n      dialog.style.display = 'flex';\n      \n      const cleanup = () => {\n        dialog.style.display = 'none';\n        cancelBtn.removeEventListener('click', onCancel);\n        okBtn.removeEventListener('click', onOk);\n      };\n      \n      const onCancel = () => {\n        cleanup();\n        resolve(false);\n      };\n      \n      const onOk = () => {\n        cleanup();\n        resolve(true);\n      };\n      \n      cancelBtn.addEventListener('click', onCancel);\n      okBtn.addEventListener('click', onOk);\n    });\n  }\n\n  // Delete Task button\n  const deleteTaskBtn = qs('#deleteTaskBtn');\n  if (deleteTaskBtn) {\n    deleteTaskBtn.addEventListener('click', async () => {\n      // Don't allow delete if this is a new unsaved task\n      if (currentRowNum === null || currentRowNum === 'new') {\n        showToast('No task to delete - this is a new task', 'error');\n        return;\n      }\n      \n      // Confirm before deleting\n      const confirmed = await showConfirmDialog('Are you sure you want to delete this Task?');\n      if (!confirmed) return;\n      \n      try {\n        await deleteCurrentRow();\n        showToast(' Task deleted successfully', 'success');\n        clearFormForNewTask();\n      } catch (e) {\n        console.error('Delete error:', e);\n        showToast(' Failed to delete task: ' + e.message, 'error');\n      }\n    });\n  }\n\n  // Guard on the DOM element so we don't wire multiple listeners or open twice\n  if (openKycPortalBtn && openKycPortalBtn.dataset.kycListenerAttached !== '1') {\n    openKycPortalBtn.dataset.kycListenerAttached = '1';\n    openKycPortalBtn.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      if (openKycPortalBtn.dataset.kycOpening === '1') return;\n      openKycPortalBtn.dataset.kycOpening = '1';\n      window.open('http://192.168.1.141:8080/', '_blank');\n      setTimeout(() => { openKycPortalBtn.dataset.kycOpening = '0'; }, 1000);\n    });\n  }\n\n  // Statistics Navigation\n  const tasksView = qs('#tasksView');\n  const statsView = qs('#statsView');\n  const tasksHeader = qs('#tasksHeader');\n  const statsHeader = qs('#statsHeader');\n  const openStatsBtn = qs('#openStatsBtn');\n  const returnToTasksBtn = qs('#returnToTasksBtn');\n  const refreshStatsBtn = qs('#refreshStatsBtn');\n\n  if (openStatsBtn) {\n    openStatsBtn.addEventListener('click', () => {\n      if (tasksView) tasksView.style.display = 'none';\n      if (tasksHeader) tasksHeader.style.display = 'none';\n      if (statsView) statsView.style.display = '';\n      if (statsHeader) statsHeader.style.display = 'flex';\n      loadStatistics();\n    });\n  }\n\n  if (returnToTasksBtn) {\n    returnToTasksBtn.addEventListener('click', () => {\n      if (tasksView) tasksView.style.display = '';\n      if (tasksHeader) tasksHeader.style.display = 'flex';\n      if (statsView) statsView.style.display = 'none';\n      if (statsHeader) statsHeader.style.display = 'none';\n    });\n  }\n\n  if (refreshStatsBtn) {\n    refreshStatsBtn.addEventListener('click', () => {\n      loadStatistics();\n    });\n  }\n\n  // Statistics calculation\n  async function loadStatistics() {\n    try {\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n        if (sheet.isNullObject) {\n          console.error('Sheet not found for statistics');\n          return;\n        }\n\n        // Load all data\n        const dataRange = sheet.getRange('A1:K5000');\n        dataRange.load('values');\n        await context.sync();\n\n        const rows = dataRange.values || [];\n        if (rows.length < 2) return;\n\n        // Parse all tasks\n        const tasks = [];\n        let todoCount = 0, inProgressCount = 0, doneCount = 0;\n        const brokerStats = {};\n        const monthlyStats = {};\n        const kycMonthly = {};\n        let totalDuration = 0, durationCount = 0;\n        \n        // Attention items with details\n        const overdueItems = [];\n        const upcomingItems = [];\n        const staleItems = [];\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const sevenDaysFromNow = new Date(today);\n        sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7);\n        const thirtyDaysAgo = new Date(today);\n        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n        for (let i = 1; i < rows.length; i++) {\n          const row = rows[i];\n          const company = row[0] ? String(row[0]).trim() : '';\n          if (!company) continue;\n\n          const category = row[1] ? String(row[1]).trim() : '';\n          const broker = row[3] ? String(row[3]).trim() : '(none)';\n          const initialRequest = row[4]; // Column E - Initial Request Date\n          const introEmail = row[5]; // Column F - Intro Email Date\n          const remindersStart = row[6]; // Column G - Reminders Start Date\n          const taskSummary = row[7] ? String(row[7]).trim() : '';\n\n          // Parse dates from columns E, F, G for monthly stats\n          // Use the earliest available date as the task creation date\n          let taskDate = null;\n          const dateE = parseDate(initialRequest);\n          const dateF = parseDate(introEmail);\n          const dateG = parseDate(remindersStart);\n          \n          // Pick the earliest non-null date\n          const availableDates = [dateE, dateF, dateG].filter(d => d !== null);\n          if (availableDates.length > 0) {\n            taskDate = availableDates.reduce((min, d) => d < min ? d : min);\n          }\n          \n          if (taskDate) {\n            const monthKey = `${taskDate.getFullYear()}-${String(taskDate.getMonth() + 1).padStart(2, '0')}`;\n            monthlyStats[monthKey] = (monthlyStats[monthKey] || 0) + 1;\n          }\n\n          // Broker stats\n          if (!brokerStats[broker]) {\n            brokerStats[broker] = { total: 0, active: 0, completed: 0 };\n          }\n          brokerStats[broker].total++;\n\n          // Parse task summary for status\n          if (taskSummary) {\n            const lines = taskSummary.split(/\\r?\\n/).filter(Boolean);\n            lines.forEach(line => {\n              const lower = line.toLowerCase();\n              \n              // Count statuses\n              if (lower.includes(': to do')) {\n                todoCount++;\n                brokerStats[broker].active++;\n              } else if (lower.includes(': in progress')) {\n                inProgressCount++;\n                brokerStats[broker].active++;\n              } else if (lower.includes(': done')) {\n                doneCount++;\n                brokerStats[broker].completed++;\n              }\n\n              // Check for KYC completed\n              if (lower.includes('kyc') && lower.includes(': done')) {\n                const completedMatch = line.match(/completed:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                if (completedMatch) {\n                  const kycDate = parseDate(completedMatch[1]);\n                  if (kycDate) {\n                    const monthKey = `${kycDate.getFullYear()}-${String(kycDate.getMonth() + 1).padStart(2, '0')}`;\n                    kycMonthly[monthKey] = (kycMonthly[monthKey] || 0) + 1;\n                  }\n                }\n              }\n\n              // Extract task name and assignee for attention items\n              const taskNameMatch = line.match(/^(.*?)\\s*:\\s*(to do|in progress|done)/i);\n              const assigneeMatch = line.match(/assigned to\\s+([^|]+)/i);\n              const taskName = taskNameMatch ? taskNameMatch[1].trim() : 'Unknown';\n              const assignee = assigneeMatch ? assigneeMatch[1].trim() : '';\n\n              // Check deadlines (support both formats)\n              const deadlineMatch = line.match(/deadline:\\s*(\\d{4}-\\d{2}-\\d{2}|\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n              if (deadlineMatch && !lower.includes(': done')) {\n                const deadline = parseDate(deadlineMatch[1]);\n                if (deadline) {\n                  const daysUntil = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));\n                  if (deadline < today) {\n                    overdueItems.push({\n                      company,\n                      task: taskName,\n                      assignee,\n                      detail: `${Math.abs(daysUntil)}d overdue`\n                    });\n                  } else if (deadline <= sevenDaysFromNow) {\n                    upcomingItems.push({\n                      company,\n                      task: taskName,\n                      assignee,\n                      detail: daysUntil === 0 ? 'Today' : `${daysUntil}d left`\n                    });\n                  }\n                }\n              }\n\n              // Check for stale tasks (no status update for 30+ days, not Done)\n              if (!lower.includes(': done')) {\n                // Look for the last action date (initiated, updated, or completed)\n                const initiatedMatch = line.match(/initiated:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                const updatedMatch = line.match(/updated:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                \n                let lastActionDate = null;\n                if (updatedMatch) {\n                  lastActionDate = parseDate(updatedMatch[1]);\n                } else if (initiatedMatch) {\n                  lastActionDate = parseDate(initiatedMatch[1]);\n                }\n                \n                if (lastActionDate && lastActionDate < thirtyDaysAgo) {\n                  const daysSince = Math.ceil((today - lastActionDate) / (1000 * 60 * 60 * 24));\n                  staleItems.push({\n                    company,\n                    task: taskName,\n                    assignee,\n                    detail: `${daysSince}d ago`\n                  });\n                }\n              }\n\n              // Calculate duration for completed tasks\n              if (lower.includes(': done')) {\n                const initiatedMatch = line.match(/initiated:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                const completedMatch = line.match(/completed:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                if (initiatedMatch && completedMatch) {\n                  const initiated = parseDate(initiatedMatch[1]);\n                  const completed = parseDate(completedMatch[1]);\n                  if (initiated && completed) {\n                    const days = Math.ceil((completed - initiated) / (1000 * 60 * 60 * 24));\n                    if (days >= 0 && days < 365) {\n                      totalDuration += days;\n                      durationCount++;\n                    }\n                  }\n                }\n              }\n            });\n          }\n        }\n\n        // Update UI\n        const activeTasks = todoCount + inProgressCount;\n        qs('#statActiveTasks').textContent = activeTasks;\n        qs('#statAvgDuration').textContent = durationCount > 0 ? Math.round(totalDuration / durationCount) : '-';\n\n        // Status bars\n        const totalStatus = todoCount + inProgressCount + doneCount;\n        if (totalStatus > 0) {\n          qs('#barToDo').style.width = (todoCount / totalStatus * 100) + '%';\n          qs('#barInProgress').style.width = (inProgressCount / totalStatus * 100) + '%';\n          qs('#barDone').style.width = (doneCount / totalStatus * 100) + '%';\n        }\n        qs('#countToDo').textContent = todoCount;\n        qs('#countInProgress').textContent = inProgressCount;\n        qs('#countDone').textContent = doneCount;\n\n        // Attention Required section - render counts and task lists\n        // Helper to render attention items and show/hide group\n        const renderAttentionGroup = (items, groupId, listId, countId) => {\n          const group = qs(`#${groupId}`);\n          const container = qs(`#${listId}`);\n          const countEl = qs(`#${countId}`);\n          \n          if (countEl) countEl.textContent = items.length;\n          \n          if (!group || !container) return;\n          \n          if (items.length === 0) {\n            group.classList.remove('has-items');\n            container.innerHTML = '';\n            return;\n          }\n          \n          group.classList.add('has-items');\n          // Format: \"Company: Task to Assignee\" with detail on right\n          container.innerHTML = items.slice(0, 10).map(item => {\n            const assigneePart = item.assignee ? ` <span class=\"to-assignee\">to ${escapeHtml(item.assignee)}</span>` : '';\n            return `<div class=\"attention-item\">\n              <span class=\"task-info\" title=\"${escapeHtml(item.company)}: ${escapeHtml(item.task)}\">${escapeHtml(item.company)}: ${escapeHtml(item.task)}${assigneePart}</span>\n              <span class=\"task-detail\">${escapeHtml(item.detail)}</span>\n            </div>`;\n          }).join('');\n        };\n        \n        // Sort and render each list\n        overdueItems.sort((a, b) => parseInt(b.detail) - parseInt(a.detail)); // Most overdue first\n        upcomingItems.sort((a, b) => parseInt(a.detail) - parseInt(b.detail)); // Soonest first\n        staleItems.sort((a, b) => parseInt(b.detail) - parseInt(a.detail)); // Oldest first\n        \n        renderAttentionGroup(overdueItems, 'overdueGroup', 'overdueList', 'statOverdue');\n        renderAttentionGroup(upcomingItems, 'upcomingGroup', 'upcomingList', 'statUpcoming');\n        renderAttentionGroup(staleItems, 'staleGroup', 'staleList', 'statStale');\n\n        // Monthly Activity Visual Chart\n        const monthlyChart = qs('#monthlyChart');\n        if (monthlyChart) {\n          const sortedMonths = Object.keys(monthlyStats).sort().reverse().slice(0, 6).reverse();\n          const maxTasks = Math.max(...sortedMonths.map(m => monthlyStats[m] || 0), 1);\n          const maxKyc = Math.max(...sortedMonths.map(m => kycMonthly[m] || 0), 1);\n          const maxVal = Math.max(maxTasks, maxKyc);\n          \n          const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n          monthlyChart.innerHTML = sortedMonths.map(month => {\n            const [year, m] = month.split('-');\n            const shortMonth = monthNames[parseInt(m) - 1];\n            const tasks = monthlyStats[month] || 0;\n            const kyc = kycMonthly[month] || 0;\n            const taskHeight = maxVal > 0 ? (tasks / maxVal * 80) : 0;\n            const kycHeight = maxVal > 0 ? (kyc / maxVal * 80) : 0;\n            return `<div class=\"month-bar-group\">\n              <div class=\"month-bars\">\n                <div class=\"month-bar tasks\" style=\"height:${taskHeight}px\">\n                  ${tasks > 0 ? `<span class=\"month-bar-value\">${tasks}</span>` : ''}\n                </div>\n                <div class=\"month-bar kyc\" style=\"height:${kycHeight}px\">\n                  ${kyc > 0 ? `<span class=\"month-bar-value\">${kyc}</span>` : ''}\n                </div>\n              </div>\n              <div class=\"month-bar-label\">${shortMonth}</div>\n            </div>`;\n          }).join('');\n        }\n\n        // Broker Activity Visual Chart - Horizontal Bars like Status Distribution\n        const brokerChart = qs('#brokerChart');\n        if (brokerChart) {\n          const sortedBrokers = Object.entries(brokerStats)\n            .filter(([name]) => name && name !== '(none)' && name.trim() !== '')\n            .sort((a, b) => (b[1].active + b[1].completed) - (a[1].active + a[1].completed));\n          // Find max for scaling (active + completed combined)\n          const maxTasks = Math.max(...sortedBrokers.map(([,s]) => s.active + s.completed), 1);\n          \n          brokerChart.innerHTML = sortedBrokers.map(([name, stats]) => {\n            const activeWidth = maxTasks > 0 ? (stats.active / maxTasks * 100) : 0;\n            const completedWidth = maxTasks > 0 ? (stats.completed / maxTasks * 100) : 0;\n            return `<div class=\"broker-row\">\n              <span class=\"broker-name\" title=\"${escapeHtml(name)}\">${escapeHtml(name)}</span>\n              <div class=\"broker-bar-track\">\n                <div class=\"broker-bar-fill active\" style=\"width:${activeWidth}%\">${stats.active > 0 ? `<span class=\"bar-num\">${stats.active}</span>` : ''}</div>\n                <div class=\"broker-bar-fill completed\" style=\"width:${completedWidth}%\">${stats.completed > 0 ? `<span class=\"bar-num\">${stats.completed}</span>` : ''}</div>\n              </div>\n            </div>`;\n          }).join('');\n        }\n      });\n    } catch (e) {\n      console.error('Error loading statistics:', e);\n    }\n  }\n\n  // Helper to parse various date formats including Excel serial numbers\n  // Fix for timezone-related date parsing bug\n  // When parsing yyyy-MM-dd strings, JavaScript interprets them as UTC midnight.\n  // This can cause day shifts when the local timezone is behind UTC.\n  function parseDate(dateVal) {\n    if (!dateVal) return null;\n    \n    // Check if it's an Excel serial number (numeric value)\n    // Excel dates are days since Jan 1, 1900 (with a bug for 1900 leap year)\n    if (typeof dateVal === 'number' && dateVal > 1 && dateVal < 100000) {\n      // Excel serial date: days since Dec 30, 1899 (accounting for Excel's leap year bug)\n      // Use UTC to avoid timezone issues, then create local date\n      const excelEpoch = Date.UTC(1899, 11, 30); // Dec 30, 1899 in UTC\n      const utcDate = new Date(excelEpoch + dateVal * 24 * 60 * 60 * 1000);\n      // Create a local date with the same year/month/day\n      const result = new Date(utcDate.getUTCFullYear(), utcDate.getUTCMonth(), utcDate.getUTCDate());\n      if (!isNaN(result.getTime()) && result.getFullYear() > 1970) {\n        return result;\n      }\n    }\n    \n    // Try as string\n    const dateStr = String(dateVal).trim();\n    \n    // Handle yyyy-MM-dd format (ISO) - parse directly to avoid timezone issues\n    const isoMatch = dateStr.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (isoMatch) {\n      const year = parseInt(isoMatch[1], 10);\n      const month = parseInt(isoMatch[2], 10) - 1; // 0-indexed\n      const day = parseInt(isoMatch[3], 10);\n      return new Date(year, month, day);\n    }\n    \n    // Try d-MMM-yyyy format (e.g., \"15-Nov-2025\")\n    const match = dateStr.match(/(\\d{1,2})[-\\s]([A-Za-z]{3})[-\\s](\\d{2,4})/);\n    if (match) {\n      const months = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};\n      const day = parseInt(match[1]);\n      const month = months[match[2].toLowerCase()];\n      let year = parseInt(match[3]);\n      if (year < 100) year += 2000;\n      if (month !== undefined) {\n        return new Date(year, month, day);\n      }\n    }\n    \n    // Fallback: try native parsing (but this may have timezone issues)\n    let d = new Date(dateStr);\n    if (!isNaN(d.getTime()) && d.getFullYear() > 1970) return d;\n    \n    return null;\n  }\n\n  // Search functionality\n  const searchInput = qs('#searchInput');\n  const searchInputWrap = qs('#searchInputWrap');\n  const searchBtn = qs('#searchBtn');\n  const searchResults = qs('#searchResults');\n  const searchHint = qs('#searchHint');\n  const searchTabs = qsa('.search-tab');\n  let currentSearchMode = 'active'; // Default to active tasks\n\n  // Update search UI based on mode\n  const loadRowHint = qs('#loadRowHint');\n  \n  function updateSearchUI() {\n    if (!searchHint || !searchInput || !searchInputWrap) return;\n    \n    if (currentSearchMode === 'active') {\n      searchInputWrap.style.display = 'none'; // No input needed\n      if (loadRowHint) loadRowHint.style.display = 'none';\n      searchHint.textContent = ' Showing tasks with status: To Do or In Progress';\n    } else if (currentSearchMode === 'company') {\n      searchInputWrap.style.display = 'flex';\n      if (loadRowHint) loadRowHint.style.display = 'flex';\n      searchInput.placeholder = 'Type company name...';\n      searchInput.type = 'text';\n      searchHint.textContent = '';\n    }\n  }\n\n  // Search tab switching\n  searchTabs.forEach(tab => {\n    tab.addEventListener('click', async () => {\n      searchTabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentSearchMode = tab.getAttribute('data-search');\n      if (searchInput) {\n        searchInput.value = '';\n      }\n      updateSearchUI();\n      \n      // Auto-load active tasks when that tab is selected\n      if (currentSearchMode === 'active') {\n        await performSearch();\n      } else {\n        // Clear results for other modes until user searches\n        if (searchResults) {\n          searchResults.classList.remove('visible');\n          searchResults.innerHTML = '';\n        }\n      }\n    });\n  });\n\n  // Search button click\n  if (searchBtn) {\n    searchBtn.addEventListener('click', async () => {\n      await performSearch();\n    });\n  }\n\n  // Enter key in search input\n  if (searchInput) {\n    searchInput.addEventListener('keypress', async (e) => {\n      if (e.key === 'Enter') {\n        hideAutocomplete();\n        await performSearch();\n      }\n    });\n  }\n\n  // Autocomplete for company search\n  const autocompleteDropdown = qs('#autocompleteDropdown');\n  let companyList = []; // Cache of all companies with row numbers\n  let autocompleteTimeout = null;\n\n  // Load all companies for autocomplete (includes ALL rows, not just unique companies)\n  async function loadCompanyList() {\n    if (companyList.length > 0) return; // Already loaded\n    try {\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n        if (sheet.isNullObject) return;\n\n        // Load columns A (company) and B (task category) to differentiate multiple rows\n        const dataRange = sheet.getRange('A2:B5000');\n        dataRange.load('values');\n        await context.sync();\n\n        const values = dataRange.values || [];\n        companyList = [];\n        for (let i = 0; i < values.length; i++) {\n          const name = values[i][0] ? String(values[i][0]).trim() : '';\n          const category = values[i][1] ? String(values[i][1]).trim() : '';\n          if (name) {\n            companyList.push({ name, category, rowNum: i + 2 });\n          }\n        }\n        // Keep ALL entries - don't remove duplicates so users can see all tasks for a company\n        console.log('Loaded', companyList.length, 'company rows for autocomplete');\n      });\n    } catch (e) {\n      console.error('Failed to load company list:', e);\n    }\n  }\n\n  function showAutocomplete(query) {\n    if (!autocompleteDropdown || !query || currentSearchMode !== 'company') {\n      hideAutocomplete();\n      return;\n    }\n    const q = query.toLowerCase();\n    \n    // Filter matches and sort: companies starting with query first, then contains\n    const allMatches = companyList.filter(c => c.name.toLowerCase().includes(q));\n    const startsWithMatches = allMatches.filter(c => c.name.toLowerCase().startsWith(q));\n    const containsMatches = allMatches.filter(c => !c.name.toLowerCase().startsWith(q));\n    const sortedMatches = [...startsWithMatches, ...containsMatches].slice(0, 15);\n    \n    if (sortedMatches.length === 0) {\n      hideAutocomplete();\n      return;\n    }\n    autocompleteDropdown.innerHTML = sortedMatches.map(c => {\n      const categoryHint = c.category ? `  ${escapeHtml(c.category)}` : '';\n      return `<div class=\"autocomplete-item\" data-row=\"${c.rowNum}\" data-name=\"${escapeHtml(c.name)}\">\n        <span class=\"company-name\">${escapeHtml(c.name)}</span>\n        <span class=\"row-hint\">Row ${c.rowNum}${categoryHint}</span>\n      </div>`;\n    }).join('');\n    autocompleteDropdown.classList.add('visible');\n\n    // Wire click handlers\n    autocompleteDropdown.querySelectorAll('.autocomplete-item').forEach(item => {\n      item.addEventListener('click', async () => {\n        const rowNum = parseInt(item.getAttribute('data-row'), 10);\n        const name = item.getAttribute('data-name');\n        if (searchInput) searchInput.value = name;\n        hideAutocomplete();\n        await selectAndLoadRow(rowNum);\n      });\n    });\n  }\n\n  function hideAutocomplete() {\n    if (autocompleteDropdown) {\n      autocompleteDropdown.classList.remove('visible');\n      autocompleteDropdown.innerHTML = '';\n    }\n  }\n\n  // Wire autocomplete on input\n  if (searchInput) {\n    searchInput.addEventListener('input', (e) => {\n      if (currentSearchMode !== 'company') return;\n      clearTimeout(autocompleteTimeout);\n      const val = e.target.value.trim();\n      if (val.length < 1) {\n        hideAutocomplete();\n        return;\n      }\n      // Debounce to avoid too many updates\n      autocompleteTimeout = setTimeout(() => {\n        showAutocomplete(val);\n      }, 150);\n    });\n\n    searchInput.addEventListener('focus', async () => {\n      if (currentSearchMode === 'company') {\n        await loadCompanyList();\n        if (searchInput.value.trim().length >= 1) {\n          showAutocomplete(searchInput.value.trim());\n        }\n      }\n    });\n\n    searchInput.addEventListener('blur', () => {\n      // Delay hide to allow click on dropdown\n      setTimeout(hideAutocomplete, 200);\n    });\n  }\n\n  // Initialize search UI on load\n  updateSearchUI();\n\n  async function performSearch() {\n    if (!searchResults) return;\n    \n    searchResults.innerHTML = '<div class=\"no-results\">Searching...</div>';\n    searchResults.classList.add('visible');\n    console.log('Search started, mode:', currentSearchMode);\n\n    try {\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n        console.log('Sheet found:', !sheet.isNullObject);\n        if (sheet.isNullObject) {\n          searchResults.innerHTML = '<div class=\"no-results\">Sheet not found</div>';\n          return;\n        }\n\n        // Read a fixed block of rows to avoid issues with usedRange returning too small an area.\n        const maxRows = 5000;\n        const dataRange = sheet.getRange(`A1:K${maxRows}`);\n        dataRange.load('values');\n        await context.sync();\n\n        const rawValues = dataRange.values || [];\n        console.log('Raw rows loaded (including header and blanks):', rawValues.length);\n\n        const values = Array.isArray(rawValues) ? rawValues : [];\n        const results = [];\n        let scannedRows = 0;\n\n        for (let i = 1; i < values.length; i++) { // Skip header row\n          const row = values[i] || [];\n          const isEmpty = row.every(c => c === null || c === '');\n          if (isEmpty) continue;\n          scannedRows++;\n          const companyName = row[0] ? String(row[0]).trim() : '';\n          const taskCategory = row[1] ? String(row[1]).trim() : '';\n          const taskSummary = row[7] ? String(row[7]).trim() : ''; // Column H\n\n          // Determine status and dates from Column H\n          let hasActiveTasks = false;\n          let dominantStatus = 'unknown';\n          let hasTodo = false, hasProgress = false, hasDone = false;\n          let todoDates = [];\n          let progressDates = [];\n          let doneDates = [];\n\n          if (taskSummary) {\n            const lines = taskSummary.split(/\\r?\\n/).filter(Boolean);\n            lines.forEach(line => {\n              const parsed = parseTaskLine(line);\n              if (!parsed) return;\n              const st = (parsed.status || '').toLowerCase();\n              if (st === 'to do') {\n                hasTodo = true;\n                if (parsed.initiated) todoDates.push(parsed.initiated);\n              } else if (st === 'in progress') {\n                hasProgress = true;\n                if (parsed.updated) progressDates.push(parsed.updated);\n              } else if (st === 'done') {\n                hasDone = true;\n                if (parsed.completed) doneDates.push(parsed.completed);\n              }\n            });\n            hasActiveTasks = hasTodo || hasProgress;\n            if (hasProgress) dominantStatus = 'progress';\n            else if (hasTodo) dominantStatus = 'todo';\n            else if (hasDone) dominantStatus = 'done';\n          }\n\n          // Choose a status-specific date to display\n          function mostRecentDate(dateArr) {\n            if (!dateArr || dateArr.length === 0) return '';\n            let best = null;\n            dateArr.forEach(dStr => {\n              if (!dStr) return;\n              const d = new Date(dStr);\n              if (isNaN(d.getTime())) return;\n              if (!best || d > best) best = d;\n            });\n            if (!best) return '';\n            const yyyy = best.getFullYear();\n            const mm = String(best.getMonth() + 1).padStart(2,'0');\n            const dd = String(best.getDate()).padStart(2,'0');\n            return `${yyyy}-${mm}-${dd}`; // normalized for display formatter\n          }\n\n          let statusDateLabel = '';\n          let statusDateRaw = '';\n          if (dominantStatus === 'progress') {\n            statusDateRaw = mostRecentDate(progressDates);\n            statusDateLabel = statusDateRaw ? 'Updated' : '';\n          } else if (dominantStatus === 'todo') {\n            statusDateRaw = mostRecentDate(todoDates);\n            statusDateLabel = statusDateRaw ? 'Initiated' : '';\n          } else if (dominantStatus === 'done') {\n            statusDateRaw = mostRecentDate(doneDates);\n            statusDateLabel = statusDateRaw ? 'Completed' : '';\n          }\n\n          const statusDateDisplay = statusDateRaw ? formatDateForDisplay(statusDateRaw) : '';\n\n          const rowNum = i + 1; // 1-based row number\n\n          if (currentSearchMode === 'company') {\n            const query = (searchInput ? searchInput.value : '').toLowerCase().trim();\n            console.log('Checking row', rowNum, '- Company:', companyName, '- Query:', query);\n            if (query && companyName.toLowerCase().includes(query)) {\n              console.log('Match found:', companyName);\n              results.push({ rowNum, companyName, taskCategory, dominantStatus, hasActiveTasks, statusDateLabel, statusDateDisplay });\n            }\n          } else if (currentSearchMode === 'active') {\n            console.log('Checking row', rowNum, '- Company:', companyName, '- Active:', hasActiveTasks);\n            if (hasActiveTasks) {\n              results.push({ rowNum, companyName, taskCategory, dominantStatus, hasActiveTasks, statusDateLabel, statusDateDisplay });\n            }\n          }\n        }\n\n        const totalRows = scannedRows;\n        const modeLabel = currentSearchMode === 'company' ? 'Company' : 'Active tasks';\n        const rawQuery = (searchInput ? searchInput.value : '').trim();\n        console.log('Search complete, mode:', modeLabel, 'rows scanned:', totalRows, 'matches:', results.length, 'query:', rawQuery);\n        if (results.length === 0) {\n          searchResults.innerHTML = '<div class=\"no-results\">No results found</div>';\n        } else {\n          searchResults.innerHTML = results.map(r => {\n            const statusBadge = r.dominantStatus === 'progress' \n              ? '<span class=\"status-badge progress\">In Progress</span>'\n              : r.dominantStatus === 'todo'\n              ? '<span class=\"status-badge todo\">To Do</span>'\n              : r.dominantStatus === 'done'\n              ? '<span class=\"status-badge done\">Done</span>'\n              : '';\n\n            const datePart = (r.statusDateLabel && r.statusDateDisplay)\n              ? `  ${r.statusDateLabel} ${escapeHtml(r.statusDateDisplay)}`\n              : '';\n\n            return `<div class=\"search-result-item\" data-row=\"${r.rowNum}\">\n              <div class=\"company\">${escapeHtml(r.companyName || '(No name)')}${statusBadge}</div>\n              <div class=\"meta\">Row ${r.rowNum}  ${escapeHtml(r.taskCategory || 'No category')}${datePart}</div>\n            </div>`;\n          }).join('');\n\n          // Wire click handlers\n          searchResults.querySelectorAll('.search-result-item').forEach(item => {\n            item.addEventListener('click', async () => {\n              const rowNum = parseInt(item.getAttribute('data-row'), 10);\n              await selectAndLoadRow(rowNum);\n              searchResults.classList.remove('visible');\n            });\n          });\n        }\n      });\n    } catch (e) {\n      console.error('Search error:', e);\n      searchResults.innerHTML = '<div class=\"no-results\">Search error</div>';\n    }\n  }\n\n  async function selectAndLoadRow(rowNum) {\n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return;\n\n      const targetRange = sheet.getRange(`A${rowNum}`);\n      targetRange.select();\n      await context.sync();\n    });\n    await loadFromActiveRow();\n  }\n\n  // Find Last KYC Produced date for a company\n  async function findLastKycDate(companyName) {\n    if (!companyName) return null;\n    \n    return Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return null;\n\n      const usedRange = sheet.getUsedRange();\n      usedRange.load('values');\n      await context.sync();\n\n      const values = usedRange.values || [];\n      let lastKycDate = null;\n\n      for (let i = 1; i < values.length; i++) {\n        const row = values[i];\n        const rowCompany = row[0] ? String(row[0]).trim().toLowerCase() : '';\n        const taskSummary = row[7] ? String(row[7]).trim() : ''; // Column H\n\n        if (rowCompany === companyName.toLowerCase() && taskSummary) {\n          // Look for KYC task with Done status\n          const lines = taskSummary.split(/\\r?\\n/).filter(Boolean);\n          lines.forEach(line => {\n            const lower = line.toLowerCase();\n            if ((lower.includes('kyc') && lower.includes(': done'))) {\n              // Try to extract completed date\n              const completedMatch = line.match(/completed:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n              if (completedMatch) {\n                lastKycDate = completedMatch[1];\n              }\n            }\n          });\n        }\n      }\n      return lastKycDate;\n    });\n  }\n\n  // Format date as d-MMM-yyyy (e.g., 1-Jul-2025)\n  // Fix for timezone-related date shift bug\n  // When parsing yyyy-MM-dd strings, JavaScript interprets them as UTC midnight.\n  // This can cause day shifts when converting back to local time.\n  function formatDateForDisplay(dateStr) {\n    if (!dateStr) return '';\n    \n    // Handle yyyy-MM-dd format specially to avoid timezone issues\n    const ymdMatch = String(dateStr).match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (ymdMatch) {\n      // Parse components directly to avoid UTC interpretation\n      const year = parseInt(ymdMatch[1], 10);\n      const month = parseInt(ymdMatch[2], 10) - 1; // 0-indexed\n      const day = parseInt(ymdMatch[3], 10);\n      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n      return `${day}-${months[month]}-${year}`;\n    }\n    \n    // For other formats, use Date parsing\n    const d = new Date(dateStr);\n    if (isNaN(d.getTime())) return '';\n    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    const day = d.getDate();\n    const month = months[d.getMonth()];\n    const year = d.getFullYear();\n    return `${day}-${month}-${year}`;\n  }\n  \n  // Alias for Excel output (same format)\n  const formatDateForExcel = formatDateForDisplay;\n\n  // Get selected task categories\n  function getSelectedCategories() {\n    return qsa('#taskCategories .category-toggle:checked').map(cb => cb.value);\n  }\n\n  // Check if \"Other Task\" is selected\n  function isOtherTaskSelected() {\n    const cb = qs('#taskCategories .category-toggle[value=\"Other Task\"]');\n    return cb && cb.checked;\n  }\n\n  function getTaskCard(taskName){\n    // __other__ card is now outside #taskCards\n    if (taskName === '__other__') {\n      return qs('#otherTaskCard');\n    }\n    return taskCardsContainer ? taskCardsContainer.querySelector(`.task-card[data-task=\"${taskName}\"]`) : null;\n  }\n\n  function getTaskStatusChips(card){\n    if (!card) return [];\n    const container = card.querySelector('[data-role=\"status-chips\"]');\n    return container ? Array.from(container.querySelectorAll('.chip')) : [];\n  }\n\n  function setCardStatus(card, val){\n    const chips = getTaskStatusChips(card);\n    chips.forEach(c=>{\n      c.classList.toggle('active', c.getAttribute('data-value')===val);\n    });\n  }\n\n  function getCardStatus(card){\n    const chips = getTaskStatusChips(card);\n    const active = chips.find(c=>c.classList.contains('active'));\n    return active ? active.getAttribute('data-value') : 'To Do';\n  }\n\n  function wireCardChips(){\n    // Wire chips in #taskCards and #otherTaskCard\n    qsa('#taskCards [data-role=\"status-chips\"] .chip, #otherTaskCard [data-role=\"status-chips\"] .chip').forEach(chip => {\n      chip.addEventListener('click', () => {\n        const container = chip.closest('[data-role=\"status-chips\"]');\n        if (!container) return;\n        const siblings = Array.from(container.querySelectorAll('.chip'));\n        siblings.forEach(c=>{\n          c.classList.toggle('active', c === chip);\n        });\n      });\n    });\n  }\n\n  function syncTasksVisibility(){\n    if (!tasksRowEl || !taskCardsContainer) return;\n    const isOther = isOtherTaskSelected();\n    const otherCard = qs('#otherTaskCard'); // Now outside #taskCards\n    const selectedCategories = getSelectedCategories();\n    const hasNonOtherCategory = selectedCategories.some(c => c !== 'Other Task');\n\n    // Show tasks section if any non-\"Other Task\" category is selected\n    if (hasNonOtherCategory) {\n      tasksRowEl.style.display = '';\n    } else {\n      tasksRowEl.style.display = 'none';\n    }\n\n    // Show/hide fixed task cards based on task toggles\n    const selected = new Set(getSelectedTaskToggles());\n    const fixedCards = qsa('#taskCards .task-card');\n    fixedCards.forEach(card => {\n      const name = card.getAttribute('data-task');\n      card.style.display = selected.has(name) ? '' : 'none';\n    });\n\n    // Show __other__ card if \"Other Task\" category is selected\n    if (otherCard) {\n      otherCard.style.display = isOther ? '' : 'none';\n    }\n  }\n\n  // Update Extra Note placeholder based on selected categories\n  function updateExtraNotePlaceholder() {\n    if (!extraNoteEl) return;\n    const categories = getSelectedCategories().filter(c => c !== 'Other Task');\n    if (categories.length === 0) {\n      extraNoteEl.placeholder = 'General note about this task';\n    } else if (categories.length === 1) {\n      extraNoteEl.placeholder = 'General note about this ' + categories[0];\n    } else {\n      extraNoteEl.placeholder = 'General note about these tasks';\n    }\n  }\n\n  // Wire category checkboxes to update visibility and placeholder\n  qsa('#taskCategories .category-toggle').forEach(cb => {\n    cb.addEventListener('change', () => {\n      syncTasksVisibility();\n      updateExtraNotePlaceholder();\n    });\n  });\n\n  function getSelectedTaskToggles(){\n    return qsa('#tasksChecklist .task-toggle:checked').map(cb => cb.value);\n  }\n\n  // Reorder checkboxes so checked ones appear at the top\n  function reorderCheckboxesToTop(containerSelector) {\n    const container = qs(containerSelector);\n    if (!container) return;\n    \n    // Get all items - could be direct children (div wrappers) or labels\n    const items = Array.from(container.children);\n    if (items.length === 0) return;\n    \n    // Sort: checked items first, then unchecked (maintain original order within each group)\n    const checked = [];\n    const unchecked = [];\n    items.forEach(item => {\n      const cb = item.querySelector('input[type=checkbox]') || item.querySelector('input[type=\"checkbox\"]');\n      if (cb && cb.checked) {\n        checked.push(item);\n      } else {\n        unchecked.push(item);\n      }\n    });\n    \n    // Re-append in sorted order: checked first, then unchecked\n    [...checked, ...unchecked].forEach(item => container.appendChild(item));\n  }\n\n  async function loadTeamMembers(){\n    if (teamMembersLoaded) return;\n    teamMembersLoaded = true; // guard immediately to avoid overlapping calls\n    const box = qs('#assignees');\n    if (!box) return;\n    // Additional DOM-level guard in case the script is evaluated more than once\n    if (box.dataset.initialized === '1') {\n      return;\n    }\n    box.dataset.initialized = '1';\n    box.innerHTML='';\n\n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('Team members');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) {\n        console.error('Team members sheet not found');\n        return;\n      }\n\n      // Read column A only for team member names\n      const usedRange = sheet.getUsedRange();\n      usedRange.load('values');\n      await context.sync();\n\n      const values = usedRange.values || [];\n      const namesRaw = values.slice(1) // skip header row\n        .map(row => row[0])\n        .filter(n => n && String(n).trim().length > 0)\n        .map(n => String(n).trim());\n\n      const names = Array.from(new Set(namesRaw)); // dedupe\n      console.log('Team members loaded from column A:', names); // Debug log\n\n      names.forEach(n => {\n        const w = document.createElement('div');\n        w.innerHTML = `<label><input type=\"checkbox\" value=\"${n}\"> ${n}</label>`;\n        box.appendChild(w);\n      });\n\n      if (brokerLeadEl) {\n        brokerLeadEl.innerHTML = '';\n        const noneOpt = document.createElement('option');\n        noneOpt.value = '';\n        noneOpt.textContent = '(none)';\n        brokerLeadEl.appendChild(noneOpt);\n        names.forEach(n => {\n          const opt = document.createElement('option');\n          opt.value = n;\n          opt.textContent = n;\n          brokerLeadEl.appendChild(opt);\n        });\n      }\n    });\n  }\n\n  function getSelectedAssignees(){\n    return Array.from(document.querySelectorAll('#assignees input[type=checkbox]:checked')).map(i=>i.value);\n  }\n\n  // Populate per-task assignee dropdowns with selected assignees\n  function updateTaskAssigneeDropdowns() {\n    const selectedAssignees = getSelectedAssignees();\n    const dropdowns = qsa('.task-assignee-select');\n    \n    dropdowns.forEach(dropdown => {\n      const currentValue = dropdown.value;\n      dropdown.innerHTML = '';\n      \n      // Add empty option\n      const emptyOpt = document.createElement('option');\n      emptyOpt.value = '';\n      emptyOpt.textContent = '(Select assignee)';\n      dropdown.appendChild(emptyOpt);\n      \n      // Add selected assignees as options\n      selectedAssignees.forEach(name => {\n        const opt = document.createElement('option');\n        opt.value = name;\n        opt.textContent = name;\n        dropdown.appendChild(opt);\n      });\n      \n      // Auto-select if only one assignee\n      if (selectedAssignees.length === 1) {\n        dropdown.value = selectedAssignees[0];\n      } else if (selectedAssignees.includes(currentValue)) {\n        // Restore previous selection if still valid\n        dropdown.value = currentValue;\n      }\n    });\n  }\n\n  // Wire assignee checkboxes to update per-task dropdowns\n  document.querySelectorAll('#assignees').forEach(container => {\n    container.addEventListener('change', (e) => {\n      if (e.target.type === 'checkbox') {\n        updateTaskAssigneeDropdowns();\n      }\n    });\n  });\n\n  async function getActiveRowIndex(){\n    return Excel.run(async (context) => {\n      // Use the currently selected range in the workbook\n      const range = context.workbook.getSelectedRange();\n      range.load('rowIndex');\n      await context.sync();\n      // rowIndex is 0-based; UI shows 1-based row numbers\n      return range.rowIndex + 1;\n    });\n  }\n\n  function parseTaskLine(raw){\n    // More flexible parsing that handles fields in any order\n    if (!raw) return null;\n    \n    // First, check basic structure: \"TaskName: Status || Assigned to ...\"\n    const basicMatch = /^(.*?)\\s*:\\s*(to do|in progress|done)\\s*\\|\\|\\s*assigned to\\s+([^|]+)/i.exec(raw);\n    if (!basicMatch) return null;\n    \n    const result = {\n      name: basicMatch[1].trim(),\n      status: basicMatch[2],\n      assignee: basicMatch[3].trim(),\n      comment: '',\n      giveUpId: '',\n      initiated: '',\n      updated: '',\n      completed: '',\n      deadline: ''\n    };\n    \n    // Extract optional fields in any order\n    const commentMatch = /\\|\\|\\s*comment:\\s*([^|]+)/i.exec(raw);\n    if (commentMatch) result.comment = commentMatch[1].trim();\n    \n    const giveUpMatch = /\\|\\|\\s*give-up id:\\s*([^|]+)/i.exec(raw);\n    if (giveUpMatch) result.giveUpId = giveUpMatch[1].trim();\n    \n    const initiatedMatch = /\\|\\|\\s*task initiated:\\s*([^|]+)/i.exec(raw);\n    if (initiatedMatch) result.initiated = initiatedMatch[1].trim();\n    \n    const updatedMatch = /\\|\\|\\s*status updated:\\s*([^|]+)/i.exec(raw);\n    if (updatedMatch) result.updated = updatedMatch[1].trim();\n    \n    const completedMatch = /\\|\\|\\s*completed:\\s*([^|]+)/i.exec(raw);\n    if (completedMatch) result.completed = completedMatch[1].trim();\n    \n    const deadlineMatch = /\\|\\|\\s*deadline:\\s*([^|]+)/i.exec(raw);\n    if (deadlineMatch) result.deadline = deadlineMatch[1].trim();\n    \n    return result;\n  }\n\n  function buildSummaryLine(v){\n    const parts = [];\n    const status = v.status || 'To Do';\n    // First segment must match parseTaskLine: \"<TaskName>: <Status>\"\n    parts.push(`${v.name}: ${status}`);\n    parts.push(`Assigned to ${v.assignees}`);\n    if (v.comment) parts.push(`Comment: ${v.comment}`);\n    if (v.giveUpId) parts.push(`Give-up ID: ${v.giveUpId}`);\n    // Only one date field will be set based on status (last action)\n    if (v.initiated) parts.push(`Task initiated: ${v.initiated}`);\n    if (v.updated) parts.push(`Status updated: ${v.updated}`);\n    if (v.completed) parts.push(`Completed: ${v.completed}`);\n    if (v.deadline) parts.push(`Deadline: ${v.deadline}`);\n    return parts.join(' || ');\n  }\n\n  async function loadFromActiveRow(){\n    await loadTeamMembers();\n    await Excel.run(async (context) => {\n      // Get active row within the same context to avoid sync issues\n      const selectedRange = context.workbook.getSelectedRange();\n      selectedRange.load('rowIndex');\n      await context.sync();\n      const uiRow = selectedRange.rowIndex + 1;\n\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return;\n\n      // Load row-level metadata and Column H, J, K in one go\n      const companyRange = sheet.getRange(`A${uiRow}`);\n      const descRange = sheet.getRange(`B${uiRow}`);\n      const assigneesRange = sheet.getRange(`C${uiRow}`);\n      const brokerRange = sheet.getRange(`D${uiRow}`);\n      const datesRange = sheet.getRange(`E${uiRow}:G${uiRow}`);\n      const hRange = sheet.getRange(`H${uiRow}`);\n      const jRange = sheet.getRange(`J${uiRow}`);\n      const kRange = sheet.getRange(`K${uiRow}`);\n      companyRange.load('values');\n      descRange.load('values');\n      assigneesRange.load('values');\n      brokerRange.load('values');\n      datesRange.load('values');\n      hRange.load('values');\n      jRange.load('values');\n      kRange.load('values');\n      await context.sync();\n\n      // Company name from column A\n      const companyVal = (companyRange.values && companyRange.values[0] && companyRange.values[0][0])\n        ? String(companyRange.values[0][0])\n        : '';\n      if (companyNameInput) companyNameInput.value = companyVal;\n\n      const descVal = (descRange.values && descRange.values[0] && descRange.values[0][0])\n        ? String(descRange.values[0][0])\n        : '';\n      // Parse comma-separated categories and check the corresponding checkboxes\n      const categories = descVal.split(',').map(s => s.trim()).filter(Boolean);\n      const allowedDescs = ['Onboarding', 'Amended Product/Rate', 'KYC update', 'Other Task'];\n      qsa('#taskCategories .category-toggle').forEach(cb => {\n        const match = categories.some(cat => cat.toLowerCase() === cb.value.toLowerCase());\n        cb.checked = match;\n      });\n\n      const brokerVal = (brokerRange.values && brokerRange.values[0] && brokerRange.values[0][0])\n        ? String(brokerRange.values[0][0])\n        : '';\n\n      if (brokerLeadEl) {\n        brokerLeadEl.value = brokerVal;\n      }\n\n      // Assignees from column C\n      const assigneesVal = (assigneesRange.values && assigneesRange.values[0] && assigneesRange.values[0][0])\n        ? String(assigneesRange.values[0][0])\n        : '';\n      const assigneesList = assigneesVal.split(/[,;]+/).map(s => s.trim().toLowerCase()).filter(Boolean);\n      console.log('Assignees from column C:', assigneesList);\n      document.querySelectorAll('#assignees input[type=checkbox]').forEach(cb => {\n        cb.checked = assigneesList.includes(cb.value.toLowerCase());\n      });\n\n      const datesRow = (datesRange.values && datesRange.values[0]) ? datesRange.values[0] : [null, null, null];\n\n      // Fix for timezone-related date shift bug in toInputDate\n      // When parsing yyyy-MM-dd strings, JavaScript interprets them as UTC midnight.\n      // This can cause day shifts when converting back to local time.\n      function toInputDate(v){\n        if (v == null || v === '') return '';\n        \n        // Excel serial number (days since 1900-01-01, with Excel's leap year bug)\n        if (typeof v === 'number') {\n          // Excel serial date: 1 = Jan 1, 1900\n          // Use UTC to avoid timezone issues\n          const excelEpoch = Date.UTC(1899, 11, 30); // Dec 30, 1899 (Excel's day 0) in UTC\n          const d = new Date(excelEpoch + v * 86400000);\n          const yyyy = d.getUTCFullYear();\n          const mm = String(d.getUTCMonth() + 1).padStart(2,'0');\n          const dd = String(d.getUTCDate()).padStart(2,'0');\n          return `${yyyy}-${mm}-${dd}`;\n        }\n        \n        // Excel usually returns Date objects for date cells\n        if (v instanceof Date) {\n          const yyyy = v.getFullYear();\n          const mm = String(v.getMonth() + 1).padStart(2,'0');\n          const dd = String(v.getDate()).padStart(2,'0');\n          return `${yyyy}-${mm}-${dd}`;\n        }\n        \n        const s = String(v).trim();\n        \n        // Handle yyyy-MM-dd format (ISO) - parse directly to avoid timezone issues\n        const ymdMatch = s.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n        if (ymdMatch) {\n          return s; // Already in correct format, return as-is\n        }\n        \n        // Handle d-MMM-yyyy format (e.g., \"1-Jul-2025\")\n        const dmmyMatch = s.match(/^(\\d{1,2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\\d{4})$/i);\n        if (dmmyMatch) {\n          const months = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};\n          const day = parseInt(dmmyMatch[1], 10);\n          const mon = months[dmmyMatch[2].toLowerCase()];\n          const year = parseInt(dmmyMatch[3], 10);\n          const dd = String(day).padStart(2,'0');\n          const mm = String(mon + 1).padStart(2,'0');\n          return `${year}-${mm}-${dd}`;\n        }\n        \n        // Try to parse strings / other values as dates\n        // But be careful with timezone issues\n        const d = new Date(v);\n        if (!isNaN(d.getTime())) {\n          const yyyy = d.getFullYear();\n          const mm = String(d.getMonth() + 1).padStart(2,'0');\n          const dd = String(d.getDate()).padStart(2,'0');\n          return `${yyyy}-${mm}-${dd}`;\n        }\n        \n        // Fallback: attempt to slice a yyyy-MM-dd looking prefix\n        return s.length >= 10 ? s.slice(0,10) : '';\n      }\n\n      console.log('Date values from Excel:', datesRow); // Debug log\n      if (initialRequestInput) initialRequestInput.value = toInputDate(datesRow[0]);\n      if (introEmailInput) introEmailInput.value = toInputDate(datesRow[1]);\n      if (remindersStartInput) remindersStartInput.value = toInputDate(datesRow[2]);\n      console.log('Parsed dates:', initialRequestInput?.value, introEmailInput?.value, remindersStartInput?.value); // Debug log\n\n      // Email Frequency from column J\n      const freqVal = (jRange.values && jRange.values[0] && jRange.values[0][0])\n        ? String(jRange.values[0][0])\n        : '';\n      if (emailFrequencyEl) emailFrequencyEl.value = freqVal;\n\n      // Extra Note from column K\n      const noteVal = (kRange.values && kRange.values[0] && kRange.values[0][0])\n        ? String(kRange.values[0][0])\n        : '';\n      if (extraNoteEl) extraNoteEl.value = noteVal;\n\n      const summary = (hRange.values && hRange.values[0] && hRange.values[0][0])\n        ? String(hRange.values[0][0])\n        : '';\n\n      // Parse all task lines in H\n      const lines = summary\n        .split(/\\r?\\n/)\n        .map(s => s.trim())\n        .filter(Boolean);\n      const parsedTasks = [];\n      const nonTaskLines = [];\n      for (let i = 0; i < lines.length; i++) {\n        const cand = parseTaskLine(lines[i]);\n        if (cand) {\n          parsedTasks.push(cand);\n        } else {\n          nonTaskLines.push(lines[i]);\n        }\n      }\n\n      // Sort tasks by status priority: To Do > In Progress > Done\n      const statusPriority = { 'to do': 1, 'in progress': 2, 'done': 3 };\n      parsedTasks.sort((a, b) => {\n        const aPriority = statusPriority[(a.status || '').toLowerCase()] || 4;\n        const bPriority = statusPriority[(b.status || '').toLowerCase()] || 4;\n        return aPriority - bPriority;\n      });\n\n      // Note: Assignees are already loaded from Column C (lines 1297-1305)\n      // Column C contains ALL assignees including \"passive\" ones not assigned to specific tasks\n      // We don't overwrite here - the checkboxes are already correctly set from Column C\n      console.log('Parsed tasks:', parsedTasks); // Debug log\n\n      // Update per-task assignee dropdowns with selected assignees\n      updateTaskAssigneeDropdowns();\n\n      // Reset all cards and task selections\n      qsa('#tasksChecklist .task-toggle').forEach(cb => { cb.checked = false; });\n      qsa('#taskCards .task-card, #otherTaskCard').forEach(card => {\n        const statusChips = getTaskStatusChips(card);\n        statusChips.forEach(c => c.classList.remove('active'));\n        const commentEl = card.querySelector('[data-role=\"comment\"]');\n        const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n        const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n        const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n        if (commentEl) commentEl.value = '';\n        if (deadlineEl) deadlineEl.value = '';\n        if (giveUpIdEl) giveUpIdEl.value = '';\n        if (taskAssigneeEl) taskAssigneeEl.value = '';\n      });\n\n      const isOther = isOtherTaskSelected();\n      if (isOther) {\n        // Use __other__ card with first parsed task if present\n        const otherCard = getTaskCard('__other__');\n        if (otherCard) {\n          const t = parsedTasks[0] || null;\n          if (taskNameInput) taskNameInput.value = t && t.name ? t.name : '';\n          if (t) {\n            const sNorm = (t.status || '').toLowerCase();\n            const displayStatus = sNorm === 'in progress' ? 'In Progress'\n              : sNorm === 'done' ? 'Done'\n              : 'To Do';\n            setCardStatus(otherCard, displayStatus);\n            const commentEl = otherCard.querySelector('[data-role=\"comment\"]');\n            const deadlineEl = otherCard.querySelector('[data-role=\"deadline\"]');\n            const taskAssigneeEl = otherCard.querySelector('[data-role=\"task-assignee\"]');\n            if (commentEl) commentEl.value = t.comment || '';\n            if (deadlineEl) deadlineEl.value = (t.deadline || '').slice(0,10);\n            // Set per-task assignee from parsed task\n            if (taskAssigneeEl && t.assignee) {\n              taskAssigneeEl.value = t.assignee.trim();\n            }\n          }\n        }\n      } else {\n        // Fixed tasks: tick checkboxes and populate corresponding cards\n        const toggles = qsa('#tasksChecklist .task-toggle');\n        toggles.forEach(cb => {\n          const name = cb.value;\n          // Map legacy \"KYC (Internal)\" to \"KYC (produced by LCMC)\"\n          const t = parsedTasks.find(pt => {\n            const ptName = (pt.name || '').toLowerCase();\n            const cbName = name.toLowerCase();\n            if (ptName === cbName) return true;\n            // Legacy mapping\n            if (cbName === 'kyc (produced by lcmc)' && ptName === 'kyc (internal)') return true;\n            return false;\n          });\n          cb.checked = !!t;\n          const card = getTaskCard(name);\n          if (card && t) {\n            const sNorm = (t.status || '').toLowerCase();\n            const displayStatus = sNorm === 'in progress' ? 'In Progress'\n              : sNorm === 'done' ? 'Done'\n              : 'To Do';\n            setCardStatus(card, displayStatus);\n            const commentEl = card.querySelector('[data-role=\"comment\"]');\n            const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n            const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n            const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n            if (commentEl) commentEl.value = t.comment || '';\n            if (deadlineEl) deadlineEl.value = (t.deadline || '').slice(0,10);\n            if (giveUpIdEl) giveUpIdEl.value = t.giveUpId || '';\n            // Set per-task assignee from parsed task\n            if (taskAssigneeEl && t.assignee) {\n              taskAssigneeEl.value = t.assignee.trim();\n            }\n          }\n        });\n      }\n\n      // Audit info from the most recently completed/updated task if available\n      if (auditTextEl) {\n        let chosenAudit = null;\n        if (parsedTasks.length > 0) {\n          chosenAudit = parsedTasks[0];\n        }\n        if (chosenAudit) {\n          const parts = [];\n          if (chosenAudit.initiated) parts.push(`Task initiated: ${chosenAudit.initiated}`);\n          if (chosenAudit.updated) parts.push(`Status updated: ${chosenAudit.updated}`);\n          if (chosenAudit.completed) parts.push(`Completed: ${chosenAudit.completed}`);\n          auditTextEl.textContent = parts.join(' | ');\n        } else {\n          auditTextEl.textContent = '';\n        }\n      }\n\n      // Update Last KYC Produced date\n      const lastKycEl = qs('#lastKycDate');\n      if (lastKycEl && companyVal) {\n        // Look for KYC Done status in current row's tasks\n        let kycCompletedDate = null;\n        parsedTasks.forEach(t => {\n          if (t.name && t.name.toLowerCase().includes('kyc') && \n              t.status && t.status.toLowerCase() === 'done' && t.completed) {\n            kycCompletedDate = t.completed;\n          }\n        });\n        if (kycCompletedDate) {\n          lastKycEl.textContent = kycCompletedDate;\n        } else {\n          // Search all rows for this company's last KYC\n          findLastKycDate(companyVal).then(date => {\n            lastKycEl.textContent = date || '';\n          });\n        }\n      } else if (lastKycEl) {\n        lastKycEl.textContent = '';\n      }\n\n      syncTasksVisibility();\n      updateDateDisplays();\n      updateExtraNotePlaceholder();\n      \n      // Reorder checked items to top\n      reorderCheckboxesToTop('#assignees');\n      reorderCheckboxesToTop('#tasksChecklist');\n      reorderCheckboxesToTop('#taskCategories');\n\n      // Track current row number for save logic\n      currentRowNum = uiRow;\n\n      // Apply deadline warnings to task cards\n      applyDeadlineWarnings();\n\n      // Update email summary button state\n      updateEmailSummaryButton();\n\n      // Close email summary section when switching rows\n      if (emailSummarySection) {\n        emailSummarySection.classList.remove('visible');\n      }\n    });\n  }\n\n  async function saveToActiveRow(){\n    const descVal = getSelectedCategories().join(', ');\n    const assignees = getSelectedAssignees().join(', ');\n    const isOther = isOtherTaskSelected();\n    console.log('Saving - Categories:', descVal, 'Assignees:', assignees, 'IsOther:', isOther);\n    await Excel.run(async (context) => {\n      // Get active row within the same context to avoid sync issues\n      const selectedRange = context.workbook.getSelectedRange();\n      selectedRange.load('rowIndex');\n      await context.sync();\n      const uiRow = selectedRange.rowIndex + 1;\n\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return;\n\n      // Persist row-level dates (E-G)\n      const datesRange = sheet.getRange(`E${uiRow}:G${uiRow}`);\n      datesRange.load('values');\n\n      // Persist company name (A), task category (B), assignees (C), broker lead (D)\n      const companyRange = sheet.getRange(`A${uiRow}`);\n      const descRange = sheet.getRange(`B${uiRow}`);\n      const assigneesRange = sheet.getRange(`C${uiRow}`);\n      const brokerRange = sheet.getRange(`D${uiRow}`);\n\n      const hRange = sheet.getRange(`H${uiRow}`);\n      const jRange = sheet.getRange(`J${uiRow}`);\n      const kRange = sheet.getRange(`K${uiRow}`);\n      hRange.load('values');\n      await context.sync();\n\n      const datesRow = (datesRange.values && datesRange.values[0]) ? datesRange.values[0] : [null,null,null];\n\n      // Format dates as d-MMM-yyyy for Excel display\n      if (initialRequestInput) datesRow[0] = formatDateForExcel(initialRequestInput.value);\n      if (introEmailInput) datesRow[1] = formatDateForExcel(introEmailInput.value);\n      if (remindersStartInput) datesRow[2] = formatDateForExcel(remindersStartInput.value);\n\n      datesRange.values = [datesRow];\n\n      descRange.values = [[descVal]];\n\n      if (brokerLeadEl) {\n        brokerRange.values = [[brokerLeadEl.value || '']];\n      }\n\n      if (companyNameInput) {\n        companyRange.values = [[companyNameInput.value || '']];\n      }\n\n      // Save assignees to Column C\n      assigneesRange.values = [[assignees]];\n      console.log('Saving assignees to column C:', assignees);\n\n      // Save Email Frequency (J) and Extra Note (K)\n      if (emailFrequencyEl) {\n        jRange.values = [[emailFrequencyEl.value || '']];\n      }\n      if (extraNoteEl) {\n        kRange.values = [[extraNoteEl.value || '']];\n      }\n\n      const existing = (hRange.values && hRange.values[0] && hRange.values[0][0])\n        ? String(hRange.values[0][0])\n        : '';\n\n      const lines = existing\n        .split(/\\r?\\n/)\n        .map(s => s.trim())\n        .filter(Boolean);\n\n      const nonTaskLines = lines.filter(l => !parseTaskLine(l));\n      const newTaskLines = [];\n\n      // Parse existing tasks to preserve dates\n      const existingTasks = {};\n      lines.forEach(l => {\n        const parsed = parseTaskLine(l);\n        if (parsed) {\n          existingTasks[parsed.name.toLowerCase()] = parsed;\n        }\n      });\n\n      // Helper to get today's date in d-MMM-yyyy format\n      const getTodayFormatted = () => {\n        const d = new Date();\n        const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n        return `${String(d.getDate()).padStart(2,'0')} ${months[d.getMonth()]} ${String(d.getFullYear()).slice(-2)}`;\n      };\n\n      // Helper to compute dates based on status and existing task\n      // Only show ONE date field based on current status (last action):\n      // - To Do: Task initiated\n      // - In Progress: Status updated\n      // - Done: Completed\n      const computeDates = (name, newStatus, existingTask) => {\n        const today = getTodayFormatted();\n        const oldStatus = existingTask ? (existingTask.status || '').toLowerCase() : '';\n        const newStatusLower = (newStatus || '').toLowerCase();\n        \n        // Preserve existing dates (use empty string if not present)\n        let initiated = (existingTask && existingTask.initiated) ? existingTask.initiated : '';\n        let updated = (existingTask && existingTask.updated) ? existingTask.updated : '';\n        let completed = (existingTask && existingTask.completed) ? existingTask.completed : '';\n        \n        // Check if this task has ANY date - if not, it's effectively new\n        const hasAnyDate = initiated || updated || completed;\n\n        // Update the relevant date based on status\n        // We show only ONE date field based on current status (last action)\n        if (newStatusLower === 'to do') {\n          // For To Do: always show initiated date\n          initiated = initiated || today;\n          // Clear other dates for display\n          updated = '';\n          completed = '';\n        } else if (newStatusLower === 'in progress') {\n          // For In Progress: set updated date if new or status changed\n          if (!hasAnyDate || oldStatus !== newStatusLower) {\n            updated = today;\n          }\n          // Clear other dates for display\n          initiated = '';\n          completed = '';\n        } else if (newStatusLower === 'done') {\n          // For Done: set completed date if new or status changed\n          if (!hasAnyDate || !completed || oldStatus !== newStatusLower) {\n            completed = today;\n          }\n          // Clear other dates for display\n          initiated = '';\n          updated = '';\n        }\n\n        return { initiated, updated, completed };\n      };\n\n      if (isOther) {\n        const otherCard = getTaskCard('__other__');\n        const name = taskNameInput ? taskNameInput.value.trim() : '';\n        if (name) {\n          const status = getCardStatus(otherCard) || 'To Do';\n          const commentEl = otherCard ? otherCard.querySelector('[data-role=\"comment\"]') : null;\n          const deadlineEl = otherCard ? otherCard.querySelector('[data-role=\"deadline\"]') : null;\n          const taskAssigneeEl = otherCard ? otherCard.querySelector('[data-role=\"task-assignee\"]') : null;\n          // Use per-task assignee if set, otherwise fall back to global assignees\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Look up existing task to preserve dates\n          const existingTask = existingTasks[name.toLowerCase()];\n          const dates = computeDates(name, status, existingTask);\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: '',\n            initiated: dates.initiated,\n            updated: dates.updated,\n            completed: dates.completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          const builtLine = buildSummaryLine(payload);\n          newTaskLines.push({ line: builtLine, status });\n        }\n      } else {\n        const toggles = getSelectedTaskToggles();\n        const fixedNames = ['Broker Agreement','Give-up Agreement','Amend Annex A','KYC (produced by LCMC)','KYC External'];\n        toggles.forEach(name => {\n          if (!fixedNames.includes(name)) return;\n          const card = getTaskCard(name);\n          if (!card) return;\n          const status = getCardStatus(card);\n          const commentEl = card.querySelector('[data-role=\"comment\"]');\n          const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n          const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n          const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n          // Use per-task assignee if set, otherwise fall back to global assignees\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Look up existing task to preserve dates (handle legacy KYC name)\n          let existingTask = existingTasks[name.toLowerCase()];\n          if (!existingTask && name.toLowerCase() === 'kyc (produced by lcmc)') {\n            existingTask = existingTasks['kyc (internal)'];\n          }\n          const dates = computeDates(name, status, existingTask);\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: giveUpIdEl ? giveUpIdEl.value.trim() : '',\n            initiated: dates.initiated,\n            updated: dates.updated,\n            completed: dates.completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          newTaskLines.push({ line: buildSummaryLine(payload), status });\n        });\n      }\n\n      // Sort task lines by status priority: To Do > In Progress > Done\n      const statusPriority = { 'to do': 1, 'in progress': 2, 'done': 3 };\n      newTaskLines.sort((a, b) => {\n        const aPriority = statusPriority[(a.status || '').toLowerCase()] || 4;\n        const bPriority = statusPriority[(b.status || '').toLowerCase()] || 4;\n        return aPriority - bPriority;\n      });\n      const sortedLines = newTaskLines.map(t => t.line);\n\n      const newValue = nonTaskLines.concat(sortedLines).filter(Boolean).join('\\n');\n      console.log('Saving to H - newTaskLines:', sortedLines, 'newValue:', newValue);\n\n      hRange.values = [[newValue]];\n\n      // Apply font color based on status priority: In Progress > To Do > Done\n      // Since Excel.js can't do per-line colors, use the \"most urgent\" status\n      if (sortedLines.length > 0) {\n        let hasInProgress = false;\n        let hasToDo = false;\n        let hasDone = false;\n        \n        sortedLines.forEach(line => {\n          const lower = line.toLowerCase();\n          if (lower.includes(': in progress')) hasInProgress = true;\n          else if (lower.includes(': to do')) hasToDo = true;\n          else if (lower.includes(': done')) hasDone = true;\n        });\n        \n        // Priority: In Progress (orange) > To Do (green) > Done (red)\n        // Use original Google Sheet colours: To Do #34a853, In Progress #ff9900, Done #cc6666\n        let fontColor;\n        if (hasInProgress) {\n          fontColor = '#ff9900'; // In Progress (orange)\n        } else if (hasToDo) {\n          fontColor = '#34a853'; // To Do (green)\n        } else if (hasDone) {\n          fontColor = '#cc6666'; // Done (soft red)\n        } else {\n          fontColor = '#34a853'; // default green\n        }\n        hRange.format.font.color = fontColor;\n      }\n\n      await context.sync();\n      console.log('Save completed successfully for row', uiRow);\n    });\n  }\n\n  // Clear form for a fresh new task entry\n  function clearFormForNewTask() {\n    // Clear company name\n    if (companyNameInput) companyNameInput.value = '';\n    \n    // Reset task category checkboxes\n    qsa('#taskCategories .category-toggle').forEach(cb => {\n      cb.checked = false;\n    });\n    \n    // Clear broker lead\n    if (brokerLeadEl) brokerLeadEl.value = '';\n    \n    // Clear all assignee checkboxes\n    document.querySelectorAll('#assignees input[type=checkbox]').forEach(cb => {\n      cb.checked = false;\n    });\n    \n    // Clear dates\n    if (initialRequestInput) initialRequestInput.value = '';\n    if (introEmailInput) introEmailInput.value = '';\n    if (remindersStartInput) remindersStartInput.value = '';\n    \n    // Clear email frequency and extra note\n    if (emailFrequencyEl) emailFrequencyEl.value = '';\n    if (extraNoteEl) extraNoteEl.value = '';\n    \n    // Uncheck all task toggles\n    qsa('#tasksChecklist .task-toggle').forEach(cb => {\n      cb.checked = false;\n    });\n    \n    // Reset all task cards (including Other Task card)\n    qsa('#taskCards .task-card, #otherTaskCard').forEach(card => {\n      // Reset status chips\n      const chips = card.querySelectorAll('[data-role=\"status-chips\"] .chip');\n      chips.forEach(c => c.classList.remove('active'));\n      \n      // Clear comment\n      const commentEl = card.querySelector('[data-role=\"comment\"]');\n      if (commentEl) commentEl.value = '';\n      \n      // Clear deadline\n      const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n      if (deadlineEl) deadlineEl.value = '';\n      \n      // Clear give-up ID\n      const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n      if (giveUpIdEl) giveUpIdEl.value = '';\n      \n      // Clear per-task assignee\n      const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n      if (taskAssigneeEl) taskAssigneeEl.value = '';\n    });\n    \n    // Clear other task name\n    if (taskNameInput) taskNameInput.value = '';\n    \n    // Clear audit text\n    if (auditTextEl) auditTextEl.textContent = '';\n    \n    // Clear Last KYC date\n    const lastKycEl = qs('#lastKycDate');\n    if (lastKycEl) lastKycEl.textContent = '';\n    \n    // Clear search results\n    if (searchResults) {\n      searchResults.classList.remove('visible');\n      searchResults.innerHTML = '';\n    }\n\n    // Close email summary section\n    if (emailSummarySection) {\n      emailSummarySection.classList.remove('visible');\n    }\n\n    // Mark as new task for save logic\n    currentRowNum = 'new';\n\n    // Update email summary button state\n    updateEmailSummaryButton();\n    \n    // Clear date displays\n    updateDateDisplays();\n    \n    // Update visibility and placeholder\n    syncTasksVisibility();\n    updateExtraNotePlaceholder();\n\n    // Autofocus first visible task comment field after a short delay\n    setTimeout(() => {\n      const visibleCard = document.querySelector('#taskCards .task-card:not([style*=\"display: none\"]), #otherTaskCard:not([style*=\"display: none\"])');\n      if (visibleCard) {\n        const commentEl = visibleCard.querySelector('[data-role=\"comment\"]');\n        if (commentEl && typeof commentEl.focus === 'function') {\n          commentEl.focus();\n        }\n      }\n    }, 100);\n  }\n\n  // Delete the current row from Excel\n  async function deleteCurrentRow() {\n    if (currentRowNum === null || currentRowNum === 'new') {\n      throw new Error('No row to delete');\n    }\n    \n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      \n      if (sheet.isNullObject) {\n        throw new Error('Sheet TASK MANAGER FORM not found');\n      }\n      \n      // Delete the entire row\n      const rowRange = sheet.getRange(`${currentRowNum}:${currentRowNum}`);\n      rowRange.delete(Excel.DeleteShiftDirection.up);\n      \n      await context.sync();\n      console.log('Deleted row', currentRowNum);\n    });\n  }\n\n  // Add a new task to the next available row\n  async function addNewTask() {\n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) {\n        console.error('Sheet TASK MANAGER FORM not found');\n        return;\n      }\n\n      // Find the first empty row by scanning column A from row 2 onwards\n      const colA = sheet.getRange('A2:A1000');\n      colA.load('values');\n      await context.sync();\n\n      let nextRow = 2; // Start from row 2 (after header)\n      const values = colA.values || [];\n      for (let i = 0; i < values.length; i++) {\n        if (values[i][0] && String(values[i][0]).trim() !== '') {\n          nextRow = i + 3; // i is 0-indexed, row 2 is first data row, so next empty is i+2+1\n        } else {\n          // Found an empty cell\n          nextRow = i + 2; // i is 0-indexed from row 2\n          break;\n        }\n      }\n\n      // Collect current form data\n      const companyVal = companyNameInput ? companyNameInput.value.trim() : '';\n      const descVal = getSelectedCategories().join(', ');\n      const isOther = isOtherTaskSelected();\n      const brokerVal = brokerLeadEl ? brokerLeadEl.value : '';\n      const assignees = getSelectedAssignees().join(', ');\n\n      // Write company name to column A\n      sheet.getRange(`A${nextRow}`).values = [[companyVal]];\n      // Write task category to column B\n      sheet.getRange(`B${nextRow}`).values = [[descVal]];\n      // Write assignees to column C\n      sheet.getRange(`C${nextRow}`).values = [[assignees]];\n      // Write broker lead to column D\n      sheet.getRange(`D${nextRow}`).values = [[brokerVal]];\n\n      // Write dates to columns E, F, G\n      const dateE = formatDateForExcel(initialRequestInput ? initialRequestInput.value : '');\n      const dateF = formatDateForExcel(introEmailInput ? introEmailInput.value : '');\n      const dateG = formatDateForExcel(remindersStartInput ? remindersStartInput.value : '');\n      sheet.getRange(`E${nextRow}:G${nextRow}`).values = [[dateE, dateF, dateG]];\n\n      // Write Email Frequency (J) and Extra Note (K)\n      sheet.getRange(`J${nextRow}`).values = [[emailFrequencyEl ? emailFrequencyEl.value : '']];\n      sheet.getRange(`K${nextRow}`).values = [[extraNoteEl ? extraNoteEl.value : '']];\n\n      // Helper to get today's date in d-MMM-yy format\n      const getTodayFormatted = () => {\n        const d = new Date();\n        const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n        return `${String(d.getDate()).padStart(2,'0')} ${months[d.getMonth()]} ${String(d.getFullYear()).slice(-2)}`;\n      };\n      const today = getTodayFormatted();\n\n      // Build Column H from selected tasks\n      const newTaskLines = [];\n      if (isOther) {\n        const otherCard = getTaskCard('__other__');\n        const name = taskNameInput ? taskNameInput.value.trim() : '';\n        if (name) {\n          const status = getCardStatus(otherCard) || 'To Do';\n          const commentEl = otherCard ? otherCard.querySelector('[data-role=\"comment\"]') : null;\n          const deadlineEl = otherCard ? otherCard.querySelector('[data-role=\"deadline\"]') : null;\n          const taskAssigneeEl = otherCard ? otherCard.querySelector('[data-role=\"task-assignee\"]') : null;\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Set date based on status for new task\n          let initiated = '', updated = '', completed = '';\n          const statusLower = status.toLowerCase();\n          if (statusLower === 'to do') {\n            initiated = today;\n          } else if (statusLower === 'in progress') {\n            updated = today;\n          } else if (statusLower === 'done') {\n            completed = today;\n          }\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: '',\n            initiated,\n            updated,\n            completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          newTaskLines.push(buildSummaryLine(payload));\n        }\n      } else {\n        const toggles = getSelectedTaskToggles();\n        const fixedNames = ['Broker Agreement','Give-up Agreement','Amend Annex A','KYC (produced by LCMC)','KYC External'];\n        toggles.forEach(name => {\n          if (!fixedNames.includes(name)) return;\n          const card = getTaskCard(name);\n          if (!card) return;\n          const status = getCardStatus(card) || 'To Do';\n          const commentEl = card.querySelector('[data-role=\"comment\"]');\n          const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n          const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n          const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Set date based on status for new task\n          let initiated = '', updated = '', completed = '';\n          const statusLower = status.toLowerCase();\n          if (statusLower === 'to do') {\n            initiated = today;\n          } else if (statusLower === 'in progress') {\n            updated = today;\n          } else if (statusLower === 'done') {\n            completed = today;\n          }\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: giveUpIdEl ? giveUpIdEl.value.trim() : '',\n            initiated,\n            updated,\n            completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          newTaskLines.push(buildSummaryLine(payload));\n        });\n      }\n\n      const hRangeNew = sheet.getRange(`H${nextRow}`);\n      hRangeNew.values = [[newTaskLines.join('\\n')]];\n\n      // Apply font color based on status priority: In Progress > To Do > Done\n      // Use original Google Sheet colours: To Do #34a853, In Progress #ff9900, Done #cc6666\n      if (newTaskLines.length > 0) {\n        let hasInProgress = false;\n        let hasToDo = false;\n        let hasDone = false;\n        \n        newTaskLines.forEach(line => {\n          const lower = line.toLowerCase();\n          if (lower.includes(': in progress')) hasInProgress = true;\n          else if (lower.includes(': to do')) hasToDo = true;\n          else if (lower.includes(': done')) hasDone = true;\n        });\n        \n        let fontColor;\n        if (hasInProgress) {\n          fontColor = '#ff9900'; // In Progress (orange)\n        } else if (hasToDo) {\n          fontColor = '#34a853'; // To Do (green)\n        } else if (hasDone) {\n          fontColor = '#cc6666'; // Done (soft red)\n        } else {\n          fontColor = '#34a853'; // default green\n        }\n        hRangeNew.format.font.color = fontColor;\n      }\n\n      await context.sync();\n\n      // Select the new row so user can see it\n      const newRowRange = sheet.getRange(`A${nextRow}`);\n      newRowRange.select();\n      await context.sync();\n\n      // Update current row number for save logic\n      currentRowNum = nextRow;\n    });\n  }\n\n  // Update date display helpers to show d-MMM-yyyy format\n  function updateDateDisplays() {\n    const dateFields = [\n      { input: '#initialRequest', display: '#initialRequestDisplay' },\n      { input: '#introEmail', display: '#introEmailDisplay' },\n      { input: '#remindersStart', display: '#remindersStartDisplay' }\n    ];\n    dateFields.forEach(({ input, display }) => {\n      const inputEl = qs(input);\n      const displayEl = qs(display);\n      if (inputEl && displayEl) {\n        const formatted = formatDateForDisplay(inputEl.value);\n        displayEl.textContent = formatted ? ` ${formatted}` : '';\n      }\n    });\n  }\n\n  // Wire date inputs to update displays\n  function wireDateInputs() {\n    const dateInputs = ['#initialRequest', '#introEmail', '#remindersStart'];\n    dateInputs.forEach(selector => {\n      const el = qs(selector);\n      if (el) {\n        el.addEventListener('change', updateDateDisplays);\n      }\n    });\n  }\n\n  // Wire deadline inputs to update warnings\n  function wireDeadlineInputs() {\n    qsa('[data-role=\"deadline\"]').forEach(input => {\n      input.addEventListener('change', () => {\n        applyDeadlineWarnings();\n      });\n    });\n  }\n\n  // ============== Email Summary Integration ==============\n\n  const emailSummaryBtn = qs('#viewEmailSummaryBtn');\n  const emailSummarySection = qs('#emailSummarySection');\n  const emailSummaryList = qs('#emailSummaryList');\n  const emailSummaryCount = qs('#emailSummaryCount');\n  const closeEmailSummaryBtn = qs('#closeEmailSummaryBtn');\n\n  // Update email summary button state based on company name\n  function updateEmailSummaryButton() {\n    const company = companyNameInput ? companyNameInput.value.trim() : '';\n    if (emailSummaryBtn) {\n      emailSummaryBtn.disabled = !company;\n    }\n  }\n\n  // Wire company name input to update button state\n  if (companyNameInput) {\n    companyNameInput.addEventListener('input', updateEmailSummaryButton);\n    companyNameInput.addEventListener('change', updateEmailSummaryButton);\n  }\n\n  // Wire email summary button click\n  if (emailSummaryBtn) {\n    emailSummaryBtn.addEventListener('click', async () => {\n      await loadEmailSummaries();\n    });\n  }\n\n  // Wire close button\n  if (closeEmailSummaryBtn) {\n    closeEmailSummaryBtn.addEventListener('click', () => {\n      if (emailSummarySection) {\n        emailSummarySection.classList.remove('visible');\n      }\n    });\n  }\n\n  // Load email summaries from Column L (populated by VBA SmartBrief macro)\n  // The VBA macro calls the API and writes the summary to column L\n  // This function reads that pre-fetched summary and displays it\n  async function loadEmailSummaries() {\n    const company = companyNameInput ? companyNameInput.value.trim() : '';\n    if (!company) {\n      showToast('No company name entered', 'error');\n      return;\n    }\n\n    // Must have a valid row to read from\n    if (currentRowNum === null || currentRowNum === 'new') {\n      showToast('Please save the task first or select an existing row', 'error');\n      return;\n    }\n\n    // Show the section with loading state\n    if (emailSummarySection) {\n      emailSummarySection.classList.add('visible');\n    }\n    if (emailSummaryList) {\n      emailSummaryList.innerHTML = '<div class=\"email-loading\">Loading summary from spreadsheet...</div>';\n    }\n\n    try {\n      // Read from Excel - extract data only, no DOM manipulation inside Excel.run\n      let summaryText = '';\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n\n        if (sheet.isNullObject) {\n          throw new Error('TASK MANAGER FORM sheet not found');\n        }\n\n        // Read column L for the current row (SmartBrief summary)\n        const cell = sheet.getRange(`L${currentRowNum}`);\n        cell.load('values');\n        await context.sync();\n\n        summaryText = (cell.values && cell.values[0] && cell.values[0][0])\n          ? String(cell.values[0][0]).trim()\n          : '';\n      });\n\n      // Excel can store in-cell line breaks as \"\\r\" on some platforms (not \"\\n\");\n      // normalize so parsing + rendering works consistently.\n      if (summaryText) {\n        summaryText = summaryText.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n      }\n\n      // If column L is empty, try to fetch from API (only works in localhost dev due to mixed-content)\n      // In production, VBA macro should have already populated column L\n      if (!summaryText) {\n        // Only attempt API call in localhost development (HTTPS add-in can't call HTTP API in production)\n        const isLocalhost = typeof window !== 'undefined' \n          && window.location \n          && window.location.hostname === 'localhost';\n        \n        if (isLocalhost) {\n          if (emailSummaryList) {\n            emailSummaryList.innerHTML = '<div class=\"email-loading\">Fetching summary from API...</div>';\n          }\n\n          const initialRequest = initialRequestInput ? String(initialRequestInput.value || '') : '';\n          const introEmail = introEmailInput ? String(introEmailInput.value || '') : '';\n          const remindersStart = remindersStartInput ? String(remindersStartInput.value || '') : '';\n\n          const apiSummary = await fetchSmartBriefSummaryFromApi(company, initialRequest, introEmail, remindersStart);\n          summaryText = apiSummary || '';\n\n          if (summaryText) {\n            summaryText = summaryText.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n          }\n\n          if (summaryText) {\n            await Excel.run(async (context) => {\n              const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n              sheet.load('name');\n              await context.sync();\n\n              if (sheet.isNullObject) {\n                throw new Error('TASK MANAGER FORM sheet not found');\n              }\n\n              const cell = sheet.getRange(`L${currentRowNum}`);\n              cell.values = [[summaryText]];\n              await context.sync();\n            });\n          }\n        }\n      }\n\n      // Now do DOM updates outside of Excel.run\n      // Update count badge (1 if we have a summary, 0 if not)\n      if (emailSummaryCount) {\n        emailSummaryCount.textContent = summaryText ? '1' : '0';\n      }\n\n      // Display the summary\n      if (!summaryText) {\n        if (emailSummaryList) {\n          emailSummaryList.innerHTML = `\n            <div class=\"email-no-summaries\">\n              No email summary found for this row.<br>\n              <small>Run the SmartBrief macro (Alt+F8  SmartBrief) to fetch summaries.</small>\n            </div>`;\n        }\n        return;\n      }\n\n      // Parse the summary text from VBA format:\n      // \"[XX% match] Subject\\n\\nSummary text\"\n      const lines = summaryText.split(/\\n/);\n      const firstLine = (lines[0] || '').trim();\n      const restText = lines.slice(1).join('\\n').replace(/^\\n+/, '').trim();\n\n      const headerMatch = firstLine.match(/^\\[(\\d+)%\\s*match\\]\\s*(.*)$/);\n      let matchPercent = 100;\n      let subject = 'Email Summary';\n      let summaryBody = summaryText;\n\n      if (headerMatch) {\n        matchPercent = parseInt(headerMatch[1], 10);\n        subject = (headerMatch[2] || '').trim() || 'Email Summary';\n        summaryBody = restText;\n      } else if (lines.length > 1) {\n        subject = firstLine || 'Email Summary';\n        summaryBody = restText;\n      } else {\n        subject = 'Email Summary';\n        summaryBody = summaryText.trim();\n      }\n\n      // Color code by match quality\n      let matchClass = 'match-high';\n      if (matchPercent < 70) matchClass = 'match-medium';\n      if (matchPercent < 50) matchClass = 'match-low';\n\n      // Parse participants and detect category for \"Apply to Task\" feature\n      const participants = parseParticipantsFromSummary(summaryText);\n      const detectedCategory = detectCategoryFromSummary(summaryText);\n      const matchedAssignees = matchParticipantsToTeamMembers(participants);\n      const summaryNotes = parseSummaryBodyFromSummary(summaryText);\n\n      // Store for \"Apply to Task\" button\n      lastParsedSmartBrief = {\n        participants,\n        detectedCategory,\n        matchedAssignees,\n        summaryNotes,\n        matchPercent,\n        subject\n      };\n\n      // Build participant chips HTML\n      let participantChipsHtml = '';\n      if (participants.length > 0) {\n        const chips = participants.map(p => {\n          const isMatched = matchedAssignees.some(a => a.toLowerCase().includes(p.name.split(' ')[0].toLowerCase()));\n          const chipClass = isMatched ? 'participant-chip matched' : 'participant-chip';\n          const title = p.email ? p.email : p.name;\n          return `<span class=\"${chipClass}\" title=\"${escapeHtml(title)}\">${escapeHtml(p.name)}</span>`;\n        }).join('');\n        participantChipsHtml = `\n          <div class=\"participants-section\">\n            <div class=\"participants-label\">Participants:</div>\n            <div class=\"participants-chips\">${chips}</div>\n          </div>\n        `;\n      }\n\n      // Build match warning HTML (if < 50%)\n      let matchWarningHtml = '';\n      if (matchPercent < 50) {\n        matchWarningHtml = `\n          <div class=\"match-warning\">\n             Low confidence match (${matchPercent}%)  verify this is the correct email thread\n          </div>\n        `;\n      }\n\n      // Build \"Apply to Task\" button HTML\n      let applyButtonHtml = '';\n      if (detectedCategory || matchedAssignees.length > 0 || summaryNotes) {\n        applyButtonHtml = `\n          <div class=\"smartbrief-actions\">\n            <button id=\"applySmartBriefBtn\" class=\"btn-apply-smartbrief\">\n               Review & Apply to Task\n            </button>\n          </div>\n        `;\n      }\n\n      // Remove participant names from summary body to avoid redundancy with chips\n      let cleanedSummaryBody = summaryBody;\n      // Remove the PARTICIPANTS section if present (already shown as chips)\n      cleanedSummaryBody = cleanedSummaryBody.replace(/## PARTICIPANTS[\\s\\S]*?(?=## |$)/, '').trim();\n      // Clean up any leading/trailing whitespace or empty lines\n      cleanedSummaryBody = cleanedSummaryBody.replace(/^\\n+/, '').replace(/\\n{3,}/g, '\\n\\n');\n\n      if (emailSummaryList) {\n        emailSummaryList.innerHTML = `\n          ${matchWarningHtml}\n          <div class=\"email-summary-item\">\n            <div class=\"email-summary-subject\">\n              ${escapeHtml(subject)}\n              <span class=\"match-score ${matchClass}\" title=\"Match score from SmartBrief\">\n                ${matchPercent}% match\n              </span>\n            </div>\n            ${participantChipsHtml}\n            <div class=\"email-summary-text\">${escapeHtml(cleanedSummaryBody).replace(/\\n/g, '<br>')}</div>\n          </div>\n          ${applyButtonHtml}\n        `;\n\n        // Wire \"Apply to Task\" button to show confirmation modal\n        const applyBtn = qs('#applySmartBriefBtn');\n        if (applyBtn) {\n          applyBtn.addEventListener('click', () => showSmartBriefConfirmation());\n        }\n      }\n\n    } catch (err) {\n      console.error('Error loading email summary from column L:', err);\n      if (emailSummaryList) {\n        emailSummaryList.innerHTML = `<div class=\"email-no-summaries\">Error reading summary: ${escapeHtml(err.message)}</div>`;\n      }\n    }\n  }\n\n  // Show confirmation modal for SmartBrief suggestions\n  function showSmartBriefConfirmation() {\n    if (!lastParsedSmartBrief) {\n      showToast('No SmartBrief data to apply', 'error');\n      return;\n    }\n\n    const { detectedCategory, matchedAssignees, summaryNotes } = lastParsedSmartBrief;\n    \n    // Build suggestion items with checkboxes\n    let suggestionsHtml = '';\n    let hasSuggestions = false;\n\n    if (detectedCategory) {\n      hasSuggestions = true;\n      suggestionsHtml += `\n        <div class=\"smartbrief-suggestion-item\">\n          <label>\n            <input type=\"checkbox\" id=\"sbApplyCategory\" checked>\n            <span class=\"suggestion-label\">Task Category:</span>\n            <span class=\"suggestion-value\">${escapeHtml(detectedCategory)}</span>\n          </label>\n        </div>\n      `;\n    }\n\n    // Individual checkboxes for each assignee (so users can uncheck irrelevant ones)\n    if (matchedAssignees && matchedAssignees.length > 0) {\n      hasSuggestions = true;\n      const assigneeCheckboxes = matchedAssignees.map((assignee, idx) => `\n        <label class=\"assignee-checkbox-item\">\n          <input type=\"checkbox\" class=\"sb-assignee-checkbox\" data-assignee=\"${escapeHtml(assignee)}\" checked>\n          <span>${escapeHtml(assignee)}</span>\n        </label>\n      `).join('');\n      \n      suggestionsHtml += `\n        <div class=\"smartbrief-suggestion-item smartbrief-assignees-group\">\n          <div class=\"suggestion-label\">Assignees:</div>\n          <div class=\"assignee-checkboxes-list\">\n            ${assigneeCheckboxes}\n          </div>\n        </div>\n      `;\n    }\n\n    if (summaryNotes) {\n      hasSuggestions = true;\n      const truncatedPreview = summaryNotes.length > 100 ? summaryNotes.substring(0, 100) + '...' : summaryNotes;\n      suggestionsHtml += `\n        <div class=\"smartbrief-suggestion-item\">\n          <label>\n            <input type=\"checkbox\" id=\"sbApplyNotes\">\n            <span class=\"suggestion-label\">Add to Notes:</span>\n            <span class=\"suggestion-value suggestion-notes\">${escapeHtml(truncatedPreview)}</span>\n          </label>\n        </div>\n      `;\n    }\n\n    if (!hasSuggestions) {\n      showToast('No suggestions available', 'info');\n      return;\n    }\n\n    // Create modal overlay\n    const overlay = document.createElement('div');\n    overlay.className = 'confirm-overlay';\n    overlay.id = 'smartbriefConfirmOverlay';\n\n    const box = document.createElement('div');\n    box.className = 'confirm-box smartbrief-confirm-box';\n    box.innerHTML = `\n      <div class=\"smartbrief-confirm-header\">\n        <span class=\"sparkle\"></span> Review Suggestions\n      </div>\n      <p class=\"smartbrief-confirm-desc\">Select which items to apply to the task:</p>\n      <div class=\"smartbrief-suggestions\">\n        ${suggestionsHtml}\n      </div>\n      <div class=\"smartbrief-confirm-buttons\">\n        <button class=\"btn-confirm-cancel\" id=\"sbCancel\">Cancel</button>\n        <button class=\"btn-apply-confirmed\" id=\"sbApply\">Apply Selected</button>\n      </div>\n    `;\n\n    overlay.appendChild(box);\n    document.body.appendChild(overlay);\n\n    // Wire buttons\n    const cancelBtn = overlay.querySelector('#sbCancel');\n    const applyBtn = overlay.querySelector('#sbApply');\n\n    cancelBtn.addEventListener('click', () => overlay.remove());\n    \n    applyBtn.addEventListener('click', () => {\n      const applyCategory = overlay.querySelector('#sbApplyCategory')?.checked;\n      const applyNotes = overlay.querySelector('#sbApplyNotes')?.checked;\n      \n      // Collect individually selected assignees\n      const selectedAssignees = [];\n      overlay.querySelectorAll('.sb-assignee-checkbox:checked').forEach(cb => {\n        selectedAssignees.push(cb.getAttribute('data-assignee'));\n      });\n      \n      overlay.remove();\n      applySmartBriefSelections(applyCategory, selectedAssignees, applyNotes);\n    });\n\n    // Close on overlay click\n    overlay.addEventListener('click', (e) => {\n      if (e.target === overlay) overlay.remove();\n    });\n  }\n\n  // Apply selected SmartBrief suggestions to the task form\n  // applyAssignees is now an array of selected assignee names (not a boolean)\n  function applySmartBriefSelections(applyCategory, selectedAssignees, applyNotes) {\n    if (!lastParsedSmartBrief) return;\n\n    const { detectedCategory, summaryNotes } = lastParsedSmartBrief;\n    let appliedItems = [];\n\n    // 1. Apply detected category\n    if (applyCategory && detectedCategory) {\n      const categoryCheckboxes = document.querySelectorAll('#taskCategories .category-toggle');\n      categoryCheckboxes.forEach(cb => {\n        if (cb.value === detectedCategory) {\n          cb.checked = true;\n          appliedItems.push(`Category: ${detectedCategory}`);\n        }\n      });\n      // Trigger visibility sync for task cards\n      syncTasksVisibility();\n    }\n\n    // 2. Apply selected assignees (now receives array of individually selected assignees)\n    if (selectedAssignees && Array.isArray(selectedAssignees) && selectedAssignees.length > 0) {\n      const assigneeCheckboxes = document.querySelectorAll('#assignees input[type=checkbox]');\n      assigneeCheckboxes.forEach(cb => {\n        if (selectedAssignees.includes(cb.value)) {\n          cb.checked = true;\n        }\n      });\n      // Update per-task dropdowns\n      updateTaskAssigneeDropdowns();\n      // Reorder checked to top\n      reorderCheckboxesToTop('#assignees');\n      appliedItems.push(`Assignees: ${selectedAssignees.join(', ')}`);\n    }\n\n    // 3. Apply summary notes to Extra Note field (append, don't overwrite)\n    if (applyNotes && summaryNotes && extraNoteEl) {\n      const existingNote = extraNoteEl.value.trim();\n      const notePrefix = '[From SmartBrief] ';\n      // Only add if not already present\n      if (!existingNote.includes(notePrefix)) {\n        const truncatedNotes = summaryNotes.length > 500 ? summaryNotes.substring(0, 500) + '...' : summaryNotes;\n        extraNoteEl.value = existingNote \n          ? `${existingNote}\\n\\n${notePrefix}${truncatedNotes}`\n          : `${notePrefix}${truncatedNotes}`;\n        appliedItems.push('Notes added');\n      }\n    }\n\n    // Mark form as having unsaved changes\n    if (appliedItems.length > 0) {\n      setUnsavedChanges(true);\n      showToast(` Applied: ${appliedItems.join(', ')}`, 'success');\n    } else {\n      showToast('No items selected', 'info');\n    }\n  }\n\n  // Format date for display\n  function formatEmailDate(dateStr) {\n    if (!dateStr) return 'Unknown date';\n    try {\n      const d = new Date(dateStr);\n      if (isNaN(d.getTime())) return dateStr;\n      return d.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });\n    } catch (e) {\n      return dateStr;\n    }\n  }\n\n  // Note: Email summaries are now populated by VBA SmartBrief macro into column L\n  // The add-in reads from column L instead of calling the API directly\n\n  // Initial load when Office host is ready\n  if (typeof Office !== 'undefined' && typeof Office.onReady === 'function') {\n  \n      Office.onReady((info) => {\n        if (info.host === Office.HostType.Excel) {\n          wireCardChips();\n          wireDateInputs();\n          wireDeadlineInputs(); // Wire deadline warnings\n          wireChangeTracking(); // Track unsaved changes\n        // Wire task checkbox visibility\n        qsa('#tasksChecklist .task-toggle').forEach(cb => {\n          cb.addEventListener('change', () => syncTasksVisibility());\n        });\n        // Wire category checkbox visibility\n        qsa('#taskCategories .category-toggle').forEach(cb => {\n          cb.addEventListener('change', () => syncTasksVisibility());\n        });\n        loadFromActiveRow().then(() => {\n          // Reset unsaved indicator after initial load\n          setUnsavedChanges(false);\n          // Auto-load active tasks on startup\n          performSearch();\n        });\n      }\n    });\n  }\n})();\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_toConsumableArray","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","toString","slice","constructor","name","test","qs","s","document","querySelector","qsa","querySelectorAll","teamMembersLoaded","hasUnsavedChanges","showToast","message","type","undefined","toast","textContent","className","setTimeout","classList","remove","checkMissingFields","missing","companyName","trim","push","brokerLead","filter","card","style","display","id","forEach","taskName","dataset","task","activeChip","deadlineInput","concat","otherTaskCard","taskNameInput","showMissingFieldsWarning","missingFields","overlay","createElement","box","maxWidth","textAlign","title","innerHTML","marginBottom","appendChild","desc","fontSize","color","list","cssText","field","li","btnWrap","closeBtn","addEventListener","body","setUnsavedChanges","unsaved","indicator","toggle","parseParticipantsFromSummary","summaryText","participants","participantsMatch","match","split","startsWith","line","email","parseSummaryBodyFromSummary","summaryMatch","join","detectCategoryFromSummary","text","toLowerCase","includes","matchParticipantsToTeamMembers","teamCheckboxes","teamNames","map","cb","matched","pNameLower","idx","findIndex","firstName","emailPrefix","tFirstName","Set","lastParsedSmartBrief","fetchSmartBriefSummaryFromApi","_x","_x2","_x3","_x4","_fetchSmartBriefSummaryFromApi","_callee0","company","initialRequest","introEmail","remindersStart","useLocalProxy","url","response","data","summaries","best","subject","summary","matchScore","matchPercent","_t4","_context0","window","location","hostname","protocol","encodeURIComponent","fetch","method","headers","JSON","stringify","initial_request","intro_email","reminders_start","threshold","ok","Error","status","json","String","match_score","parseFloat","Number","isFinite","Math","round","escapeHtml","div","applyDeadlineWarnings","warningClass","deadlineStr","deadline","Date","isNaN","getTime","today","setHours","diffDays","ceil","getDueDateWarningClass","add","preventDefault","returnValue","companyNameInput","brokerLeadEl","initialRequestInput","introEmailInput","remindersStartInput","emailFrequencyEl","extraNoteEl","auditTextEl","tasksRowEl","taskCardsContainer","saveBtn","newTaskBtn","loadSelectedBtn","openKycPortalBtn","currentRowNum","showConfirmDialog","dialog","msgEl","cancelBtn","okBtn","cleanup","removeEventListener","onCancel","onOk","_callee","_t","_context","addNewTask","saveToActiveRow","console","error","_callee2","_t2","_context2","loadFromActiveRow","clearFormForNewTask","deleteTaskBtn","_callee3","_t3","_context3","deleteCurrentRow","kycListenerAttached","stopPropagation","kycOpening","open","tasksView","statsView","tasksHeader","statsHeader","openStatsBtn","returnToTasksBtn","refreshStatsBtn","loadStatistics","_loadStatistics","_callee10","_t5","_context11","Excel","run","_ref1","_callee1","context","sheet","dataRange","rows","todoCount","inProgressCount","doneCount","brokerStats","monthlyStats","kycMonthly","totalDuration","durationCount","overdueItems","upcomingItems","staleItems","sevenDaysFromNow","thirtyDaysAgo","_loop","activeTasks","totalStatus","renderAttentionGroup","monthlyChart","sortedMonths","maxTasks","maxKyc","maxVal","monthNames","brokerChart","sortedBrokers","_maxTasks","_context10","workbook","worksheets","getItemOrNullObject","load","sync","isNullObject","getRange","values","setDate","getDate","row","broker","taskSummary","taskDate","dateE","dateF","dateG","availableDates","monthKey","_context1","parseDate","reduce","min","getFullYear","getMonth","padStart","total","active","completed","Boolean","lower","completedMatch","kycDate","taskNameMatch","assigneeMatch","assignee","deadlineMatch","daysUntil","detail","abs","initiatedMatch","updatedMatch","lastActionDate","daysSince","initiated","days","_regeneratorValues","width","items","groupId","listId","countId","group","container","countEl","item","assigneePart","sort","b","parseInt","keys","reverse","max","month","_month$split2","_slicedToArray","shortMonth","tasks","kyc","kycHeight","entries","_ref10","_ref12","_ref14","_ref15","stats","activeWidth","completedWidth","_x8","dateVal","excelEpoch","UTC","utcDate","result","getUTCFullYear","getUTCMonth","getUTCDate","dateStr","isoMatch","year","day","jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec","searchInput","searchInputWrap","searchBtn","searchResults","searchHint","searchTabs","currentSearchMode","loadRowHint","updateSearchUI","placeholder","tab","_callee4","_context4","getAttribute","performSearch","_callee5","_context5","_ref6","_callee6","_context6","key","hideAutocomplete","_x5","autocompleteDropdown","companyList","autocompleteTimeout","loadCompanyList","_loadCompanyList","_callee12","_t6","_context13","_ref16","_callee11","category","_context12","rowNum","log","_x9","showAutocomplete","query","q","allMatches","startsWithMatches","containsMatches","sortedMatches","categoryHint","_callee7","_context7","selectAndLoadRow","_performSearch","_callee15","_t7","_context17","_ref17","_callee14","rawValues","results","scannedRows","_loop2","totalRows","modeLabel","rawQuery","_context16","taskCategory","hasActiveTasks","dominantStatus","hasTodo","hasProgress","hasDone","todoDates","progressDates","doneDates","mostRecentDate","statusDateLabel","statusDateRaw","statusDateDisplay","_context15","dateArr","dStr","yyyy","mm","dd","every","parsed","parseTaskLine","st","updated","formatDateForDisplay","statusBadge","datePart","_callee13","_context14","_x0","_x6","_selectAndLoadRow","_callee17","_context19","_ref19","_callee16","_context18","select","_x1","findLastKycDate","_x7","_findLastKycDate","_callee19","_context21","_ref20","_callee18","usedRange","lastKycDate","rowCompany","_context20","getUsedRange","_x10","ymdMatch","clearTimeout","val","target","_callee8","_context8","formatDateForExcel","getSelectedCategories","isOtherTaskSelected","checked","getTaskCard","getTaskStatusChips","setCardStatus","getCardStatus","find","contains","syncTasksVisibility","isOther","otherCard","hasNonOtherCategory","some","selected","getSelectedTaskToggles","has","updateExtraNotePlaceholder","categories","reorderCheckboxesToTop","containerSelector","children","unchecked","loadTeamMembers","_loadTeamMembers","_callee21","_context23","initialized","_ref21","_callee20","namesRaw","names","noneOpt","_context22","opt","_x11","getSelectedAssignees","updateTaskAssigneeDropdowns","selectedAssignees","dropdown","currentValue","emptyOpt","raw","basicMatch","exec","comment","giveUpId","commentMatch","giveUpMatch","buildSummaryLine","parts","assignees","_loadFromActiveRow","_callee25","_context27","_ref23","_callee24","selectedRange","uiRow","companyRange","descRange","assigneesRange","brokerRange","datesRange","hRange","jRange","kRange","companyVal","descVal","brokerVal","assigneesVal","assigneesList","datesRow","toInputDate","freqVal","noteVal","lines","parsedTasks","nonTaskLines","cand","statusPriority","sNorm","commentEl","deadlineEl","taskAssigneeEl","chosenAudit","lastKycEl","kycCompletedDate","_context26","dmmyMatch","mon","getSelectedRange","rowIndex","cat","giveUpIdEl","pt","ptName","cbName","date","updateDateDisplays","updateEmailSummaryButton","emailSummarySection","_x13","_saveToActiveRow","_callee27","_context29","_ref24","_callee26","existing","newTaskLines","existingTasks","getTodayFormatted","computeDates","taskAssignee","existingTask","dates","payload","builtLine","toggles","fixedNames","sortedLines","newValue","hasInProgress","hasToDo","fontColor","_context28","newStatus","oldStatus","newStatusLower","hasAnyDate","format","font","_x14","visibleCard","focus","_deleteCurrentRow","_callee29","_context31","_ref25","_callee28","_context30","delete","DeleteShiftDirection","up","_x15","_addNewTask","_callee31","_context33","_ref26","_callee30","colA","nextRow","statusLower","hRangeNew","_context32","_x16","input","_ref9","inputEl","displayEl","formatted","emailSummaryBtn","emailSummaryList","emailSummaryCount","closeEmailSummaryBtn","disabled","loadEmailSummaries","_loadEmailSummaries","_callee34","apiSummary","firstLine","restText","headerMatch","summaryBody","matchClass","detectedCategory","matchedAssignees","summaryNotes","participantChipsHtml","chips","matchWarningHtml","applyButtonHtml","cleanedSummaryBody","applyBtn","_t8","_context36","_ref27","_callee32","cell","_context34","_x17","replace","_ref28","_callee33","_context35","_x18","chipClass","showSmartBriefConfirmation","_lastParsedSmartBrief","suggestionsHtml","hasSuggestions","assigneeCheckboxes","truncatedPreview","substring","_overlay$querySelecto","_overlay$querySelecto2","applyCategory","applyNotes","_lastParsedSmartBrief2","appliedItems","existingNote","notePrefix","truncatedNotes","applySmartBriefSelections","_callee9","_context9","Office","onReady","info","host","HostType","chip","closest","selector","el"],"ignoreList":[],"sourceRoot":""}