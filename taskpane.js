/*! For license information please see taskpane.js.LICENSE.txt */
!function(){function e(e){if(null!=e){var n=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}}}throw new TypeError(t(e)+" is not iterable")}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o,c,s=[],i=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(a=o.call(n)).done)&&(s.push(a.value),s.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return s}}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",c=n.toStringTag||"@@toStringTag";function s(n,a,o,c){var s=a&&a.prototype instanceof l?a:l,u=Object.create(s.prototype);return r(u,"_invoke",function(n,a,r){var o,c,s,l=0,u=r||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,c=0,s=e,f.n=n,i}};function m(n,a){for(c=n,s=a,t=0;!d&&l&&!r&&t<u.length;t++){var r,o=u[t],m=f.p,v=o[2];n>3?(r=v===a)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=m&&((r=n<2&&m<o[1])?(c=0,f.v=a,f.n=o[1]):m<v&&(r=n<3||o[0]>a||a>v)&&(o[4]=n,o[5]=a,f.n=v,c=0))}if(r||n>1)return i;throw d=!0,a}return function(r,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,v),c=u,s=v;(t=c<2?e:s)||!d;){o||(c?c<3?(c>1&&(f.n=-1),m(c,s)):f.n=s:f.v=s);try{if(l=2,o){if(c||(r="next"),t=o[r]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),c=1);o=e}else if((t=(d=f.n<0)?s:n.call(a,f))!==i)break}catch(t){o=e,c=1,s=t}finally{l=1}}return{value:t,done:d}}}(n,o,c),!0),u}var i={};function l(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][o]?t(t([][o]())):(r(t={},o,function(){return this}),t),m=d.prototype=l.prototype=Object.create(f);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,r(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,r(m,"constructor",d),r(d,"constructor",u),u.displayName="GeneratorFunction",r(d,c,"GeneratorFunction"),r(m),r(m,c,"Generator"),r(m,o,function(){return this}),r(m,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:v}})()}function r(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}r=function(e,t,n,a){function c(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(c("next",0),c("throw",1),c("return",2))},r(e,t,n,a)}function o(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function i(e,t,n,a,r,o,c){try{var s=e[o](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(a,r)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function c(e){i(o,a,r,c,s,"next",e)}function s(e){i(o,a,r,c,s,"throw",e)}c(void 0)})}}!function(){var t=function(e){return document.querySelector(e)},r=function(e){return Array.from(document.querySelectorAll(e))},c=!1,s=!1,i=new Map;function u(){return d.apply(this,arguments)}function d(){return d=l(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=l(a().m(function e(t){var n,r,o,c,s,l;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(n&&!n.isNullObject){e.n=2;break}return e.a(2);case 2:i.clear(),r=2;case 3:if(!(r<=1e3)){e.n=7;break}return(o=n.getRange("H".concat(r))).load("values"),o.load("text"),e.n=4,t.sync();case 4:if(c=o.values&&o.values[0]&&o.values[0][0],s=o.text&&o.text[0]&&o.text[0][0],c||s){e.n=5;break}return e.a(3,6);case 5:"string"==typeof(l=o.values[0][0]||o.text[0][0])&&l.split("\n").forEach(function(e){e.trim()&&e.split(";").forEach(function(e){var t=e.indexOf(":");if(-1!==t){var n=e.substring(0,t).trim();if(n){var a=e.match(/Assigned to ([^|]+)/);if(a){var r=a[1].trim();if(r&&""!==r){i.has(n)||i.set(n,new Map);var o=i.get(n);o.set(r,(o.get(r)||0)+1)}}}}})});case 6:r++,e.n=3;break;case 7:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("Error building task-assignee patterns:",t);case 3:return e.a(2)}},e,null,[[0,2]])})),d.apply(this,arguments)}function f(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r=t("#toast");r&&(r.textContent=e,r.className="toast "+n+" show",setTimeout(function(){r.classList.remove("show")},a))}function m(){var e=[],n=t("#companyName");n&&n.value.trim()||e.push("Company Name"),0===Array.from(document.querySelectorAll(".category-toggle:checked")).length&&e.push("Task Category");var a=t("#brokerLead");a&&a.value||e.push("Broker Lead"),0===Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).length&&e.push("Assigned To"),Array.from(document.querySelectorAll(".task-card")).filter(function(e){return"none"!==e.style.display&&"otherTaskCard"!==e.id}).forEach(function(t){var n=t.dataset.task||"Task",a=t.querySelector(".chip.active"),r=t.querySelector('[data-role="deadline"]');a||e.push("".concat(n,": Status")),r&&r.value||e.push("".concat(n,": Deadline"))});var r=t("#otherTaskCard");if(r&&"none"!==r.style.display){var o=t("#taskName");o&&o.value.trim()||e.push("Other Task: Task Name"),r.querySelector(".chip.active")||e.push("Other Task: Status");var c=r.querySelector('[data-role="deadline"]');c&&c.value||e.push("Other Task: Deadline")}var s=t("#emailFrequency");return s&&("SELECT"===s.tagName?s.selectedIndex<=0||!s.value:!s.value||""===s.value.trim())&&e.push("üïê Email Frequency"),e}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=document.createElement("div");n.className="confirm-overlay",n.id="missingFieldsOverlay";var a=document.createElement("div");if(a.className="confirm-box",a.style.maxWidth="320px",a.style.textAlign="left",0===e.length&&t){var r=document.createElement("p");r.innerHTML='<strong style="color:#10b981;">'.concat(t,"</strong>"),r.style.marginBottom="12px",r.style.textAlign="center",a.appendChild(r)}else{var o=document.createElement("p");o.innerHTML='<strong style="color:#f59e0b;">‚ö†Ô∏è Missing Fields</strong>',o.style.marginBottom="12px",o.style.textAlign="center",a.appendChild(o);var c=document.createElement("p");c.textContent=t||"The following fields are empty:",c.style.fontSize="12px",c.style.color="#64748b",c.style.marginBottom="8px",a.appendChild(c);var s=document.createElement("ul");s.style.cssText="margin:0 0 16px 0;padding-left:20px;font-size:12px;color:#334155;max-height:150px;overflow-y:auto;",e.forEach(function(e){var t=document.createElement("li");t.textContent=e,t.style.marginBottom="4px",s.appendChild(t)}),a.appendChild(s)}var i=document.createElement("div");i.style.textAlign="center";var l=document.createElement("button");l.textContent="Got it",l.style.cssText="padding:8px 24px;font-size:13px;font-weight:500;border:none;border-radius:6px;background:#1e40af;color:#fff;cursor:pointer;",l.addEventListener("click",function(){n.remove()}),i.appendChild(l),a.appendChild(i),n.appendChild(a),document.body.appendChild(n)}function p(e){s=e;var n=t("#unsavedIndicator");n&&n.classList.toggle("visible",e)}function g(e){return!!e&&String(e).trim().toLowerCase().endsWith("@lcmcommodities.com")}function h(e){var t=[],n=e.match(/## PARTICIPANTS\n([\s\S]*?)(?=\n## |$)/);return n&&n[1].split("\n").filter(function(e){return e.trim().startsWith("-")}).forEach(function(e){var n=e.match(/^-\s*(.+?)(?:\s*\(([^)]+)\))?\s*$/);if(n){var a=n[1].trim(),r=n[2]?n[2].trim():"";a&&t.push({name:a,email:r})}}),t}function y(e){var t=e.match(/## SUMMARY\n([\s\S]*?)(?=\n## |$)/);return t?t[1].trim():e.split("\n").slice(1).join("\n").trim()}function k(e){var t=e.toLowerCase();return t.includes("onboarding")||t.includes("new client")||t.includes("new account")||t.includes("account opening")?"Onboarding":t.includes("kyc")||t.includes("know your customer")||t.includes("compliance")||t.includes("documents")||t.includes("documentation")?"KYC update":t.includes("rate")||t.includes("pricing")||t.includes("amendment")||t.includes("amended")||t.includes("fee")||t.includes("commission")?"Amended Product/Rate":t.includes("give-up")||t.includes("giveup")||t.includes("give up")?"Give-up":null}function b(e){var t=(e||"").toLowerCase(),n=[];return[{keywords:["give-up","giveup","give up"],task:"Give-up Agreement"},{keywords:["broker agreement","brokerage agreement","brokerage"],task:"Broker Agreement"},{keywords:["annex a","amend annex","amendment"],task:"Amend Annex A"},{keywords:["kyc","know your client","due diligence"],task:"KYC (produced by LCMC)"},{keywords:["external kyc","third party kyc","counterparty kyc"],task:"KYC External"}].forEach(function(e){e.keywords.some(function(e){return t.includes(e)})&&n.push(e.task)}),o(new Set(n))}function w(e){console.log("=== SMARTBRIEF MATCH DEBUG ==="),console.log("Total participants found:",e.length),console.log("All participants:",e),f("SmartBrief: Processing ".concat(e.length," participants"),"info");var t=Array.from(document.querySelectorAll("#assignees input[type=checkbox]")).filter(function(e){return e.dataset.email&&e.dataset.email.trim().length>0}).map(function(e){var t=String(e.value||""),n=String(e.dataset.email||"").toLowerCase(),a=String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim(),r=a.split(" ").filter(Boolean);return{cb:e,raw:t,norm:a,email:n,first:r[0]||"",last:r.length>1?r[r.length-1]:"",isSingleToken:r.length<=1}}),n=[],a=e.filter(function(e){return g(e.email)});return console.log("[SmartBrief] LCM participants:",a.map(function(e){return{name:e.name,email:e.email}})),console.log("[SmartBrief] Team entries:",t.map(function(e){return{raw:e.raw,norm:e.norm,first:e.first,last:e.last,isSingleToken:e.isSingleToken}})),a.forEach(function(e){var a=(e.email||"").toLowerCase(),r=null,o="";a&&(r=t.find(function(e){return e.email&&e.email===a}))&&(o="exact email"),r?(console.log('[SmartBrief] Matched participant "'.concat(e.name,'" (').concat(e.email,') -> team "').concat(r.raw,'" via ').concat(o)),n.push(r.raw)):console.log('[SmartBrief] No match for participant "'.concat(e.name,'" (').concat(e.email,") - no email match found"))}),o(new Set(n))}var S=null;function A(e){var t=document.createElement("div");return t.textContent=String(e||""),t.innerHTML}function E(e){var t=String(e||"").replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"),n=[],a=!1;return t.forEach(function(e){var t=e.match(/^##\s*(.+?)\s*$/);if(t){var r=t[1].trim();return n.push('<div style="margin-top:10px;margin-bottom:6px;color:var(--primary);font-weight:700;font-size:11px;letter-spacing:.6px;text-transform:uppercase;">'.concat(A(r),"</div>")),void(a=!1)}var o=String(e).replace(/^(\s*-\s*)\[(?:\s|x|X)\]\s+/,"$1");o.trim()?(n.push("<div>".concat(A(o),"</div>")),a=!1):a||(n.push('<div style="height:8px"></div>'),a=!0)}),n.join("")}function C(){r(".task-card").forEach(function(e){var t=e.querySelector('[data-role="deadline"]');if(t){var n=function(e){if(!e)return"";var t=new Date(e);if(isNaN(t.getTime()))return"";var n=new Date;n.setHours(0,0,0,0),t.setHours(0,0,0,0);var a=Math.ceil((t-n)/864e5);return a<0?"overdue":a<=3?"warning":""}(t.value);e.classList.remove("deadline-warning","deadline-overdue"),"overdue"===n?e.classList.add("deadline-overdue"):"warning"===n&&e.classList.add("deadline-warning")}})}window.addEventListener("beforeunload",function(e){if(s)return e.preventDefault(),e.returnValue="",""});var L=t("#companyName"),x=t("#brokerLead"),T=t("#initialRequest"),M=t("#introEmail"),N=t("#remindersStart"),R=t("#emailFrequency"),O=t("#extraNote"),D=t("#auditText"),q=t("#tasksRow"),I=t("#taskCards"),B=t("#taskName"),j=t("#saveBtn"),F=t("#newTaskBtn"),G=t("#loadSelectedBtn"),H=t("#openKycPortal"),K=null;function U(e){return new Promise(function(n){var a=t("#confirmDialog"),r=t("#confirmMessage"),o=t("#confirmCancel"),c=t("#confirmOk");if(a&&r&&o&&c){r.textContent=e,a.style.display="flex";var s=function(){a.style.display="none",o.removeEventListener("click",i),c.removeEventListener("click",l)},i=function(){s(),n(!1)},l=function(){s(),n(!0)};o.addEventListener("click",i),c.addEventListener("click",l)}else n(!1)})}j&&j.addEventListener("click",l(a().m(function e(){var t,n;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t=m(),null!==K&&"new"!==K){e.n=2;break}return e.n=1,ze();case 1:0===t.length?v([],"üéâ Excellent! Task completed with all required fields properly filled."):v(t,"‚úÖ New task added successfully!"),e.n=4;break;case 2:return e.n=3,Ue();case 3:0===t.length?v([],"üéâ Perfect! All task details are complete and saved successfully."):v(t,"‚úÖ Changes saved to row ".concat(K,"!"));case 4:p(!1),u(),e.n=6;break;case 5:e.p=5,n=e.v,console.error("Save error:",n),f("‚ùå Save failed: "+n.message,"error");case 6:return e.a(2)}},e,null,[[0,5]])}))),G&&G.addEventListener("click",l(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,He();case 1:f("‚úÖ Loaded row "+K,"success"),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Load error:",t),f("‚ùå Failed to load row","error");case 3:return e.a(2)}},e,null,[[0,2]])}))),F&&F.addEventListener("click",function(){_e()});var P=t("#deleteTaskBtn");P&&P.addEventListener("click",l(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==K&&"new"!==K){e.n=1;break}return f("No task to delete - this is a new task","error"),e.a(2);case 1:return e.n=2,U("Are you sure you want to delete this Task?");case 2:if(e.v){e.n=3;break}return e.a(2);case 3:return e.p=3,e.n=4,Je();case 4:f("‚úÖ Task deleted successfully","success"),_e(),e.n=6;break;case 5:e.p=5,t=e.v,console.error("Delete error:",t),f("‚ùå Failed to delete task: "+t.message,"error");case 6:return e.a(2)}},e,null,[[3,5]])}))),H&&"1"!==H.dataset.kycListenerAttached&&(H.dataset.kycListenerAttached="1",H.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),"1"!==H.dataset.kycOpening&&(H.dataset.kycOpening="1",window.open("http://192.168.1.141:8080/","_blank"),setTimeout(function(){H.dataset.kycOpening="0"},1e3))}));var _=t("#tasksView"),J=t("#statsView"),Y=t("#tasksHeader"),z=t("#statsHeader"),V=t("#openStatsBtn"),$=t("#returnToTasksBtn"),W=t("#refreshStatsBtn");function Z(){return Q.apply(this,arguments)}function Q(){return Q=l(a().m(function r(){var c;return a().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,Excel.run(function(){var r=l(a().m(function r(c){var s,i,l,u,d,f,m,v,p,g,h,y,k,b,w,S,E,C,L,x,T,M,N,R,O,D,q,I,B,j,F;return a().w(function(r){for(;;)switch(r.n){case 0:return(s=c.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),r.n=1,c.sync();case 1:if(!s.isNullObject){r.n=2;break}return console.error("Sheet not found for statistics"),r.a(2);case 2:return(i=s.getRange("A1:K5000")).load("values"),r.n=3,c.sync();case 3:if(!((l=i.values||[]).length<2)){r.n=4;break}return r.a(2);case 4:u=0,d=0,f=0,m={},v={},p={},g=0,h=0,y=[],k=[],b=[],(w=new Date).setHours(0,0,0,0),(S=new Date(w)).setDate(S.getDate()+7),(E=new Date(w)).setDate(E.getDate()-30),C=a().m(function e(){var t,n,r,o,c,s,i,A,C,x,T,M,N;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=l[L],n=t[0]?String(t[0]).trim():""){e.n=1;break}return e.a(2,1);case 1:t[1]&&String(t[1]).trim(),r=t[3]?String(t[3]).trim():"(none)",o=t[4],c=t[5],s=t[6],i=t[7]?String(t[7]).trim():"",A=null,C=X(o),x=X(c),T=X(s),(M=[C,x,T].filter(function(e){return null!==e})).length>0&&(A=M.reduce(function(e,t){return t<e?t:e})),A&&(N="".concat(A.getFullYear(),"-").concat(String(A.getMonth()+1).padStart(2,"0")),v[N]=(v[N]||0)+1),m[r]||(m[r]={total:0,active:0,completed:0}),m[r].total++,i&&i.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes(": to do")?(u++,m[r].active++):t.includes(": in progress")?(d++,m[r].active++):t.includes(": done")&&(f++,m[r].completed++),t.includes("kyc")&&t.includes(": done")){var a=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(a){var o=X(a[1]);if(o){var c="".concat(o.getFullYear(),"-").concat(String(o.getMonth()+1).padStart(2,"0"));p[c]=(p[c]||0)+1}}}var s=e.match(/^(.*?)\s*:\s*(to do|in progress|done)/i),i=e.match(/assigned to\s+([^|]+)/i),l=s?s[1].trim():"Unknown",v=i?i[1].trim():"",A=e.match(/deadline:\s*(\d{4}-\d{2}-\d{2}|\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(A&&!t.includes(": done")){var C=X(A[1]);if(C){var L=Math.ceil((C-w)/864e5);C<w?y.push({company:n,task:l,assignee:v,detail:"".concat(Math.abs(L),"d overdue")}):C<=S&&k.push({company:n,task:l,assignee:v,detail:0===L?"Today":"".concat(L,"d left")})}}if(!t.includes(": done")){var x=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),T=e.match(/updated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),M=null;if(T?M=X(T[1]):x&&(M=X(x[1])),M&&M<E){var N=Math.ceil((w-M)/864e5);b.push({company:n,task:l,assignee:v,detail:"".concat(N,"d ago")})}}if(t.includes(": done")){var R=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),O=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(R&&O){var D=X(R[1]),q=X(O[1]);if(D&&q){var I=Math.ceil((q-D)/864e5);I>=0&&I<365&&(g+=I,h++)}}}});case 2:return e.a(2)}},e)}),L=1;case 5:if(!(L<l.length)){r.n=8;break}return r.d(e(C()),6);case 6:if(!r.v){r.n=7;break}return r.a(3,7);case 7:L++,r.n=5;break;case 8:x=u+d,t("#statActiveTasks").textContent=x,t("#statAvgDuration").textContent=h>0?Math.round(g/h):"-",(T=u+d+f)>0&&(t("#barToDo").style.width=u/T*100+"%",t("#barInProgress").style.width=d/T*100+"%",t("#barDone").style.width=f/T*100+"%"),t("#countToDo").textContent=u,t("#countInProgress").textContent=d,t("#countDone").textContent=f,M=function(e,n,a,r){var o=t("#".concat(n)),c=t("#".concat(a)),s=t("#".concat(r));if(s&&(s.textContent=e.length),o&&c){if(0===e.length)return o.classList.remove("has-items"),void(c.innerHTML="");o.classList.add("has-items"),c.innerHTML=e.slice(0,10).map(function(e){var t=e.assignee?' <span class="to-assignee">to '.concat(A(e.assignee),"</span>"):"";return'<div class="attention-item">\n              <span class="task-info" title="'.concat(A(e.company),": ").concat(A(e.task),'">').concat(A(e.company),": ").concat(A(e.task)).concat(t,'</span>\n              <span class="task-detail">').concat(A(e.detail),"</span>\n            </div>")}).join("")}},y.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),k.sort(function(e,t){return parseInt(e.detail)-parseInt(t.detail)}),b.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),M(y,"overdueGroup","overdueList","statOverdue"),M(k,"upcomingGroup","upcomingList","statUpcoming"),M(b,"staleGroup","staleList","statStale"),(N=t("#monthlyChart"))&&(R=Object.keys(v).sort().reverse().slice(0,6).reverse(),O=Math.max.apply(Math,o(R.map(function(e){return v[e]||0})).concat([1])),D=Math.max.apply(Math,o(R.map(function(e){return p[e]||0})).concat([1])),q=Math.max(O,D),I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],N.innerHTML=R.map(function(e){var t=n(e.split("-"),2),a=(t[0],t[1]),r=I[parseInt(a)-1],o=v[e]||0,c=p[e]||0,s=q>0?c/q*80:0;return'<div class="month-bar-group">\n              <div class="month-bars">\n                <div class="month-bar tasks" style="height:'.concat(q>0?o/q*80:0,'px">\n                  ').concat(o>0?'<span class="month-bar-value">'.concat(o,"</span>"):"",'\n                </div>\n                <div class="month-bar kyc" style="height:').concat(s,'px">\n                  ').concat(c>0?'<span class="month-bar-value">'.concat(c,"</span>"):"",'\n                </div>\n              </div>\n              <div class="month-bar-label">').concat(r,"</div>\n            </div>")}).join("")),(B=t("#brokerChart"))&&(j=Object.entries(m).filter(function(e){var t=n(e,1)[0];return t&&"(none)"!==t&&""!==t.trim()}).sort(function(e,t){return t[1].active+t[1].completed-(e[1].active+e[1].completed)}),F=Math.max.apply(Math,o(j.map(function(e){var t=n(e,2)[1];return t.active+t.completed})).concat([1])),B.innerHTML=j.map(function(e){var t=n(e,2),a=t[0],r=t[1],o=F>0?r.active/F*100:0,c=F>0?r.completed/F*100:0;return'<div class="broker-row">\n              <span class="broker-name" title="'.concat(A(a),'">').concat(A(a),'</span>\n              <div class="broker-bar-track">\n                <div class="broker-bar-fill active" style="width:').concat(o,'%">').concat(r.active>0?'<span class="bar-num">'.concat(r.active,"</span>"):"",'</div>\n                <div class="broker-bar-fill completed" style="width:').concat(c,'%">').concat(r.completed>0?'<span class="bar-num">'.concat(r.completed,"</span>"):"","</div>\n              </div>\n            </div>")}).join(""));case 9:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}());case 1:r.n=3;break;case 2:r.p=2,c=r.v,console.error("Error loading statistics:",c);case 3:return r.a(2)}},r,null,[[0,2]])})),Q.apply(this,arguments)}function X(e){if(!e)return null;if("number"==typeof e&&e>1&&e<1e5){var t=Date.UTC(1899,11,30),n=new Date(t+24*e*60*60*1e3),a=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate());if(!isNaN(a.getTime())&&a.getFullYear()>1970)return a}var r=String(e).trim(),o=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(o){var c=parseInt(o[1],10),s=parseInt(o[2],10)-1,i=parseInt(o[3],10);return new Date(c,s,i)}var l=r.match(/(\d{1,2})[-\s]([A-Za-z]{3})[-\s](\d{2,4})/);if(l){var u=parseInt(l[1]),d={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[l[2].toLowerCase()],f=parseInt(l[3]);if(f<100&&(f+=2e3),void 0!==d)return new Date(f,d,u)}var m=new Date(r);return!isNaN(m.getTime())&&m.getFullYear()>1970?m:null}V&&V.addEventListener("click",function(){_&&(_.style.display="none"),Y&&(Y.style.display="none"),J&&(J.style.display=""),z&&(z.style.display="flex"),Z()}),$&&$.addEventListener("click",function(){_&&(_.style.display=""),Y&&(Y.style.display="flex"),J&&(J.style.display="none"),z&&(z.style.display="none")}),W&&W.addEventListener("click",function(){Z()});var ee=t("#searchInput"),te=t("#searchInputWrap"),ne=t("#searchBtn"),ae=t("#searchResults"),re=t("#searchHint"),oe=r(".search-tab"),ce="active",se=t("#loadRowHint");function ie(){re&&ee&&te&&("active"===ce?(te.style.display="none",se&&(se.style.display="none"),re.textContent="üí° Showing tasks with status: To Do or In Progress"):"company"===ce&&(te.style.display="flex",se&&(se.style.display="flex"),ee.placeholder="Type company name...",ee.type="text",re.textContent=""))}oe.forEach(function(e){e.addEventListener("click",l(a().m(function t(){return a().w(function(t){for(;;)switch(t.n){case 0:if(oe.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),ce=e.getAttribute("data-search"),ee&&(ee.value=""),ie(),"active"!==ce){t.n=2;break}return t.n=1,ge();case 1:t.n=3;break;case 2:ae&&(ae.classList.remove("visible"),ae.innerHTML="");case 3:return t.a(2)}},t)})))}),ne&&ne.addEventListener("click",l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,ge();case 1:return e.a(2)}},e)}))),ee&&ee.addEventListener("keypress",function(){var e=l(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:if("Enter"!==t.key){e.n=1;break}return pe(),e.n=1,ge();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());var le=t("#autocompleteDropdown"),ue=[],de=null;function fe(){return me.apply(this,arguments)}function me(){return me=l(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(ue.length>0)){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=l(a().m(function e(t){var n,r,o,c,s,i;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return e.a(2);case 2:return(r=n.getRange("A2:B5000")).load("values"),e.n=3,t.sync();case 3:for(o=r.values||[],ue=[],c=0;c<o.length;c++)s=o[c][0]?String(o[c][0]).trim():"",i=o[c][1]?String(o[c][1]).trim():"",s&&ue.push({name:s,category:i,rowNum:c+2});console.log("Loaded",ue.length,"company rows for autocomplete");case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("Failed to load company list:",t);case 4:return e.a(2)}},e,null,[[1,3]])})),me.apply(this,arguments)}function ve(e){if(le&&e&&"company"===ce){var t=e.toLowerCase(),n=ue.filter(function(e){return e.name.toLowerCase().includes(t)}),r=n.filter(function(e){return e.name.toLowerCase().startsWith(t)}),c=n.filter(function(e){return!e.name.toLowerCase().startsWith(t)}),s=[].concat(o(r),o(c)).slice(0,15);0!==s.length?(le.innerHTML=s.map(function(e){var t=e.category?" ¬∑ ".concat(A(e.category)):"";return'<div class="autocomplete-item" data-row="'.concat(e.rowNum,'" data-name="').concat(A(e.name),'">\n        <span class="company-name">').concat(A(e.name),'</span>\n        <span class="row-hint">Row ').concat(e.rowNum).concat(t,"</span>\n      </div>")}).join(""),le.classList.add("visible"),le.querySelectorAll(".autocomplete-item").forEach(function(e){e.addEventListener("click",l(a().m(function t(){var n,r;return a().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),r=e.getAttribute("data-name"),ee&&(ee.value=r),pe(),t.n=1,ye(n);case 1:return t.a(2)}},t)})))})):pe()}else pe()}function pe(){le&&(le.classList.remove("visible"),le.innerHTML="")}function ge(){return he.apply(this,arguments)}function he(){return he=l(a().m(function t(){var n;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(ae){t.n=1;break}return t.a(2);case 1:return ae.innerHTML='<div class="no-results">Searching...</div>',ae.classList.add("visible"),console.log("Search started, mode:",ce),t.p=2,t.n=3,Excel.run(function(){var t=l(a().m(function t(n){var r,o,c,s,i,u,d,f,m,v,p;return a().w(function(t){for(;;)switch(t.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),t.n=1,n.sync();case 1:if(console.log("Sheet found:",!r.isNullObject),!r.isNullObject){t.n=2;break}return ae.innerHTML='<div class="no-results">Sheet not found</div>',t.a(2);case 2:return(o=r.getRange("A1:K".concat(5e3))).load("values"),t.n=3,n.sync();case 3:c=o.values||[],console.log("Raw rows loaded (including header and blanks):",c.length),s=Array.isArray(c)?c:[],i=[],u=0,d=a().m(function e(){var t,n,r,o,c,l,d,m,v,p,g,h,y,k,b,w,S,A;return a().w(function(e){for(;;)switch(e.n){case 0:if(y=function(e){if(!e||0===e.length)return"";var t=null;if(e.forEach(function(e){if(e){var n=new Date(e);isNaN(n.getTime())||(!t||n>t)&&(t=n)}}),!t)return"";var n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r)},!(t=s[f]||[]).every(function(e){return null===e||""===e})){e.n=1;break}return e.a(2,1);case 1:u++,n=t[0]?String(t[0]).trim():"",r=t[1]?String(t[1]).trim():"",o=t[7]?String(t[7]).trim():"",c=!1,l="unknown",d=!1,m=!1,v=!1,p=[],g=[],h=[],o&&(o.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=Fe(e);if(t){var n=(t.status||"").toLowerCase();"to do"===n?(d=!0,t.initiated&&p.push(t.initiated)):"in progress"===n?(m=!0,t.updated&&g.push(t.updated)):"done"===n&&(v=!0,t.completed&&h.push(t.completed))}}),c=d||m,m?l="progress":d?l="todo":v&&(l="done")),k="",b="","progress"===l?(b=y(g),k=b?"Updated":""):"todo"===l?(b=y(p),k=b?"Initiated":""):"done"===l&&(b=y(h),k=b?"Completed":""),w=b?Se(b):"",S=f+1,"company"===ce?(A=(ee?ee.value:"").toLowerCase().trim(),console.log("Checking row",S,"- Company:",n,"- Query:",A),A&&n.toLowerCase().includes(A)&&(console.log("Match found:",n),i.push({rowNum:S,companyName:n,taskCategory:r,dominantStatus:l,hasActiveTasks:c,statusDateLabel:k,statusDateDisplay:w}))):"active"===ce&&(console.log("Checking row",S,"- Company:",n,"- Active:",c),c&&i.push({rowNum:S,companyName:n,taskCategory:r,dominantStatus:l,hasActiveTasks:c,statusDateLabel:k,statusDateDisplay:w}));case 2:return e.a(2)}},e)}),f=1;case 4:if(!(f<s.length)){t.n=7;break}return t.d(e(d()),5);case 5:if(!t.v){t.n=6;break}return t.a(3,6);case 6:f++,t.n=4;break;case 7:m=u,v="company"===ce?"Company":"Active tasks",p=(ee?ee.value:"").trim(),console.log("Search complete, mode:",v,"rows scanned:",m,"matches:",i.length,"query:",p),0===i.length?ae.innerHTML='<div class="no-results">No results found</div>':(ae.innerHTML=i.map(function(e){var t="progress"===e.dominantStatus?'<span class="status-badge progress">In Progress</span>':"todo"===e.dominantStatus?'<span class="status-badge todo">To Do</span>':"done"===e.dominantStatus?'<span class="status-badge done">Done</span>':"",n=e.statusDateLabel&&e.statusDateDisplay?" ¬∑ ".concat(e.statusDateLabel," ").concat(A(e.statusDateDisplay)):"";return'<div class="search-result-item" data-row="'.concat(e.rowNum,'">\n              <div class="company">').concat(A(e.companyName||"(No name)")).concat(t,'</div>\n              <div class="meta">Row ').concat(e.rowNum," ¬∑ ").concat(A(e.taskCategory||"No category")).concat(n,"</div>\n            </div>")}).join(""),ae.querySelectorAll(".search-result-item").forEach(function(e){e.addEventListener("click",l(a().m(function t(){var n;return a().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),t.n=1,ye(n);case 1:ae.classList.remove("visible");case 2:return t.a(2)}},t)})))}));case 8:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 3:t.n=5;break;case 4:t.p=4,n=t.v,console.error("Search error:",n),ae.innerHTML='<div class="no-results">Search error</div>';case 5:return t.a(2)}},t,null,[[2,4]])})),he.apply(this,arguments)}function ye(e){return ke.apply(this,arguments)}function ke(){return ke=l(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=l(a().m(function e(n){var r;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}return e.a(2);case 2:return r.getRange("A".concat(t)).select(),e.n=3,n.sync();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.n=2,He();case 2:return e.a(2)}},e)})),ke.apply(this,arguments)}function be(e){return we.apply(this,arguments)}function we(){return we=l(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2,null);case 1:return e.a(2,Excel.run(function(){var e=l(a().m(function e(n){var r,o,c,s,i,l,u,d;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}return e.a(2,null);case 2:return(o=r.getUsedRange()).load("values"),e.n=3,n.sync();case 3:for(c=o.values||[],s=null,i=1;i<c.length;i++)l=c[i],u=l[0]?String(l[0]).trim().toLowerCase():"",d=l[7]?String(l[7]).trim():"",u===t.toLowerCase()&&d&&d.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes("kyc")&&t.includes(": done")){var n=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);n&&(s=n[1])}});return e.a(2,s)}},e)}));return function(t){return e.apply(this,arguments)}}()))}},e)})),we.apply(this,arguments)}function Se(e){if(!e)return"";var t=String(e).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){var n=parseInt(t[1],10),a=parseInt(t[2],10)-1,r=parseInt(t[3],10);return"".concat(r,"-").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a],"-").concat(n)}var o=new Date(e);if(isNaN(o.getTime()))return"";var c=o.getDate(),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o.getMonth()],i=o.getFullYear();return"".concat(c,"-").concat(s,"-").concat(i)}ee&&(ee.addEventListener("input",function(e){if("company"===ce){clearTimeout(de);var t=e.target.value.trim();t.length<1?pe():de=setTimeout(function(){ve(t)},150)}}),ee.addEventListener("focus",l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if("company"!==ce){e.n=2;break}return e.n=1,fe();case 1:ee.value.trim().length>=1&&ve(ee.value.trim());case 2:return e.a(2)}},e)}))),ee.addEventListener("blur",function(){setTimeout(pe,200)})),ie();var Ae=Se;function Ee(){return r("#taskCategories .category-toggle:checked").map(function(e){return e.value})}function Ce(){var e=t('#taskCategories .category-toggle[value="Other Task"]');return e&&e.checked}function Le(e){return"__other__"===e?t("#otherTaskCard"):I?I.querySelector('.task-card[data-task="'.concat(e,'"]')):null}function xe(e){if(!e)return[];var t=e.querySelector('[data-role="status-chips"]');return t?Array.from(t.querySelectorAll(".chip")):[]}function Te(e,t){xe(e).forEach(function(e){e.classList.toggle("active",e.getAttribute("data-value")===t)})}function Me(e){var t=xe(e).find(function(e){return e.classList.contains("active")});return t?t.getAttribute("data-value"):"To Do"}function Ne(){if(q&&I){var e=Ce(),n=t("#otherTaskCard"),a=Ee().some(function(e){return"Other Task"!==e});q.style.display=a?"":"none";var o=new Set(Oe());r("#taskCards .task-card").forEach(function(e){var t=e.getAttribute("data-task");e.style.display=o.has(t)?"":"none"}),n&&(n.style.display=e?"":"none")}}function Re(){if(O){var e=Ee().filter(function(e){return"Other Task"!==e});0===e.length?O.placeholder="General note about this task":1===e.length?O.placeholder="General note about this "+e[0]:O.placeholder="General note about these tasks"}}function Oe(){return r("#tasksChecklist .task-toggle:checked").map(function(e){return e.value})}function De(e){var n=t(e);if(n){var a=Array.from(n.children);if(0!==a.length){var r=[],o=[];a.forEach(function(e){var t=e.querySelector("input[type=checkbox]")||e.querySelector('input[type="checkbox"]');t&&t.checked?r.push(e):o.push(e)}),[].concat(r,o).forEach(function(e){return n.appendChild(e)})}}}function qe(){return Ie.apply(this,arguments)}function Ie(){return Ie=l(a().m(function e(){var n;return a().w(function(e){for(;;)switch(e.n){case 0:if(!c){e.n=1;break}return e.a(2);case 1:if(c=!0,n=t("#assignees")){e.n=2;break}return e.a(2);case 2:if("1"!==n.dataset.initialized){e.n=3;break}return e.a(2);case 3:return n.dataset.initialized="1",n.innerHTML="",e.n=4,Excel.run(function(){var e=l(a().m(function e(t){var r,o,c,s,i;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=t.workbook.worksheets.getItemOrNullObject("Team members")).load("name"),e.n=1,t.sync();case 1:if(!r.isNullObject){e.n=2;break}return console.error("Team members sheet not found"),e.a(2);case 2:return(o=r.getUsedRange()).load("values"),e.n=3,t.sync();case 3:c=o.values||[],s=c.slice(1).map(function(e){return{name:e[0]?String(e[0]).trim():"",email:e[1]?String(e[1]).trim().toLowerCase():""}}).filter(function(e){return e.name&&e.name.length>0}),console.log("Team members loaded from columns A and B:",s),s.forEach(function(e){var t=document.createElement("div");t.innerHTML='<label><input type="checkbox" value="'.concat(e.name,'" data-email="').concat(e.email,'"> ').concat(e.name,"</label>"),n.appendChild(t)}),x&&(x.innerHTML="",(i=document.createElement("option")).value="",i.textContent="(none)",x.appendChild(i),s.forEach(function(e){var t=document.createElement("option");t.value=e.name,t.textContent=e.name,x.appendChild(t)}));case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return e.a(2)}},e)})),Ie.apply(this,arguments)}function Be(){return Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).map(function(e){return e.value})}function je(){var e=Be();r(".task-assignee-select").forEach(function(t){var n=t.value;t.innerHTML="";var a=document.createElement("option");a.value="",a.textContent="(Select assignee)",t.appendChild(a),e.forEach(function(e){var n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),1===e.length?t.value=e[0]:e.includes(n)&&(t.value=n)})}function Fe(e){if(!e)return null;var t=/^(.*?)\s*:\s*(to do|in progress|done)\s*\|\|\s*assigned to\s+([^|]+)/i.exec(e);if(!t)return null;var n={name:t[1].trim(),status:t[2],assignee:t[3].trim(),comment:"",giveUpId:"",initiated:"",updated:"",completed:"",deadline:""},a=/\|\|\s*comment:\s*([^|]+)/i.exec(e);a&&(n.comment=a[1].trim());var r=/\|\|\s*give-up id:\s*([^|]+)/i.exec(e);r&&(n.giveUpId=r[1].trim());var o=/\|\|\s*task initiated:\s*([^|]+)/i.exec(e);o&&(n.initiated=o[1].trim());var c=/\|\|\s*status updated:\s*([^|]+)/i.exec(e);c&&(n.updated=c[1].trim());var s=/\|\|\s*completed:\s*([^|]+)/i.exec(e);s&&(n.completed=s[1].trim());var i=/\|\|\s*deadline:\s*([^|]+)/i.exec(e);return i&&(n.deadline=i[1].trim()),n}function Ge(e){var t=[],n=e.status||"To Do";return t.push("".concat(e.name,": ").concat(n)),t.push("Assigned to ".concat(e.assignees)),e.comment&&t.push("Comment: ".concat(e.comment)),e.giveUpId&&t.push("Give-up ID: ".concat(e.giveUpId)),e.initiated&&t.push("Task initiated: ".concat(e.initiated)),e.updated&&t.push("Status updated: ".concat(e.updated)),e.completed&&t.push("Completed: ".concat(e.completed)),e.deadline&&t.push("Deadline: ".concat(e.deadline)),t.join(" || ")}function He(){return Ke.apply(this,arguments)}function Ke(){return Ke=l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,qe();case 1:return e.n=2,Excel.run(function(){var e=l(a().m(function e(n){var o,c,s,i,l,u,d,f,m,v,p,g,h,y,k,b,w,S,A,E,q,I,j,F,G,H,U,P,_,J,Y,z,V,$,W,Z,Q,X;return a().w(function(e){for(;;)switch(e.n){case 0:return A=function(e){if(null==e||""===e)return"";if("number"==typeof e){var t=Date.UTC(1899,11,30),n=new Date(t+864e5*e),a=n.getUTCFullYear(),r=String(n.getUTCMonth()+1).padStart(2,"0"),o=String(n.getUTCDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(o)}if(e instanceof Date){var c=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return"".concat(c,"-").concat(s,"-").concat(i)}var l=String(e).trim();if(l.match(/^(\d{4})-(\d{2})-(\d{2})$/))return l;var u=l.match(/^(\d{1,2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{4})$/i);if(u){var d=parseInt(u[1],10),f={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[u[2].toLowerCase()],m=parseInt(u[3],10),v=String(d).padStart(2,"0"),p=String(f+1).padStart(2,"0");return"".concat(m,"-").concat(p,"-").concat(v)}var g=new Date(e);if(!isNaN(g.getTime())){var h=g.getFullYear(),y=String(g.getMonth()+1).padStart(2,"0"),k=String(g.getDate()).padStart(2,"0");return"".concat(h,"-").concat(y,"-").concat(k)}return l.length>=10?l.slice(0,10):""},(o=n.workbook.getSelectedRange()).load("rowIndex"),e.n=1,n.sync();case 1:return c=o.rowIndex+1,(s=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=2,n.sync();case 2:if(!s.isNullObject){e.n=3;break}return e.a(2);case 3:return i=s.getRange("A".concat(c)),l=s.getRange("B".concat(c)),u=s.getRange("C".concat(c)),d=s.getRange("D".concat(c)),f=s.getRange("E".concat(c,":G").concat(c)),m=s.getRange("H".concat(c)),v=s.getRange("J".concat(c)),p=s.getRange("K".concat(c)),i.load("values"),l.load("values"),u.load("values"),d.load("values"),f.load("values"),m.load("values"),v.load("values"),p.load("values"),e.n=4,n.sync();case 4:for(g=i.values&&i.values[0]&&i.values[0][0]?String(i.values[0][0]):"",L&&(L.value=g),h=l.values&&l.values[0]&&l.values[0][0]?String(l.values[0][0]):"",y=h.split(",").map(function(e){return e.trim()}).filter(Boolean),r("#taskCategories .category-toggle").forEach(function(e){var t=y.some(function(t){return t.toLowerCase()===e.value.toLowerCase()});e.checked=t}),k=d.values&&d.values[0]&&d.values[0][0]?String(d.values[0][0]):"",x&&(x.value=k),b=u.values&&u.values[0]&&u.values[0][0]?String(u.values[0][0]):"",w=b.split(/[,;]+/).map(function(e){return e.trim().toLowerCase()}).filter(Boolean),console.log("Assignees from column C:",w),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=w.includes(e.value.toLowerCase())}),S=f.values&&f.values[0]?f.values[0]:[null,null,null],console.log("Date values from Excel:",S),T&&(T.value=A(S[0])),M&&(M.value=A(S[1])),N&&(N.value=A(S[2])),console.log("Parsed dates:",null==T?void 0:T.value,null==M?void 0:M.value,null==N?void 0:N.value),E=v.values&&v.values[0]&&v.values[0][0]?String(v.values[0][0]):"",R&&(R.value=E),q=p.values&&p.values[0]&&p.values[0][0]?String(p.values[0][0]):"",O&&(O.value=q),I=m.values&&m.values[0]&&m.values[0][0]?String(m.values[0][0]):"",j=I.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),F=[],G=[],H=0;H<j.length;H++)(U=Fe(j[H]))?F.push(U):G.push(j[H]);P={"to do":1,"in progress":2,done:3},F.sort(function(e,t){return(P[(e.status||"").toLowerCase()]||4)-(P[(t.status||"").toLowerCase()]||4)}),console.log("Parsed tasks:",F),je(),r("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),r("#taskCards .task-card, #otherTaskCard").forEach(function(e){xe(e).forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]'),n=e.querySelector('[data-role="deadline"]'),a=e.querySelector('[data-role="giveUpId"]'),r=e.querySelector('[data-role="task-assignee"]');t&&(t.value=""),n&&(n.value=""),a&&(a.value=""),r&&(r.value="")}),Ce()?(_=Le("__other__"))&&(J=F[0]||null,B&&(B.value=J&&J.name?J.name:""),J&&(Y=(J.status||"").toLowerCase(),Te(_,"in progress"===Y?"In Progress":"done"===Y?"Done":"To Do"),z=_.querySelector('[data-role="comment"]'),V=_.querySelector('[data-role="deadline"]'),$=_.querySelector('[data-role="task-assignee"]'),z&&(z.value=J.comment||""),V&&(V.value=(J.deadline||"").slice(0,10)),$&&J.assignee&&($.value=J.assignee.trim()))):r("#tasksChecklist .task-toggle").forEach(function(e){var t=e.value,n=F.find(function(e){var n=(e.name||"").toLowerCase(),a=t.toLowerCase();return n===a||"kyc (produced by lcmc)"===a&&"kyc (internal)"===n});e.checked=!!n;var a=Le(t);if(a&&n){var r=(n.status||"").toLowerCase();Te(a,"in progress"===r?"In Progress":"done"===r?"Done":"To Do");var o=a.querySelector('[data-role="comment"]'),c=a.querySelector('[data-role="deadline"]'),s=a.querySelector('[data-role="giveUpId"]'),i=a.querySelector('[data-role="task-assignee"]');o&&(o.value=n.comment||""),c&&(c.value=(n.deadline||"").slice(0,10)),s&&(s.value=n.giveUpId||""),i&&n.assignee&&(i.value=n.assignee.trim())}}),D&&(W=null,F.length>0&&(W=F[0]),W?(Z=[],W.initiated&&Z.push("Task initiated: ".concat(W.initiated)),W.updated&&Z.push("Status updated: ".concat(W.updated)),W.completed&&Z.push("Completed: ".concat(W.completed)),D.textContent=Z.join(" | ")):D.textContent=""),(Q=t("#lastKycDate"))&&g?(X=null,F.forEach(function(e){e.name&&e.name.toLowerCase().includes("kyc")&&e.status&&"done"===e.status.toLowerCase()&&e.completed&&(X=e.completed)}),X?Q.textContent=X:be(g).then(function(e){Q.textContent=e||"‚Äî"})):Q&&(Q.textContent="‚Äî"),Ne(),$e(),Re(),De("#assignees"),De("#tasksChecklist"),De("#taskCategories"),K=c,C(),et(),Ze&&Ze.classList.remove("visible");case 5:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e)})),Ke.apply(this,arguments)}function Ue(){return Pe.apply(this,arguments)}function Pe(){return Pe=l(a().m(function e(){var t,n,r;return a().w(function(e){for(;;)switch(e.n){case 0:return t=Ee().join(", "),n=Be().join(", "),r=Ce(),console.log("Saving - Categories:",t,"Assignees:",n,"IsOther:",r),e.n=1,Excel.run(function(){var e=l(a().m(function e(o){var c,s,i,l,u,d,f,m,v,p,g,h,y,k,b,w,S,A,E,C,D,q,I,j,F,G,H,K,U,P,_,J,Y,z,V,$,W,Z,Q;return a().w(function(e){for(;;)switch(e.n){case 0:return(c=o.workbook.getSelectedRange()).load("rowIndex"),e.n=1,o.sync();case 1:return s=c.rowIndex+1,(i=o.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=2,o.sync();case 2:if(!i.isNullObject){e.n=3;break}return e.a(2);case 3:return(l=i.getRange("E".concat(s,":G").concat(s))).load("values"),u=i.getRange("A".concat(s)),d=i.getRange("B".concat(s)),f=i.getRange("C".concat(s)),m=i.getRange("D".concat(s)),v=i.getRange("H".concat(s)),p=i.getRange("J".concat(s)),g=i.getRange("K".concat(s)),v.load("values"),e.n=4,o.sync();case 4:return h=l.values&&l.values[0]?l.values[0]:[null,null,null],T&&(h[0]=Ae(T.value)),M&&(h[1]=Ae(M.value)),N&&(h[2]=Ae(N.value)),l.values=[h],d.values=[[t]],x&&(m.values=[[x.value||""]]),L&&(u.values=[[L.value||""]]),f.values=[[n]],console.log("Saving assignees to column C:",n),R&&(p.values=[[R.value||""]]),O&&(g.values=[[O.value||""]]),y=v.values&&v.values[0]&&v.values[0][0]?String(v.values[0][0]):"",k=y.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),b=k.filter(function(e){return!Fe(e)}),w=[],S={},k.forEach(function(e){var t=Fe(e);t&&(S[t.name.toLowerCase()]=t)}),A=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))},E=function(e,t,n){var a=A(),r=n?(n.status||"").toLowerCase():"",o=(t||"").toLowerCase(),c=n&&n.initiated?n.initiated:"",s=n&&n.updated?n.updated:"",i=n&&n.completed?n.completed:"",l=c||s||i;return"to do"===o?(c=c||a,s="",i=""):"in progress"===o?(l&&r===o||(s=a),c="",i=""):"done"===o&&(l&&i&&r===o||(i=a),c="",s=""),{initiated:c,updated:s,completed:i}},r?(C=Le("__other__"),(D=B?B.value.trim():"")&&(q=Me(C)||"To Do",I=C?C.querySelector('[data-role="comment"]'):null,j=C?C.querySelector('[data-role="deadline"]'):null,F=C?C.querySelector('[data-role="task-assignee"]'):null,G=F&&F.value?F.value:n,H=S[D.toLowerCase()],K=E(0,q,H),U={name:D,status:q,assignees:G,comment:I?I.value.trim():"",giveUpId:"",initiated:K.initiated,updated:K.updated,completed:K.completed,deadline:j?j.value:""},P=Ge(U),w.push({line:P,status:q}))):(_=Oe(),J=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],_.forEach(function(e){if(J.includes(e)){var t=Le(e);if(t){var a=Me(t),r=t.querySelector('[data-role="comment"]'),o=t.querySelector('[data-role="deadline"]'),c=t.querySelector('[data-role="giveUpId"]'),s=t.querySelector('[data-role="task-assignee"]'),i=s&&s.value?s.value:n,l=S[e.toLowerCase()];l||"kyc (produced by lcmc)"!==e.toLowerCase()||(l=S["kyc (internal)"]);var u=E(0,a,l),d={name:e,status:a,assignees:i,comment:r?r.value.trim():"",giveUpId:c?c.value.trim():"",initiated:u.initiated,updated:u.updated,completed:u.completed,deadline:o?o.value:""};w.push({line:Ge(d),status:a})}}})),Y={"to do":1,"in progress":2,done:3},w.sort(function(e,t){return(Y[(e.status||"").toLowerCase()]||4)-(Y[(t.status||"").toLowerCase()]||4)}),z=w.map(function(e){return e.line}),V=b.concat(z).filter(Boolean).join("\n"),console.log("Saving to H - newTaskLines:",z,"newValue:",V),v.values=[[V]],z.length>0&&($=!1,W=!1,Z=!1,z.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?$=!0:t.includes(": to do")?W=!0:t.includes(": done")&&(Z=!0)}),Q=$?"#ff9900":W?"#34a853":Z?"#cc6666":"#34a853",v.format.font.color=Q),e.n=5,o.sync();case 5:console.log("Save completed successfully for row",s);case 6:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),Pe.apply(this,arguments)}function _e(){L&&(L.value=""),r("#taskCategories .category-toggle").forEach(function(e){e.checked=!1}),x&&(x.value=""),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=!1}),T&&(T.value=""),M&&(M.value=""),N&&(N.value=""),R&&(R.value=""),O&&(O.value=""),r("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),r("#taskCards .task-card, #otherTaskCard").forEach(function(e){e.querySelectorAll('[data-role="status-chips"] .chip').forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]');t&&(t.value="");var n=e.querySelector('[data-role="deadline"]');n&&(n.value="");var a=e.querySelector('[data-role="giveUpId"]');a&&(a.value="");var r=e.querySelector('[data-role="task-assignee"]');r&&(r.value="")}),B&&(B.value=""),D&&(D.textContent="");var e=t("#lastKycDate");e&&(e.textContent="‚Äî"),ae&&(ae.classList.remove("visible"),ae.innerHTML=""),Ze&&Ze.classList.remove("visible"),K="new",et(),$e(),Ne(),Re(),setTimeout(function(){var e=document.querySelector('#taskCards .task-card:not([style*="display: none"]), #otherTaskCard:not([style*="display: none"])');if(e){var t=e.querySelector('[data-role="comment"]');t&&"function"==typeof t.focus&&t.focus()}},100)}function Je(){return Ye.apply(this,arguments)}function Ye(){return Ye=l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if(null!==K&&"new"!==K){e.n=1;break}throw new Error("No row to delete");case 1:return e.n=2,Excel.run(function(){var e=l(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("Sheet TASK MANAGER FORM not found");case 2:return n.getRange("".concat(K,":").concat(K)).delete(Excel.DeleteShiftDirection.up),e.n=3,t.sync();case 3:console.log("Deleted row",K);case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e)})),Ye.apply(this,arguments)}function ze(){return Ve.apply(this,arguments)}function Ve(){return Ve=l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=l(a().m(function e(t){var n,r,o,c,s,i,l,u,d,f,m,v,p,g,h,y,k,b,w,S,A,E,C,D,q,I,j,F,G,H,U,P,_,J;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return console.error("Sheet TASK MANAGER FORM not found"),e.a(2);case 2:return(r=n.getRange("A2:A1000")).load("values"),e.n=3,t.sync();case 3:o=2,c=r.values||[],s=0;case 4:if(!(s<c.length)){e.n=7;break}if(!c[s][0]||""===String(c[s][0]).trim()){e.n=5;break}o=s+3,e.n=6;break;case 5:return o=s+2,e.a(3,7);case 6:s++,e.n=4;break;case 7:return i=L?L.value.trim():"",l=Ee().join(", "),u=Ce(),d=x?x.value:"",f=Be().join(", "),n.getRange("A".concat(o)).values=[[i]],n.getRange("B".concat(o)).values=[[l]],n.getRange("C".concat(o)).values=[[f]],n.getRange("D".concat(o)).values=[[d]],m=Ae(T?T.value:""),v=Ae(M?M.value:""),p=Ae(N?N.value:""),n.getRange("E".concat(o,":G").concat(o)).values=[[m,v,p]],n.getRange("J".concat(o)).values=[[R?R.value:""]],n.getRange("K".concat(o)).values=[[O?O.value:""]],g=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))}(),h=[],u?(y=Le("__other__"),(k=B?B.value.trim():"")&&(b=Me(y)||"To Do",w=y?y.querySelector('[data-role="comment"]'):null,S=y?y.querySelector('[data-role="deadline"]'):null,A=y?y.querySelector('[data-role="task-assignee"]'):null,E=A&&A.value?A.value:f,C="",D="",q="","to do"===(I=b.toLowerCase())?C=g:"in progress"===I?D=g:"done"===I&&(q=g),j={name:k,status:b,assignees:E,comment:w?w.value.trim():"",giveUpId:"",initiated:C,updated:D,completed:q,deadline:S?S.value:""},h.push(Ge(j)))):(F=Oe(),G=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],F.forEach(function(e){if(G.includes(e)){var t=Le(e);if(t){var n=Me(t)||"To Do",a=t.querySelector('[data-role="comment"]'),r=t.querySelector('[data-role="deadline"]'),o=t.querySelector('[data-role="giveUpId"]'),c=t.querySelector('[data-role="task-assignee"]'),s=c&&c.value?c.value:f,i="",l="",u="",d=n.toLowerCase();"to do"===d?i=g:"in progress"===d?l=g:"done"===d&&(u=g);var m={name:e,status:n,assignees:s,comment:a?a.value.trim():"",giveUpId:o?o.value.trim():"",initiated:i,updated:l,completed:u,deadline:r?r.value:""};h.push(Ge(m))}}})),(H=n.getRange("H".concat(o))).values=[[h.join("\n")]],h.length>0&&(U=!1,P=!1,_=!1,h.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?U=!0:t.includes(": to do")?P=!0:t.includes(": done")&&(_=!0)}),J=U?"#ff9900":P?"#34a853":_?"#cc6666":"#34a853",H.format.font.color=J),e.n=8,t.sync();case 8:return n.getRange("A".concat(o)).select(),e.n=9,t.sync();case 9:K=o;case 10:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),Ve.apply(this,arguments)}function $e(){[{input:"#initialRequest",display:"#initialRequestDisplay"},{input:"#introEmail",display:"#introEmailDisplay"},{input:"#remindersStart",display:"#remindersStartDisplay"}].forEach(function(e){var n=e.input,a=e.display,r=t(n),o=t(a);if(r&&o){var c=Se(r.value);o.textContent=c?"‚Üí ".concat(c):""}})}r("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){Ne(),Re()})}),document.querySelectorAll("#assignees").forEach(function(e){e.addEventListener("change",function(e){"checkbox"===e.target.type&&je()})});var We=t("#viewEmailSummaryBtn"),Ze=t("#emailSummarySection"),Qe=(t("#emailSummaryList"),t("#emailSummaryCount")),Xe=t("#closeEmailSummaryBtn");function et(){var e=L?L.value.trim():"";We&&(We.disabled=!e)}function tt(){return nt.apply(this,arguments)}function nt(){return nt=l(a().m(function e(){var n,r,o,c,s,i,u,d,m,v,p,C,x,T,M,N,R,O,D,q,I,B,j,F,G,H;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("=== LOADING EMAIL SUMMARIES ==="),n=t("#emailSummaryList")){e.n=1;break}return console.log("emailSummaryList element not found"),e.a(2);case 1:if(L&&L.value.trim()){e.n=2;break}return f("No company name entered","error"),e.a(2);case 2:if(null!==K&&"new"!==K){e.n=3;break}return f("Please save the task first or select an existing row","error"),e.a(2);case 3:return console.log("[SmartBrief] Button clicked, currentRowNum:",K),f("SmartBrief v2: Loading row "+K,"info"),Ze&&Ze.classList.add("visible"),n&&(n.textContent="Loading summary from spreadsheet..."),e.p=4,r="",e.n=5,Excel.run(function(){var e=l(a().m(function e(t){var n,o;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw console.log("[SmartBrief] ERROR: Sheet not found"),new Error("TASK MANAGER FORM sheet not found");case 2:return console.log("[SmartBrief] Sheet found:",n.name),console.log("[SmartBrief] Reading cell L"+K),(o=n.getRange("L".concat(K))).load("values"),e.n=3,t.sync();case 3:r=o.values&&o.values[0]&&o.values[0][0]?String(o.values[0][0]).trim():"",console.log("[SmartBrief] Cell value length:",r.length,"preview:",r.substring(0,80));case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 5:if(r&&(r=r.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),r){e.n=16;break}return console.log("[SmartBrief] Column L empty, triggering VBA via M1..."),f("Column L empty - triggering VBA for row "+K,"info"),n&&(n.textContent="Writing to M1 to trigger VBA macro..."),e.p=6,e.n=7,Excel.run(function(){var e=l(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItem("TASK MANAGER FORM")).getRange("M2").values=[[""]],n.getRange("M1").values=[[K]],e.n=1,t.sync();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 7:f("Wrote "+K+" to M1 - waiting for VBA...","info"),e.n=9;break;case 8:return e.p=8,f("Error writing to M1: "+(G=e.v).message,"error"),n&&(n.textContent="Error: "+G.message),e.a(2);case 9:o=0,c=60,s=!1;case 10:if(!(o<c)||s){e.n=13;break}return e.n=11,new Promise(function(e){return setTimeout(e,500)});case 11:return o++,e.n=12,Excel.run(function(){var e=l(a().m(function e(t){var n,r,o;return a().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook.worksheets.getItem("TASK MANAGER FORM"),(r=n.getRange("M2")).load("values"),e.n=1,t.sync();case 1:if(!(o=r.values[0][0])||!String(o).startsWith("DONE:")){e.n=3;break}return s=!0,console.log("[SmartBrief] VBA completed:",o),r.values=[[""]],e.n=2,t.sync();case 2:e.n=4;break;case 3:if(!o||!String(o).startsWith("ERROR:")){e.n=4;break}return console.log("[SmartBrief] VBA error:",o),s=!0,r.values=[[""]],e.n=4,t.sync();case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 12:e.n=10;break;case 13:if(!s){e.n=15;break}return e.n=14,Excel.run(function(){var e=l(a().m(function e(t){var n,o;return a().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook.worksheets.getItem("TASK MANAGER FORM"),(o=n.getRange("L".concat(K))).load("values"),e.n=1,t.sync();case 1:r=o.values&&o.values[0]&&o.values[0][0]?String(o.values[0][0]).trim():"",console.log("[SmartBrief] After VBA, column L value:",r.substring(0,80));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 14:e.n=16;break;case 15:console.log("[SmartBrief] VBA trigger timed out");case 16:if(Qe&&(Qe.textContent=r?"1":"0"),r){e.n=17;break}return n&&(n.innerHTML='\n            <div class="email-no-summaries">\n              No email summary found for this row.<br>\n              <small>Run the SmartBrief macro (Alt+F8 ‚Üí SmartBrief) to fetch summaries.</small>\n            </div>'),e.a(2);case 17:i=r.split(/\n/),u=(i[0]||"").trim(),d=i.slice(1).join("\n").replace(/^\n+/,"").trim(),m=u.match(/^\[(\d+)%\s*match\]\s*(.*)$/),v=100,p="Email Summary",C=r,m?(v=parseInt(m[1],10),p=(m[2]||"").trim()||"Email Summary",C=d):i.length>1?(p=u||"Email Summary",C=d):(p="Email Summary",C=r.trim()),x="match-high",v<70&&(x="match-medium"),v<50&&(x="match-low"),T=h(r),M=k(r),N=w(T),R=y(r),O=b(r),S={participants:T,detectedCategory:M,matchedAssignees:N,summaryNotes:R,suggestedTasks:O,matchPercent:v,subject:p},D="",T.length>0&&(q=T.map(function(e){var t=g(e.email)?"participant-chip matched":"participant-chip",n=e.email?e.email:e.name;return'<span class="'.concat(t,'" title="').concat(A(n),'">').concat(A(e.name),"</span>")}).join(""),D='\n          <div class="participants-section">\n            <div class="participants-label">Participants:</div>\n            <div class="participants-chips">'.concat(q,"</div>\n          </div>\n        ")),I="",v<50&&(I='\n          <div class="match-warning">\n            ‚ö†Ô∏è Low confidence match ('.concat(v,"%) ‚Äî verify this is the correct email thread\n          </div>\n        ")),B="",(M||N.length>0||R)&&(B='\n          <div class="smartbrief-actions">\n            <button id="applySmartBriefBtn" class="btn-apply-smartbrief">\n              ‚ú® Review & Apply to Task\n            </button>\n          </div>\n        '),j=(j=(j=C).replace(/## PARTICIPANTS[\s\S]*?(?=## |$)/,"").trim()).replace(/^\n+/,"").replace(/\n{3,}/g,"\n\n"),n&&(n.innerHTML="\n          ".concat(I,'\n          <div class="email-summary-item">\n            <div class="email-summary-subject">\n              ').concat(A(p),'\n              <span class="match-score ').concat(x,'" title="Match score from SmartBrief">\n                ').concat(v,"% match\n              </span>\n            </div>\n            ").concat(D,'\n            <div class="email-summary-text">').concat(E(j),"</div>\n          </div>\n          ").concat(B,"\n        "),(F=t("#applySmartBriefBtn"))&&F.addEventListener("click",function(){return at()})),e.n=19;break;case 18:e.p=18,H=e.v,console.error("Error loading email summary from column L:",H),n&&(n.innerHTML='<div class="email-no-summaries">Error reading summary: '.concat(A(H.message),"</div>"));case 19:return e.a(2)}},e,null,[[6,8],[4,18]])})),nt.apply(this,arguments)}function at(){if(S){var e=S,a=e.detectedCategory,c=e.matchedAssignees,s=(e.summaryNotes,e.suggestedTasks),l="",u=!1;if(a&&(u=!0,l+='\n        <div class="smartbrief-suggestion-item">\n          <label>\n            <input type="checkbox" id="sbApplyCategory" checked>\n            <span class="suggestion-label">Task Category:</span>\n            <span class="suggestion-value">'.concat(A(a),"</span>\n          </label>\n        </div>\n      ")),c&&c.length>0){u=!0;var d=c.map(function(e,t){return'\n        <label class="assignee-checkbox-item">\n          <input type="checkbox" class="sb-assignee-checkbox" data-assignee="'.concat(A(e),'" checked>\n          <span>').concat(A(e),"</span>\n        </label>\n      ")}).join("");l+='\n        <div class="smartbrief-suggestion-item smartbrief-assignees-group">\n          <div class="suggestion-label">Assignees:</div>\n          <div class="assignee-checkboxes-list">\n            '.concat(d,"\n          </div>\n        </div>\n      ")}if(s&&s.length>0){u=!0;var m=s.map(function(e){var t=function(e){var t=i.get(e);if(!t||0===t.size)return null;var n=0,a=null;return t.forEach(function(e,t){e>n&&(n=e,a=t)}),a}(e),n="";return t&&(n='\n            <span class="task-assignee-suggestion">\n              ‚Üí <input type="checkbox" class="sb-assignee-suggest" data-task="'.concat(A(e),'" data-assignee="').concat(A(t),'" checked>\n              <span style="color:#1e40af;font-weight:500;">').concat(A(t),"</span>\n            </span>\n          ")),'\n          <label class="assignee-checkbox-item">\n            <input type="checkbox" class="sb-task-checkbox" data-task="'.concat(A(e),'" checked>\n            <span>').concat(A(e)).concat(n,"</span>\n          </label>\n        ")}).join("");l+='\n        <div class="smartbrief-suggestion-item smartbrief-assignees-group">\n          <div class="suggestion-label">Suggested Tasks <span style="font-size:11px;color:#64748b;">(with pattern-based assignees)</span>:</div>\n          <div class="assignee-checkboxes-list">\n            '.concat(m,"\n          </div>\n        </div>\n      ")}if(!u){f("No suggestions available - but check for missing fields","info");var v=[];T&&!T.value&&v.push("Initial Request Date"),N&&!N.value&&v.push("Reminders Start Date"),x&&!x.value&&v.push("Broker Lead");var g=t("#emailFrequency");return g&&("SELECT"===g.tagName?g.selectedIndex<=0||!g.value:!g.value||""===g.value.trim())&&v.push("Email Frequency"),0===document.querySelectorAll("#tasksChecklist .task-toggle:checked").length&&v.push("Task Selection"),0===document.querySelectorAll("#assignees input[type=checkbox]:checked").length&&v.push("Assignees"),void(v.length>0&&setTimeout(function(){f("‚ö†Ô∏è Still needed: ".concat(v.join(", "),". Click Save when done!"),"info",1e4)},2e3))}var h=document.createElement("div");h.className="confirm-overlay",h.id="smartbriefConfirmOverlay";var y=document.createElement("div");y.className="confirm-box smartbrief-confirm-box",y.innerHTML='\n      <div class="smartbrief-confirm-header">\n        <span class="sparkle">‚ú®</span> Review Suggestions\n      </div>\n      <p class="smartbrief-confirm-desc">Select which items to apply to the task:</p>\n      <div class="smartbrief-suggestions">\n        '.concat(l,'\n      </div>\n      <div class="smartbrief-confirm-buttons">\n        <button class="btn-confirm-cancel" id="sbCancel">Cancel</button>\n        <button class="btn-apply-confirmed" id="sbApply">Apply Selected</button>\n      </div>\n    '),h.appendChild(y),document.body.appendChild(h);var k=h.querySelector("#sbCancel"),b=h.querySelector("#sbApply");k.addEventListener("click",function(){return h.remove()}),b.addEventListener("click",function(){var e,a,c=null===(e=h.querySelector("#sbApplyCategory"))||void 0===e?void 0:e.checked,s=null===(a=h.querySelector("#sbApplyNotes"))||void 0===a?void 0:a.checked,i=[];h.querySelectorAll(".sb-assignee-checkbox:checked").forEach(function(e){i.push(e.getAttribute("data-assignee"))});var l=[];h.querySelectorAll(".sb-task-checkbox:checked").forEach(function(e){l.push(e.getAttribute("data-task"))});var u={};h.querySelectorAll(".sb-assignee-suggest:checked").forEach(function(e){var t=e.getAttribute("data-task"),n=e.getAttribute("data-assignee");u[t]||(u[t]=[]),u[t].push(n)}),h.remove(),function(e,a,c){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(S){var l=S,u=l.detectedCategory,d=(l.summaryNotes,l.matchedAssignees,[]);e&&u&&(document.querySelectorAll("#taskCategories .category-toggle").forEach(function(e){e.value===u&&(e.checked=!0,d.push("Category: ".concat(u)))}),Ne());var m=[];document.querySelectorAll("#smartbriefConfirmOverlay .sb-assignee-checkbox:checked").forEach(function(e){m.push(e.value)});var v=new Map,g=new Set;Object.entries(i).forEach(function(e){var t=n(e,2),a=t[0],r=t[1];v.set(a,r),r.forEach(function(e){return g.add(e)})});var h=new Set([].concat(m,o(g)));h.size>0&&(r("#assignees input[type=checkbox]").forEach(function(e){h.has(e.value)&&(e.checked=!0)}),je(),De("#assignees"),d.push("Assignees: ".concat(o(h).join(", ")))),s&&s.length>0&&(document.querySelectorAll("#tasksChecklist .task-toggle").forEach(function(e){s.includes(e.value)&&(e.checked=!0,e.dispatchEvent(new Event("change",{bubbles:!0})))}),je(),setTimeout(function(){s.forEach(function(e){var t=v.get(e)||[],n=t.length>0?t[0]:null;if(n){var a=document.querySelector('#taskCards .task-card[data-task="'.concat(e,'"]'));if(a){var r=a.querySelector(".task-assignee-select");r&&Array.from(r.options).find(function(e){return e.value===n})&&(r.value=n,r.style.backgroundColor="#f0f9ff",r.title="Auto-suggested based on pattern: ".concat(e," ‚Üí ").concat(n))}}})},100),document.querySelectorAll("#taskCards .task-card").forEach(function(e){var t=e.querySelectorAll('.chip[data-value="To Do"]');t.length>0&&(e.querySelectorAll(".chip").forEach(function(e){return e.classList.remove("active")}),t.forEach(function(e){return e.classList.add("active")}))}),d.push("Tasks: ".concat(s.join(", "))));var y=[];T&&!T.value&&y.push("Initial Request Date"),N&&!N.value&&y.push("Reminders Start Date"),x&&!x.value&&y.push("Broker Lead");var k=t("#emailFrequency");if(k&&("SELECT"===k.tagName?k.selectedIndex<=0||!k.value:!k.value||""===k.value.trim())&&y.push("Email Frequency"),0===document.querySelectorAll("#tasksChecklist .task-toggle:checked").length&&y.push("Task Selection"),0===document.querySelectorAll("#assignees input[type=checkbox]:checked").length&&y.push("Assignees"),d.length>0){p(!0);var b="";y.length>0&&(b="‚ö†Ô∏è Still needed: ".concat(y.join(", "),". ")),f(b+='‚ú® Applied to form - Click "Save Changes" to confirm!',"success",1e4);var w=document.getElementById("saveBtn");w&&(w.style.animation="pulse 2s ease-in-out 3",setTimeout(function(){w.style.animation=""},6e3))}else f("No items selected","info")}}(c,i,s,l,u)}),h.addEventListener("click",function(e){e.target===h&&h.remove()})}else f("No SmartBrief data available","error")}L&&(L.addEventListener("input",et),L.addEventListener("change",et)),console.log("[SmartBrief] emailSummaryBtn element:",We),We?(console.log("[SmartBrief] Attaching click handler to emailSummaryBtn"),We.addEventListener("click",l(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return console.log("[SmartBrief] Button clicked!"),e.n=1,tt();case 1:return e.a(2)}},e)})))):console.error("[SmartBrief] emailSummaryBtn NOT FOUND in DOM!"),Xe&&Xe.addEventListener("click",function(){Ze&&Ze.classList.remove("visible")}),"undefined"!=typeof Office&&"function"==typeof Office.onReady&&Office.onReady(function(e){e.host===Office.HostType.Excel&&(r('#taskCards [data-role="status-chips"] .chip, #otherTaskCard [data-role="status-chips"] .chip').forEach(function(e){e.addEventListener("click",function(){var t=e.closest('[data-role="status-chips"]');t&&Array.from(t.querySelectorAll(".chip")).forEach(function(t){t.classList.toggle("active",t===e)})})}),["#initialRequest","#introEmail","#remindersStart"].forEach(function(e){var n=t(e);n&&n.addEventListener("change",$e)}),r('[data-role="deadline"]').forEach(function(e){e.addEventListener("change",function(){C()})}),r("input, select, textarea").forEach(function(e){e.addEventListener("change",function(){return p(!0)}),e.addEventListener("input",function(){return p(!0)})}),r(".chip").forEach(function(e){e.addEventListener("click",function(){return p(!0)})}),r("#tasksChecklist .task-toggle").forEach(function(e){e.addEventListener("change",function(){return Ne()})}),r("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){return Ne()})}),He().then(function(){p(!1),u(),ge()}))})}()}();
//# sourceMappingURL=taskpane.js.map