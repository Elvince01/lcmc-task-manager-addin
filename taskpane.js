/*! For license information please see taskpane.js.LICENSE.txt */
!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){if(null!=t){var n=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o,c,s=[],i=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(a=o.call(n)).done)&&(s.push(a.value),s.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw r}}return s}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",c=n.toStringTag||"@@toStringTag";function s(n,a,o,c){var s=a&&a.prototype instanceof u?a:u,l=Object.create(s.prototype);return r(l,"_invoke",function(n,a,r){var o,c,s,u=0,l=r||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,c=0,s=e,f.n=n,i}};function m(n,a){for(c=n,s=a,t=0;!d&&u&&!r&&t<l.length;t++){var r,o=l[t],m=f.p,p=o[2];n>3?(r=p===a)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=m&&((r=n<2&&m<o[1])?(c=0,f.v=a,f.n=o[1]):m<p&&(r=n<3||o[0]>a||a>p)&&(o[4]=n,o[5]=a,f.n=p,c=0))}if(r||n>1)return i;throw d=!0,a}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&m(l,p),c=l,s=p;(t=c<2?e:s)||!d;){o||(c?c<3?(c>1&&(f.n=-1),m(c,s)):f.n=s:f.v=s);try{if(u=2,o){if(c||(r="next"),t=o[r]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),c=1);o=e}else if((t=(d=f.n<0)?s:n.call(a,f))!==i)break}catch(t){o=e,c=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,o,c),!0),l}var i={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][o]?t(t([][o]())):(r(t={},o,function(){return this}),t),m=d.prototype=u.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,r(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=d,r(m,"constructor",d),r(d,"constructor",l),l.displayName="GeneratorFunction",r(d,c,"GeneratorFunction"),r(m),r(m,c,"Generator"),r(m,o,function(){return this}),r(m,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:p}})()}function r(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}r=function(e,t,n,a){function c(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(c("next",0),c("throw",1),c("return",2))},r(e,t,n,a)}function o(e,t,n,a,r,o,c){try{var s=e[o](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(a,r)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var c=e.apply(t,n);function s(e){o(c,a,r,s,i,"next",e)}function i(e){o(c,a,r,s,i,"throw",e)}s(void 0)})}}function s(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}!function(){var e=function(e){return document.querySelector(e)},r=function(e){return Array.from(document.querySelectorAll(e))},o=!1,i=!1;function u(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=e("#toast");a&&(a.textContent=t,a.className="toast "+n+" show",setTimeout(function(){a.classList.remove("show")},3e3))}function l(){var t=[],n=e("#companyName");n&&n.value.trim()||t.push("Company Name"),0===Array.from(document.querySelectorAll(".category-toggle:checked")).length&&t.push("Task Category");var a=e("#brokerLead");a&&a.value||t.push("Broker Lead"),0===Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).length&&t.push("Assigned To"),Array.from(document.querySelectorAll(".task-card")).filter(function(e){return"none"!==e.style.display&&"otherTaskCard"!==e.id}).forEach(function(e){var n=e.dataset.task||"Task",a=e.querySelector(".chip.active"),r=e.querySelector('[data-role="deadline"]');a||t.push("".concat(n,": Status")),r&&r.value||t.push("".concat(n,": Deadline"))});var r=e("#otherTaskCard");if(r&&"none"!==r.style.display){var o=e("#taskName");o&&o.value.trim()||t.push("Other Task: Task Name"),r.querySelector(".chip.active")||t.push("Other Task: Status");var c=r.querySelector('[data-role="deadline"]');c&&c.value||t.push("Other Task: Deadline")}return t}function d(e){var t=document.createElement("div");t.className="confirm-overlay",t.id="missingFieldsOverlay";var n=document.createElement("div");n.className="confirm-box",n.style.maxWidth="320px",n.style.textAlign="left";var a=document.createElement("p");a.innerHTML='<strong style="color:#f59e0b;">‚ö†Ô∏è Missing Fields</strong>',a.style.marginBottom="12px",a.style.textAlign="center",n.appendChild(a);var r=document.createElement("p");r.textContent="The following fields are empty:",r.style.fontSize="12px",r.style.color="#64748b",r.style.marginBottom="8px",n.appendChild(r);var o=document.createElement("ul");o.style.cssText="margin:0 0 16px 0;padding-left:20px;font-size:12px;color:#334155;max-height:150px;overflow-y:auto;",e.forEach(function(e){var t=document.createElement("li");t.textContent=e,t.style.marginBottom="4px",o.appendChild(t)}),n.appendChild(o);var c=document.createElement("div");c.style.textAlign="center";var s=document.createElement("button");s.textContent="Got it",s.style.cssText="padding:8px 24px;font-size:13px;font-weight:500;border:none;border-radius:6px;background:#1e40af;color:#fff;cursor:pointer;",s.addEventListener("click",function(){t.remove()}),c.appendChild(s),n.appendChild(c),t.appendChild(n),document.body.appendChild(t)}function f(t){i=t;var n=e("#unsavedIndicator");n&&n.classList.toggle("visible",t)}function m(e){var t=[],n=e.match(/## PARTICIPANTS\n([\s\S]*?)(?=\n## |$)/);return n&&n[1].split("\n").filter(function(e){return e.trim().startsWith("-")}).forEach(function(e){var n=e.match(/^-\s*(.+?)(?:\s*\(([^)]+)\))?\s*$/);if(n){var a=n[1].trim(),r=n[2]?n[2].trim():"";a&&t.push({name:a,email:r})}}),t}function p(e){var t=e.match(/## SUMMARY\n([\s\S]*?)(?=\n## |$)/);return t?t[1].trim():e.split("\n").slice(1).join("\n").trim()}function v(e){var t=e.toLowerCase();return t.includes("onboarding")||t.includes("new client")||t.includes("new account")||t.includes("account opening")?"Onboarding":t.includes("kyc")||t.includes("know your customer")||t.includes("compliance")||t.includes("documents")||t.includes("documentation")?"KYC update":t.includes("rate")||t.includes("pricing")||t.includes("amendment")||t.includes("amended")||t.includes("fee")||t.includes("commission")?"Amended Product/Rate":t.includes("give-up")||t.includes("giveup")||t.includes("give up")?"Give-up":null}function g(e){var t=Array.from(document.querySelectorAll("#assignees input[type=checkbox]")),n=t.map(function(e){return e.value.toLowerCase()}),a=[];return e.filter(function(e){if(!e.email)return!1;var t=e.email.toLowerCase();return t.endsWith("@lcmcommodities.com")||t.endsWith("@lcmc.com")}).forEach(function(e){var r=e.name.toLowerCase(),o=n.findIndex(function(e){return e===r});if(-1===o){var c=r.split(" ")[0];o=n.findIndex(function(e){return e.startsWith(c)||e.includes(c)})}if(-1===o&&e.email){var s=e.email.split("@")[0].toLowerCase();o=n.findIndex(function(e){var t=e.split(" ")[0];return s.includes(t)||t.includes(s)})}-1!==o&&a.push(t[o].value)}),s(new Set(a))}var h=null;function y(e,t,n,a){return k.apply(this,arguments)}function k(){return(k=c(a().m(function e(t,n,r,o){var c,s,i,l,d,f,m,p,v,g;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return c="".concat("http://192.168.1.141:5002","/api/task-manager/summaries/").concat(encodeURIComponent(t)),e.p=1,e.n=2,fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({initial_request:n,intro_email:r,reminders_start:o,threshold:.5})});case 2:if((s=e.v).ok){e.n=3;break}throw new Error("Server returned ".concat(s.status));case 3:return e.n=4,s.json();case 4:if(i=e.v,0!==(l=Array.isArray(i.summaries)?i.summaries:[]).length){e.n=5;break}return e.a(2,"");case 5:if(d=l[0]||{},f=String(d.subject||"No subject"),m=String(d.summary||"").trim(),p="number"==typeof d.match_score?d.match_score:parseFloat(d.match_score),v=Number.isFinite(p)?Math.round(100*p):0,m){e.n=6;break}return e.a(2,"");case 6:return e.a(2,"[".concat(v,"% match] ").concat(f,"\n\n").concat(m));case 7:return e.p=7,u("SmartBrief API error: "+((g=e.v)&&g.message?g.message:String(g)),"error"),e.a(2,"")}},e,null,[[1,7]])}))).apply(this,arguments)}function b(e){var t=document.createElement("div");return t.textContent=String(e||""),t.innerHTML}function w(){r(".task-card").forEach(function(e){var t=e.querySelector('[data-role="deadline"]');if(t){var n=function(e){if(!e)return"";var t=new Date(e);if(isNaN(t.getTime()))return"";var n=new Date;n.setHours(0,0,0,0),t.setHours(0,0,0,0);var a=Math.ceil((t-n)/864e5);return a<0?"overdue":a<=3?"warning":""}(t.value);e.classList.remove("deadline-warning","deadline-overdue"),"overdue"===n?e.classList.add("deadline-overdue"):"warning"===n&&e.classList.add("deadline-warning")}})}window.addEventListener("beforeunload",function(e){if(i)return e.preventDefault(),e.returnValue="",""});var S=e("#companyName"),A=e("#brokerLead"),C=e("#initialRequest"),E=e("#introEmail"),L=e("#remindersStart"),T=e("#emailFrequency"),x=e("#extraNote"),N=e("#auditText"),M=e("#tasksRow"),O=e("#taskCards"),D=e("#taskName"),R=e("#saveBtn"),I=e("#newTaskBtn"),j=e("#loadSelectedBtn"),q=e("#openKycPortal"),F=null;function B(t){return new Promise(function(n){var a=e("#confirmDialog"),r=e("#confirmMessage"),o=e("#confirmCancel"),c=e("#confirmOk");if(a&&r&&o&&c){r.textContent=t,a.style.display="flex";var s=function(){a.style.display="none",o.removeEventListener("click",i),c.removeEventListener("click",u)},i=function(){s(),n(!1)},u=function(){s(),n(!0)};o.addEventListener("click",i),c.addEventListener("click",u)}else n(!1)})}R&&R.addEventListener("click",c(a().m(function e(){var t,n;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t=l(),null!==F&&"new"!==F){e.n=2;break}return e.n=1,Ke();case 1:u("‚úÖ New task added successfully!","success"),e.n=4;break;case 2:return e.n=3,Be();case 3:u("‚úÖ Changes saved to row "+F,"success");case 4:f(!1),t.length>0&&setTimeout(function(){d(t)},500),e.n=6;break;case 5:e.p=5,n=e.v,console.error("Save error:",n),u("‚ùå Save failed: "+n.message,"error");case 6:return e.a(2)}},e,null,[[0,5]])}))),j&&j.addEventListener("click",c(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,qe();case 1:u("‚úÖ Loaded row "+F,"success"),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Load error:",t),u("‚ùå Failed to load row","error");case 3:return e.a(2)}},e,null,[[0,2]])}))),I&&I.addEventListener("click",function(){Ge()});var H=e("#deleteTaskBtn");H&&H.addEventListener("click",c(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==F&&"new"!==F){e.n=1;break}return u("No task to delete - this is a new task","error"),e.a(2);case 1:return e.n=2,B("Are you sure you want to delete this Task?");case 2:if(e.v){e.n=3;break}return e.a(2);case 3:return e.p=3,e.n=4,Ue();case 4:u("‚úÖ Task deleted successfully","success"),Ge(),e.n=6;break;case 5:e.p=5,t=e.v,console.error("Delete error:",t),u("‚ùå Failed to delete task: "+t.message,"error");case 6:return e.a(2)}},e,null,[[3,5]])}))),q&&"1"!==q.dataset.kycListenerAttached&&(q.dataset.kycListenerAttached="1",q.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),"1"!==q.dataset.kycOpening&&(q.dataset.kycOpening="1",window.open("http://192.168.1.141:8080/","_blank"),setTimeout(function(){q.dataset.kycOpening="0"},1e3))}));var G=e("#tasksView"),U=e("#statsView"),_=e("#tasksHeader"),K=e("#statsHeader"),P=e("#openStatsBtn"),J=e("#returnToTasksBtn"),Y=e("#refreshStatsBtn");function z(){return $.apply(this,arguments)}function $(){return $=c(a().m(function r(){var o;return a().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,Excel.run(function(){var r=c(a().m(function r(o){var c,i,u,l,d,f,m,p,v,g,h,y,k,w,S,A,C,E,L,T,x,N,M,O,D,R,I,j,q,F,B;return a().w(function(r){for(;;)switch(r.n){case 0:return(c=o.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),r.n=1,o.sync();case 1:if(!c.isNullObject){r.n=2;break}return console.error("Sheet not found for statistics"),r.a(2);case 2:return(i=c.getRange("A1:K5000")).load("values"),r.n=3,o.sync();case 3:if(!((u=i.values||[]).length<2)){r.n=4;break}return r.a(2);case 4:l=0,d=0,f=0,m={},p={},v={},g=0,h=0,y=[],k=[],w=[],(S=new Date).setHours(0,0,0,0),(A=new Date(S)).setDate(A.getDate()+7),(C=new Date(S)).setDate(C.getDate()-30),E=a().m(function e(){var t,n,r,o,c,s,i,b,E,T,x,N,M;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=u[L],n=t[0]?String(t[0]).trim():""){e.n=1;break}return e.a(2,1);case 1:t[1]&&String(t[1]).trim(),r=t[3]?String(t[3]).trim():"(none)",o=t[4],c=t[5],s=t[6],i=t[7]?String(t[7]).trim():"",b=null,E=W(o),T=W(c),x=W(s),(N=[E,T,x].filter(function(e){return null!==e})).length>0&&(b=N.reduce(function(e,t){return t<e?t:e})),b&&(M="".concat(b.getFullYear(),"-").concat(String(b.getMonth()+1).padStart(2,"0")),p[M]=(p[M]||0)+1),m[r]||(m[r]={total:0,active:0,completed:0}),m[r].total++,i&&i.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes(": to do")?(l++,m[r].active++):t.includes(": in progress")?(d++,m[r].active++):t.includes(": done")&&(f++,m[r].completed++),t.includes("kyc")&&t.includes(": done")){var a=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(a){var o=W(a[1]);if(o){var c="".concat(o.getFullYear(),"-").concat(String(o.getMonth()+1).padStart(2,"0"));v[c]=(v[c]||0)+1}}}var s=e.match(/^(.*?)\s*:\s*(to do|in progress|done)/i),i=e.match(/assigned to\s+([^|]+)/i),u=s?s[1].trim():"Unknown",p=i?i[1].trim():"",b=e.match(/deadline:\s*(\d{4}-\d{2}-\d{2}|\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(b&&!t.includes(": done")){var E=W(b[1]);if(E){var L=Math.ceil((E-S)/864e5);E<S?y.push({company:n,task:u,assignee:p,detail:"".concat(Math.abs(L),"d overdue")}):E<=A&&k.push({company:n,task:u,assignee:p,detail:0===L?"Today":"".concat(L,"d left")})}}if(!t.includes(": done")){var T=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),x=e.match(/updated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),N=null;if(x?N=W(x[1]):T&&(N=W(T[1])),N&&N<C){var M=Math.ceil((S-N)/864e5);w.push({company:n,task:u,assignee:p,detail:"".concat(M,"d ago")})}}if(t.includes(": done")){var O=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),D=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(O&&D){var R=W(O[1]),I=W(D[1]);if(R&&I){var j=Math.ceil((I-R)/864e5);j>=0&&j<365&&(g+=j,h++)}}}});case 2:return e.a(2)}},e)}),L=1;case 5:if(!(L<u.length)){r.n=8;break}return r.d(t(E()),6);case 6:if(!r.v){r.n=7;break}return r.a(3,7);case 7:L++,r.n=5;break;case 8:T=l+d,e("#statActiveTasks").textContent=T,e("#statAvgDuration").textContent=h>0?Math.round(g/h):"-",(x=l+d+f)>0&&(e("#barToDo").style.width=l/x*100+"%",e("#barInProgress").style.width=d/x*100+"%",e("#barDone").style.width=f/x*100+"%"),e("#countToDo").textContent=l,e("#countInProgress").textContent=d,e("#countDone").textContent=f,N=function(t,n,a,r){var o=e("#".concat(n)),c=e("#".concat(a)),s=e("#".concat(r));if(s&&(s.textContent=t.length),o&&c){if(0===t.length)return o.classList.remove("has-items"),void(c.innerHTML="");o.classList.add("has-items"),c.innerHTML=t.slice(0,10).map(function(e){var t=e.assignee?' <span class="to-assignee">to '.concat(b(e.assignee),"</span>"):"";return'<div class="attention-item">\n              <span class="task-info" title="'.concat(b(e.company),": ").concat(b(e.task),'">').concat(b(e.company),": ").concat(b(e.task)).concat(t,'</span>\n              <span class="task-detail">').concat(b(e.detail),"</span>\n            </div>")}).join("")}},y.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),k.sort(function(e,t){return parseInt(e.detail)-parseInt(t.detail)}),w.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),N(y,"overdueGroup","overdueList","statOverdue"),N(k,"upcomingGroup","upcomingList","statUpcoming"),N(w,"staleGroup","staleList","statStale"),(M=e("#monthlyChart"))&&(O=Object.keys(p).sort().reverse().slice(0,6).reverse(),D=Math.max.apply(Math,s(O.map(function(e){return p[e]||0})).concat([1])),R=Math.max.apply(Math,s(O.map(function(e){return v[e]||0})).concat([1])),I=Math.max(D,R),j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],M.innerHTML=O.map(function(e){var t=n(e.split("-"),2),a=(t[0],t[1]),r=j[parseInt(a)-1],o=p[e]||0,c=v[e]||0,s=I>0?c/I*80:0;return'<div class="month-bar-group">\n              <div class="month-bars">\n                <div class="month-bar tasks" style="height:'.concat(I>0?o/I*80:0,'px">\n                  ').concat(o>0?'<span class="month-bar-value">'.concat(o,"</span>"):"",'\n                </div>\n                <div class="month-bar kyc" style="height:').concat(s,'px">\n                  ').concat(c>0?'<span class="month-bar-value">'.concat(c,"</span>"):"",'\n                </div>\n              </div>\n              <div class="month-bar-label">').concat(r,"</div>\n            </div>")}).join("")),(q=e("#brokerChart"))&&(F=Object.entries(m).filter(function(e){var t=n(e,1)[0];return t&&"(none)"!==t&&""!==t.trim()}).sort(function(e,t){return t[1].active+t[1].completed-(e[1].active+e[1].completed)}),B=Math.max.apply(Math,s(F.map(function(e){var t=n(e,2)[1];return t.active+t.completed})).concat([1])),q.innerHTML=F.map(function(e){var t=n(e,2),a=t[0],r=t[1],o=B>0?r.active/B*100:0,c=B>0?r.completed/B*100:0;return'<div class="broker-row">\n              <span class="broker-name" title="'.concat(b(a),'">').concat(b(a),'</span>\n              <div class="broker-bar-track">\n                <div class="broker-bar-fill active" style="width:').concat(o,'%">').concat(r.active>0?'<span class="bar-num">'.concat(r.active,"</span>"):"",'</div>\n                <div class="broker-bar-fill completed" style="width:').concat(c,'%">').concat(r.completed>0?'<span class="bar-num">'.concat(r.completed,"</span>"):"","</div>\n              </div>\n            </div>")}).join(""));case 9:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}());case 1:r.n=3;break;case 2:r.p=2,o=r.v,console.error("Error loading statistics:",o);case 3:return r.a(2)}},r,null,[[0,2]])})),$.apply(this,arguments)}function W(e){if(!e)return null;if("number"==typeof e&&e>1&&e<1e5){var t=Date.UTC(1899,11,30),n=new Date(t+24*e*60*60*1e3),a=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate());if(!isNaN(a.getTime())&&a.getFullYear()>1970)return a}var r=String(e).trim(),o=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(o){var c=parseInt(o[1],10),s=parseInt(o[2],10)-1,i=parseInt(o[3],10);return new Date(c,s,i)}var u=r.match(/(\d{1,2})[-\s]([A-Za-z]{3})[-\s](\d{2,4})/);if(u){var l=parseInt(u[1]),d={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[u[2].toLowerCase()],f=parseInt(u[3]);if(f<100&&(f+=2e3),void 0!==d)return new Date(f,d,l)}var m=new Date(r);return!isNaN(m.getTime())&&m.getFullYear()>1970?m:null}P&&P.addEventListener("click",function(){G&&(G.style.display="none"),_&&(_.style.display="none"),U&&(U.style.display=""),K&&(K.style.display="flex"),z()}),J&&J.addEventListener("click",function(){G&&(G.style.display=""),_&&(_.style.display="flex"),U&&(U.style.display="none"),K&&(K.style.display="none")}),Y&&Y.addEventListener("click",function(){z()});var Z=e("#searchInput"),V=e("#searchInputWrap"),Q=e("#searchBtn"),X=e("#searchResults"),ee=e("#searchHint"),te=r(".search-tab"),ne="active",ae=e("#loadRowHint");function re(){ee&&Z&&V&&("active"===ne?(V.style.display="none",ae&&(ae.style.display="none"),ee.textContent="üí° Showing tasks with status: To Do or In Progress"):"company"===ne&&(V.style.display="flex",ae&&(ae.style.display="flex"),Z.placeholder="Type company name...",Z.type="text",ee.textContent=""))}te.forEach(function(e){e.addEventListener("click",c(a().m(function t(){return a().w(function(t){for(;;)switch(t.n){case 0:if(te.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),ne=e.getAttribute("data-search"),Z&&(Z.value=""),re(),"active"!==ne){t.n=2;break}return t.n=1,fe();case 1:t.n=3;break;case 2:X&&(X.classList.remove("visible"),X.innerHTML="");case 3:return t.a(2)}},t)})))}),Q&&Q.addEventListener("click",c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fe();case 1:return e.a(2)}},e)}))),Z&&Z.addEventListener("keypress",function(){var e=c(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:if("Enter"!==t.key){e.n=1;break}return de(),e.n=1,fe();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());var oe=e("#autocompleteDropdown"),ce=[],se=null;function ie(){return ue.apply(this,arguments)}function ue(){return ue=c(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(ce.length>0)){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=c(a().m(function e(t){var n,r,o,c,s,i;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return e.a(2);case 2:return(r=n.getRange("A2:B5000")).load("values"),e.n=3,t.sync();case 3:for(o=r.values||[],ce=[],c=0;c<o.length;c++)s=o[c][0]?String(o[c][0]).trim():"",i=o[c][1]?String(o[c][1]).trim():"",s&&ce.push({name:s,category:i,rowNum:c+2});console.log("Loaded",ce.length,"company rows for autocomplete");case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("Failed to load company list:",t);case 4:return e.a(2)}},e,null,[[1,3]])})),ue.apply(this,arguments)}function le(e){if(oe&&e&&"company"===ne){var t=e.toLowerCase(),n=ce.filter(function(e){return e.name.toLowerCase().includes(t)}),r=n.filter(function(e){return e.name.toLowerCase().startsWith(t)}),o=n.filter(function(e){return!e.name.toLowerCase().startsWith(t)}),i=[].concat(s(r),s(o)).slice(0,15);0!==i.length?(oe.innerHTML=i.map(function(e){var t=e.category?" ¬∑ ".concat(b(e.category)):"";return'<div class="autocomplete-item" data-row="'.concat(e.rowNum,'" data-name="').concat(b(e.name),'">\n        <span class="company-name">').concat(b(e.name),'</span>\n        <span class="row-hint">Row ').concat(e.rowNum).concat(t,"</span>\n      </div>")}).join(""),oe.classList.add("visible"),oe.querySelectorAll(".autocomplete-item").forEach(function(e){e.addEventListener("click",c(a().m(function t(){var n,r;return a().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),r=e.getAttribute("data-name"),Z&&(Z.value=r),de(),t.n=1,pe(n);case 1:return t.a(2)}},t)})))})):de()}else de()}function de(){oe&&(oe.classList.remove("visible"),oe.innerHTML="")}function fe(){return me.apply(this,arguments)}function me(){return me=c(a().m(function e(){var n;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(X){e.n=1;break}return e.a(2);case 1:return X.innerHTML='<div class="no-results">Searching...</div>',X.classList.add("visible"),console.log("Search started, mode:",ne),e.p=2,e.n=3,Excel.run(function(){var e=c(a().m(function e(n){var r,o,s,i,u,l,d,f,m,p,v;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(console.log("Sheet found:",!r.isNullObject),!r.isNullObject){e.n=2;break}return X.innerHTML='<div class="no-results">Sheet not found</div>',e.a(2);case 2:return(o=r.getRange("A1:K".concat(5e3))).load("values"),e.n=3,n.sync();case 3:s=o.values||[],console.log("Raw rows loaded (including header and blanks):",s.length),i=Array.isArray(s)?s:[],u=[],l=0,d=a().m(function e(){var t,n,r,o,c,s,d,m,p,v,g,h,y,k,b,w,S,A;return a().w(function(e){for(;;)switch(e.n){case 0:if(y=function(e){if(!e||0===e.length)return"";var t=null;if(e.forEach(function(e){if(e){var n=new Date(e);isNaN(n.getTime())||(!t||n>t)&&(t=n)}}),!t)return"";var n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r)},!(t=i[f]||[]).every(function(e){return null===e||""===e})){e.n=1;break}return e.a(2,1);case 1:l++,n=t[0]?String(t[0]).trim():"",r=t[1]?String(t[1]).trim():"",o=t[7]?String(t[7]).trim():"",c=!1,s="unknown",d=!1,m=!1,p=!1,v=[],g=[],h=[],o&&(o.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=Ie(e);if(t){var n=(t.status||"").toLowerCase();"to do"===n?(d=!0,t.initiated&&v.push(t.initiated)):"in progress"===n?(m=!0,t.updated&&g.push(t.updated)):"done"===n&&(p=!0,t.completed&&h.push(t.completed))}}),c=d||m,m?s="progress":d?s="todo":p&&(s="done")),k="",b="","progress"===s?(b=y(g),k=b?"Updated":""):"todo"===s?(b=y(v),k=b?"Initiated":""):"done"===s&&(b=y(h),k=b?"Completed":""),w=b?ye(b):"",S=f+1,"company"===ne?(A=(Z?Z.value:"").toLowerCase().trim(),console.log("Checking row",S,"- Company:",n,"- Query:",A),A&&n.toLowerCase().includes(A)&&(console.log("Match found:",n),u.push({rowNum:S,companyName:n,taskCategory:r,dominantStatus:s,hasActiveTasks:c,statusDateLabel:k,statusDateDisplay:w}))):"active"===ne&&(console.log("Checking row",S,"- Company:",n,"- Active:",c),c&&u.push({rowNum:S,companyName:n,taskCategory:r,dominantStatus:s,hasActiveTasks:c,statusDateLabel:k,statusDateDisplay:w}));case 2:return e.a(2)}},e)}),f=1;case 4:if(!(f<i.length)){e.n=7;break}return e.d(t(d()),5);case 5:if(!e.v){e.n=6;break}return e.a(3,6);case 6:f++,e.n=4;break;case 7:m=l,p="company"===ne?"Company":"Active tasks",v=(Z?Z.value:"").trim(),console.log("Search complete, mode:",p,"rows scanned:",m,"matches:",u.length,"query:",v),0===u.length?X.innerHTML='<div class="no-results">No results found</div>':(X.innerHTML=u.map(function(e){var t="progress"===e.dominantStatus?'<span class="status-badge progress">In Progress</span>':"todo"===e.dominantStatus?'<span class="status-badge todo">To Do</span>':"done"===e.dominantStatus?'<span class="status-badge done">Done</span>':"",n=e.statusDateLabel&&e.statusDateDisplay?" ¬∑ ".concat(e.statusDateLabel," ").concat(b(e.statusDateDisplay)):"";return'<div class="search-result-item" data-row="'.concat(e.rowNum,'">\n              <div class="company">').concat(b(e.companyName||"(No name)")).concat(t,'</div>\n              <div class="meta">Row ').concat(e.rowNum," ¬∑ ").concat(b(e.taskCategory||"No category")).concat(n,"</div>\n            </div>")}).join(""),X.querySelectorAll(".search-result-item").forEach(function(e){e.addEventListener("click",c(a().m(function t(){var n;return a().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),t.n=1,pe(n);case 1:X.classList.remove("visible");case 2:return t.a(2)}},t)})))}));case 8:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,n=e.v,console.error("Search error:",n),X.innerHTML='<div class="no-results">Search error</div>';case 5:return e.a(2)}},e,null,[[2,4]])})),me.apply(this,arguments)}function pe(e){return ve.apply(this,arguments)}function ve(){return ve=c(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=c(a().m(function e(n){var r;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}return e.a(2);case 2:return r.getRange("A".concat(t)).select(),e.n=3,n.sync();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.n=2,qe();case 2:return e.a(2)}},e)})),ve.apply(this,arguments)}function ge(e){return he.apply(this,arguments)}function he(){return he=c(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2,null);case 1:return e.a(2,Excel.run(function(){var e=c(a().m(function e(n){var r,o,c,s,i,u,l,d;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}return e.a(2,null);case 2:return(o=r.getUsedRange()).load("values"),e.n=3,n.sync();case 3:for(c=o.values||[],s=null,i=1;i<c.length;i++)u=c[i],l=u[0]?String(u[0]).trim().toLowerCase():"",d=u[7]?String(u[7]).trim():"",l===t.toLowerCase()&&d&&d.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes("kyc")&&t.includes(": done")){var n=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);n&&(s=n[1])}});return e.a(2,s)}},e)}));return function(t){return e.apply(this,arguments)}}()))}},e)})),he.apply(this,arguments)}function ye(e){if(!e)return"";var t=String(e).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){var n=parseInt(t[1],10),a=parseInt(t[2],10)-1,r=parseInt(t[3],10);return"".concat(r,"-").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a],"-").concat(n)}var o=new Date(e);if(isNaN(o.getTime()))return"";var c=o.getDate(),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o.getMonth()],i=o.getFullYear();return"".concat(c,"-").concat(s,"-").concat(i)}Z&&(Z.addEventListener("input",function(e){if("company"===ne){clearTimeout(se);var t=e.target.value.trim();t.length<1?de():se=setTimeout(function(){le(t)},150)}}),Z.addEventListener("focus",c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if("company"!==ne){e.n=2;break}return e.n=1,ie();case 1:Z.value.trim().length>=1&&le(Z.value.trim());case 2:return e.a(2)}},e)}))),Z.addEventListener("blur",function(){setTimeout(de,200)})),re();var ke=ye;function be(){return r("#taskCategories .category-toggle:checked").map(function(e){return e.value})}function we(){var t=e('#taskCategories .category-toggle[value="Other Task"]');return t&&t.checked}function Se(t){return"__other__"===t?e("#otherTaskCard"):O?O.querySelector('.task-card[data-task="'.concat(t,'"]')):null}function Ae(e){if(!e)return[];var t=e.querySelector('[data-role="status-chips"]');return t?Array.from(t.querySelectorAll(".chip")):[]}function Ce(e,t){Ae(e).forEach(function(e){e.classList.toggle("active",e.getAttribute("data-value")===t)})}function Ee(e){var t=Ae(e).find(function(e){return e.classList.contains("active")});return t?t.getAttribute("data-value"):"To Do"}function Le(){if(M&&O){var t=we(),n=e("#otherTaskCard"),a=be().some(function(e){return"Other Task"!==e});M.style.display=a?"":"none";var o=new Set(xe());r("#taskCards .task-card").forEach(function(e){var t=e.getAttribute("data-task");e.style.display=o.has(t)?"":"none"}),n&&(n.style.display=t?"":"none")}}function Te(){if(x){var e=be().filter(function(e){return"Other Task"!==e});0===e.length?x.placeholder="General note about this task":1===e.length?x.placeholder="General note about this "+e[0]:x.placeholder="General note about these tasks"}}function xe(){return r("#tasksChecklist .task-toggle:checked").map(function(e){return e.value})}function Ne(t){var n=e(t);if(n){var a=Array.from(n.children);if(0!==a.length){var r=[],o=[];a.forEach(function(e){var t=e.querySelector("input[type=checkbox]")||e.querySelector('input[type="checkbox"]');t&&t.checked?r.push(e):o.push(e)}),[].concat(r,o).forEach(function(e){return n.appendChild(e)})}}}function Me(){return Oe.apply(this,arguments)}function Oe(){return Oe=c(a().m(function t(){var n;return a().w(function(t){for(;;)switch(t.n){case 0:if(!o){t.n=1;break}return t.a(2);case 1:if(o=!0,n=e("#assignees")){t.n=2;break}return t.a(2);case 2:if("1"!==n.dataset.initialized){t.n=3;break}return t.a(2);case 3:return n.dataset.initialized="1",n.innerHTML="",t.n=4,Excel.run(function(){var e=c(a().m(function e(t){var r,o,c,s,i,u;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=t.workbook.worksheets.getItemOrNullObject("Team members")).load("name"),e.n=1,t.sync();case 1:if(!r.isNullObject){e.n=2;break}return console.error("Team members sheet not found"),e.a(2);case 2:return(o=r.getUsedRange()).load("values"),e.n=3,t.sync();case 3:c=o.values||[],s=c.slice(1).map(function(e){return e[0]}).filter(function(e){return e&&String(e).trim().length>0}).map(function(e){return String(e).trim()}),i=Array.from(new Set(s)),console.log("Team members loaded from column A:",i),i.forEach(function(e){var t=document.createElement("div");t.innerHTML='<label><input type="checkbox" value="'.concat(e,'"> ').concat(e,"</label>"),n.appendChild(t)}),A&&(A.innerHTML="",(u=document.createElement("option")).value="",u.textContent="(none)",A.appendChild(u),i.forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,A.appendChild(t)}));case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return t.a(2)}},t)})),Oe.apply(this,arguments)}function De(){return Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).map(function(e){return e.value})}function Re(){var e=De();r(".task-assignee-select").forEach(function(t){var n=t.value;t.innerHTML="";var a=document.createElement("option");a.value="",a.textContent="(Select assignee)",t.appendChild(a),e.forEach(function(e){var n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),1===e.length?t.value=e[0]:e.includes(n)&&(t.value=n)})}function Ie(e){if(!e)return null;var t=/^(.*?)\s*:\s*(to do|in progress|done)\s*\|\|\s*assigned to\s+([^|]+)/i.exec(e);if(!t)return null;var n={name:t[1].trim(),status:t[2],assignee:t[3].trim(),comment:"",giveUpId:"",initiated:"",updated:"",completed:"",deadline:""},a=/\|\|\s*comment:\s*([^|]+)/i.exec(e);a&&(n.comment=a[1].trim());var r=/\|\|\s*give-up id:\s*([^|]+)/i.exec(e);r&&(n.giveUpId=r[1].trim());var o=/\|\|\s*task initiated:\s*([^|]+)/i.exec(e);o&&(n.initiated=o[1].trim());var c=/\|\|\s*status updated:\s*([^|]+)/i.exec(e);c&&(n.updated=c[1].trim());var s=/\|\|\s*completed:\s*([^|]+)/i.exec(e);s&&(n.completed=s[1].trim());var i=/\|\|\s*deadline:\s*([^|]+)/i.exec(e);return i&&(n.deadline=i[1].trim()),n}function je(e){var t=[],n=e.status||"To Do";return t.push("".concat(e.name,": ").concat(n)),t.push("Assigned to ".concat(e.assignees)),e.comment&&t.push("Comment: ".concat(e.comment)),e.giveUpId&&t.push("Give-up ID: ".concat(e.giveUpId)),e.initiated&&t.push("Task initiated: ".concat(e.initiated)),e.updated&&t.push("Status updated: ".concat(e.updated)),e.completed&&t.push("Completed: ".concat(e.completed)),e.deadline&&t.push("Deadline: ".concat(e.deadline)),t.join(" || ")}function qe(){return Fe.apply(this,arguments)}function Fe(){return Fe=c(a().m(function t(){return a().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Me();case 1:return t.n=2,Excel.run(function(){var t=c(a().m(function t(n){var o,c,s,i,u,l,d,f,m,p,v,g,h,y,k,b,M,O,R,I,j,q,B,H,G,U,_,K,P,J,Y,z,$,W,Z,V,Q,X;return a().w(function(t){for(;;)switch(t.n){case 0:return R=function(e){if(null==e||""===e)return"";if("number"==typeof e){var t=Date.UTC(1899,11,30),n=new Date(t+864e5*e),a=n.getUTCFullYear(),r=String(n.getUTCMonth()+1).padStart(2,"0"),o=String(n.getUTCDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(o)}if(e instanceof Date){var c=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return"".concat(c,"-").concat(s,"-").concat(i)}var u=String(e).trim();if(u.match(/^(\d{4})-(\d{2})-(\d{2})$/))return u;var l=u.match(/^(\d{1,2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{4})$/i);if(l){var d=parseInt(l[1],10),f={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[l[2].toLowerCase()],m=parseInt(l[3],10),p=String(d).padStart(2,"0"),v=String(f+1).padStart(2,"0");return"".concat(m,"-").concat(v,"-").concat(p)}var g=new Date(e);if(!isNaN(g.getTime())){var h=g.getFullYear(),y=String(g.getMonth()+1).padStart(2,"0"),k=String(g.getDate()).padStart(2,"0");return"".concat(h,"-").concat(y,"-").concat(k)}return u.length>=10?u.slice(0,10):""},(o=n.workbook.getSelectedRange()).load("rowIndex"),t.n=1,n.sync();case 1:return c=o.rowIndex+1,(s=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),t.n=2,n.sync();case 2:if(!s.isNullObject){t.n=3;break}return t.a(2);case 3:return i=s.getRange("A".concat(c)),u=s.getRange("B".concat(c)),l=s.getRange("C".concat(c)),d=s.getRange("D".concat(c)),f=s.getRange("E".concat(c,":G").concat(c)),m=s.getRange("H".concat(c)),p=s.getRange("J".concat(c)),v=s.getRange("K".concat(c)),i.load("values"),u.load("values"),l.load("values"),d.load("values"),f.load("values"),m.load("values"),p.load("values"),v.load("values"),t.n=4,n.sync();case 4:for(g=i.values&&i.values[0]&&i.values[0][0]?String(i.values[0][0]):"",S&&(S.value=g),h=u.values&&u.values[0]&&u.values[0][0]?String(u.values[0][0]):"",y=h.split(",").map(function(e){return e.trim()}).filter(Boolean),r("#taskCategories .category-toggle").forEach(function(e){var t=y.some(function(t){return t.toLowerCase()===e.value.toLowerCase()});e.checked=t}),k=d.values&&d.values[0]&&d.values[0][0]?String(d.values[0][0]):"",A&&(A.value=k),b=l.values&&l.values[0]&&l.values[0][0]?String(l.values[0][0]):"",M=b.split(/[,;]+/).map(function(e){return e.trim().toLowerCase()}).filter(Boolean),console.log("Assignees from column C:",M),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=M.includes(e.value.toLowerCase())}),O=f.values&&f.values[0]?f.values[0]:[null,null,null],console.log("Date values from Excel:",O),C&&(C.value=R(O[0])),E&&(E.value=R(O[1])),L&&(L.value=R(O[2])),console.log("Parsed dates:",null==C?void 0:C.value,null==E?void 0:E.value,null==L?void 0:L.value),I=p.values&&p.values[0]&&p.values[0][0]?String(p.values[0][0]):"",T&&(T.value=I),j=v.values&&v.values[0]&&v.values[0][0]?String(v.values[0][0]):"",x&&(x.value=j),q=m.values&&m.values[0]&&m.values[0][0]?String(m.values[0][0]):"",B=q.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),H=[],G=[],U=0;U<B.length;U++)(_=Ie(B[U]))?H.push(_):G.push(B[U]);K={"to do":1,"in progress":2,done:3},H.sort(function(e,t){return(K[(e.status||"").toLowerCase()]||4)-(K[(t.status||"").toLowerCase()]||4)}),console.log("Parsed tasks:",H),Re(),r("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),r("#taskCards .task-card, #otherTaskCard").forEach(function(e){Ae(e).forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]'),n=e.querySelector('[data-role="deadline"]'),a=e.querySelector('[data-role="giveUpId"]'),r=e.querySelector('[data-role="task-assignee"]');t&&(t.value=""),n&&(n.value=""),a&&(a.value=""),r&&(r.value="")}),we()?(P=Se("__other__"))&&(J=H[0]||null,D&&(D.value=J&&J.name?J.name:""),J&&(Y=(J.status||"").toLowerCase(),Ce(P,"in progress"===Y?"In Progress":"done"===Y?"Done":"To Do"),z=P.querySelector('[data-role="comment"]'),$=P.querySelector('[data-role="deadline"]'),W=P.querySelector('[data-role="task-assignee"]'),z&&(z.value=J.comment||""),$&&($.value=(J.deadline||"").slice(0,10)),W&&J.assignee&&(W.value=J.assignee.trim()))):r("#tasksChecklist .task-toggle").forEach(function(e){var t=e.value,n=H.find(function(e){var n=(e.name||"").toLowerCase(),a=t.toLowerCase();return n===a||"kyc (produced by lcmc)"===a&&"kyc (internal)"===n});e.checked=!!n;var a=Se(t);if(a&&n){var r=(n.status||"").toLowerCase();Ce(a,"in progress"===r?"In Progress":"done"===r?"Done":"To Do");var o=a.querySelector('[data-role="comment"]'),c=a.querySelector('[data-role="deadline"]'),s=a.querySelector('[data-role="giveUpId"]'),i=a.querySelector('[data-role="task-assignee"]');o&&(o.value=n.comment||""),c&&(c.value=(n.deadline||"").slice(0,10)),s&&(s.value=n.giveUpId||""),i&&n.assignee&&(i.value=n.assignee.trim())}}),N&&(Z=null,H.length>0&&(Z=H[0]),Z?(V=[],Z.initiated&&V.push("Task initiated: ".concat(Z.initiated)),Z.updated&&V.push("Status updated: ".concat(Z.updated)),Z.completed&&V.push("Completed: ".concat(Z.completed)),N.textContent=V.join(" | ")):N.textContent=""),(Q=e("#lastKycDate"))&&g?(X=null,H.forEach(function(e){e.name&&e.name.toLowerCase().includes("kyc")&&e.status&&"done"===e.status.toLowerCase()&&e.completed&&(X=e.completed)}),X?Q.textContent=X:ge(g).then(function(e){Q.textContent=e||"‚Äî"})):Q&&(Q.textContent="‚Äî"),Le(),Je(),Te(),Ne("#assignees"),Ne("#tasksChecklist"),Ne("#taskCategories"),F=c,w(),Ve(),ze&&ze.classList.remove("visible");case 5:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:return t.a(2)}},t)})),Fe.apply(this,arguments)}function Be(){return He.apply(this,arguments)}function He(){return He=c(a().m(function e(){var t,n,r;return a().w(function(e){for(;;)switch(e.n){case 0:return t=be().join(", "),n=De().join(", "),r=we(),console.log("Saving - Categories:",t,"Assignees:",n,"IsOther:",r),e.n=1,Excel.run(function(){var e=c(a().m(function e(o){var c,s,i,u,l,d,f,m,p,v,g,h,y,k,b,w,N,M,O,R,I,j,q,F,B,H,G,U,_,K,P,J,Y,z,$,W,Z,V,Q;return a().w(function(e){for(;;)switch(e.n){case 0:return(c=o.workbook.getSelectedRange()).load("rowIndex"),e.n=1,o.sync();case 1:return s=c.rowIndex+1,(i=o.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=2,o.sync();case 2:if(!i.isNullObject){e.n=3;break}return e.a(2);case 3:return(u=i.getRange("E".concat(s,":G").concat(s))).load("values"),l=i.getRange("A".concat(s)),d=i.getRange("B".concat(s)),f=i.getRange("C".concat(s)),m=i.getRange("D".concat(s)),p=i.getRange("H".concat(s)),v=i.getRange("J".concat(s)),g=i.getRange("K".concat(s)),p.load("values"),e.n=4,o.sync();case 4:return h=u.values&&u.values[0]?u.values[0]:[null,null,null],C&&(h[0]=ke(C.value)),E&&(h[1]=ke(E.value)),L&&(h[2]=ke(L.value)),u.values=[h],d.values=[[t]],A&&(m.values=[[A.value||""]]),S&&(l.values=[[S.value||""]]),f.values=[[n]],console.log("Saving assignees to column C:",n),T&&(v.values=[[T.value||""]]),x&&(g.values=[[x.value||""]]),y=p.values&&p.values[0]&&p.values[0][0]?String(p.values[0][0]):"",k=y.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),b=k.filter(function(e){return!Ie(e)}),w=[],N={},k.forEach(function(e){var t=Ie(e);t&&(N[t.name.toLowerCase()]=t)}),M=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))},O=function(e,t,n){var a=M(),r=n?(n.status||"").toLowerCase():"",o=(t||"").toLowerCase(),c=n&&n.initiated?n.initiated:"",s=n&&n.updated?n.updated:"",i=n&&n.completed?n.completed:"",u=c||s||i;return"to do"===o?(c=c||a,s="",i=""):"in progress"===o?(u&&r===o||(s=a),c="",i=""):"done"===o&&(u&&i&&r===o||(i=a),c="",s=""),{initiated:c,updated:s,completed:i}},r?(R=Se("__other__"),(I=D?D.value.trim():"")&&(j=Ee(R)||"To Do",q=R?R.querySelector('[data-role="comment"]'):null,F=R?R.querySelector('[data-role="deadline"]'):null,B=R?R.querySelector('[data-role="task-assignee"]'):null,H=B&&B.value?B.value:n,G=N[I.toLowerCase()],U=O(0,j,G),_={name:I,status:j,assignees:H,comment:q?q.value.trim():"",giveUpId:"",initiated:U.initiated,updated:U.updated,completed:U.completed,deadline:F?F.value:""},K=je(_),w.push({line:K,status:j}))):(P=xe(),J=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],P.forEach(function(e){if(J.includes(e)){var t=Se(e);if(t){var a=Ee(t),r=t.querySelector('[data-role="comment"]'),o=t.querySelector('[data-role="deadline"]'),c=t.querySelector('[data-role="giveUpId"]'),s=t.querySelector('[data-role="task-assignee"]'),i=s&&s.value?s.value:n,u=N[e.toLowerCase()];u||"kyc (produced by lcmc)"!==e.toLowerCase()||(u=N["kyc (internal)"]);var l=O(0,a,u),d={name:e,status:a,assignees:i,comment:r?r.value.trim():"",giveUpId:c?c.value.trim():"",initiated:l.initiated,updated:l.updated,completed:l.completed,deadline:o?o.value:""};w.push({line:je(d),status:a})}}})),Y={"to do":1,"in progress":2,done:3},w.sort(function(e,t){return(Y[(e.status||"").toLowerCase()]||4)-(Y[(t.status||"").toLowerCase()]||4)}),z=w.map(function(e){return e.line}),$=b.concat(z).filter(Boolean).join("\n"),console.log("Saving to H - newTaskLines:",z,"newValue:",$),p.values=[[$]],z.length>0&&(W=!1,Z=!1,V=!1,z.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?W=!0:t.includes(": to do")?Z=!0:t.includes(": done")&&(V=!0)}),Q=W?"#ff9900":Z?"#34a853":V?"#cc6666":"#34a853",p.format.font.color=Q),e.n=5,o.sync();case 5:console.log("Save completed successfully for row",s);case 6:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),He.apply(this,arguments)}function Ge(){S&&(S.value=""),r("#taskCategories .category-toggle").forEach(function(e){e.checked=!1}),A&&(A.value=""),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=!1}),C&&(C.value=""),E&&(E.value=""),L&&(L.value=""),T&&(T.value=""),x&&(x.value=""),r("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),r("#taskCards .task-card, #otherTaskCard").forEach(function(e){e.querySelectorAll('[data-role="status-chips"] .chip').forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]');t&&(t.value="");var n=e.querySelector('[data-role="deadline"]');n&&(n.value="");var a=e.querySelector('[data-role="giveUpId"]');a&&(a.value="");var r=e.querySelector('[data-role="task-assignee"]');r&&(r.value="")}),D&&(D.value=""),N&&(N.textContent="");var t=e("#lastKycDate");t&&(t.textContent="‚Äî"),X&&(X.classList.remove("visible"),X.innerHTML=""),ze&&ze.classList.remove("visible"),F="new",Ve(),Je(),Le(),Te(),setTimeout(function(){var e=document.querySelector('#taskCards .task-card:not([style*="display: none"]), #otherTaskCard:not([style*="display: none"])');if(e){var t=e.querySelector('[data-role="comment"]');t&&"function"==typeof t.focus&&t.focus()}},100)}function Ue(){return _e.apply(this,arguments)}function _e(){return _e=c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if(null!==F&&"new"!==F){e.n=1;break}throw new Error("No row to delete");case 1:return e.n=2,Excel.run(function(){var e=c(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("Sheet TASK MANAGER FORM not found");case 2:return n.getRange("".concat(F,":").concat(F)).delete(Excel.DeleteShiftDirection.up),e.n=3,t.sync();case 3:console.log("Deleted row",F);case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e)})),_e.apply(this,arguments)}function Ke(){return Pe.apply(this,arguments)}function Pe(){return Pe=c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=c(a().m(function e(t){var n,r,o,c,s,i,u,l,d,f,m,p,v,g,h,y,k,b,w,N,M,O,R,I,j,q,B,H,G,U,_,K,P,J;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return console.error("Sheet TASK MANAGER FORM not found"),e.a(2);case 2:return(r=n.getRange("A2:A1000")).load("values"),e.n=3,t.sync();case 3:o=2,c=r.values||[],s=0;case 4:if(!(s<c.length)){e.n=7;break}if(!c[s][0]||""===String(c[s][0]).trim()){e.n=5;break}o=s+3,e.n=6;break;case 5:return o=s+2,e.a(3,7);case 6:s++,e.n=4;break;case 7:return i=S?S.value.trim():"",u=be().join(", "),l=we(),d=A?A.value:"",f=De().join(", "),n.getRange("A".concat(o)).values=[[i]],n.getRange("B".concat(o)).values=[[u]],n.getRange("C".concat(o)).values=[[f]],n.getRange("D".concat(o)).values=[[d]],m=ke(C?C.value:""),p=ke(E?E.value:""),v=ke(L?L.value:""),n.getRange("E".concat(o,":G").concat(o)).values=[[m,p,v]],n.getRange("J".concat(o)).values=[[T?T.value:""]],n.getRange("K".concat(o)).values=[[x?x.value:""]],g=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))}(),h=[],l?(y=Se("__other__"),(k=D?D.value.trim():"")&&(b=Ee(y)||"To Do",w=y?y.querySelector('[data-role="comment"]'):null,N=y?y.querySelector('[data-role="deadline"]'):null,M=y?y.querySelector('[data-role="task-assignee"]'):null,O=M&&M.value?M.value:f,R="",I="",j="","to do"===(q=b.toLowerCase())?R=g:"in progress"===q?I=g:"done"===q&&(j=g),B={name:k,status:b,assignees:O,comment:w?w.value.trim():"",giveUpId:"",initiated:R,updated:I,completed:j,deadline:N?N.value:""},h.push(je(B)))):(H=xe(),G=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],H.forEach(function(e){if(G.includes(e)){var t=Se(e);if(t){var n=Ee(t)||"To Do",a=t.querySelector('[data-role="comment"]'),r=t.querySelector('[data-role="deadline"]'),o=t.querySelector('[data-role="giveUpId"]'),c=t.querySelector('[data-role="task-assignee"]'),s=c&&c.value?c.value:f,i="",u="",l="",d=n.toLowerCase();"to do"===d?i=g:"in progress"===d?u=g:"done"===d&&(l=g);var m={name:e,status:n,assignees:s,comment:a?a.value.trim():"",giveUpId:o?o.value.trim():"",initiated:i,updated:u,completed:l,deadline:r?r.value:""};h.push(je(m))}}})),(U=n.getRange("H".concat(o))).values=[[h.join("\n")]],h.length>0&&(_=!1,K=!1,P=!1,h.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?_=!0:t.includes(": to do")?K=!0:t.includes(": done")&&(P=!0)}),J=_?"#ff9900":K?"#34a853":P?"#cc6666":"#34a853",U.format.font.color=J),e.n=8,t.sync();case 8:return n.getRange("A".concat(o)).select(),e.n=9,t.sync();case 9:F=o;case 10:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),Pe.apply(this,arguments)}function Je(){[{input:"#initialRequest",display:"#initialRequestDisplay"},{input:"#introEmail",display:"#introEmailDisplay"},{input:"#remindersStart",display:"#remindersStartDisplay"}].forEach(function(t){var n=t.input,a=t.display,r=e(n),o=e(a);if(r&&o){var c=ye(r.value);o.textContent=c?"‚Üí ".concat(c):""}})}r("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){Le(),Te()})}),document.querySelectorAll("#assignees").forEach(function(e){e.addEventListener("change",function(e){"checkbox"===e.target.type&&Re()})});var Ye=e("#viewEmailSummaryBtn"),ze=e("#emailSummarySection"),$e=e("#emailSummaryList"),We=e("#emailSummaryCount"),Ze=e("#closeEmailSummaryBtn");function Ve(){var e=S?S.value.trim():"";Ye&&(Ye.disabled=!e)}function Qe(){return Xe.apply(this,arguments)}function Xe(){return Xe=c(a().m(function t(){var n,r,o,s,i,l,d,f,k,w,A,T,x,N,M,O,D,R,I,j,q,B,H,G,U;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=S?S.value.trim():""){t.n=1;break}return u("No company name entered","error"),t.a(2);case 1:if(null!==F&&"new"!==F){t.n=2;break}return u("Please save the task first or select an existing row","error"),t.a(2);case 2:return ze&&ze.classList.add("visible"),$e&&($e.innerHTML='<div class="email-loading">Loading summary from spreadsheet...</div>'),t.p=3,r="",t.n=4,Excel.run(function(){var e=c(a().m(function e(t){var n,o;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("TASK MANAGER FORM sheet not found");case 2:return(o=n.getRange("L".concat(F))).load("values"),e.n=3,t.sync();case 3:r=o.values&&o.values[0]&&o.values[0][0]?String(o.values[0][0]).trim():"";case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:if(r&&(r=r.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),r){t.n=6;break}if("undefined"==typeof window||!window.location||"localhost"!==window.location.hostname){t.n=6;break}return $e&&($e.innerHTML='<div class="email-loading">Fetching summary from API...</div>'),o=C?String(C.value||""):"",s=E?String(E.value||""):"",i=L?String(L.value||""):"",t.n=5,y(n,o,s,i);case 5:if(l=t.v,(r=l||"")&&(r=r.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),!r){t.n=6;break}return t.n=6,Excel.run(function(){var e=c(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("TASK MANAGER FORM sheet not found");case 2:return n.getRange("L".concat(F)).values=[[r]],e.n=3,t.sync();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 6:if(We&&(We.textContent=r?"1":"0"),r){t.n=7;break}return $e&&($e.innerHTML='\n            <div class="email-no-summaries">\n              No email summary found for this row.<br>\n              <small>Run the SmartBrief macro (Alt+F8 ‚Üí SmartBrief) to fetch summaries.</small>\n            </div>'),t.a(2);case 7:d=r.split(/\n/),f=(d[0]||"").trim(),k=d.slice(1).join("\n").replace(/^\n+/,"").trim(),w=f.match(/^\[(\d+)%\s*match\]\s*(.*)$/),A=100,T="Email Summary",x=r,w?(A=parseInt(w[1],10),T=(w[2]||"").trim()||"Email Summary",x=k):d.length>1?(T=f||"Email Summary",x=k):(T="Email Summary",x=r.trim()),N="match-high",A<70&&(N="match-medium"),A<50&&(N="match-low"),M=m(r),O=v(r),D=g(M),R=p(r),h={participants:M,detectedCategory:O,matchedAssignees:D,summaryNotes:R,matchPercent:A,subject:T},I="",M.length>0&&(j=M.map(function(e){var t=D.some(function(t){return t.toLowerCase().includes(e.name.split(" ")[0].toLowerCase())})?"participant-chip matched":"participant-chip",n=e.email?e.email:e.name;return'<span class="'.concat(t,'" title="').concat(b(n),'">').concat(b(e.name),"</span>")}).join(""),I='\n          <div class="participants-section">\n            <div class="participants-label">Participants:</div>\n            <div class="participants-chips">'.concat(j,"</div>\n          </div>\n        ")),q="",A<50&&(q='\n          <div class="match-warning">\n            ‚ö†Ô∏è Low confidence match ('.concat(A,"%) ‚Äî verify this is the correct email thread\n          </div>\n        ")),B="",(O||D.length>0||R)&&(B='\n          <div class="smartbrief-actions">\n            <button id="applySmartBriefBtn" class="btn-apply-smartbrief">\n              ‚ú® Review & Apply to Task\n            </button>\n          </div>\n        '),H=(H=(H=x).replace(/## PARTICIPANTS[\s\S]*?(?=## |$)/,"").trim()).replace(/^\n+/,"").replace(/\n{3,}/g,"\n\n"),$e&&($e.innerHTML="\n          ".concat(q,'\n          <div class="email-summary-item">\n            <div class="email-summary-subject">\n              ').concat(b(T),'\n              <span class="match-score ').concat(N,'" title="Match score from SmartBrief">\n                ').concat(A,"% match\n              </span>\n            </div>\n            ").concat(I,'\n            <div class="email-summary-text">').concat(b(H).replace(/\n/g,"<br>"),"</div>\n          </div>\n          ").concat(B,"\n        "),(G=e("#applySmartBriefBtn"))&&G.addEventListener("click",function(){return et()})),t.n=9;break;case 8:t.p=8,U=t.v,console.error("Error loading email summary from column L:",U),$e&&($e.innerHTML='<div class="email-no-summaries">Error reading summary: '.concat(b(U.message),"</div>"));case 9:return t.a(2)}},t,null,[[3,8]])})),Xe.apply(this,arguments)}function et(){if(h){var e=h,t=e.detectedCategory,n=e.matchedAssignees,a=e.summaryNotes,r="",o=!1;if(t&&(o=!0,r+='\n        <div class="smartbrief-suggestion-item">\n          <label>\n            <input type="checkbox" id="sbApplyCategory" checked>\n            <span class="suggestion-label">Task Category:</span>\n            <span class="suggestion-value">'.concat(b(t),"</span>\n          </label>\n        </div>\n      ")),n&&n.length>0){o=!0;var c=n.map(function(e,t){return'\n        <label class="assignee-checkbox-item">\n          <input type="checkbox" class="sb-assignee-checkbox" data-assignee="'.concat(b(e),'" checked>\n          <span>').concat(b(e),"</span>\n        </label>\n      ")}).join("");r+='\n        <div class="smartbrief-suggestion-item smartbrief-assignees-group">\n          <div class="suggestion-label">Assignees:</div>\n          <div class="assignee-checkboxes-list">\n            '.concat(c,"\n          </div>\n        </div>\n      ")}if(a){o=!0;var s=a.length>100?a.substring(0,100)+"...":a;r+='\n        <div class="smartbrief-suggestion-item">\n          <label>\n            <input type="checkbox" id="sbApplyNotes">\n            <span class="suggestion-label">Add to Notes:</span>\n            <span class="suggestion-value suggestion-notes">'.concat(b(s),"</span>\n          </label>\n        </div>\n      ")}if(o){var i=document.createElement("div");i.className="confirm-overlay",i.id="smartbriefConfirmOverlay";var l=document.createElement("div");l.className="confirm-box smartbrief-confirm-box",l.innerHTML='\n      <div class="smartbrief-confirm-header">\n        <span class="sparkle">‚ú®</span> Review Suggestions\n      </div>\n      <p class="smartbrief-confirm-desc">Select which items to apply to the task:</p>\n      <div class="smartbrief-suggestions">\n        '.concat(r,'\n      </div>\n      <div class="smartbrief-confirm-buttons">\n        <button class="btn-confirm-cancel" id="sbCancel">Cancel</button>\n        <button class="btn-apply-confirmed" id="sbApply">Apply Selected</button>\n      </div>\n    '),i.appendChild(l),document.body.appendChild(i);var d=i.querySelector("#sbCancel"),m=i.querySelector("#sbApply");d.addEventListener("click",function(){return i.remove()}),m.addEventListener("click",function(){var e,t,n=null===(e=i.querySelector("#sbApplyCategory"))||void 0===e?void 0:e.checked,a=null===(t=i.querySelector("#sbApplyNotes"))||void 0===t?void 0:t.checked,r=[];i.querySelectorAll(".sb-assignee-checkbox:checked").forEach(function(e){r.push(e.getAttribute("data-assignee"))}),i.remove(),function(e,t,n){if(h){var a=h,r=a.detectedCategory,o=a.summaryNotes,c=[];if(e&&r&&(document.querySelectorAll("#taskCategories .category-toggle").forEach(function(e){e.value===r&&(e.checked=!0,c.push("Category: ".concat(r)))}),Le()),t&&Array.isArray(t)&&t.length>0&&(document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){t.includes(e.value)&&(e.checked=!0)}),Re(),Ne("#assignees"),c.push("Assignees: ".concat(t.join(", ")))),n&&o&&x){var s=x.value.trim(),i="[From SmartBrief] ";if(!s.includes(i)){var l=o.length>500?o.substring(0,500)+"...":o;x.value=s?"".concat(s,"\n\n").concat(i).concat(l):"".concat(i).concat(l),c.push("Notes added")}}c.length>0?(f(!0),u("‚ú® Applied: ".concat(c.join(", ")),"success")):u("No items selected","info")}}(n,r,a)}),i.addEventListener("click",function(e){e.target===i&&i.remove()})}else u("No suggestions available","info")}else u("No SmartBrief data to apply","error")}S&&(S.addEventListener("input",Ve),S.addEventListener("change",Ve)),Ye&&Ye.addEventListener("click",c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Qe();case 1:return e.a(2)}},e)}))),Ze&&Ze.addEventListener("click",function(){ze&&ze.classList.remove("visible")}),"undefined"!=typeof Office&&"function"==typeof Office.onReady&&Office.onReady(function(t){t.host===Office.HostType.Excel&&(r('#taskCards [data-role="status-chips"] .chip, #otherTaskCard [data-role="status-chips"] .chip').forEach(function(e){e.addEventListener("click",function(){var t=e.closest('[data-role="status-chips"]');t&&Array.from(t.querySelectorAll(".chip")).forEach(function(t){t.classList.toggle("active",t===e)})})}),["#initialRequest","#introEmail","#remindersStart"].forEach(function(t){var n=e(t);n&&n.addEventListener("change",Je)}),r('[data-role="deadline"]').forEach(function(e){e.addEventListener("change",function(){w()})}),r("input, select, textarea").forEach(function(e){e.addEventListener("change",function(){return f(!0)}),e.addEventListener("input",function(){return f(!0)})}),r(".chip").forEach(function(e){e.addEventListener("click",function(){return f(!0)})}),r("#tasksChecklist .task-toggle").forEach(function(e){e.addEventListener("change",function(){return Le()})}),r("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){return Le()})}),qe().then(function(){f(!1),fe()}))})}()}();
//# sourceMappingURL=taskpane.js.map