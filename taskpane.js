/*! For license information please see taskpane.js.LICENSE.txt */
!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){if(null!=t){var n=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o,c,s=[],i=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(a=o.call(n)).done)&&(s.push(a.value),s.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw r}}return s}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function c(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,a,r,o){var c=a&&a.prototype instanceof u?a:u,l=Object.create(c.prototype);return s(l,"_invoke",function(n,a,r){var o,c,s,u=0,l=r||[],d=!1,f={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,n){return o=t,c=0,s=e,f.n=n,i}};function v(n,a){for(c=n,s=a,t=0;!d&&u&&!r&&t<l.length;t++){var r,o=l[t],v=f.p,m=o[2];n>3?(r=m===a)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=v&&((r=n<2&&v<o[1])?(c=0,f.v=a,f.n=o[1]):v<m&&(r=n<3||o[0]>a||a>m)&&(o[4]=n,o[5]=a,f.n=m,c=0))}if(r||n>1)return i;throw d=!0,a}return function(r,l,m){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&v(l,m),c=l,s=m;(t=c<2?e:s)||!d;){o||(c?c<3?(c>1&&(f.n=-1),v(c,s)):f.n=s:f.v=s);try{if(u=2,o){if(c||(r="next"),t=o[r]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),c=1);o=e}else if((t=(d=f.n<0)?s:n.call(a,f))!==i)break}catch(t){o=e,c=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,r,o),!0),l}var i={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][a]?t(t([][a]())):(s(t={},a,function(){return this}),t),v=d.prototype=u.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,r,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=d,s(v,"constructor",d),s(d,"constructor",l),l.displayName="GeneratorFunction",s(d,r,"GeneratorFunction"),s(v),s(v,r,"Generator"),s(v,a,function(){return this}),s(v,"toString",function(){return"[object Generator]"}),(c=function(){return{w:o,m:m}})()}function s(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}s=function(e,t,n,a){function o(t,n){s(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},s(e,t,n,a)}function i(e,t,n,a,r,o,c){try{var s=e[o](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(a,r)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function c(e){i(o,a,r,c,s,"next",e)}function s(e){i(o,a,r,c,s,"throw",e)}c(void 0)})}}!function(){var e=function(e){return document.querySelector(e)},r=function(e){return Array.from(document.querySelectorAll(e))},o=!1,s=!1,i="http://localhost:5002";function l(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=e("#toast");a&&(a.textContent=t,a.className="toast "+n+" show",setTimeout(function(){a.classList.remove("show")},3e3))}function d(){var t=[],n=e("#companyName");n&&n.value.trim()||t.push("Company Name"),0===Array.from(document.querySelectorAll(".category-toggle:checked")).length&&t.push("Task Category");var a=e("#brokerLead");a&&a.value||t.push("Broker Lead"),0===Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).length&&t.push("Assigned To"),Array.from(document.querySelectorAll(".task-card")).filter(function(e){return"none"!==e.style.display&&"otherTaskCard"!==e.id}).forEach(function(e){var n=e.dataset.task||"Task",a=e.querySelector(".chip.active"),r=e.querySelector('[data-role="deadline"]');a||t.push("".concat(n,": Status")),r&&r.value||t.push("".concat(n,": Deadline"))});var r=e("#otherTaskCard");if(r&&"none"!==r.style.display){var o=e("#taskName");o&&o.value.trim()||t.push("Other Task: Task Name"),r.querySelector(".chip.active")||t.push("Other Task: Status");var c=r.querySelector('[data-role="deadline"]');c&&c.value||t.push("Other Task: Deadline")}return t}function f(e){var t=document.createElement("div");t.className="confirm-overlay",t.id="missingFieldsOverlay";var n=document.createElement("div");n.className="confirm-box",n.style.maxWidth="320px",n.style.textAlign="left";var a=document.createElement("p");a.innerHTML='<strong style="color:#f59e0b;">‚ö†Ô∏è Missing Fields</strong>',a.style.marginBottom="12px",a.style.textAlign="center",n.appendChild(a);var r=document.createElement("p");r.textContent="The following fields are empty:",r.style.fontSize="12px",r.style.color="#64748b",r.style.marginBottom="8px",n.appendChild(r);var o=document.createElement("ul");o.style.cssText="margin:0 0 16px 0;padding-left:20px;font-size:12px;color:#334155;max-height:150px;overflow-y:auto;",e.forEach(function(e){var t=document.createElement("li");t.textContent=e,t.style.marginBottom="4px",o.appendChild(t)}),n.appendChild(o);var c=document.createElement("div");c.style.textAlign="center";var s=document.createElement("button");s.textContent="Got it",s.style.cssText="padding:8px 24px;font-size:13px;font-weight:500;border:none;border-radius:6px;background:#1e40af;color:#fff;cursor:pointer;",s.addEventListener("click",function(){t.remove()}),c.appendChild(s),n.appendChild(c),t.appendChild(n),document.body.appendChild(t)}function v(t){s=t;var n=e("#unsavedIndicator");n&&n.classList.toggle("visible",t)}function m(e){var t=document.createElement("div");return t.textContent=String(e||""),t.innerHTML}function p(){r(".task-card").forEach(function(e){var t=e.querySelector('[data-role="deadline"]');if(t){var n=function(e){if(!e)return"";var t=new Date(e);if(isNaN(t.getTime()))return"";var n=new Date;n.setHours(0,0,0,0),t.setHours(0,0,0,0);var a=Math.ceil((t-n)/864e5);return a<0?"overdue":a<=3?"warning":""}(t.value);e.classList.remove("deadline-warning","deadline-overdue"),"overdue"===n?e.classList.add("deadline-overdue"):"warning"===n&&e.classList.add("deadline-warning")}})}window.addEventListener("beforeunload",function(e){if(s)return e.preventDefault(),e.returnValue="",""});var g=e("#companyName"),h=e("#brokerLead"),y=e("#initialRequest"),k=e("#introEmail"),w=e("#remindersStart"),b=e("#emailFrequency"),S=e("#extraNote"),E=e("#auditText"),C=e("#tasksRow"),L=e("#taskCards"),A=e("#taskName"),T=e("#saveBtn"),x=e("#newTaskBtn"),D=e("#loadSelectedBtn"),M=e("#openKycPortal"),N=null;function O(t){return new Promise(function(n){var a=e("#confirmDialog"),r=e("#confirmMessage"),o=e("#confirmCancel"),c=e("#confirmOk");if(a&&r&&o&&c){r.textContent=t,a.style.display="flex";var s=function(){a.style.display="none",o.removeEventListener("click",i),c.removeEventListener("click",u)},i=function(){s(),n(!1)},u=function(){s(),n(!0)};o.addEventListener("click",i),c.addEventListener("click",u)}else n(!1)})}T&&T.addEventListener("click",u(c().m(function e(){var t,n;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t=d(),null!==N&&"new"!==N){e.n=2;break}return e.n=1,Fe();case 1:l("‚úÖ New task added successfully!","success"),e.n=4;break;case 2:return e.n=3,Oe();case 3:l("‚úÖ Changes saved to row "+N,"success");case 4:v(!1),t.length>0&&setTimeout(function(){f(t)},500),e.n=6;break;case 5:e.p=5,n=e.v,console.error("Save error:",n),l("‚ùå Save failed: "+n.message,"error");case 6:return e.a(2)}},e,null,[[0,5]])}))),D&&D.addEventListener("click",u(c().m(function e(){var t;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Me();case 1:l("‚úÖ Loaded row "+N,"success"),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Load error:",t),l("‚ùå Failed to load row","error");case 3:return e.a(2)}},e,null,[[0,2]])}))),x&&x.addEventListener("click",function(){Ie()});var R=e("#deleteTaskBtn");R&&R.addEventListener("click",u(c().m(function e(){var t;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==N&&"new"!==N){e.n=1;break}return l("No task to delete - this is a new task","error"),e.a(2);case 1:return e.n=2,O("Are you sure you want to delete this Task?");case 2:if(e.v){e.n=3;break}return e.a(2);case 3:return e.p=3,e.n=4,je();case 4:l("‚úÖ Task deleted successfully","success"),Ie(),e.n=6;break;case 5:e.p=5,t=e.v,console.error("Delete error:",t),l("‚ùå Failed to delete task: "+t.message,"error");case 6:return e.a(2)}},e,null,[[3,5]])}))),M&&"1"!==M.dataset.kycListenerAttached&&(M.dataset.kycListenerAttached="1",M.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),"1"!==M.dataset.kycOpening&&(M.dataset.kycOpening="1",window.open("http://192.168.1.141:8080/","_blank"),setTimeout(function(){M.dataset.kycOpening="0"},1e3))}));var I=e("#tasksView"),j=e("#statsView"),q=e("#tasksHeader"),F=e("#statsHeader"),H=e("#openStatsBtn"),G=e("#returnToTasksBtn"),U=e("#refreshStatsBtn");function B(){return _.apply(this,arguments)}function _(){return _=u(c().m(function r(){var o;return c().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,Excel.run(function(){var r=u(c().m(function r(o){var s,i,u,l,d,f,v,p,g,h,y,k,w,b,S,E,C,L,A,T,x,D,M,N,O,R,I,j,q,F,H;return c().w(function(r){for(;;)switch(r.n){case 0:return(s=o.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),r.n=1,o.sync();case 1:if(!s.isNullObject){r.n=2;break}return console.error("Sheet not found for statistics"),r.a(2);case 2:return(i=s.getRange("A1:K5000")).load("values"),r.n=3,o.sync();case 3:if(!((u=i.values||[]).length<2)){r.n=4;break}return r.a(2);case 4:l=0,d=0,f=0,v={},p={},g={},h=0,y=0,k=[],w=[],b=[],(S=new Date).setHours(0,0,0,0),(E=new Date(S)).setDate(E.getDate()+7),(C=new Date(S)).setDate(C.getDate()-30),L=c().m(function e(){var t,n,a,r,o,s,i,m,L,T,x,D,M;return c().w(function(e){for(;;)switch(e.n){case 0:if(t=u[A],n=t[0]?String(t[0]).trim():""){e.n=1;break}return e.a(2,1);case 1:t[1]&&String(t[1]).trim(),a=t[3]?String(t[3]).trim():"(none)",r=t[4],o=t[5],s=t[6],i=t[7]?String(t[7]).trim():"",m=null,L=K(r),T=K(o),x=K(s),(D=[L,T,x].filter(function(e){return null!==e})).length>0&&(m=D.reduce(function(e,t){return t<e?t:e})),m&&(M="".concat(m.getFullYear(),"-").concat(String(m.getMonth()+1).padStart(2,"0")),p[M]=(p[M]||0)+1),v[a]||(v[a]={total:0,active:0,completed:0}),v[a].total++,i&&i.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes(": to do")?(l++,v[a].active++):t.includes(": in progress")?(d++,v[a].active++):t.includes(": done")&&(f++,v[a].completed++),t.includes("kyc")&&t.includes(": done")){var r=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(r){var o=K(r[1]);if(o){var c="".concat(o.getFullYear(),"-").concat(String(o.getMonth()+1).padStart(2,"0"));g[c]=(g[c]||0)+1}}}var s=e.match(/^(.*?)\s*:\s*(to do|in progress|done)/i),i=e.match(/assigned to\s+([^|]+)/i),u=s?s[1].trim():"Unknown",m=i?i[1].trim():"",p=e.match(/deadline:\s*(\d{4}-\d{2}-\d{2}|\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(p&&!t.includes(": done")){var L=K(p[1]);if(L){var A=Math.ceil((L-S)/864e5);L<S?k.push({company:n,task:u,assignee:m,detail:"".concat(Math.abs(A),"d overdue")}):L<=E&&w.push({company:n,task:u,assignee:m,detail:0===A?"Today":"".concat(A,"d left")})}}if(!t.includes(": done")){var T=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),x=e.match(/updated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),D=null;if(x?D=K(x[1]):T&&(D=K(T[1])),D&&D<C){var M=Math.ceil((S-D)/864e5);b.push({company:n,task:u,assignee:m,detail:"".concat(M,"d ago")})}}if(t.includes(": done")){var N=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),O=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(N&&O){var R=K(N[1]),I=K(O[1]);if(R&&I){var j=Math.ceil((I-R)/864e5);j>=0&&j<365&&(h+=j,y++)}}}});case 2:return e.a(2)}},e)}),A=1;case 5:if(!(A<u.length)){r.n=8;break}return r.d(t(L()),6);case 6:if(!r.v){r.n=7;break}return r.a(3,7);case 7:A++,r.n=5;break;case 8:T=l+d,e("#statActiveTasks").textContent=T,e("#statAvgDuration").textContent=y>0?Math.round(h/y):"-",(x=l+d+f)>0&&(e("#barToDo").style.width=l/x*100+"%",e("#barInProgress").style.width=d/x*100+"%",e("#barDone").style.width=f/x*100+"%"),e("#countToDo").textContent=l,e("#countInProgress").textContent=d,e("#countDone").textContent=f,D=function(t,n,a,r){var o=e("#".concat(n)),c=e("#".concat(a)),s=e("#".concat(r));if(s&&(s.textContent=t.length),o&&c){if(0===t.length)return o.classList.remove("has-items"),void(c.innerHTML="");o.classList.add("has-items"),c.innerHTML=t.slice(0,10).map(function(e){var t=e.assignee?' <span class="to-assignee">to '.concat(m(e.assignee),"</span>"):"";return'<div class="attention-item">\n              <span class="task-info" title="'.concat(m(e.company),": ").concat(m(e.task),'">').concat(m(e.company),": ").concat(m(e.task)).concat(t,'</span>\n              <span class="task-detail">').concat(m(e.detail),"</span>\n            </div>")}).join("")}},k.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),w.sort(function(e,t){return parseInt(e.detail)-parseInt(t.detail)}),b.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),D(k,"overdueGroup","overdueList","statOverdue"),D(w,"upcomingGroup","upcomingList","statUpcoming"),D(b,"staleGroup","staleList","statStale"),(M=e("#monthlyChart"))&&(N=Object.keys(p).sort().reverse().slice(0,6).reverse(),O=Math.max.apply(Math,a(N.map(function(e){return p[e]||0})).concat([1])),R=Math.max.apply(Math,a(N.map(function(e){return g[e]||0})).concat([1])),I=Math.max(O,R),j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],M.innerHTML=N.map(function(e){var t=n(e.split("-"),2),a=(t[0],t[1]),r=j[parseInt(a)-1],o=p[e]||0,c=g[e]||0,s=I>0?c/I*80:0;return'<div class="month-bar-group">\n              <div class="month-bars">\n                <div class="month-bar tasks" style="height:'.concat(I>0?o/I*80:0,'px">\n                  ').concat(o>0?'<span class="month-bar-value">'.concat(o,"</span>"):"",'\n                </div>\n                <div class="month-bar kyc" style="height:').concat(s,'px">\n                  ').concat(c>0?'<span class="month-bar-value">'.concat(c,"</span>"):"",'\n                </div>\n              </div>\n              <div class="month-bar-label">').concat(r,"</div>\n            </div>")}).join("")),(q=e("#brokerChart"))&&(F=Object.entries(v).filter(function(e){var t=n(e,1)[0];return t&&"(none)"!==t&&""!==t.trim()}).sort(function(e,t){return t[1].active+t[1].completed-(e[1].active+e[1].completed)}),H=Math.max.apply(Math,a(F.map(function(e){var t=n(e,2)[1];return t.active+t.completed})).concat([1])),q.innerHTML=F.map(function(e){var t=n(e,2),a=t[0],r=t[1],o=H>0?r.active/H*100:0,c=H>0?r.completed/H*100:0;return'<div class="broker-row">\n              <span class="broker-name" title="'.concat(m(a),'">').concat(m(a),'</span>\n              <div class="broker-bar-track">\n                <div class="broker-bar-fill active" style="width:').concat(o,'%">').concat(r.active>0?'<span class="bar-num">'.concat(r.active,"</span>"):"",'</div>\n                <div class="broker-bar-fill completed" style="width:').concat(c,'%">').concat(r.completed>0?'<span class="bar-num">'.concat(r.completed,"</span>"):"","</div>\n              </div>\n            </div>")}).join(""));case 9:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}());case 1:r.n=3;break;case 2:r.p=2,o=r.v,console.error("Error loading statistics:",o);case 3:return r.a(2)}},r,null,[[0,2]])})),_.apply(this,arguments)}function K(e){if(!e)return null;if("number"==typeof e&&e>1&&e<1e5){var t=Date.UTC(1899,11,30),n=new Date(t+24*e*60*60*1e3),a=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate());if(!isNaN(a.getTime())&&a.getFullYear()>1970)return a}var r=String(e).trim(),o=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(o){var c=parseInt(o[1],10),s=parseInt(o[2],10)-1,i=parseInt(o[3],10);return new Date(c,s,i)}var u=r.match(/(\d{1,2})[-\s]([A-Za-z]{3})[-\s](\d{2,4})/);if(u){var l=parseInt(u[1]),d={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[u[2].toLowerCase()],f=parseInt(u[3]);if(f<100&&(f+=2e3),void 0!==d)return new Date(f,d,l)}var v=new Date(r);return!isNaN(v.getTime())&&v.getFullYear()>1970?v:null}H&&H.addEventListener("click",function(){I&&(I.style.display="none"),q&&(q.style.display="none"),j&&(j.style.display=""),F&&(F.style.display="flex"),B()}),G&&G.addEventListener("click",function(){I&&(I.style.display=""),q&&(q.style.display="flex"),j&&(j.style.display="none"),F&&(F.style.display="none")}),U&&U.addEventListener("click",function(){B()});var J=e("#searchInput"),P=e("#searchInputWrap"),Y=e("#searchBtn"),z=e("#searchResults"),Z=e("#searchHint"),$=r(".search-tab"),V="active",W=e("#loadRowHint");function Q(){Z&&J&&P&&("active"===V?(P.style.display="none",W&&(W.style.display="none"),Z.textContent="üí° Showing tasks with status: To Do or In Progress"):"company"===V&&(P.style.display="flex",W&&(W.style.display="flex"),J.placeholder="Type company name...",J.type="text",Z.textContent=""))}$.forEach(function(e){e.addEventListener("click",u(c().m(function t(){return c().w(function(t){for(;;)switch(t.n){case 0:if($.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),V=e.getAttribute("data-search"),J&&(J.value=""),Q(),"active"!==V){t.n=2;break}return t.n=1,ce();case 1:t.n=3;break;case 2:z&&(z.classList.remove("visible"),z.innerHTML="");case 3:return t.a(2)}},t)})))}),Y&&Y.addEventListener("click",u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,ce();case 1:return e.a(2)}},e)}))),J&&J.addEventListener("keypress",function(){var e=u(c().m(function e(t){return c().w(function(e){for(;;)switch(e.n){case 0:if("Enter"!==t.key){e.n=1;break}return oe(),e.n=1,ce();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());var X=e("#autocompleteDropdown"),ee=[],te=null;function ne(){return ae.apply(this,arguments)}function ae(){return ae=u(c().m(function e(){var t;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(ee.length>0)){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=u(c().m(function e(t){var n,a,r,o,s,i;return c().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return e.a(2);case 2:return(a=n.getRange("A2:B5000")).load("values"),e.n=3,t.sync();case 3:for(r=a.values||[],ee=[],o=0;o<r.length;o++)s=r[o][0]?String(r[o][0]).trim():"",i=r[o][1]?String(r[o][1]).trim():"",s&&ee.push({name:s,category:i,rowNum:o+2});console.log("Loaded",ee.length,"company rows for autocomplete");case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("Failed to load company list:",t);case 4:return e.a(2)}},e,null,[[1,3]])})),ae.apply(this,arguments)}function re(e){if(X&&e&&"company"===V){var t=e.toLowerCase(),n=ee.filter(function(e){return e.name.toLowerCase().includes(t)}),r=n.filter(function(e){return e.name.toLowerCase().startsWith(t)}),o=n.filter(function(e){return!e.name.toLowerCase().startsWith(t)}),s=[].concat(a(r),a(o)).slice(0,15);0!==s.length?(X.innerHTML=s.map(function(e){var t=e.category?" ¬∑ ".concat(m(e.category)):"";return'<div class="autocomplete-item" data-row="'.concat(e.rowNum,'" data-name="').concat(m(e.name),'">\n        <span class="company-name">').concat(m(e.name),'</span>\n        <span class="row-hint">Row ').concat(e.rowNum).concat(t,"</span>\n      </div>")}).join(""),X.classList.add("visible"),X.querySelectorAll(".autocomplete-item").forEach(function(e){e.addEventListener("click",u(c().m(function t(){var n,a;return c().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),a=e.getAttribute("data-name"),J&&(J.value=a),oe(),t.n=1,ie(n);case 1:return t.a(2)}},t)})))})):oe()}else oe()}function oe(){X&&(X.classList.remove("visible"),X.innerHTML="")}function ce(){return se.apply(this,arguments)}function se(){return se=u(c().m(function e(){var n;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(z){e.n=1;break}return e.a(2);case 1:return z.innerHTML='<div class="no-results">Searching...</div>',z.classList.add("visible"),console.log("Search started, mode:",V),e.p=2,e.n=3,Excel.run(function(){var e=u(c().m(function e(n){var a,r,o,s,i,l,d,f,v,p,g;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(console.log("Sheet found:",!a.isNullObject),!a.isNullObject){e.n=2;break}return z.innerHTML='<div class="no-results">Sheet not found</div>',e.a(2);case 2:return(r=a.getRange("A1:K".concat(5e3))).load("values"),e.n=3,n.sync();case 3:o=r.values||[],console.log("Raw rows loaded (including header and blanks):",o.length),s=Array.isArray(o)?o:[],i=[],l=0,d=c().m(function e(){var t,n,a,r,o,u,d,v,m,p,g,h,y,k,w,b,S,E;return c().w(function(e){for(;;)switch(e.n){case 0:if(y=function(e){if(!e||0===e.length)return"";var t=null;if(e.forEach(function(e){if(e){var n=new Date(e);isNaN(n.getTime())||(!t||n>t)&&(t=n)}}),!t)return"";var n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r)},!(t=s[f]||[]).every(function(e){return null===e||""===e})){e.n=1;break}return e.a(2,1);case 1:l++,n=t[0]?String(t[0]).trim():"",a=t[1]?String(t[1]).trim():"",r=t[7]?String(t[7]).trim():"",o=!1,u="unknown",d=!1,v=!1,m=!1,p=[],g=[],h=[],r&&(r.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=xe(e);if(t){var n=(t.status||"").toLowerCase();"to do"===n?(d=!0,t.initiated&&p.push(t.initiated)):"in progress"===n?(v=!0,t.updated&&g.push(t.updated)):"done"===n&&(m=!0,t.completed&&h.push(t.completed))}}),o=d||v,v?u="progress":d?u="todo":m&&(u="done")),k="",w="","progress"===u?(w=y(g),k=w?"Updated":""):"todo"===u?(w=y(p),k=w?"Initiated":""):"done"===u&&(w=y(h),k=w?"Completed":""),b=w?fe(w):"",S=f+1,"company"===V?(E=(J?J.value:"").toLowerCase().trim(),console.log("Checking row",S,"- Company:",n,"- Query:",E),E&&n.toLowerCase().includes(E)&&(console.log("Match found:",n),i.push({rowNum:S,companyName:n,taskCategory:a,dominantStatus:u,hasActiveTasks:o,statusDateLabel:k,statusDateDisplay:b}))):"active"===V&&(console.log("Checking row",S,"- Company:",n,"- Active:",o),o&&i.push({rowNum:S,companyName:n,taskCategory:a,dominantStatus:u,hasActiveTasks:o,statusDateLabel:k,statusDateDisplay:b}));case 2:return e.a(2)}},e)}),f=1;case 4:if(!(f<s.length)){e.n=7;break}return e.d(t(d()),5);case 5:if(!e.v){e.n=6;break}return e.a(3,6);case 6:f++,e.n=4;break;case 7:v=l,p="company"===V?"Company":"Active tasks",g=(J?J.value:"").trim(),console.log("Search complete, mode:",p,"rows scanned:",v,"matches:",i.length,"query:",g),0===i.length?z.innerHTML='<div class="no-results">No results found</div>':(z.innerHTML=i.map(function(e){var t="progress"===e.dominantStatus?'<span class="status-badge progress">In Progress</span>':"todo"===e.dominantStatus?'<span class="status-badge todo">To Do</span>':"done"===e.dominantStatus?'<span class="status-badge done">Done</span>':"",n=e.statusDateLabel&&e.statusDateDisplay?" ¬∑ ".concat(e.statusDateLabel," ").concat(m(e.statusDateDisplay)):"";return'<div class="search-result-item" data-row="'.concat(e.rowNum,'">\n              <div class="company">').concat(m(e.companyName||"(No name)")).concat(t,'</div>\n              <div class="meta">Row ').concat(e.rowNum," ¬∑ ").concat(m(e.taskCategory||"No category")).concat(n,"</div>\n            </div>")}).join(""),z.querySelectorAll(".search-result-item").forEach(function(e){e.addEventListener("click",u(c().m(function t(){var n;return c().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),t.n=1,ie(n);case 1:z.classList.remove("visible");case 2:return t.a(2)}},t)})))}));case 8:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,n=e.v,console.error("Search error:",n),z.innerHTML='<div class="no-results">Search error</div>';case 5:return e.a(2)}},e,null,[[2,4]])})),se.apply(this,arguments)}function ie(e){return ue.apply(this,arguments)}function ue(){return ue=u(c().m(function e(t){return c().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=u(c().m(function e(n){var a;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!a.isNullObject){e.n=2;break}return e.a(2);case 2:return a.getRange("A".concat(t)).select(),e.n=3,n.sync();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.n=2,Me();case 2:return e.a(2)}},e)})),ue.apply(this,arguments)}function le(e){return de.apply(this,arguments)}function de(){return de=u(c().m(function e(t){return c().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2,null);case 1:return e.a(2,Excel.run(function(){var e=u(c().m(function e(n){var a,r,o,s,i,u,l,d;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!a.isNullObject){e.n=2;break}return e.a(2,null);case 2:return(r=a.getUsedRange()).load("values"),e.n=3,n.sync();case 3:for(o=r.values||[],s=null,i=1;i<o.length;i++)u=o[i],l=u[0]?String(u[0]).trim().toLowerCase():"",d=u[7]?String(u[7]).trim():"",l===t.toLowerCase()&&d&&d.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes("kyc")&&t.includes(": done")){var n=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);n&&(s=n[1])}});return e.a(2,s)}},e)}));return function(t){return e.apply(this,arguments)}}()))}},e)})),de.apply(this,arguments)}function fe(e){if(!e)return"";var t=String(e).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){var n=parseInt(t[1],10),a=parseInt(t[2],10)-1,r=parseInt(t[3],10);return"".concat(r,"-").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a],"-").concat(n)}var o=new Date(e);if(isNaN(o.getTime()))return"";var c=o.getDate(),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o.getMonth()],i=o.getFullYear();return"".concat(c,"-").concat(s,"-").concat(i)}J&&(J.addEventListener("input",function(e){if("company"===V){clearTimeout(te);var t=e.target.value.trim();t.length<1?oe():te=setTimeout(function(){re(t)},150)}}),J.addEventListener("focus",u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:if("company"!==V){e.n=2;break}return e.n=1,ne();case 1:J.value.trim().length>=1&&re(J.value.trim());case 2:return e.a(2)}},e)}))),J.addEventListener("blur",function(){setTimeout(oe,200)})),Q();var ve=fe;function me(){return r("#taskCategories .category-toggle:checked").map(function(e){return e.value})}function pe(){var t=e('#taskCategories .category-toggle[value="Other Task"]');return t&&t.checked}function ge(t){return"__other__"===t?e("#otherTaskCard"):L?L.querySelector('.task-card[data-task="'.concat(t,'"]')):null}function he(e){if(!e)return[];var t=e.querySelector('[data-role="status-chips"]');return t?Array.from(t.querySelectorAll(".chip")):[]}function ye(e,t){he(e).forEach(function(e){e.classList.toggle("active",e.getAttribute("data-value")===t)})}function ke(e){var t=he(e).find(function(e){return e.classList.contains("active")});return t?t.getAttribute("data-value"):"To Do"}function we(){if(C&&L){var t=pe(),n=e("#otherTaskCard"),a=me().some(function(e){return"Other Task"!==e});C.style.display=a?"":"none";var o=new Set(Se());r("#taskCards .task-card").forEach(function(e){var t=e.getAttribute("data-task");e.style.display=o.has(t)?"":"none"}),n&&(n.style.display=t?"":"none")}}function be(){if(S){var e=me().filter(function(e){return"Other Task"!==e});0===e.length?S.placeholder="General note about this task":1===e.length?S.placeholder="General note about this "+e[0]:S.placeholder="General note about these tasks"}}function Se(){return r("#tasksChecklist .task-toggle:checked").map(function(e){return e.value})}function Ee(t){var n=e(t);if(n){var a=Array.from(n.children);if(0!==a.length){var r=[],o=[];a.forEach(function(e){var t=e.querySelector("input[type=checkbox]")||e.querySelector('input[type="checkbox"]');t&&t.checked?r.push(e):o.push(e)}),[].concat(r,o).forEach(function(e){return n.appendChild(e)})}}}function Ce(){return Le.apply(this,arguments)}function Le(){return Le=u(c().m(function t(){var n;return c().w(function(t){for(;;)switch(t.n){case 0:if(!o){t.n=1;break}return t.a(2);case 1:if(o=!0,n=e("#assignees")){t.n=2;break}return t.a(2);case 2:if("1"!==n.dataset.initialized){t.n=3;break}return t.a(2);case 3:return n.dataset.initialized="1",n.innerHTML="",t.n=4,Excel.run(function(){var e=u(c().m(function e(t){var a,r,o,s,i,u;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=t.workbook.worksheets.getItemOrNullObject("Team members")).load("name"),e.n=1,t.sync();case 1:if(!a.isNullObject){e.n=2;break}return console.error("Team members sheet not found"),e.a(2);case 2:return(r=a.getUsedRange()).load("values"),e.n=3,t.sync();case 3:o=r.values||[],s=o.slice(1).map(function(e){return e[0]}).filter(function(e){return e&&String(e).trim().length>0}).map(function(e){return String(e).trim()}),i=Array.from(new Set(s)),console.log("Team members loaded from column A:",i),i.forEach(function(e){var t=document.createElement("div");t.innerHTML='<label><input type="checkbox" value="'.concat(e,'"> ').concat(e,"</label>"),n.appendChild(t)}),h&&(h.innerHTML="",(u=document.createElement("option")).value="",u.textContent="(none)",h.appendChild(u),i.forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,h.appendChild(t)}));case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return t.a(2)}},t)})),Le.apply(this,arguments)}function Ae(){return Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).map(function(e){return e.value})}function Te(){var e=Ae();r(".task-assignee-select").forEach(function(t){var n=t.value;t.innerHTML="";var a=document.createElement("option");a.value="",a.textContent="(Select assignee)",t.appendChild(a),e.forEach(function(e){var n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),1===e.length?t.value=e[0]:e.includes(n)&&(t.value=n)})}function xe(e){if(!e)return null;var t=/^(.*?)\s*:\s*(to do|in progress|done)\s*\|\|\s*assigned to\s+([^|]+)/i.exec(e);if(!t)return null;var n={name:t[1].trim(),status:t[2],assignee:t[3].trim(),comment:"",giveUpId:"",initiated:"",updated:"",completed:"",deadline:""},a=/\|\|\s*comment:\s*([^|]+)/i.exec(e);a&&(n.comment=a[1].trim());var r=/\|\|\s*give-up id:\s*([^|]+)/i.exec(e);r&&(n.giveUpId=r[1].trim());var o=/\|\|\s*task initiated:\s*([^|]+)/i.exec(e);o&&(n.initiated=o[1].trim());var c=/\|\|\s*status updated:\s*([^|]+)/i.exec(e);c&&(n.updated=c[1].trim());var s=/\|\|\s*completed:\s*([^|]+)/i.exec(e);s&&(n.completed=s[1].trim());var i=/\|\|\s*deadline:\s*([^|]+)/i.exec(e);return i&&(n.deadline=i[1].trim()),n}function De(e){var t=[],n=e.status||"To Do";return t.push("".concat(e.name,": ").concat(n)),t.push("Assigned to ".concat(e.assignees)),e.comment&&t.push("Comment: ".concat(e.comment)),e.giveUpId&&t.push("Give-up ID: ".concat(e.giveUpId)),e.initiated&&t.push("Task initiated: ".concat(e.initiated)),e.updated&&t.push("Status updated: ".concat(e.updated)),e.completed&&t.push("Completed: ".concat(e.completed)),e.deadline&&t.push("Deadline: ".concat(e.deadline)),t.join(" || ")}function Me(){return Ne.apply(this,arguments)}function Ne(){return Ne=u(c().m(function t(){return c().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Ce();case 1:return t.n=2,Excel.run(function(){var t=u(c().m(function t(n){var a,o,s,i,u,l,d,f,v,m,C,L,T,x,D,M,O,R,I,j,q,F,H,G,U,B,_,K,J,P,Y,z,Z,$,V,W,Q,X;return c().w(function(t){for(;;)switch(t.n){case 0:return I=function(e){if(null==e||""===e)return"";if("number"==typeof e){var t=Date.UTC(1899,11,30),n=new Date(t+864e5*e),a=n.getUTCFullYear(),r=String(n.getUTCMonth()+1).padStart(2,"0"),o=String(n.getUTCDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(o)}if(e instanceof Date){var c=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return"".concat(c,"-").concat(s,"-").concat(i)}var u=String(e).trim();if(u.match(/^(\d{4})-(\d{2})-(\d{2})$/))return u;var l=u.match(/^(\d{1,2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{4})$/i);if(l){var d=parseInt(l[1],10),f={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[l[2].toLowerCase()],v=parseInt(l[3],10),m=String(d).padStart(2,"0"),p=String(f+1).padStart(2,"0");return"".concat(v,"-").concat(p,"-").concat(m)}var g=new Date(e);if(!isNaN(g.getTime())){var h=g.getFullYear(),y=String(g.getMonth()+1).padStart(2,"0"),k=String(g.getDate()).padStart(2,"0");return"".concat(h,"-").concat(y,"-").concat(k)}return u.length>=10?u.slice(0,10):""},(a=n.workbook.getSelectedRange()).load("rowIndex"),t.n=1,n.sync();case 1:return o=a.rowIndex+1,(s=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),t.n=2,n.sync();case 2:if(!s.isNullObject){t.n=3;break}return t.a(2);case 3:return i=s.getRange("A".concat(o)),u=s.getRange("B".concat(o)),l=s.getRange("C".concat(o)),d=s.getRange("D".concat(o)),f=s.getRange("E".concat(o,":G").concat(o)),v=s.getRange("H".concat(o)),m=s.getRange("J".concat(o)),C=s.getRange("K".concat(o)),i.load("values"),u.load("values"),l.load("values"),d.load("values"),f.load("values"),v.load("values"),m.load("values"),C.load("values"),t.n=4,n.sync();case 4:for(L=i.values&&i.values[0]&&i.values[0][0]?String(i.values[0][0]):"",g&&(g.value=L),T=u.values&&u.values[0]&&u.values[0][0]?String(u.values[0][0]):"",x=T.split(",").map(function(e){return e.trim()}).filter(Boolean),r("#taskCategories .category-toggle").forEach(function(e){var t=x.some(function(t){return t.toLowerCase()===e.value.toLowerCase()});e.checked=t}),D=d.values&&d.values[0]&&d.values[0][0]?String(d.values[0][0]):"",h&&(h.value=D),M=l.values&&l.values[0]&&l.values[0][0]?String(l.values[0][0]):"",O=M.split(/[,;]+/).map(function(e){return e.trim().toLowerCase()}).filter(Boolean),console.log("Assignees from column C:",O),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=O.includes(e.value.toLowerCase())}),R=f.values&&f.values[0]?f.values[0]:[null,null,null],console.log("Date values from Excel:",R),y&&(y.value=I(R[0])),k&&(k.value=I(R[1])),w&&(w.value=I(R[2])),console.log("Parsed dates:",null==y?void 0:y.value,null==k?void 0:k.value,null==w?void 0:w.value),j=m.values&&m.values[0]&&m.values[0][0]?String(m.values[0][0]):"",b&&(b.value=j),q=C.values&&C.values[0]&&C.values[0][0]?String(C.values[0][0]):"",S&&(S.value=q),F=v.values&&v.values[0]&&v.values[0][0]?String(v.values[0][0]):"",H=F.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),G=[],U=[],B=0;B<H.length;B++)(_=xe(H[B]))?G.push(_):U.push(H[B]);K={"to do":1,"in progress":2,done:3},G.sort(function(e,t){return(K[(e.status||"").toLowerCase()]||4)-(K[(t.status||"").toLowerCase()]||4)}),console.log("Parsed tasks:",G),Te(),r("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),r("#taskCards .task-card, #otherTaskCard").forEach(function(e){he(e).forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]'),n=e.querySelector('[data-role="deadline"]'),a=e.querySelector('[data-role="giveUpId"]'),r=e.querySelector('[data-role="task-assignee"]');t&&(t.value=""),n&&(n.value=""),a&&(a.value=""),r&&(r.value="")}),pe()?(J=ge("__other__"))&&(P=G[0]||null,A&&(A.value=P&&P.name?P.name:""),P&&(Y=(P.status||"").toLowerCase(),ye(J,"in progress"===Y?"In Progress":"done"===Y?"Done":"To Do"),z=J.querySelector('[data-role="comment"]'),Z=J.querySelector('[data-role="deadline"]'),$=J.querySelector('[data-role="task-assignee"]'),z&&(z.value=P.comment||""),Z&&(Z.value=(P.deadline||"").slice(0,10)),$&&P.assignee&&($.value=P.assignee.trim()))):r("#tasksChecklist .task-toggle").forEach(function(e){var t=e.value,n=G.find(function(e){var n=(e.name||"").toLowerCase(),a=t.toLowerCase();return n===a||"kyc (produced by lcmc)"===a&&"kyc (internal)"===n});e.checked=!!n;var a=ge(t);if(a&&n){var r=(n.status||"").toLowerCase();ye(a,"in progress"===r?"In Progress":"done"===r?"Done":"To Do");var o=a.querySelector('[data-role="comment"]'),c=a.querySelector('[data-role="deadline"]'),s=a.querySelector('[data-role="giveUpId"]'),i=a.querySelector('[data-role="task-assignee"]');o&&(o.value=n.comment||""),c&&(c.value=(n.deadline||"").slice(0,10)),s&&(s.value=n.giveUpId||""),i&&n.assignee&&(i.value=n.assignee.trim())}}),E&&(V=null,G.length>0&&(V=G[0]),V?(W=[],V.initiated&&W.push("Task initiated: ".concat(V.initiated)),V.updated&&W.push("Status updated: ".concat(V.updated)),V.completed&&W.push("Completed: ".concat(V.completed)),E.textContent=W.join(" | ")):E.textContent=""),(Q=e("#lastKycDate"))&&L?(X=null,G.forEach(function(e){e.name&&e.name.toLowerCase().includes("kyc")&&e.status&&"done"===e.status.toLowerCase()&&e.completed&&(X=e.completed)}),X?Q.textContent=X:le(L).then(function(e){Q.textContent=e||"‚Äî"})):Q&&(Q.textContent="‚Äî"),we(),Ge(),be(),Ee("#assignees"),Ee("#tasksChecklist"),Ee("#taskCategories"),N=o,p(),Pe(),Be&&Be.classList.remove("visible");case 5:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:return t.a(2)}},t)})),Ne.apply(this,arguments)}function Oe(){return Re.apply(this,arguments)}function Re(){return Re=u(c().m(function e(){var t,n,a;return c().w(function(e){for(;;)switch(e.n){case 0:return t=me().join(", "),n=Ae().join(", "),a=pe(),console.log("Saving - Categories:",t,"Assignees:",n,"IsOther:",a),e.n=1,Excel.run(function(){var e=u(c().m(function e(r){var o,s,i,u,l,d,f,v,m,p,E,C,L,T,x,D,M,N,O,R,I,j,q,F,H,G,U,B,_,K,J,P,Y,z,Z,$,V,W,Q;return c().w(function(e){for(;;)switch(e.n){case 0:return(o=r.workbook.getSelectedRange()).load("rowIndex"),e.n=1,r.sync();case 1:return s=o.rowIndex+1,(i=r.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=2,r.sync();case 2:if(!i.isNullObject){e.n=3;break}return e.a(2);case 3:return(u=i.getRange("E".concat(s,":G").concat(s))).load("values"),l=i.getRange("A".concat(s)),d=i.getRange("B".concat(s)),f=i.getRange("C".concat(s)),v=i.getRange("D".concat(s)),m=i.getRange("H".concat(s)),p=i.getRange("J".concat(s)),E=i.getRange("K".concat(s)),m.load("values"),e.n=4,r.sync();case 4:return C=u.values&&u.values[0]?u.values[0]:[null,null,null],y&&(C[0]=ve(y.value)),k&&(C[1]=ve(k.value)),w&&(C[2]=ve(w.value)),u.values=[C],d.values=[[t]],h&&(v.values=[[h.value||""]]),g&&(l.values=[[g.value||""]]),f.values=[[n]],console.log("Saving assignees to column C:",n),b&&(p.values=[[b.value||""]]),S&&(E.values=[[S.value||""]]),L=m.values&&m.values[0]&&m.values[0][0]?String(m.values[0][0]):"",T=L.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),x=T.filter(function(e){return!xe(e)}),D=[],M={},T.forEach(function(e){var t=xe(e);t&&(M[t.name.toLowerCase()]=t)}),N=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))},O=function(e,t,n){var a=N(),r=n?(n.status||"").toLowerCase():"",o=(t||"").toLowerCase(),c=n&&n.initiated?n.initiated:"",s=n&&n.updated?n.updated:"",i=n&&n.completed?n.completed:"",u=c||s||i;return"to do"===o?(c=c||a,s="",i=""):"in progress"===o?(u&&r===o||(s=a),c="",i=""):"done"===o&&(u&&i&&r===o||(i=a),c="",s=""),{initiated:c,updated:s,completed:i}},a?(R=ge("__other__"),(I=A?A.value.trim():"")&&(j=ke(R)||"To Do",q=R?R.querySelector('[data-role="comment"]'):null,F=R?R.querySelector('[data-role="deadline"]'):null,H=R?R.querySelector('[data-role="task-assignee"]'):null,G=H&&H.value?H.value:n,U=M[I.toLowerCase()],B=O(0,j,U),_={name:I,status:j,assignees:G,comment:q?q.value.trim():"",giveUpId:"",initiated:B.initiated,updated:B.updated,completed:B.completed,deadline:F?F.value:""},K=De(_),D.push({line:K,status:j}))):(J=Se(),P=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],J.forEach(function(e){if(P.includes(e)){var t=ge(e);if(t){var a=ke(t),r=t.querySelector('[data-role="comment"]'),o=t.querySelector('[data-role="deadline"]'),c=t.querySelector('[data-role="giveUpId"]'),s=t.querySelector('[data-role="task-assignee"]'),i=s&&s.value?s.value:n,u=M[e.toLowerCase()];u||"kyc (produced by lcmc)"!==e.toLowerCase()||(u=M["kyc (internal)"]);var l=O(0,a,u),d={name:e,status:a,assignees:i,comment:r?r.value.trim():"",giveUpId:c?c.value.trim():"",initiated:l.initiated,updated:l.updated,completed:l.completed,deadline:o?o.value:""};D.push({line:De(d),status:a})}}})),Y={"to do":1,"in progress":2,done:3},D.sort(function(e,t){return(Y[(e.status||"").toLowerCase()]||4)-(Y[(t.status||"").toLowerCase()]||4)}),z=D.map(function(e){return e.line}),Z=x.concat(z).filter(Boolean).join("\n"),console.log("Saving to H - newTaskLines:",z,"newValue:",Z),m.values=[[Z]],z.length>0&&($=!1,V=!1,W=!1,z.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?$=!0:t.includes(": to do")?V=!0:t.includes(": done")&&(W=!0)}),Q=$?"#ff9900":V?"#34a853":W?"#cc6666":"#34a853",m.format.font.color=Q),e.n=5,r.sync();case 5:console.log("Save completed successfully for row",s);case 6:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),Re.apply(this,arguments)}function Ie(){g&&(g.value=""),r("#taskCategories .category-toggle").forEach(function(e){e.checked=!1}),h&&(h.value=""),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=!1}),y&&(y.value=""),k&&(k.value=""),w&&(w.value=""),b&&(b.value=""),S&&(S.value=""),r("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),r("#taskCards .task-card, #otherTaskCard").forEach(function(e){e.querySelectorAll('[data-role="status-chips"] .chip').forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]');t&&(t.value="");var n=e.querySelector('[data-role="deadline"]');n&&(n.value="");var a=e.querySelector('[data-role="giveUpId"]');a&&(a.value="");var r=e.querySelector('[data-role="task-assignee"]');r&&(r.value="")}),A&&(A.value=""),E&&(E.textContent="");var t=e("#lastKycDate");t&&(t.textContent="‚Äî"),z&&(z.classList.remove("visible"),z.innerHTML=""),Be&&Be.classList.remove("visible"),N="new",Pe(),Ge(),we(),be(),setTimeout(function(){var e=document.querySelector('#taskCards .task-card:not([style*="display: none"]), #otherTaskCard:not([style*="display: none"])');if(e){var t=e.querySelector('[data-role="comment"]');t&&"function"==typeof t.focus&&t.focus()}},100)}function je(){return qe.apply(this,arguments)}function qe(){return qe=u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:if(null!==N&&"new"!==N){e.n=1;break}throw new Error("No row to delete");case 1:return e.n=2,Excel.run(function(){var e=u(c().m(function e(t){var n;return c().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("Sheet TASK MANAGER FORM not found");case 2:return n.getRange("".concat(N,":").concat(N)).delete(Excel.DeleteShiftDirection.up),e.n=3,t.sync();case 3:console.log("Deleted row",N);case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e)})),qe.apply(this,arguments)}function Fe(){return He.apply(this,arguments)}function He(){return He=u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=u(c().m(function e(t){var n,a,r,o,s,i,u,l,d,f,v,m,p,E,C,L,T,x,D,M,O,R,I,j,q,F,H,G,U,B,_,K,J,P;return c().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return console.error("Sheet TASK MANAGER FORM not found"),e.a(2);case 2:return(a=n.getRange("A2:A1000")).load("values"),e.n=3,t.sync();case 3:r=2,o=a.values||[],s=0;case 4:if(!(s<o.length)){e.n=7;break}if(!o[s][0]||""===String(o[s][0]).trim()){e.n=5;break}r=s+3,e.n=6;break;case 5:return r=s+2,e.a(3,7);case 6:s++,e.n=4;break;case 7:return i=g?g.value.trim():"",u=me().join(", "),l=pe(),d=h?h.value:"",f=Ae().join(", "),n.getRange("A".concat(r)).values=[[i]],n.getRange("B".concat(r)).values=[[u]],n.getRange("C".concat(r)).values=[[f]],n.getRange("D".concat(r)).values=[[d]],v=ve(y?y.value:""),m=ve(k?k.value:""),p=ve(w?w.value:""),n.getRange("E".concat(r,":G").concat(r)).values=[[v,m,p]],n.getRange("J".concat(r)).values=[[b?b.value:""]],n.getRange("K".concat(r)).values=[[S?S.value:""]],E=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))}(),C=[],l?(L=ge("__other__"),(T=A?A.value.trim():"")&&(x=ke(L)||"To Do",D=L?L.querySelector('[data-role="comment"]'):null,M=L?L.querySelector('[data-role="deadline"]'):null,O=L?L.querySelector('[data-role="task-assignee"]'):null,R=O&&O.value?O.value:f,I="",j="",q="","to do"===(F=x.toLowerCase())?I=E:"in progress"===F?j=E:"done"===F&&(q=E),H={name:T,status:x,assignees:R,comment:D?D.value.trim():"",giveUpId:"",initiated:I,updated:j,completed:q,deadline:M?M.value:""},C.push(De(H)))):(G=Se(),U=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],G.forEach(function(e){if(U.includes(e)){var t=ge(e);if(t){var n=ke(t)||"To Do",a=t.querySelector('[data-role="comment"]'),r=t.querySelector('[data-role="deadline"]'),o=t.querySelector('[data-role="giveUpId"]'),c=t.querySelector('[data-role="task-assignee"]'),s=c&&c.value?c.value:f,i="",u="",l="",d=n.toLowerCase();"to do"===d?i=E:"in progress"===d?u=E:"done"===d&&(l=E);var v={name:e,status:n,assignees:s,comment:a?a.value.trim():"",giveUpId:o?o.value.trim():"",initiated:i,updated:u,completed:l,deadline:r?r.value:""};C.push(De(v))}}})),(B=n.getRange("H".concat(r))).values=[[C.join("\n")]],C.length>0&&(_=!1,K=!1,J=!1,C.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?_=!0:t.includes(": to do")?K=!0:t.includes(": done")&&(J=!0)}),P=_?"#ff9900":K?"#34a853":J?"#cc6666":"#34a853",B.format.font.color=P),e.n=8,t.sync();case 8:return n.getRange("A".concat(r)).select(),e.n=9,t.sync();case 9:N=r;case 10:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),He.apply(this,arguments)}function Ge(){[{input:"#initialRequest",display:"#initialRequestDisplay"},{input:"#introEmail",display:"#introEmailDisplay"},{input:"#remindersStart",display:"#remindersStartDisplay"}].forEach(function(t){var n=t.input,a=t.display,r=e(n),o=e(a);if(r&&o){var c=fe(r.value);o.textContent=c?"‚Üí ".concat(c):""}})}r("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){we(),be()})}),document.querySelectorAll("#assignees").forEach(function(e){e.addEventListener("change",function(e){"checkbox"===e.target.type&&Te()})});var Ue=e("#viewEmailSummaryBtn"),Be=e("#emailSummarySection"),_e=e("#emailSummaryList"),Ke=e("#emailSummaryCount"),Je=e("#closeEmailSummaryBtn");function Pe(){var e=g?g.value.trim():"";Ue&&(Ue.disabled=!e)}function Ye(){return ze.apply(this,arguments)}function ze(){return(ze=u(c().m(function e(){var t,n,a,r,o;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=g?g.value.trim():""){e.n=1;break}return l("No company name entered","error"),e.a(2);case 1:return Be&&Be.classList.add("visible"),_e&&(_e.innerHTML='<div class="email-loading">Loading summaries...</div>'),e.p=2,e.n=3,fetch("".concat(i,"/api/task-manager/summaries/").concat(encodeURIComponent(t),"?include_drafts=true"));case 3:if((n=e.v).ok){e.n=4;break}throw new Error("Server returned ".concat(n.status));case 4:return e.n=5,n.json();case 5:if(a=e.v,r=a.summaries||[],Ke&&(Ke.textContent=r.length),0!==r.length){e.n=6;break}return _e.innerHTML='<div class="email-no-summaries">No email summaries found for this company.</div>',e.a(2);case 6:_e.innerHTML=r.map(function(e){return'\n        <div class="email-summary-item '.concat(e.is_draft?"draft":"confirmed",'" data-id="').concat(e.id,'">\n          <div class="email-summary-subject">\n            ').concat(m(e.subject||"No subject"),"\n            ").concat(e.is_draft?'<span class="draft-badge">Draft</span>':"",'\n          </div>\n          <div class="email-summary-meta">\n            From: ').concat(m(e.from||"Unknown")," | ").concat(Ze(e.date),'\n          </div>\n          <div class="email-summary-text">').concat(m(e.summary||"No summary available"),"</div>\n          ").concat(e.is_draft?'\n            <div class="email-summary-actions">\n              <button class="btn-confirm-summary" onclick="window.confirmEmailSummary('.concat(e.id,')">\n                ‚úì Confirm & Link to Task\n              </button>\n            </div>\n          '):"","\n        </div>\n      ")}).join(""),e.n=8;break;case 7:e.p=7,o=e.v,console.error("Error loading email summaries:",o),_e&&(_e.innerHTML='<div class="email-no-summaries">Error loading summaries: '.concat(m(o.message),"<br><small>Make sure the Email Summarizer service is running.</small></div>"));case 8:return e.a(2)}},e,null,[[2,7]])}))).apply(this,arguments)}function Ze(e){if(!e)return"Unknown date";try{var t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch(t){return e}}g&&(g.addEventListener("input",Pe),g.addEventListener("change",Pe)),Ue&&Ue.addEventListener("click",u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye();case 1:return e.a(2)}},e)}))),Je&&Je.addEventListener("click",function(){Be&&Be.classList.remove("visible")}),window.confirmEmailSummary=function(){var e=u(c().m(function e(t){var n,a;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==N&&"new"!==N){e.n=1;break}return l("Please save the task first","error"),e.a(2);case 1:return e.p=1,e.n=2,fetch("".concat(i,"/api/task-manager/confirm/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_row:N})});case 2:if((n=e.v).ok){e.n=3;break}throw new Error("Server returned ".concat(n.status));case 3:return e.n=4,Excel.run(function(){var e=u(c().m(function e(n){var a,r,o,s;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!a.isNullObject){e.n=2;break}throw new Error("Sheet not found");case 2:return(r=a.getRange("L".concat(N))).load("values"),e.n=3,n.sync();case 3:return o=r.values&&r.values[0]&&r.values[0][0]?String(r.values[0][0]):"",s="[Email Summary #".concat(t,"]"),r.values=[[o?"".concat(o," ").concat(s):s]],e.n=4,n.sync();case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return l("Summary confirmed and linked!","success"),e.n=5,Ye();case 5:e.n=7;break;case 6:e.p=6,a=e.v,console.error("Error confirming summary:",a),l("Error confirming summary: "+a.message,"error");case 7:return e.a(2)}},e,null,[[1,6]])}));return function(t){return e.apply(this,arguments)}}(),"undefined"!=typeof Office&&"function"==typeof Office.onReady&&Office.onReady(function(t){t.host===Office.HostType.Excel&&(r('#taskCards [data-role="status-chips"] .chip, #otherTaskCard [data-role="status-chips"] .chip').forEach(function(e){e.addEventListener("click",function(){var t=e.closest('[data-role="status-chips"]');t&&Array.from(t.querySelectorAll(".chip")).forEach(function(t){t.classList.toggle("active",t===e)})})}),["#initialRequest","#introEmail","#remindersStart"].forEach(function(t){var n=e(t);n&&n.addEventListener("change",Ge)}),r('[data-role="deadline"]').forEach(function(e){e.addEventListener("change",function(){p()})}),r("input, select, textarea").forEach(function(e){e.addEventListener("change",function(){return v(!0)}),e.addEventListener("input",function(){return v(!0)})}),r(".chip").forEach(function(e){e.addEventListener("click",function(){return v(!0)})}),r("#tasksChecklist .task-toggle").forEach(function(e){e.addEventListener("change",function(){return we()})}),r("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){return we()})}),Me().then(function(){v(!1),ce()}))})}()}();
//# sourceMappingURL=taskpane.js.map