/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={60947:function(e,t,n){"use strict";e.exports=n.p+"0775df2254caa4e8eaa2.js"}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var r=a.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=a[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){if(null!=t){var n=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o,c,s=[],i=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(a=o.call(n)).done)&&(s.push(a.value),s.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw r}}return s}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function c(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,a,r,o){var c=a&&a.prototype instanceof u?a:u,l=Object.create(c.prototype);return s(l,"_invoke",function(n,a,r){var o,c,s,u=0,l=r||[],d=!1,f={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,n){return o=t,c=0,s=e,f.n=n,i}};function v(n,a){for(c=n,s=a,t=0;!d&&u&&!r&&t<l.length;t++){var r,o=l[t],v=f.p,m=o[2];n>3?(r=m===a)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=v&&((r=n<2&&v<o[1])?(c=0,f.v=a,f.n=o[1]):v<m&&(r=n<3||o[0]>a||a>m)&&(o[4]=n,o[5]=a,f.n=m,c=0))}if(r||n>1)return i;throw d=!0,a}return function(r,l,m){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&v(l,m),c=l,s=m;(t=c<2?e:s)||!d;){o||(c?c<3?(c>1&&(f.n=-1),v(c,s)):f.n=s:f.v=s);try{if(u=2,o){if(c||(r="next"),t=o[r]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),c=1);o=e}else if((t=(d=f.n<0)?s:n.call(a,f))!==i)break}catch(t){o=e,c=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,r,o),!0),l}var i={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][a]?t(t([][a]())):(s(t={},a,function(){return this}),t),v=d.prototype=u.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,r,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=d,s(v,"constructor",d),s(d,"constructor",l),l.displayName="GeneratorFunction",s(d,r,"GeneratorFunction"),s(v),s(v,r,"Generator"),s(v,a,function(){return this}),s(v,"toString",function(){return"[object Generator]"}),(c=function(){return{w:o,m:m}})()}function s(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}s=function(e,t,n,a){function o(t,n){s(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},s(e,t,n,a)}function i(e,t,n,a,r,o,c){try{var s=e[o](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(a,r)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function c(e){i(o,a,r,c,s,"next",e)}function s(e){i(o,a,r,c,s,"throw",e)}c(void 0)})}}!function(){var e=function(e){return document.querySelector(e)},r=function(e){return Array.from(document.querySelectorAll(e))},o=!1,s=!1,i="http://localhost:5002";function l(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=e("#toast");a&&(a.textContent=t,a.className="toast "+n+" show",setTimeout(function(){a.classList.remove("show")},3e3))}function d(t){s=t;var n=e("#unsavedIndicator");n&&n.classList.toggle("visible",t)}function f(e){var t=document.createElement("div");return t.textContent=String(e||""),t.innerHTML}function v(){r(".task-card").forEach(function(e){var t=e.querySelector('[data-role="deadline"]');if(t){var n=function(e){if(!e)return"";var t=new Date(e);if(isNaN(t.getTime()))return"";var n=new Date;n.setHours(0,0,0,0),t.setHours(0,0,0,0);var a=Math.ceil((t-n)/864e5);return a<0?"overdue":a<=3?"warning":""}(t.value);e.classList.remove("deadline-warning","deadline-overdue"),"overdue"===n?e.classList.add("deadline-overdue"):"warning"===n&&e.classList.add("deadline-warning")}})}window.addEventListener("beforeunload",function(e){if(s)return e.preventDefault(),e.returnValue="",""});var m=e("#companyName"),p=e("#brokerLead"),g=e("#initialRequest"),h=e("#introEmail"),y=e("#remindersStart"),k=e("#emailFrequency"),w=e("#extraNote"),b=e("#auditText"),S=e("#tasksRow"),E=e("#taskCards"),L=e("#taskName"),C=e("#saveBtn"),A=e("#newTaskBtn"),T=e("#loadSelectedBtn"),D=e("#openKycPortal"),x=null;function M(t){return new Promise(function(n){var a=e("#confirmDialog"),r=e("#confirmMessage"),o=e("#confirmCancel"),c=e("#confirmOk");if(a&&r&&o&&c){r.textContent=t,a.style.display="flex";var s=function(){a.style.display="none",o.removeEventListener("click",i),c.removeEventListener("click",u)},i=function(){s(),n(!1)},u=function(){s(),n(!0)};o.addEventListener("click",i),c.addEventListener("click",u)}else n(!1)})}C&&C.addEventListener("click",u(c().m(function e(){var t;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,null!==x&&"new"!==x){e.n=2;break}return e.n=1,Ie();case 1:l("âœ… New task added successfully!","success"),e.n=4;break;case 2:return e.n=3,Me();case 3:l("âœ… Changes saved to row "+x,"success");case 4:d(!1),e.n=6;break;case 5:e.p=5,t=e.v,console.error("Save error:",t),l("âŒ Save failed: "+t.message,"error");case 6:return e.a(2)}},e,null,[[0,5]])}))),T&&T.addEventListener("click",u(c().m(function e(){var t;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,De();case 1:l("âœ… Loaded row "+x,"success"),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Load error:",t),l("âŒ Failed to load row","error");case 3:return e.a(2)}},e,null,[[0,2]])}))),A&&A.addEventListener("click",function(){Oe()});var N=e("#deleteTaskBtn");N&&N.addEventListener("click",u(c().m(function e(){var t;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==x&&"new"!==x){e.n=1;break}return l("No task to delete - this is a new task","error"),e.a(2);case 1:return e.n=2,M("Are you sure you want to delete this Task?");case 2:if(e.v){e.n=3;break}return e.a(2);case 3:return e.p=3,e.n=4,Re();case 4:l("âœ… Task deleted successfully","success"),Oe(),e.n=6;break;case 5:e.p=5,t=e.v,console.error("Delete error:",t),l("âŒ Failed to delete task: "+t.message,"error");case 6:return e.a(2)}},e,null,[[3,5]])}))),D&&"1"!==D.dataset.kycListenerAttached&&(D.dataset.kycListenerAttached="1",D.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),"1"!==D.dataset.kycOpening&&(D.dataset.kycOpening="1",window.open("http://192.168.1.141:8080/","_blank"),setTimeout(function(){D.dataset.kycOpening="0"},1e3))}));var O=e("#tasksView"),R=e("#statsView"),j=e("#tasksHeader"),I=e("#statsHeader"),q=e("#openStatsBtn"),F=e("#returnToTasksBtn"),H=e("#refreshStatsBtn");function U(){return G.apply(this,arguments)}function G(){return G=u(c().m(function r(){var o;return c().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,Excel.run(function(){var r=u(c().m(function r(o){var s,i,u,l,d,v,m,p,g,h,y,k,w,b,S,E,L,C,A,T,D,x,M,N,O,R,j,I,q,F,H;return c().w(function(r){for(;;)switch(r.n){case 0:return(s=o.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),r.n=1,o.sync();case 1:if(!s.isNullObject){r.n=2;break}return console.error("Sheet not found for statistics"),r.a(2);case 2:return(i=s.getRange("A1:K5000")).load("values"),r.n=3,o.sync();case 3:if(!((u=i.values||[]).length<2)){r.n=4;break}return r.a(2);case 4:l=0,d=0,v=0,m={},p={},g={},h=0,y=0,k=[],w=[],b=[],(S=new Date).setHours(0,0,0,0),(E=new Date(S)).setDate(E.getDate()+7),(L=new Date(S)).setDate(L.getDate()-30),C=c().m(function e(){var t,n,a,r,o,s,i,f,C,T,D,x,M;return c().w(function(e){for(;;)switch(e.n){case 0:if(t=u[A],n=t[0]?String(t[0]).trim():""){e.n=1;break}return e.a(2,1);case 1:t[1]&&String(t[1]).trim(),a=t[3]?String(t[3]).trim():"(none)",r=t[4],o=t[5],s=t[6],i=t[7]?String(t[7]).trim():"",f=null,C=_(r),T=_(o),D=_(s),(x=[C,T,D].filter(function(e){return null!==e})).length>0&&(f=x.reduce(function(e,t){return t<e?t:e})),f&&(M="".concat(f.getFullYear(),"-").concat(String(f.getMonth()+1).padStart(2,"0")),p[M]=(p[M]||0)+1),m[a]||(m[a]={total:0,active:0,completed:0}),m[a].total++,i&&i.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes(": to do")?(l++,m[a].active++):t.includes(": in progress")?(d++,m[a].active++):t.includes(": done")&&(v++,m[a].completed++),t.includes("kyc")&&t.includes(": done")){var r=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(r){var o=_(r[1]);if(o){var c="".concat(o.getFullYear(),"-").concat(String(o.getMonth()+1).padStart(2,"0"));g[c]=(g[c]||0)+1}}}var s=e.match(/^(.*?)\s*:\s*(to do|in progress|done)/i),i=e.match(/assigned to\s+([^|]+)/i),u=s?s[1].trim():"Unknown",f=i?i[1].trim():"",p=e.match(/deadline:\s*(\d{4}-\d{2}-\d{2}|\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(p&&!t.includes(": done")){var C=_(p[1]);if(C){var A=Math.ceil((C-S)/864e5);C<S?k.push({company:n,task:u,assignee:f,detail:"".concat(Math.abs(A),"d overdue")}):C<=E&&w.push({company:n,task:u,assignee:f,detail:0===A?"Today":"".concat(A,"d left")})}}if(!t.includes(": done")){var T=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),D=e.match(/updated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),x=null;if(D?x=_(D[1]):T&&(x=_(T[1])),x&&x<L){var M=Math.ceil((S-x)/864e5);b.push({company:n,task:u,assignee:f,detail:"".concat(M,"d ago")})}}if(t.includes(": done")){var N=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),O=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(N&&O){var R=_(N[1]),j=_(O[1]);if(R&&j){var I=Math.ceil((j-R)/864e5);I>=0&&I<365&&(h+=I,y++)}}}});case 2:return e.a(2)}},e)}),A=1;case 5:if(!(A<u.length)){r.n=8;break}return r.d(t(C()),6);case 6:if(!r.v){r.n=7;break}return r.a(3,7);case 7:A++,r.n=5;break;case 8:T=l+d,e("#statActiveTasks").textContent=T,e("#statAvgDuration").textContent=y>0?Math.round(h/y):"-",(D=l+d+v)>0&&(e("#barToDo").style.width=l/D*100+"%",e("#barInProgress").style.width=d/D*100+"%",e("#barDone").style.width=v/D*100+"%"),e("#countToDo").textContent=l,e("#countInProgress").textContent=d,e("#countDone").textContent=v,x=function(t,n,a,r){var o=e("#".concat(n)),c=e("#".concat(a)),s=e("#".concat(r));if(s&&(s.textContent=t.length),o&&c){if(0===t.length)return o.classList.remove("has-items"),void(c.innerHTML="");o.classList.add("has-items"),c.innerHTML=t.slice(0,10).map(function(e){var t=e.assignee?' <span class="to-assignee">to '.concat(f(e.assignee),"</span>"):"";return'<div class="attention-item">\n              <span class="task-info" title="'.concat(f(e.company),": ").concat(f(e.task),'">').concat(f(e.company),": ").concat(f(e.task)).concat(t,'</span>\n              <span class="task-detail">').concat(f(e.detail),"</span>\n            </div>")}).join("")}},k.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),w.sort(function(e,t){return parseInt(e.detail)-parseInt(t.detail)}),b.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),x(k,"overdueGroup","overdueList","statOverdue"),x(w,"upcomingGroup","upcomingList","statUpcoming"),x(b,"staleGroup","staleList","statStale"),(M=e("#monthlyChart"))&&(N=Object.keys(p).sort().reverse().slice(0,6).reverse(),O=Math.max.apply(Math,a(N.map(function(e){return p[e]||0})).concat([1])),R=Math.max.apply(Math,a(N.map(function(e){return g[e]||0})).concat([1])),j=Math.max(O,R),I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],M.innerHTML=N.map(function(e){var t=n(e.split("-"),2),a=(t[0],t[1]),r=I[parseInt(a)-1],o=p[e]||0,c=g[e]||0,s=j>0?c/j*80:0;return'<div class="month-bar-group">\n              <div class="month-bars">\n                <div class="month-bar tasks" style="height:'.concat(j>0?o/j*80:0,'px">\n                  ').concat(o>0?'<span class="month-bar-value">'.concat(o,"</span>"):"",'\n                </div>\n                <div class="month-bar kyc" style="height:').concat(s,'px">\n                  ').concat(c>0?'<span class="month-bar-value">'.concat(c,"</span>"):"",'\n                </div>\n              </div>\n              <div class="month-bar-label">').concat(r,"</div>\n            </div>")}).join("")),(q=e("#brokerChart"))&&(F=Object.entries(m).filter(function(e){var t=n(e,1)[0];return t&&"(none)"!==t&&""!==t.trim()}).sort(function(e,t){return t[1].active+t[1].completed-(e[1].active+e[1].completed)}),H=Math.max.apply(Math,a(F.map(function(e){var t=n(e,2)[1];return t.active+t.completed})).concat([1])),q.innerHTML=F.map(function(e){var t=n(e,2),a=t[0],r=t[1],o=H>0?r.active/H*100:0,c=H>0?r.completed/H*100:0;return'<div class="broker-row">\n              <span class="broker-name" title="'.concat(f(a),'">').concat(f(a),'</span>\n              <div class="broker-bar-track">\n                <div class="broker-bar-fill active" style="width:').concat(o,'%">').concat(r.active>0?'<span class="bar-num">'.concat(r.active,"</span>"):"",'</div>\n                <div class="broker-bar-fill completed" style="width:').concat(c,'%">').concat(r.completed>0?'<span class="bar-num">'.concat(r.completed,"</span>"):"","</div>\n              </div>\n            </div>")}).join(""));case 9:return r.a(2)}},r)}));return function(e){return r.apply(this,arguments)}}());case 1:r.n=3;break;case 2:r.p=2,o=r.v,console.error("Error loading statistics:",o);case 3:return r.a(2)}},r,null,[[0,2]])})),G.apply(this,arguments)}function _(e){if(!e)return null;if("number"==typeof e&&e>1&&e<1e5){var t=Date.UTC(1899,11,30),n=new Date(t+24*e*60*60*1e3),a=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate());if(!isNaN(a.getTime())&&a.getFullYear()>1970)return a}var r=String(e).trim(),o=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(o){var c=parseInt(o[1],10),s=parseInt(o[2],10)-1,i=parseInt(o[3],10);return new Date(c,s,i)}var u=r.match(/(\d{1,2})[-\s]([A-Za-z]{3})[-\s](\d{2,4})/);if(u){var l=parseInt(u[1]),d={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[u[2].toLowerCase()],f=parseInt(u[3]);if(f<100&&(f+=2e3),void 0!==d)return new Date(f,d,l)}var v=new Date(r);return!isNaN(v.getTime())&&v.getFullYear()>1970?v:null}q&&q.addEventListener("click",function(){O&&(O.style.display="none"),j&&(j.style.display="none"),R&&(R.style.display=""),I&&(I.style.display="flex"),U()}),F&&F.addEventListener("click",function(){O&&(O.style.display=""),j&&(j.style.display="flex"),R&&(R.style.display="none"),I&&(I.style.display="none")}),H&&H.addEventListener("click",function(){U()});var B=e("#searchInput"),K=e("#searchInputWrap"),J=e("#searchBtn"),P=e("#searchResults"),Y=e("#searchHint"),z=r(".search-tab"),Z="active",$=e("#loadRowHint");function V(){Y&&B&&K&&("active"===Z?(K.style.display="none",$&&($.style.display="none"),Y.textContent="ðŸ’¡ Showing tasks with status: To Do or In Progress"):"company"===Z&&(K.style.display="flex",$&&($.style.display="flex"),B.placeholder="Type company name...",B.type="text",Y.textContent=""))}z.forEach(function(e){e.addEventListener("click",u(c().m(function t(){return c().w(function(t){for(;;)switch(t.n){case 0:if(z.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),Z=e.getAttribute("data-search"),B&&(B.value=""),V(),"active"!==Z){t.n=2;break}return t.n=1,re();case 1:t.n=3;break;case 2:P&&(P.classList.remove("visible"),P.innerHTML="");case 3:return t.a(2)}},t)})))}),J&&J.addEventListener("click",u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,re();case 1:return e.a(2)}},e)}))),B&&B.addEventListener("keypress",function(){var e=u(c().m(function e(t){return c().w(function(e){for(;;)switch(e.n){case 0:if("Enter"!==t.key){e.n=1;break}return ae(),e.n=1,re();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());var W=e("#autocompleteDropdown"),Q=[],X=null;function ee(){return te.apply(this,arguments)}function te(){return te=u(c().m(function e(){var t;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(Q.length>0)){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=u(c().m(function e(t){var n,a,r,o,s,i;return c().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return e.a(2);case 2:return(a=n.getRange("A2:B5000")).load("values"),e.n=3,t.sync();case 3:for(r=a.values||[],Q=[],o=0;o<r.length;o++)s=r[o][0]?String(r[o][0]).trim():"",i=r[o][1]?String(r[o][1]).trim():"",s&&Q.push({name:s,category:i,rowNum:o+2});console.log("Loaded",Q.length,"company rows for autocomplete");case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("Failed to load company list:",t);case 4:return e.a(2)}},e,null,[[1,3]])})),te.apply(this,arguments)}function ne(e){if(W&&e&&"company"===Z){var t=e.toLowerCase(),n=Q.filter(function(e){return e.name.toLowerCase().includes(t)}),r=n.filter(function(e){return e.name.toLowerCase().startsWith(t)}),o=n.filter(function(e){return!e.name.toLowerCase().startsWith(t)}),s=[].concat(a(r),a(o)).slice(0,15);0!==s.length?(W.innerHTML=s.map(function(e){var t=e.category?" Â· ".concat(f(e.category)):"";return'<div class="autocomplete-item" data-row="'.concat(e.rowNum,'" data-name="').concat(f(e.name),'">\n        <span class="company-name">').concat(f(e.name),'</span>\n        <span class="row-hint">Row ').concat(e.rowNum).concat(t,"</span>\n      </div>")}).join(""),W.classList.add("visible"),W.querySelectorAll(".autocomplete-item").forEach(function(e){e.addEventListener("click",u(c().m(function t(){var n,a;return c().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),a=e.getAttribute("data-name"),B&&(B.value=a),ae(),t.n=1,ce(n);case 1:return t.a(2)}},t)})))})):ae()}else ae()}function ae(){W&&(W.classList.remove("visible"),W.innerHTML="")}function re(){return oe.apply(this,arguments)}function oe(){return oe=u(c().m(function e(){var n;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(P){e.n=1;break}return e.a(2);case 1:return P.innerHTML='<div class="no-results">Searching...</div>',P.classList.add("visible"),console.log("Search started, mode:",Z),e.p=2,e.n=3,Excel.run(function(){var e=u(c().m(function e(n){var a,r,o,s,i,l,d,v,m,p,g;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(console.log("Sheet found:",!a.isNullObject),!a.isNullObject){e.n=2;break}return P.innerHTML='<div class="no-results">Sheet not found</div>',e.a(2);case 2:return(r=a.getRange("A1:K".concat(5e3))).load("values"),e.n=3,n.sync();case 3:o=r.values||[],console.log("Raw rows loaded (including header and blanks):",o.length),s=Array.isArray(o)?o:[],i=[],l=0,d=c().m(function e(){var t,n,a,r,o,u,d,f,m,p,g,h,y,k,w,b,S,E;return c().w(function(e){for(;;)switch(e.n){case 0:if(y=function(e){if(!e||0===e.length)return"";var t=null;if(e.forEach(function(e){if(e){var n=new Date(e);isNaN(n.getTime())||(!t||n>t)&&(t=n)}}),!t)return"";var n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r)},!(t=s[v]||[]).every(function(e){return null===e||""===e})){e.n=1;break}return e.a(2,1);case 1:l++,n=t[0]?String(t[0]).trim():"",a=t[1]?String(t[1]).trim():"",r=t[7]?String(t[7]).trim():"",o=!1,u="unknown",d=!1,f=!1,m=!1,p=[],g=[],h=[],r&&(r.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=Ae(e);if(t){var n=(t.status||"").toLowerCase();"to do"===n?(d=!0,t.initiated&&p.push(t.initiated)):"in progress"===n?(f=!0,t.updated&&g.push(t.updated)):"done"===n&&(m=!0,t.completed&&h.push(t.completed))}}),o=d||f,f?u="progress":d?u="todo":m&&(u="done")),k="",w="","progress"===u?(w=y(g),k=w?"Updated":""):"todo"===u?(w=y(p),k=w?"Initiated":""):"done"===u&&(w=y(h),k=w?"Completed":""),b=w?le(w):"",S=v+1,"company"===Z?(E=(B?B.value:"").toLowerCase().trim(),console.log("Checking row",S,"- Company:",n,"- Query:",E),E&&n.toLowerCase().includes(E)&&(console.log("Match found:",n),i.push({rowNum:S,companyName:n,taskCategory:a,dominantStatus:u,hasActiveTasks:o,statusDateLabel:k,statusDateDisplay:b}))):"active"===Z&&(console.log("Checking row",S,"- Company:",n,"- Active:",o),o&&i.push({rowNum:S,companyName:n,taskCategory:a,dominantStatus:u,hasActiveTasks:o,statusDateLabel:k,statusDateDisplay:b}));case 2:return e.a(2)}},e)}),v=1;case 4:if(!(v<s.length)){e.n=7;break}return e.d(t(d()),5);case 5:if(!e.v){e.n=6;break}return e.a(3,6);case 6:v++,e.n=4;break;case 7:m=l,p="company"===Z?"Company":"Active tasks",g=(B?B.value:"").trim(),console.log("Search complete, mode:",p,"rows scanned:",m,"matches:",i.length,"query:",g),0===i.length?P.innerHTML='<div class="no-results">No results found</div>':(P.innerHTML=i.map(function(e){var t="progress"===e.dominantStatus?'<span class="status-badge progress">In Progress</span>':"todo"===e.dominantStatus?'<span class="status-badge todo">To Do</span>':"done"===e.dominantStatus?'<span class="status-badge done">Done</span>':"",n=e.statusDateLabel&&e.statusDateDisplay?" Â· ".concat(e.statusDateLabel," ").concat(f(e.statusDateDisplay)):"";return'<div class="search-result-item" data-row="'.concat(e.rowNum,'">\n              <div class="company">').concat(f(e.companyName||"(No name)")).concat(t,'</div>\n              <div class="meta">Row ').concat(e.rowNum," Â· ").concat(f(e.taskCategory||"No category")).concat(n,"</div>\n            </div>")}).join(""),P.querySelectorAll(".search-result-item").forEach(function(e){e.addEventListener("click",u(c().m(function t(){var n;return c().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),t.n=1,ce(n);case 1:P.classList.remove("visible");case 2:return t.a(2)}},t)})))}));case 8:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,n=e.v,console.error("Search error:",n),P.innerHTML='<div class="no-results">Search error</div>';case 5:return e.a(2)}},e,null,[[2,4]])})),oe.apply(this,arguments)}function ce(e){return se.apply(this,arguments)}function se(){return se=u(c().m(function e(t){return c().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=u(c().m(function e(n){var a;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!a.isNullObject){e.n=2;break}return e.a(2);case 2:return a.getRange("A".concat(t)).select(),e.n=3,n.sync();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.n=2,De();case 2:return e.a(2)}},e)})),se.apply(this,arguments)}function ie(e){return ue.apply(this,arguments)}function ue(){return ue=u(c().m(function e(t){return c().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2,null);case 1:return e.a(2,Excel.run(function(){var e=u(c().m(function e(n){var a,r,o,s,i,u,l,d;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!a.isNullObject){e.n=2;break}return e.a(2,null);case 2:return(r=a.getUsedRange()).load("values"),e.n=3,n.sync();case 3:for(o=r.values||[],s=null,i=1;i<o.length;i++)u=o[i],l=u[0]?String(u[0]).trim().toLowerCase():"",d=u[7]?String(u[7]).trim():"",l===t.toLowerCase()&&d&&d.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes("kyc")&&t.includes(": done")){var n=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);n&&(s=n[1])}});return e.a(2,s)}},e)}));return function(t){return e.apply(this,arguments)}}()))}},e)})),ue.apply(this,arguments)}function le(e){if(!e)return"";var t=String(e).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){var n=parseInt(t[1],10),a=parseInt(t[2],10)-1,r=parseInt(t[3],10);return"".concat(r,"-").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a],"-").concat(n)}var o=new Date(e);if(isNaN(o.getTime()))return"";var c=o.getDate(),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o.getMonth()],i=o.getFullYear();return"".concat(c,"-").concat(s,"-").concat(i)}B&&(B.addEventListener("input",function(e){if("company"===Z){clearTimeout(X);var t=e.target.value.trim();t.length<1?ae():X=setTimeout(function(){ne(t)},150)}}),B.addEventListener("focus",u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:if("company"!==Z){e.n=2;break}return e.n=1,ee();case 1:B.value.trim().length>=1&&ne(B.value.trim());case 2:return e.a(2)}},e)}))),B.addEventListener("blur",function(){setTimeout(ae,200)})),V();var de=le;function fe(){return r("#taskCategories .category-toggle:checked").map(function(e){return e.value})}function ve(){var t=e('#taskCategories .category-toggle[value="Other Task"]');return t&&t.checked}function me(t){return"__other__"===t?e("#otherTaskCard"):E?E.querySelector('.task-card[data-task="'.concat(t,'"]')):null}function pe(e){if(!e)return[];var t=e.querySelector('[data-role="status-chips"]');return t?Array.from(t.querySelectorAll(".chip")):[]}function ge(e,t){pe(e).forEach(function(e){e.classList.toggle("active",e.getAttribute("data-value")===t)})}function he(e){var t=pe(e).find(function(e){return e.classList.contains("active")});return t?t.getAttribute("data-value"):"To Do"}function ye(){if(S&&E){var t=ve(),n=e("#otherTaskCard"),a=fe().some(function(e){return"Other Task"!==e});S.style.display=a?"":"none";var o=new Set(we());r("#taskCards .task-card").forEach(function(e){var t=e.getAttribute("data-task");e.style.display=o.has(t)?"":"none"}),n&&(n.style.display=t?"":"none")}}function ke(){if(w){var e=fe().filter(function(e){return"Other Task"!==e});0===e.length?w.placeholder="General note about this task":1===e.length?w.placeholder="General note about this "+e[0]:w.placeholder="General note about these tasks"}}function we(){return r("#tasksChecklist .task-toggle:checked").map(function(e){return e.value})}function be(t){var n=e(t);if(n){var a=Array.from(n.children);if(0!==a.length){var r=[],o=[];a.forEach(function(e){var t=e.querySelector("input[type=checkbox]")||e.querySelector('input[type="checkbox"]');t&&t.checked?r.push(e):o.push(e)}),[].concat(r,o).forEach(function(e){return n.appendChild(e)})}}}function Se(){return Ee.apply(this,arguments)}function Ee(){return Ee=u(c().m(function t(){var n;return c().w(function(t){for(;;)switch(t.n){case 0:if(!o){t.n=1;break}return t.a(2);case 1:if(o=!0,n=e("#assignees")){t.n=2;break}return t.a(2);case 2:if("1"!==n.dataset.initialized){t.n=3;break}return t.a(2);case 3:return n.dataset.initialized="1",n.innerHTML="",t.n=4,Excel.run(function(){var e=u(c().m(function e(t){var a,r,o,s,i,u;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=t.workbook.worksheets.getItemOrNullObject("Team members")).load("name"),e.n=1,t.sync();case 1:if(!a.isNullObject){e.n=2;break}return console.error("Team members sheet not found"),e.a(2);case 2:return(r=a.getUsedRange()).load("values"),e.n=3,t.sync();case 3:o=r.values||[],s=o.slice(1).map(function(e){return e[0]}).filter(function(e){return e&&String(e).trim().length>0}).map(function(e){return String(e).trim()}),i=Array.from(new Set(s)),console.log("Team members loaded from column A:",i),i.forEach(function(e){var t=document.createElement("div");t.innerHTML='<label><input type="checkbox" value="'.concat(e,'"> ').concat(e,"</label>"),n.appendChild(t)}),p&&(p.innerHTML="",(u=document.createElement("option")).value="",u.textContent="(none)",p.appendChild(u),i.forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,p.appendChild(t)}));case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return t.a(2)}},t)})),Ee.apply(this,arguments)}function Le(){return Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).map(function(e){return e.value})}function Ce(){var e=Le();r(".task-assignee-select").forEach(function(t){var n=t.value;t.innerHTML="";var a=document.createElement("option");a.value="",a.textContent="(Select assignee)",t.appendChild(a),e.forEach(function(e){var n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),1===e.length?t.value=e[0]:e.includes(n)&&(t.value=n)})}function Ae(e){if(!e)return null;var t=/^(.*?)\s*:\s*(to do|in progress|done)\s*\|\|\s*assigned to\s+([^|]+)/i.exec(e);if(!t)return null;var n={name:t[1].trim(),status:t[2],assignee:t[3].trim(),comment:"",giveUpId:"",initiated:"",updated:"",completed:"",deadline:""},a=/\|\|\s*comment:\s*([^|]+)/i.exec(e);a&&(n.comment=a[1].trim());var r=/\|\|\s*give-up id:\s*([^|]+)/i.exec(e);r&&(n.giveUpId=r[1].trim());var o=/\|\|\s*task initiated:\s*([^|]+)/i.exec(e);o&&(n.initiated=o[1].trim());var c=/\|\|\s*status updated:\s*([^|]+)/i.exec(e);c&&(n.updated=c[1].trim());var s=/\|\|\s*completed:\s*([^|]+)/i.exec(e);s&&(n.completed=s[1].trim());var i=/\|\|\s*deadline:\s*([^|]+)/i.exec(e);return i&&(n.deadline=i[1].trim()),n}function Te(e){var t=[],n=e.status||"To Do";return t.push("".concat(e.name,": ").concat(n)),t.push("Assigned to ".concat(e.assignees)),e.comment&&t.push("Comment: ".concat(e.comment)),e.giveUpId&&t.push("Give-up ID: ".concat(e.giveUpId)),e.initiated&&t.push("Task initiated: ".concat(e.initiated)),e.updated&&t.push("Status updated: ".concat(e.updated)),e.completed&&t.push("Completed: ".concat(e.completed)),e.deadline&&t.push("Deadline: ".concat(e.deadline)),t.join(" || ")}function De(){return xe.apply(this,arguments)}function xe(){return xe=u(c().m(function t(){return c().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Se();case 1:return t.n=2,Excel.run(function(){var t=u(c().m(function t(n){var a,o,s,i,u,l,d,f,S,E,C,A,T,D,M,N,O,R,j,I,q,F,H,U,G,_,B,K,J,P,Y,z,Z,$,V,W,Q,X;return c().w(function(t){for(;;)switch(t.n){case 0:return j=function(e){if(null==e||""===e)return"";if("number"==typeof e){var t=Date.UTC(1899,11,30),n=new Date(t+864e5*e),a=n.getUTCFullYear(),r=String(n.getUTCMonth()+1).padStart(2,"0"),o=String(n.getUTCDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(o)}if(e instanceof Date){var c=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return"".concat(c,"-").concat(s,"-").concat(i)}var u=String(e).trim();if(u.match(/^(\d{4})-(\d{2})-(\d{2})$/))return u;var l=u.match(/^(\d{1,2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{4})$/i);if(l){var d=parseInt(l[1],10),f={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[l[2].toLowerCase()],v=parseInt(l[3],10),m=String(d).padStart(2,"0"),p=String(f+1).padStart(2,"0");return"".concat(v,"-").concat(p,"-").concat(m)}var g=new Date(e);if(!isNaN(g.getTime())){var h=g.getFullYear(),y=String(g.getMonth()+1).padStart(2,"0"),k=String(g.getDate()).padStart(2,"0");return"".concat(h,"-").concat(y,"-").concat(k)}return u.length>=10?u.slice(0,10):""},(a=n.workbook.getSelectedRange()).load("rowIndex"),t.n=1,n.sync();case 1:return o=a.rowIndex+1,(s=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),t.n=2,n.sync();case 2:if(!s.isNullObject){t.n=3;break}return t.a(2);case 3:return i=s.getRange("A".concat(o)),u=s.getRange("B".concat(o)),l=s.getRange("C".concat(o)),d=s.getRange("D".concat(o)),f=s.getRange("E".concat(o,":G").concat(o)),S=s.getRange("H".concat(o)),E=s.getRange("J".concat(o)),C=s.getRange("K".concat(o)),i.load("values"),u.load("values"),l.load("values"),d.load("values"),f.load("values"),S.load("values"),E.load("values"),C.load("values"),t.n=4,n.sync();case 4:for(A=i.values&&i.values[0]&&i.values[0][0]?String(i.values[0][0]):"",m&&(m.value=A),T=u.values&&u.values[0]&&u.values[0][0]?String(u.values[0][0]):"",D=T.split(",").map(function(e){return e.trim()}).filter(Boolean),r("#taskCategories .category-toggle").forEach(function(e){var t=D.some(function(t){return t.toLowerCase()===e.value.toLowerCase()});e.checked=t}),M=d.values&&d.values[0]&&d.values[0][0]?String(d.values[0][0]):"",p&&(p.value=M),N=l.values&&l.values[0]&&l.values[0][0]?String(l.values[0][0]):"",O=N.split(/[,;]+/).map(function(e){return e.trim().toLowerCase()}).filter(Boolean),console.log("Assignees from column C:",O),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=O.includes(e.value.toLowerCase())}),R=f.values&&f.values[0]?f.values[0]:[null,null,null],console.log("Date values from Excel:",R),g&&(g.value=j(R[0])),h&&(h.value=j(R[1])),y&&(y.value=j(R[2])),console.log("Parsed dates:",null==g?void 0:g.value,null==h?void 0:h.value,null==y?void 0:y.value),I=E.values&&E.values[0]&&E.values[0][0]?String(E.values[0][0]):"",k&&(k.value=I),q=C.values&&C.values[0]&&C.values[0][0]?String(C.values[0][0]):"",w&&(w.value=q),F=S.values&&S.values[0]&&S.values[0][0]?String(S.values[0][0]):"",H=F.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),U=[],G=[],_=0;_<H.length;_++)(B=Ae(H[_]))?U.push(B):G.push(H[_]);K={"to do":1,"in progress":2,done:3},U.sort(function(e,t){return(K[(e.status||"").toLowerCase()]||4)-(K[(t.status||"").toLowerCase()]||4)}),console.log("Parsed tasks:",U),Ce(),r("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),r("#taskCards .task-card, #otherTaskCard").forEach(function(e){pe(e).forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]'),n=e.querySelector('[data-role="deadline"]'),a=e.querySelector('[data-role="giveUpId"]'),r=e.querySelector('[data-role="task-assignee"]');t&&(t.value=""),n&&(n.value=""),a&&(a.value=""),r&&(r.value="")}),ve()?(J=me("__other__"))&&(P=U[0]||null,L&&(L.value=P&&P.name?P.name:""),P&&(Y=(P.status||"").toLowerCase(),ge(J,"in progress"===Y?"In Progress":"done"===Y?"Done":"To Do"),z=J.querySelector('[data-role="comment"]'),Z=J.querySelector('[data-role="deadline"]'),$=J.querySelector('[data-role="task-assignee"]'),z&&(z.value=P.comment||""),Z&&(Z.value=(P.deadline||"").slice(0,10)),$&&P.assignee&&($.value=P.assignee.trim()))):r("#tasksChecklist .task-toggle").forEach(function(e){var t=e.value,n=U.find(function(e){var n=(e.name||"").toLowerCase(),a=t.toLowerCase();return n===a||"kyc (produced by lcmc)"===a&&"kyc (internal)"===n});e.checked=!!n;var a=me(t);if(a&&n){var r=(n.status||"").toLowerCase();ge(a,"in progress"===r?"In Progress":"done"===r?"Done":"To Do");var o=a.querySelector('[data-role="comment"]'),c=a.querySelector('[data-role="deadline"]'),s=a.querySelector('[data-role="giveUpId"]'),i=a.querySelector('[data-role="task-assignee"]');o&&(o.value=n.comment||""),c&&(c.value=(n.deadline||"").slice(0,10)),s&&(s.value=n.giveUpId||""),i&&n.assignee&&(i.value=n.assignee.trim())}}),b&&(V=null,U.length>0&&(V=U[0]),V?(W=[],V.initiated&&W.push("Task initiated: ".concat(V.initiated)),V.updated&&W.push("Status updated: ".concat(V.updated)),V.completed&&W.push("Completed: ".concat(V.completed)),b.textContent=W.join(" | ")):b.textContent=""),(Q=e("#lastKycDate"))&&A?(X=null,U.forEach(function(e){e.name&&e.name.toLowerCase().includes("kyc")&&e.status&&"done"===e.status.toLowerCase()&&e.completed&&(X=e.completed)}),X?Q.textContent=X:ie(A).then(function(e){Q.textContent=e||"â€”"})):Q&&(Q.textContent="â€”"),ye(),Fe(),ke(),be("#assignees"),be("#tasksChecklist"),be("#taskCategories"),x=o,v(),Ke(),Ue&&Ue.classList.remove("visible");case 5:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:return t.a(2)}},t)})),xe.apply(this,arguments)}function Me(){return Ne.apply(this,arguments)}function Ne(){return Ne=u(c().m(function e(){var t,n,a;return c().w(function(e){for(;;)switch(e.n){case 0:return t=fe().join(", "),n=Le().join(", "),a=ve(),console.log("Saving - Categories:",t,"Assignees:",n,"IsOther:",a),e.n=1,Excel.run(function(){var e=u(c().m(function e(r){var o,s,i,u,l,d,f,v,b,S,E,C,A,T,D,x,M,N,O,R,j,I,q,F,H,U,G,_,B,K,J,P,Y,z,Z,$,V,W,Q;return c().w(function(e){for(;;)switch(e.n){case 0:return(o=r.workbook.getSelectedRange()).load("rowIndex"),e.n=1,r.sync();case 1:return s=o.rowIndex+1,(i=r.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=2,r.sync();case 2:if(!i.isNullObject){e.n=3;break}return e.a(2);case 3:return(u=i.getRange("E".concat(s,":G").concat(s))).load("values"),l=i.getRange("A".concat(s)),d=i.getRange("B".concat(s)),f=i.getRange("C".concat(s)),v=i.getRange("D".concat(s)),b=i.getRange("H".concat(s)),S=i.getRange("J".concat(s)),E=i.getRange("K".concat(s)),b.load("values"),e.n=4,r.sync();case 4:return C=u.values&&u.values[0]?u.values[0]:[null,null,null],g&&(C[0]=de(g.value)),h&&(C[1]=de(h.value)),y&&(C[2]=de(y.value)),u.values=[C],d.values=[[t]],p&&(v.values=[[p.value||""]]),m&&(l.values=[[m.value||""]]),f.values=[[n]],console.log("Saving assignees to column C:",n),k&&(S.values=[[k.value||""]]),w&&(E.values=[[w.value||""]]),A=b.values&&b.values[0]&&b.values[0][0]?String(b.values[0][0]):"",T=A.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),D=T.filter(function(e){return!Ae(e)}),x=[],M={},T.forEach(function(e){var t=Ae(e);t&&(M[t.name.toLowerCase()]=t)}),N=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))},O=function(e,t,n){var a=N(),r=n?(n.status||"").toLowerCase():"",o=(t||"").toLowerCase(),c=n&&n.initiated?n.initiated:"",s=n&&n.updated?n.updated:"",i=n&&n.completed?n.completed:"",u=c||s||i;return"to do"===o?(c=c||a,s="",i=""):"in progress"===o?(u&&r===o||(s=a),c="",i=""):"done"===o&&(u&&i&&r===o||(i=a),c="",s=""),{initiated:c,updated:s,completed:i}},a?(R=me("__other__"),(j=L?L.value.trim():"")&&(I=he(R)||"To Do",q=R?R.querySelector('[data-role="comment"]'):null,F=R?R.querySelector('[data-role="deadline"]'):null,H=R?R.querySelector('[data-role="task-assignee"]'):null,U=H&&H.value?H.value:n,G=M[j.toLowerCase()],_=O(0,I,G),B={name:j,status:I,assignees:U,comment:q?q.value.trim():"",giveUpId:"",initiated:_.initiated,updated:_.updated,completed:_.completed,deadline:F?F.value:""},K=Te(B),x.push({line:K,status:I}))):(J=we(),P=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],J.forEach(function(e){if(P.includes(e)){var t=me(e);if(t){var a=he(t),r=t.querySelector('[data-role="comment"]'),o=t.querySelector('[data-role="deadline"]'),c=t.querySelector('[data-role="giveUpId"]'),s=t.querySelector('[data-role="task-assignee"]'),i=s&&s.value?s.value:n,u=M[e.toLowerCase()];u||"kyc (produced by lcmc)"!==e.toLowerCase()||(u=M["kyc (internal)"]);var l=O(0,a,u),d={name:e,status:a,assignees:i,comment:r?r.value.trim():"",giveUpId:c?c.value.trim():"",initiated:l.initiated,updated:l.updated,completed:l.completed,deadline:o?o.value:""};x.push({line:Te(d),status:a})}}})),Y={"to do":1,"in progress":2,done:3},x.sort(function(e,t){return(Y[(e.status||"").toLowerCase()]||4)-(Y[(t.status||"").toLowerCase()]||4)}),z=x.map(function(e){return e.line}),Z=D.concat(z).filter(Boolean).join("\n"),console.log("Saving to H - newTaskLines:",z,"newValue:",Z),b.values=[[Z]],z.length>0&&($=!1,V=!1,W=!1,z.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?$=!0:t.includes(": to do")?V=!0:t.includes(": done")&&(W=!0)}),Q=$?"#ff9900":V?"#34a853":W?"#cc6666":"#34a853",b.format.font.color=Q),e.n=5,r.sync();case 5:console.log("Save completed successfully for row",s);case 6:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),Ne.apply(this,arguments)}function Oe(){m&&(m.value=""),r("#taskCategories .category-toggle").forEach(function(e){e.checked=!1}),p&&(p.value=""),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=!1}),g&&(g.value=""),h&&(h.value=""),y&&(y.value=""),k&&(k.value=""),w&&(w.value=""),r("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),r("#taskCards .task-card, #otherTaskCard").forEach(function(e){e.querySelectorAll('[data-role="status-chips"] .chip').forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]');t&&(t.value="");var n=e.querySelector('[data-role="deadline"]');n&&(n.value="");var a=e.querySelector('[data-role="giveUpId"]');a&&(a.value="");var r=e.querySelector('[data-role="task-assignee"]');r&&(r.value="")}),L&&(L.value=""),b&&(b.textContent="");var t=e("#lastKycDate");t&&(t.textContent="â€”"),P&&(P.classList.remove("visible"),P.innerHTML=""),Ue&&Ue.classList.remove("visible"),x="new",Ke(),Fe(),ye(),ke(),setTimeout(function(){var e=document.querySelector('#taskCards .task-card:not([style*="display: none"]), #otherTaskCard:not([style*="display: none"])');if(e){var t=e.querySelector('[data-role="comment"]');t&&"function"==typeof t.focus&&t.focus()}},100)}function Re(){return je.apply(this,arguments)}function je(){return je=u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:if(null!==x&&"new"!==x){e.n=1;break}throw new Error("No row to delete");case 1:return e.n=2,Excel.run(function(){var e=u(c().m(function e(t){var n;return c().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("Sheet TASK MANAGER FORM not found");case 2:return n.getRange("".concat(x,":").concat(x)).delete(Excel.DeleteShiftDirection.up),e.n=3,t.sync();case 3:console.log("Deleted row",x);case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e)})),je.apply(this,arguments)}function Ie(){return qe.apply(this,arguments)}function qe(){return qe=u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=u(c().m(function e(t){var n,a,r,o,s,i,u,l,d,f,v,b,S,E,C,A,T,D,M,N,O,R,j,I,q,F,H,U,G,_,B,K,J,P;return c().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return console.error("Sheet TASK MANAGER FORM not found"),e.a(2);case 2:return(a=n.getRange("A2:A1000")).load("values"),e.n=3,t.sync();case 3:r=2,o=a.values||[],s=0;case 4:if(!(s<o.length)){e.n=7;break}if(!o[s][0]||""===String(o[s][0]).trim()){e.n=5;break}r=s+3,e.n=6;break;case 5:return r=s+2,e.a(3,7);case 6:s++,e.n=4;break;case 7:return i=m?m.value.trim():"",u=fe().join(", "),l=ve(),d=p?p.value:"",f=Le().join(", "),n.getRange("A".concat(r)).values=[[i]],n.getRange("B".concat(r)).values=[[u]],n.getRange("C".concat(r)).values=[[f]],n.getRange("D".concat(r)).values=[[d]],v=de(g?g.value:""),b=de(h?h.value:""),S=de(y?y.value:""),n.getRange("E".concat(r,":G").concat(r)).values=[[v,b,S]],n.getRange("J".concat(r)).values=[[k?k.value:""]],n.getRange("K".concat(r)).values=[[w?w.value:""]],E=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))}(),C=[],l?(A=me("__other__"),(T=L?L.value.trim():"")&&(D=he(A)||"To Do",M=A?A.querySelector('[data-role="comment"]'):null,N=A?A.querySelector('[data-role="deadline"]'):null,O=A?A.querySelector('[data-role="task-assignee"]'):null,R=O&&O.value?O.value:f,j="",I="",q="","to do"===(F=D.toLowerCase())?j=E:"in progress"===F?I=E:"done"===F&&(q=E),H={name:T,status:D,assignees:R,comment:M?M.value.trim():"",giveUpId:"",initiated:j,updated:I,completed:q,deadline:N?N.value:""},C.push(Te(H)))):(U=we(),G=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],U.forEach(function(e){if(G.includes(e)){var t=me(e);if(t){var n=he(t)||"To Do",a=t.querySelector('[data-role="comment"]'),r=t.querySelector('[data-role="deadline"]'),o=t.querySelector('[data-role="giveUpId"]'),c=t.querySelector('[data-role="task-assignee"]'),s=c&&c.value?c.value:f,i="",u="",l="",d=n.toLowerCase();"to do"===d?i=E:"in progress"===d?u=E:"done"===d&&(l=E);var v={name:e,status:n,assignees:s,comment:a?a.value.trim():"",giveUpId:o?o.value.trim():"",initiated:i,updated:u,completed:l,deadline:r?r.value:""};C.push(Te(v))}}})),(_=n.getRange("H".concat(r))).values=[[C.join("\n")]],C.length>0&&(B=!1,K=!1,J=!1,C.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?B=!0:t.includes(": to do")?K=!0:t.includes(": done")&&(J=!0)}),P=B?"#ff9900":K?"#34a853":J?"#cc6666":"#34a853",_.format.font.color=P),e.n=8,t.sync();case 8:return n.getRange("A".concat(r)).select(),e.n=9,t.sync();case 9:x=r;case 10:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),qe.apply(this,arguments)}function Fe(){[{input:"#initialRequest",display:"#initialRequestDisplay"},{input:"#introEmail",display:"#introEmailDisplay"},{input:"#remindersStart",display:"#remindersStartDisplay"}].forEach(function(t){var n=t.input,a=t.display,r=e(n),o=e(a);if(r&&o){var c=le(r.value);o.textContent=c?"â†’ ".concat(c):""}})}r("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){ye(),ke()})}),document.querySelectorAll("#assignees").forEach(function(e){e.addEventListener("change",function(e){"checkbox"===e.target.type&&Ce()})});var He=e("#viewEmailSummaryBtn"),Ue=e("#emailSummarySection"),Ge=e("#emailSummaryList"),_e=e("#emailSummaryCount"),Be=e("#closeEmailSummaryBtn");function Ke(){var e=m?m.value.trim():"";He&&(He.disabled=!e)}function Je(){return Pe.apply(this,arguments)}function Pe(){return(Pe=u(c().m(function e(){var t,n,a,r,o;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=m?m.value.trim():""){e.n=1;break}return l("No company name entered","error"),e.a(2);case 1:return Ue&&Ue.classList.add("visible"),Ge&&(Ge.innerHTML='<div class="email-loading">Loading summaries...</div>'),e.p=2,e.n=3,fetch("".concat(i,"/api/task-manager/summaries/").concat(encodeURIComponent(t),"?include_drafts=true"));case 3:if((n=e.v).ok){e.n=4;break}throw new Error("Server returned ".concat(n.status));case 4:return e.n=5,n.json();case 5:if(a=e.v,r=a.summaries||[],_e&&(_e.textContent=r.length),0!==r.length){e.n=6;break}return Ge.innerHTML='<div class="email-no-summaries">No email summaries found for this company.</div>',e.a(2);case 6:Ge.innerHTML=r.map(function(e){return'\n        <div class="email-summary-item '.concat(e.is_draft?"draft":"confirmed",'" data-id="').concat(e.id,'">\n          <div class="email-summary-subject">\n            ').concat(f(e.subject||"No subject"),"\n            ").concat(e.is_draft?'<span class="draft-badge">Draft</span>':"",'\n          </div>\n          <div class="email-summary-meta">\n            From: ').concat(f(e.from||"Unknown")," | ").concat(Ye(e.date),'\n          </div>\n          <div class="email-summary-text">').concat(f(e.summary||"No summary available"),"</div>\n          ").concat(e.is_draft?'\n            <div class="email-summary-actions">\n              <button class="btn-confirm-summary" onclick="window.confirmEmailSummary('.concat(e.id,')">\n                âœ“ Confirm & Link to Task\n              </button>\n            </div>\n          '):"","\n        </div>\n      ")}).join(""),e.n=8;break;case 7:e.p=7,o=e.v,console.error("Error loading email summaries:",o),Ge&&(Ge.innerHTML='<div class="email-no-summaries">Error loading summaries: '.concat(f(o.message),"<br><small>Make sure the Email Summarizer service is running.</small></div>"));case 8:return e.a(2)}},e,null,[[2,7]])}))).apply(this,arguments)}function Ye(e){if(!e)return"Unknown date";try{var t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch(t){return e}}m&&(m.addEventListener("input",Ke),m.addEventListener("change",Ke)),He&&He.addEventListener("click",u(c().m(function e(){return c().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Je();case 1:return e.a(2)}},e)}))),Be&&Be.addEventListener("click",function(){Ue&&Ue.classList.remove("visible")}),window.confirmEmailSummary=function(){var e=u(c().m(function e(t){var n,a;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==x&&"new"!==x){e.n=1;break}return l("Please save the task first","error"),e.a(2);case 1:return e.p=1,e.n=2,fetch("".concat(i,"/api/task-manager/confirm/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_row:x})});case 2:if((n=e.v).ok){e.n=3;break}throw new Error("Server returned ".concat(n.status));case 3:return e.n=4,Excel.run(function(){var e=u(c().m(function e(n){var a,r,o,s;return c().w(function(e){for(;;)switch(e.n){case 0:return(a=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!a.isNullObject){e.n=2;break}throw new Error("Sheet not found");case 2:return(r=a.getRange("L".concat(x))).load("values"),e.n=3,n.sync();case 3:return o=r.values&&r.values[0]&&r.values[0][0]?String(r.values[0][0]):"",s="[Email Summary #".concat(t,"]"),r.values=[[o?"".concat(o," ").concat(s):s]],e.n=4,n.sync();case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return l("Summary confirmed and linked!","success"),e.n=5,Je();case 5:e.n=7;break;case 6:e.p=6,a=e.v,console.error("Error confirming summary:",a),l("Error confirming summary: "+a.message,"error");case 7:return e.a(2)}},e,null,[[1,6]])}));return function(t){return e.apply(this,arguments)}}(),"undefined"!=typeof Office&&"function"==typeof Office.onReady&&Office.onReady(function(t){t.host===Office.HostType.Excel&&(r('#taskCards [data-role="status-chips"] .chip, #otherTaskCard [data-role="status-chips"] .chip').forEach(function(e){e.addEventListener("click",function(){var t=e.closest('[data-role="status-chips"]');t&&Array.from(t.querySelectorAll(".chip")).forEach(function(t){t.classList.toggle("active",t===e)})})}),["#initialRequest","#introEmail","#remindersStart"].forEach(function(t){var n=e(t);n&&n.addEventListener("change",Fe)}),r('[data-role="deadline"]').forEach(function(e){e.addEventListener("change",function(){v()})}),r("input, select, textarea").forEach(function(e){e.addEventListener("change",function(){return d(!0)}),e.addEventListener("input",function(){return d(!0)})}),r(".chip").forEach(function(e){e.addEventListener("click",function(){return d(!0)})}),r("#tasksChecklist .task-toggle").forEach(function(e){e.addEventListener("change",function(){return ye()})}),r("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){return ye()})}),De().then(function(){d(!1),re()}))})}()}(),function(){"use strict";new URL(n(60947),n.b)}()}();
//# sourceMappingURL=taskpane.js.map