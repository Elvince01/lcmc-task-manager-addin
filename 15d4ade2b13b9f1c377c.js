/*! For license information please see 15d4ade2b13b9f1c377c.js.LICENSE.txt */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorValues(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(_typeof(e)+" is not iterable")}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,c,s=[],i=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);i=!0);}catch(e){u=!0,a=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function o(n,r,a,o){var i=r&&r.prototype instanceof s?r:s,u=Object.create(i.prototype);return _regeneratorDefine2(u,"_invoke",function(n,r,a){var o,s,i,u=0,l=a||[],d=!1,f={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,n){return o=t,s=0,i=e,f.n=n,c}};function v(n,r){for(s=n,i=r,t=0;!d&&u&&!a&&t<l.length;t++){var a,o=l[t],v=f.p,m=o[2];n>3?(a=m===r)&&(i=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=v&&((a=n<2&&v<o[1])?(s=0,f.v=r,f.n=o[1]):v<m&&(a=n<3||o[0]>r||r>m)&&(o[4]=n,o[5]=r,f.n=m,s=0))}if(a||n>1)return c;throw d=!0,r}return function(a,l,m){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&v(l,m),s=l,i=m;(t=s<2?e:i)||!d;){o||(s?s<3?(s>1&&(f.n=-1),v(s,i)):f.n=i:f.v=i);try{if(u=2,o){if(s||(a="next"),t=o[a]){if(!(t=t.call(o,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(i=TypeError("The iterator does not provide a '"+a+"' method"),s=1);o=e}else if((t=(d=f.n<0)?i:n.call(r,f))!==c)break}catch(t){o=e,s=1,i=t}finally{u=1}}return{value:t,done:d}}}(n,a,o),!0),u}var c={};function s(){}function i(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(_regeneratorDefine2(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return i.prototype=u,_regeneratorDefine2(d,"constructor",u),_regeneratorDefine2(u,"constructor",i),i.displayName="GeneratorFunction",_regeneratorDefine2(u,a,"GeneratorFunction"),_regeneratorDefine2(d),_regeneratorDefine2(d,a,"Generator"),_regeneratorDefine2(d,r,function(){return this}),_regeneratorDefine2(d,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:o,m:f}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,a,o,c){try{var s=e[o](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function c(e){asyncGeneratorStep(o,r,a,c,s,"next",e)}function s(e){asyncGeneratorStep(o,r,a,c,s,"throw",e)}c(void 0)})}}!function(){var e=function(e){return document.querySelector(e)},t=function(e){return Array.from(document.querySelectorAll(e))},n=!1,r=!1,a="http://localhost:5002";function o(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=e("#toast");r&&(r.textContent=t,r.className="toast "+n+" show",setTimeout(function(){r.classList.remove("show")},3e3))}function c(t){r=t;var n=e("#unsavedIndicator");n&&n.classList.toggle("visible",t)}function s(e){var t=document.createElement("div");return t.textContent=String(e||""),t.innerHTML}function i(){t(".task-card").forEach(function(e){var t=e.querySelector('[data-role="deadline"]');if(t){var n=function(e){if(!e)return"";var t=new Date(e);if(isNaN(t.getTime()))return"";var n=new Date;n.setHours(0,0,0,0),t.setHours(0,0,0,0);var r=Math.ceil((t-n)/864e5);return r<0?"overdue":r<=3?"warning":""}(t.value);e.classList.remove("deadline-warning","deadline-overdue"),"overdue"===n?e.classList.add("deadline-overdue"):"warning"===n&&e.classList.add("deadline-warning")}})}window.addEventListener("beforeunload",function(e){if(r)return e.preventDefault(),e.returnValue="",""});var u=e("#companyName"),l=e("#brokerLead"),d=e("#initialRequest"),f=e("#introEmail"),v=e("#remindersStart"),m=e("#emailFrequency"),p=e("#extraNote"),g=e("#auditText"),y=e("#tasksRow"),h=e("#taskCards"),k=e("#taskName"),w=e("#saveBtn"),b=e("#newTaskBtn"),S=e("#loadSelectedBtn"),_=e("#openKycPortal"),T=null;function A(t){return new Promise(function(n){var r=e("#confirmDialog"),a=e("#confirmMessage"),o=e("#confirmCancel"),c=e("#confirmOk");if(r&&a&&o&&c){a.textContent=t,r.style.display="flex";var s=function(){r.style.display="none",o.removeEventListener("click",i),c.removeEventListener("click",u)},i=function(){s(),n(!1)},u=function(){s(),n(!0)};o.addEventListener("click",i),c.addEventListener("click",u)}else n(!1)})}w&&w.addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,null!==T&&"new"!==T){e.n=2;break}return e.n=1,Me();case 1:o("âœ… New task added successfully!","success"),e.n=4;break;case 2:return e.n=3,Ae();case 3:o("âœ… Changes saved to row "+T,"success");case 4:c(!1),e.n=6;break;case 5:e.p=5,t=e.v,console.error("Save error:",t),o("âŒ Save failed: "+t.message,"error");case 6:return e.a(2)}},e,null,[[0,5]])}))),S&&S.addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,_e();case 1:o("âœ… Loaded row "+T,"success"),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Load error:",t),o("âŒ Failed to load row","error");case 3:return e.a(2)}},e,null,[[0,2]])}))),b&&b.addEventListener("click",function(){Ee()});var L=e("#deleteTaskBtn");L&&L.addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==T&&"new"!==T){e.n=1;break}return o("No task to delete - this is a new task","error"),e.a(2);case 1:return e.n=2,A("Are you sure you want to delete this Task?");case 2:if(e.v){e.n=3;break}return e.a(2);case 3:return e.p=3,e.n=4,Ce();case 4:o("âœ… Task deleted successfully","success"),Ee(),e.n=6;break;case 5:e.p=5,t=e.v,console.error("Delete error:",t),o("âŒ Failed to delete task: "+t.message,"error");case 6:return e.a(2)}},e,null,[[3,5]])}))),_&&"1"!==_.dataset.kycListenerAttached&&(_.dataset.kycListenerAttached="1",_.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),"1"!==_.dataset.kycOpening&&(_.dataset.kycOpening="1",window.open("http://192.168.1.141:8080/","_blank"),setTimeout(function(){_.dataset.kycOpening="0"},1e3))}));var E=e("#tasksView"),C=e("#statsView"),D=e("#tasksHeader"),M=e("#statsHeader"),N=e("#openStatsBtn"),x=e("#returnToTasksBtn"),O=e("#refreshStatsBtn");function R(){return I.apply(this,arguments)}function I(){return I=_asyncToGenerator(_regenerator().m(function t(){var n;return _regenerator().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Excel.run(function(){var t=_asyncToGenerator(_regenerator().m(function t(n){var r,a,o,c,i,u,l,d,f,v,m,p,g,y,h,k,w,b,S,_,T,A,L,E,C,D,M,N,x,O,R;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),t.n=1,n.sync();case 1:if(!r.isNullObject){t.n=2;break}return console.error("Sheet not found for statistics"),t.a(2);case 2:return(a=r.getRange("A1:K5000")).load("values"),t.n=3,n.sync();case 3:if(!((o=a.values||[]).length<2)){t.n=4;break}return t.a(2);case 4:c=0,i=0,u=0,l={},d={},f={},v=0,m=0,p=[],g=[],y=[],(h=new Date).setHours(0,0,0,0),(k=new Date(h)).setDate(k.getDate()+7),(w=new Date(h)).setDate(w.getDate()-30),b=_regenerator().m(function e(){var t,n,r,a,s,b,_,T,A,L,E,C,D;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(t=o[S],n=t[0]?String(t[0]).trim():""){e.n=1;break}return e.a(2,1);case 1:t[1]&&String(t[1]).trim(),r=t[3]?String(t[3]).trim():"(none)",a=t[4],s=t[5],b=t[6],_=t[7]?String(t[7]).trim():"",T=null,A=G(a),L=G(s),E=G(b),(C=[A,L,E].filter(function(e){return null!==e})).length>0&&(T=C.reduce(function(e,t){return t<e?t:e})),T&&(D="".concat(T.getFullYear(),"-").concat(String(T.getMonth()+1).padStart(2,"0")),d[D]=(d[D]||0)+1),l[r]||(l[r]={total:0,active:0,completed:0}),l[r].total++,_&&_.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes(": to do")?(c++,l[r].active++):t.includes(": in progress")?(i++,l[r].active++):t.includes(": done")&&(u++,l[r].completed++),t.includes("kyc")&&t.includes(": done")){var a=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(a){var o=G(a[1]);if(o){var s="".concat(o.getFullYear(),"-").concat(String(o.getMonth()+1).padStart(2,"0"));f[s]=(f[s]||0)+1}}}var d=e.match(/^(.*?)\s*:\s*(to do|in progress|done)/i),b=e.match(/assigned to\s+([^|]+)/i),S=d?d[1].trim():"Unknown",_=b?b[1].trim():"",T=e.match(/deadline:\s*(\d{4}-\d{2}-\d{2}|\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(T&&!t.includes(": done")){var A=G(T[1]);if(A){var L=Math.ceil((A-h)/864e5);A<h?p.push({company:n,task:S,assignee:_,detail:"".concat(Math.abs(L),"d overdue")}):A<=k&&g.push({company:n,task:S,assignee:_,detail:0===L?"Today":"".concat(L,"d left")})}}if(!t.includes(": done")){var E=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),C=e.match(/updated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),D=null;if(C?D=G(C[1]):E&&(D=G(E[1])),D&&D<w){var M=Math.ceil((h-D)/864e5);y.push({company:n,task:S,assignee:_,detail:"".concat(M,"d ago")})}}if(t.includes(": done")){var N=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),x=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(N&&x){var O=G(N[1]),R=G(x[1]);if(O&&R){var I=Math.ceil((R-O)/864e5);I>=0&&I<365&&(v+=I,m++)}}}});case 2:return e.a(2)}},e)}),S=1;case 5:if(!(S<o.length)){t.n=8;break}return t.d(_regeneratorValues(b()),6);case 6:if(!t.v){t.n=7;break}return t.a(3,7);case 7:S++,t.n=5;break;case 8:_=c+i,e("#statActiveTasks").textContent=_,e("#statAvgDuration").textContent=m>0?Math.round(v/m):"-",(T=c+i+u)>0&&(e("#barToDo").style.width=c/T*100+"%",e("#barInProgress").style.width=i/T*100+"%",e("#barDone").style.width=u/T*100+"%"),e("#countToDo").textContent=c,e("#countInProgress").textContent=i,e("#countDone").textContent=u,A=function(t,n,r,a){var o=e("#".concat(n)),c=e("#".concat(r)),i=e("#".concat(a));if(i&&(i.textContent=t.length),o&&c){if(0===t.length)return o.classList.remove("has-items"),void(c.innerHTML="");o.classList.add("has-items"),c.innerHTML=t.slice(0,10).map(function(e){var t=e.assignee?' <span class="to-assignee">to '.concat(s(e.assignee),"</span>"):"";return'<div class="attention-item">\n              <span class="task-info" title="'.concat(s(e.company),": ").concat(s(e.task),'">').concat(s(e.company),": ").concat(s(e.task)).concat(t,'</span>\n              <span class="task-detail">').concat(s(e.detail),"</span>\n            </div>")}).join("")}},p.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),g.sort(function(e,t){return parseInt(e.detail)-parseInt(t.detail)}),y.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),A(p,"overdueGroup","overdueList","statOverdue"),A(g,"upcomingGroup","upcomingList","statUpcoming"),A(y,"staleGroup","staleList","statStale"),(L=e("#monthlyChart"))&&(E=Object.keys(d).sort().reverse().slice(0,6).reverse(),C=Math.max.apply(Math,_toConsumableArray(E.map(function(e){return d[e]||0})).concat([1])),D=Math.max.apply(Math,_toConsumableArray(E.map(function(e){return f[e]||0})).concat([1])),M=Math.max(C,D),N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],L.innerHTML=E.map(function(e){var t=_slicedToArray(e.split("-"),2),n=(t[0],t[1]),r=N[parseInt(n)-1],a=d[e]||0,o=f[e]||0,c=M>0?o/M*80:0;return'<div class="month-bar-group">\n              <div class="month-bars">\n                <div class="month-bar tasks" style="height:'.concat(M>0?a/M*80:0,'px">\n                  ').concat(a>0?'<span class="month-bar-value">'.concat(a,"</span>"):"",'\n                </div>\n                <div class="month-bar kyc" style="height:').concat(c,'px">\n                  ').concat(o>0?'<span class="month-bar-value">'.concat(o,"</span>"):"",'\n                </div>\n              </div>\n              <div class="month-bar-label">').concat(r,"</div>\n            </div>")}).join("")),(x=e("#brokerChart"))&&(O=Object.entries(l).filter(function(e){var t=_slicedToArray(e,1)[0];return t&&"(none)"!==t&&""!==t.trim()}).sort(function(e,t){return t[1].active+t[1].completed-(e[1].active+e[1].completed)}),R=Math.max.apply(Math,_toConsumableArray(O.map(function(e){var t=_slicedToArray(e,2)[1];return t.active+t.completed})).concat([1])),x.innerHTML=O.map(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1],a=R>0?r.active/R*100:0,o=R>0?r.completed/R*100:0;return'<div class="broker-row">\n              <span class="broker-name" title="'.concat(s(n),'">').concat(s(n),'</span>\n              <div class="broker-bar-track">\n                <div class="broker-bar-fill active" style="width:').concat(a,'%">').concat(r.active>0?'<span class="bar-num">'.concat(r.active,"</span>"):"",'</div>\n                <div class="broker-bar-fill completed" style="width:').concat(o,'%">').concat(r.completed>0?'<span class="bar-num">'.concat(r.completed,"</span>"):"","</div>\n              </div>\n            </div>")}).join(""));case 9:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 1:t.n=3;break;case 2:t.p=2,n=t.v,console.error("Error loading statistics:",n);case 3:return t.a(2)}},t,null,[[0,2]])})),I.apply(this,arguments)}function G(e){if(!e)return null;if("number"==typeof e&&e>1&&e<1e5){var t=new Date(1899,11,30),n=new Date(t.getTime()+24*e*60*60*1e3);if(!isNaN(n.getTime())&&n.getFullYear()>1970)return n}var r=String(e),a=new Date(r);if(!isNaN(a.getTime())&&a.getFullYear()>1970)return a;var o=r.match(/(\d{1,2})[-\s]([A-Za-z]{3})[-\s](\d{2,4})/);if(o){var c=parseInt(o[1]),s={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[o[2].toLowerCase()],i=parseInt(o[3]);if(i<100&&(i+=2e3),void 0!==s)return new Date(i,s,c)}return null}N&&N.addEventListener("click",function(){E&&(E.style.display="none"),D&&(D.style.display="none"),C&&(C.style.display=""),M&&(M.style.display="flex"),R()}),x&&x.addEventListener("click",function(){E&&(E.style.display=""),D&&(D.style.display="flex"),C&&(C.style.display="none"),M&&(M.style.display="none")}),O&&O.addEventListener("click",function(){R()});var j=e("#searchInput"),q=e("#searchInputWrap"),H=e("#searchBtn"),F=e("#searchResults"),U=e("#searchHint"),B=t(".search-tab"),K="active",J=e("#loadRowHint");function P(){U&&j&&q&&("active"===K?(q.style.display="none",J&&(J.style.display="none"),U.textContent="ðŸ’¡ Showing tasks with status: To Do or In Progress"):"company"===K&&(q.style.display="flex",J&&(J.style.display="flex"),j.placeholder="Type company name...",j.type="text",U.textContent=""))}B.forEach(function(e){e.addEventListener("click",_asyncToGenerator(_regenerator().m(function t(){return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(B.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),K=e.getAttribute("data-search"),j&&(j.value=""),P(),"active"!==K){t.n=2;break}return t.n=1,X();case 1:t.n=3;break;case 2:F&&(F.classList.remove("visible"),F.innerHTML="");case 3:return t.a(2)}},t)})))}),H&&H.addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,X();case 1:return e.a(2)}},e)}))),j&&j.addEventListener("keypress",function(){var e=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if("Enter"!==t.key){e.n=1;break}return Q(),e.n=1,X();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());var Y=e("#autocompleteDropdown"),z=[],Z=null;function V(){return W.apply(this,arguments)}function W(){return W=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(z.length>0)){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var n,r,a,o,c,s;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return e.a(2);case 2:return(r=n.getRange("A2:B5000")).load("values"),e.n=3,t.sync();case 3:for(a=r.values||[],z=[],o=0;o<a.length;o++)c=a[o][0]?String(a[o][0]).trim():"",s=a[o][1]?String(a[o][1]).trim():"",c&&z.push({name:c,category:s,rowNum:o+2});console.log("Loaded",z.length,"company rows for autocomplete");case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("Failed to load company list:",t);case 4:return e.a(2)}},e,null,[[1,3]])})),W.apply(this,arguments)}function $(e){if(Y&&e&&"company"===K){var t=e.toLowerCase(),n=z.filter(function(e){return e.name.toLowerCase().includes(t)}),r=n.filter(function(e){return e.name.toLowerCase().startsWith(t)}),a=n.filter(function(e){return!e.name.toLowerCase().startsWith(t)}),o=[].concat(_toConsumableArray(r),_toConsumableArray(a)).slice(0,15);0!==o.length?(Y.innerHTML=o.map(function(e){var t=e.category?" Â· ".concat(s(e.category)):"";return'<div class="autocomplete-item" data-row="'.concat(e.rowNum,'" data-name="').concat(s(e.name),'">\n        <span class="company-name">').concat(s(e.name),'</span>\n        <span class="row-hint">Row ').concat(e.rowNum).concat(t,"</span>\n      </div>")}).join(""),Y.classList.add("visible"),Y.querySelectorAll(".autocomplete-item").forEach(function(e){e.addEventListener("click",_asyncToGenerator(_regenerator().m(function t(){var n,r;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),r=e.getAttribute("data-name"),j&&(j.value=r),Q(),t.n=1,te(n);case 1:return t.a(2)}},t)})))})):Q()}else Q()}function Q(){Y&&(Y.classList.remove("visible"),Y.innerHTML="")}function X(){return ee.apply(this,arguments)}function ee(){return ee=_asyncToGenerator(_regenerator().m(function e(){var t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(F){e.n=1;break}return e.a(2);case 1:return F.innerHTML='<div class="no-results">Searching...</div>',F.classList.add("visible"),console.log("Search started, mode:",K),e.p=2,e.n=3,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var n,r,a,o,c,i,u,l,d,f,v;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(console.log("Sheet found:",!n.isNullObject),!n.isNullObject){e.n=2;break}return F.innerHTML='<div class="no-results">Sheet not found</div>',e.a(2);case 2:return(r=n.getRange("A1:K".concat(5e3))).load("values"),e.n=3,t.sync();case 3:a=r.values||[],console.log("Raw rows loaded (including header and blanks):",a.length),o=Array.isArray(a)?a:[],c=[],i=0,u=_regenerator().m(function e(){var t,n,r,a,s,u,d,f,v,m,p,g,y,h,k,w,b,S;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(y=function(e){if(!e||0===e.length)return"";var t=null;if(e.forEach(function(e){if(e){var n=new Date(e);isNaN(n.getTime())||(!t||n>t)&&(t=n)}}),!t)return"";var n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(r,"-").concat(a)},!(t=o[l]||[]).every(function(e){return null===e||""===e})){e.n=1;break}return e.a(2,1);case 1:i++,n=t[0]?String(t[0]).trim():"",r=t[1]?String(t[1]).trim():"",a=t[7]?String(t[7]).trim():"",s=!1,u="unknown",d=!1,f=!1,v=!1,m=[],p=[],g=[],a&&(a.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=be(e);if(t){var n=(t.status||"").toLowerCase();"to do"===n?(d=!0,t.initiated&&m.push(t.initiated)):"in progress"===n?(f=!0,t.updated&&p.push(t.updated)):"done"===n&&(v=!0,t.completed&&g.push(t.completed))}}),s=d||f,f?u="progress":d?u="todo":v&&(u="done")),h="",k="","progress"===u?(k=y(p),h=k?"Updated":""):"todo"===u?(k=y(m),h=k?"Initiated":""):"done"===u&&(k=y(g),h=k?"Completed":""),w=k?oe(k):"",b=l+1,"company"===K?(S=(j?j.value:"").toLowerCase().trim(),console.log("Checking row",b,"- Company:",n,"- Query:",S),S&&n.toLowerCase().includes(S)&&(console.log("Match found:",n),c.push({rowNum:b,companyName:n,taskCategory:r,dominantStatus:u,hasActiveTasks:s,statusDateLabel:h,statusDateDisplay:w}))):"active"===K&&(console.log("Checking row",b,"- Company:",n,"- Active:",s),s&&c.push({rowNum:b,companyName:n,taskCategory:r,dominantStatus:u,hasActiveTasks:s,statusDateLabel:h,statusDateDisplay:w}));case 2:return e.a(2)}},e)}),l=1;case 4:if(!(l<o.length)){e.n=7;break}return e.d(_regeneratorValues(u()),5);case 5:if(!e.v){e.n=6;break}return e.a(3,6);case 6:l++,e.n=4;break;case 7:d=i,f="company"===K?"Company":"Active tasks",v=(j?j.value:"").trim(),console.log("Search complete, mode:",f,"rows scanned:",d,"matches:",c.length,"query:",v),0===c.length?F.innerHTML='<div class="no-results">No results found</div>':(F.innerHTML=c.map(function(e){var t="progress"===e.dominantStatus?'<span class="status-badge progress">In Progress</span>':"todo"===e.dominantStatus?'<span class="status-badge todo">To Do</span>':"done"===e.dominantStatus?'<span class="status-badge done">Done</span>':"",n=e.statusDateLabel&&e.statusDateDisplay?" Â· ".concat(e.statusDateLabel," ").concat(s(e.statusDateDisplay)):"";return'<div class="search-result-item" data-row="'.concat(e.rowNum,'">\n              <div class="company">').concat(s(e.companyName||"(No name)")).concat(t,'</div>\n              <div class="meta">Row ').concat(e.rowNum," Â· ").concat(s(e.taskCategory||"No category")).concat(n,"</div>\n            </div>")}).join(""),F.querySelectorAll(".search-result-item").forEach(function(e){e.addEventListener("click",_asyncToGenerator(_regenerator().m(function t(){var n;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),t.n=1,te(n);case 1:F.classList.remove("visible");case 2:return t.a(2)}},t)})))}));case 8:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,t=e.v,console.error("Search error:",t),F.innerHTML='<div class="no-results">Search error</div>';case 5:return e.a(2)}},e,null,[[2,4]])})),ee.apply(this,arguments)}function te(e){return ne.apply(this,arguments)}function ne(){return ne=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}return e.a(2);case 2:return r.getRange("A".concat(t)).select(),e.n=3,n.sync();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.n=2,_e();case 2:return e.a(2)}},e)})),ne.apply(this,arguments)}function re(e){return ae.apply(this,arguments)}function ae(){return ae=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2,null);case 1:return e.a(2,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,a,o,c,s,i,u,l;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}return e.a(2,null);case 2:return(a=r.getUsedRange()).load("values"),e.n=3,n.sync();case 3:for(o=a.values||[],c=null,s=1;s<o.length;s++)i=o[s],u=i[0]?String(i[0]).trim().toLowerCase():"",l=i[7]?String(i[7]).trim():"",u===t.toLowerCase()&&l&&l.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes("kyc")&&t.includes(": done")){var n=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);n&&(c=n[1])}});return e.a(2,c)}},e)}));return function(t){return e.apply(this,arguments)}}()))}},e)})),ae.apply(this,arguments)}function oe(e){if(!e)return"";var t=String(e).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){var n=parseInt(t[1],10),r=parseInt(t[2],10)-1,a=parseInt(t[3],10);return"".concat(a,"-").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][r],"-").concat(n)}var o=new Date(e);if(isNaN(o.getTime()))return"";var c=o.getDate(),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o.getMonth()],i=o.getFullYear();return"".concat(c,"-").concat(s,"-").concat(i)}j&&(j.addEventListener("input",function(e){if("company"===K){clearTimeout(Z);var t=e.target.value.trim();t.length<1?Q():Z=setTimeout(function(){$(t)},150)}}),j.addEventListener("focus",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if("company"!==K){e.n=2;break}return e.n=1,V();case 1:j.value.trim().length>=1&&$(j.value.trim());case 2:return e.a(2)}},e)}))),j.addEventListener("blur",function(){setTimeout(Q,200)})),P();var ce=oe;function se(){return t("#taskCategories .category-toggle:checked").map(function(e){return e.value})}function ie(){var t=e('#taskCategories .category-toggle[value="Other Task"]');return t&&t.checked}function ue(t){return"__other__"===t?e("#otherTaskCard"):h?h.querySelector('.task-card[data-task="'.concat(t,'"]')):null}function le(e){if(!e)return[];var t=e.querySelector('[data-role="status-chips"]');return t?Array.from(t.querySelectorAll(".chip")):[]}function de(e,t){le(e).forEach(function(e){e.classList.toggle("active",e.getAttribute("data-value")===t)})}function fe(e){var t=le(e).find(function(e){return e.classList.contains("active")});return t?t.getAttribute("data-value"):"To Do"}function ve(){if(y&&h){var n=ie(),r=e("#otherTaskCard"),a=se().some(function(e){return"Other Task"!==e});y.style.display=a?"":"none";var o=new Set(pe());t("#taskCards .task-card").forEach(function(e){var t=e.getAttribute("data-task");e.style.display=o.has(t)?"":"none"}),r&&(r.style.display=n?"":"none")}}function me(){if(p){var e=se().filter(function(e){return"Other Task"!==e});0===e.length?p.placeholder="General note about this task":1===e.length?p.placeholder="General note about this "+e[0]:p.placeholder="General note about these tasks"}}function pe(){return t("#tasksChecklist .task-toggle:checked").map(function(e){return e.value})}function ge(t){var n=e(t);if(n){var r=Array.from(n.children);if(0!==r.length){var a=[],o=[];r.forEach(function(e){var t=e.querySelector("input[type=checkbox]")||e.querySelector('input[type="checkbox"]');t&&t.checked?a.push(e):o.push(e)}),[].concat(a,o).forEach(function(e){return n.appendChild(e)})}}}function ye(){return he.apply(this,arguments)}function he(){return he=_asyncToGenerator(_regenerator().m(function t(){var r;return _regenerator().w(function(t){for(;;)switch(t.n){case 0:if(!n){t.n=1;break}return t.a(2);case 1:if(n=!0,r=e("#assignees")){t.n=2;break}return t.a(2);case 2:if("1"!==r.dataset.initialized){t.n=3;break}return t.a(2);case 3:return r.dataset.initialized="1",r.innerHTML="",t.n=4,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var n,a,o,c,s,i;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("Team members")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return console.error("Team members sheet not found"),e.a(2);case 2:return(a=n.getUsedRange()).load("values"),e.n=3,t.sync();case 3:o=a.values||[],c=o.slice(1).map(function(e){return e[0]}).filter(function(e){return e&&String(e).trim().length>0}).map(function(e){return String(e).trim()}),s=Array.from(new Set(c)),console.log("Team members loaded from column A:",s),s.forEach(function(e){var t=document.createElement("div");t.innerHTML='<label><input type="checkbox" value="'.concat(e,'"> ').concat(e,"</label>"),r.appendChild(t)}),l&&(l.innerHTML="",(i=document.createElement("option")).value="",i.textContent="(none)",l.appendChild(i),s.forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,l.appendChild(t)}));case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return t.a(2)}},t)})),he.apply(this,arguments)}function ke(){return Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).map(function(e){return e.value})}function we(){var e=ke();t(".task-assignee-select").forEach(function(t){var n=t.value;t.innerHTML="";var r=document.createElement("option");r.value="",r.textContent="(Select assignee)",t.appendChild(r),e.forEach(function(e){var n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),1===e.length?t.value=e[0]:e.includes(n)&&(t.value=n)})}function be(e){if(!e)return null;var t=/^(.*?)\s*:\s*(to do|in progress|done)\s*\|\|\s*assigned to\s+([^|]+)/i.exec(e);if(!t)return null;var n={name:t[1].trim(),status:t[2],assignee:t[3].trim(),comment:"",giveUpId:"",initiated:"",updated:"",completed:"",deadline:""},r=/\|\|\s*comment:\s*([^|]+)/i.exec(e);r&&(n.comment=r[1].trim());var a=/\|\|\s*give-up id:\s*([^|]+)/i.exec(e);a&&(n.giveUpId=a[1].trim());var o=/\|\|\s*task initiated:\s*([^|]+)/i.exec(e);o&&(n.initiated=o[1].trim());var c=/\|\|\s*status updated:\s*([^|]+)/i.exec(e);c&&(n.updated=c[1].trim());var s=/\|\|\s*completed:\s*([^|]+)/i.exec(e);s&&(n.completed=s[1].trim());var i=/\|\|\s*deadline:\s*([^|]+)/i.exec(e);return i&&(n.deadline=i[1].trim()),n}function Se(e){var t=[],n=e.status||"To Do";return t.push("".concat(e.name,": ").concat(n)),t.push("Assigned to ".concat(e.assignees)),e.comment&&t.push("Comment: ".concat(e.comment)),e.giveUpId&&t.push("Give-up ID: ".concat(e.giveUpId)),e.initiated&&t.push("Task initiated: ".concat(e.initiated)),e.updated&&t.push("Status updated: ".concat(e.updated)),e.completed&&t.push("Completed: ".concat(e.completed)),e.deadline&&t.push("Deadline: ".concat(e.deadline)),t.join(" || ")}function _e(){return Te.apply(this,arguments)}function Te(){return Te=_asyncToGenerator(_regenerator().m(function n(){return _regenerator().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,ye();case 1:return n.n=2,Excel.run(function(){var n=_asyncToGenerator(_regenerator().m(function n(r){var a,o,c,s,y,h,w,b,S,_,A,L,E,C,D,M,N,x,O,R,I,G,j,q,H,F,U,B,K,J,P,Y,z,Z,V,W,$,Q;return _regenerator().w(function(n){for(;;)switch(n.n){case 0:return O=function(e){if(null==e||""===e)return"";if("number"==typeof e){var t=Date.UTC(1899,11,30),n=new Date(t+864e5*e),r=n.getUTCFullYear(),a=String(n.getUTCMonth()+1).padStart(2,"0"),o=String(n.getUTCDate()).padStart(2,"0");return"".concat(r,"-").concat(a,"-").concat(o)}if(e instanceof Date){var c=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return"".concat(c,"-").concat(s,"-").concat(i)}var u=String(e).trim();if(u.match(/^(\d{4})-(\d{2})-(\d{2})$/))return u;var l=u.match(/^(\d{1,2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{4})$/i);if(l){var d=parseInt(l[1],10),f={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[l[2].toLowerCase()],v=parseInt(l[3],10),m=String(d).padStart(2,"0"),p=String(f+1).padStart(2,"0");return"".concat(v,"-").concat(p,"-").concat(m)}var g=new Date(e);if(!isNaN(g.getTime())){var y=g.getFullYear(),h=String(g.getMonth()+1).padStart(2,"0"),k=String(g.getDate()).padStart(2,"0");return"".concat(y,"-").concat(h,"-").concat(k)}return u.length>=10?u.slice(0,10):""},(a=r.workbook.getSelectedRange()).load("rowIndex"),n.n=1,r.sync();case 1:return o=a.rowIndex+1,(c=r.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),n.n=2,r.sync();case 2:if(!c.isNullObject){n.n=3;break}return n.a(2);case 3:return s=c.getRange("A".concat(o)),y=c.getRange("B".concat(o)),h=c.getRange("C".concat(o)),w=c.getRange("D".concat(o)),b=c.getRange("E".concat(o,":G").concat(o)),S=c.getRange("H".concat(o)),_=c.getRange("J".concat(o)),A=c.getRange("K".concat(o)),s.load("values"),y.load("values"),h.load("values"),w.load("values"),b.load("values"),S.load("values"),_.load("values"),A.load("values"),n.n=4,r.sync();case 4:for(L=s.values&&s.values[0]&&s.values[0][0]?String(s.values[0][0]):"",u&&(u.value=L),E=y.values&&y.values[0]&&y.values[0][0]?String(y.values[0][0]):"",C=E.split(",").map(function(e){return e.trim()}).filter(Boolean),t("#taskCategories .category-toggle").forEach(function(e){var t=C.some(function(t){return t.toLowerCase()===e.value.toLowerCase()});e.checked=t}),D=w.values&&w.values[0]&&w.values[0][0]?String(w.values[0][0]):"",l&&(l.value=D),M=h.values&&h.values[0]&&h.values[0][0]?String(h.values[0][0]):"",N=M.split(/[,;]+/).map(function(e){return e.trim().toLowerCase()}).filter(Boolean),console.log("Assignees from column C:",N),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=N.includes(e.value.toLowerCase())}),x=b.values&&b.values[0]?b.values[0]:[null,null,null],console.log("Date values from Excel:",x),d&&(d.value=O(x[0])),f&&(f.value=O(x[1])),v&&(v.value=O(x[2])),console.log("Parsed dates:",null==d?void 0:d.value,null==f?void 0:f.value,null==v?void 0:v.value),R=_.values&&_.values[0]&&_.values[0][0]?String(_.values[0][0]):"",m&&(m.value=R),I=A.values&&A.values[0]&&A.values[0][0]?String(A.values[0][0]):"",p&&(p.value=I),G=S.values&&S.values[0]&&S.values[0][0]?String(S.values[0][0]):"",j=G.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),q=[],H=[],F=0;F<j.length;F++)(U=be(j[F]))?q.push(U):H.push(j[F]);B={"to do":1,"in progress":2,done:3},q.sort(function(e,t){return(B[(e.status||"").toLowerCase()]||4)-(B[(t.status||"").toLowerCase()]||4)}),console.log("Parsed tasks:",q),we(),t("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),t("#taskCards .task-card, #otherTaskCard").forEach(function(e){le(e).forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]'),n=e.querySelector('[data-role="deadline"]'),r=e.querySelector('[data-role="giveUpId"]'),a=e.querySelector('[data-role="task-assignee"]');t&&(t.value=""),n&&(n.value=""),r&&(r.value=""),a&&(a.value="")}),ie()?(K=ue("__other__"))&&(J=q[0]||null,k&&(k.value=J&&J.name?J.name:""),J&&(P=(J.status||"").toLowerCase(),de(K,"in progress"===P?"In Progress":"done"===P?"Done":"To Do"),Y=K.querySelector('[data-role="comment"]'),z=K.querySelector('[data-role="deadline"]'),Z=K.querySelector('[data-role="task-assignee"]'),Y&&(Y.value=J.comment||""),z&&(z.value=(J.deadline||"").slice(0,10)),Z&&J.assignee&&(Z.value=J.assignee.trim()))):t("#tasksChecklist .task-toggle").forEach(function(e){var t=e.value,n=q.find(function(e){var n=(e.name||"").toLowerCase(),r=t.toLowerCase();return n===r||"kyc (produced by lcmc)"===r&&"kyc (internal)"===n});e.checked=!!n;var r=ue(t);if(r&&n){var a=(n.status||"").toLowerCase();de(r,"in progress"===a?"In Progress":"done"===a?"Done":"To Do");var o=r.querySelector('[data-role="comment"]'),c=r.querySelector('[data-role="deadline"]'),s=r.querySelector('[data-role="giveUpId"]'),i=r.querySelector('[data-role="task-assignee"]');o&&(o.value=n.comment||""),c&&(c.value=(n.deadline||"").slice(0,10)),s&&(s.value=n.giveUpId||""),i&&n.assignee&&(i.value=n.assignee.trim())}}),g&&(V=null,q.length>0&&(V=q[0]),V?(W=[],V.initiated&&W.push("Task initiated: ".concat(V.initiated)),V.updated&&W.push("Status updated: ".concat(V.updated)),V.completed&&W.push("Completed: ".concat(V.completed)),g.textContent=W.join(" | ")):g.textContent=""),($=e("#lastKycDate"))&&L?(Q=null,q.forEach(function(e){e.name&&e.name.toLowerCase().includes("kyc")&&e.status&&"done"===e.status.toLowerCase()&&e.completed&&(Q=e.completed)}),Q?$.textContent=Q:re(L).then(function(e){$.textContent=e||"â€”"})):$&&($.textContent="â€”"),ve(),xe(),me(),ge("#assignees"),ge("#tasksChecklist"),ge("#taskCategories"),T=o,i(),qe(),Re&&Re.classList.remove("visible");case 5:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}());case 2:return n.a(2)}},n)})),Te.apply(this,arguments)}function Ae(){return Le.apply(this,arguments)}function Le(){return Le=_asyncToGenerator(_regenerator().m(function e(){var t,n,r;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return t=se().join(", "),n=ke().join(", "),r=ie(),console.log("Saving - Categories:",t,"Assignees:",n,"IsOther:",r),e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(a){var o,c,s,i,g,y,h,w,b,S,_,T,A,L,E,C,D,M,N,x,O,R,I,G,j,q,H,F,U,B,K,J,P,Y,z,Z,V,W,$;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(o=a.workbook.getSelectedRange()).load("rowIndex"),e.n=1,a.sync();case 1:return c=o.rowIndex+1,(s=a.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=2,a.sync();case 2:if(!s.isNullObject){e.n=3;break}return e.a(2);case 3:return(i=s.getRange("E".concat(c,":G").concat(c))).load("values"),g=s.getRange("A".concat(c)),y=s.getRange("B".concat(c)),h=s.getRange("C".concat(c)),w=s.getRange("D".concat(c)),b=s.getRange("H".concat(c)),S=s.getRange("J".concat(c)),_=s.getRange("K".concat(c)),b.load("values"),e.n=4,a.sync();case 4:return T=i.values&&i.values[0]?i.values[0]:[null,null,null],d&&(T[0]=ce(d.value)),f&&(T[1]=ce(f.value)),v&&(T[2]=ce(v.value)),i.values=[T],y.values=[[t]],l&&(w.values=[[l.value||""]]),u&&(g.values=[[u.value||""]]),h.values=[[n]],console.log("Saving assignees to column C:",n),m&&(S.values=[[m.value||""]]),p&&(_.values=[[p.value||""]]),A=b.values&&b.values[0]&&b.values[0][0]?String(b.values[0][0]):"",L=A.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),E=L.filter(function(e){return!be(e)}),C=[],D={},L.forEach(function(e){var t=be(e);t&&(D[t.name.toLowerCase()]=t)}),M=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))},N=function(e,t,n){var r=M(),a=n?(n.status||"").toLowerCase():"",o=(t||"").toLowerCase(),c=n&&n.initiated?n.initiated:"",s=n&&n.updated?n.updated:"",i=n&&n.completed?n.completed:"",u=c||s||i;return"to do"===o?(c=c||r,s="",i=""):"in progress"===o?(u&&a===o||(s=r),c="",i=""):"done"===o&&(u&&i&&a===o||(i=r),c="",s=""),{initiated:c,updated:s,completed:i}},r?(x=ue("__other__"),(O=k?k.value.trim():"")&&(R=fe(x)||"To Do",I=x?x.querySelector('[data-role="comment"]'):null,G=x?x.querySelector('[data-role="deadline"]'):null,j=x?x.querySelector('[data-role="task-assignee"]'):null,q=j&&j.value?j.value:n,H=D[O.toLowerCase()],F=N(0,R,H),U={name:O,status:R,assignees:q,comment:I?I.value.trim():"",giveUpId:"",initiated:F.initiated,updated:F.updated,completed:F.completed,deadline:G?G.value:""},B=Se(U),C.push({line:B,status:R}))):(K=pe(),J=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],K.forEach(function(e){if(J.includes(e)){var t=ue(e);if(t){var r=fe(t),a=t.querySelector('[data-role="comment"]'),o=t.querySelector('[data-role="deadline"]'),c=t.querySelector('[data-role="giveUpId"]'),s=t.querySelector('[data-role="task-assignee"]'),i=s&&s.value?s.value:n,u=D[e.toLowerCase()];u||"kyc (produced by lcmc)"!==e.toLowerCase()||(u=D["kyc (internal)"]);var l=N(0,r,u),d={name:e,status:r,assignees:i,comment:a?a.value.trim():"",giveUpId:c?c.value.trim():"",initiated:l.initiated,updated:l.updated,completed:l.completed,deadline:o?o.value:""};C.push({line:Se(d),status:r})}}})),P={"to do":1,"in progress":2,done:3},C.sort(function(e,t){return(P[(e.status||"").toLowerCase()]||4)-(P[(t.status||"").toLowerCase()]||4)}),Y=C.map(function(e){return e.line}),z=E.concat(Y).filter(Boolean).join("\n"),console.log("Saving to H - newTaskLines:",Y,"newValue:",z),b.values=[[z]],Y.length>0&&(Z=!1,V=!1,W=!1,Y.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?Z=!0:t.includes(": to do")?V=!0:t.includes(": done")&&(W=!0)}),$=Z?"#ff9900":V?"#34a853":W?"#cc6666":"#34a853",b.format.font.color=$),e.n=5,a.sync();case 5:console.log("Save completed successfully for row",c);case 6:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),Le.apply(this,arguments)}function Ee(){u&&(u.value=""),t("#taskCategories .category-toggle").forEach(function(e){e.checked=!1}),l&&(l.value=""),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=!1}),d&&(d.value=""),f&&(f.value=""),v&&(v.value=""),m&&(m.value=""),p&&(p.value=""),t("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),t("#taskCards .task-card, #otherTaskCard").forEach(function(e){e.querySelectorAll('[data-role="status-chips"] .chip').forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]');t&&(t.value="");var n=e.querySelector('[data-role="deadline"]');n&&(n.value="");var r=e.querySelector('[data-role="giveUpId"]');r&&(r.value="");var a=e.querySelector('[data-role="task-assignee"]');a&&(a.value="")}),k&&(k.value=""),g&&(g.textContent="");var n=e("#lastKycDate");n&&(n.textContent="â€”"),F&&(F.classList.remove("visible"),F.innerHTML=""),Re&&Re.classList.remove("visible"),T="new",qe(),xe(),ve(),me(),setTimeout(function(){var e=document.querySelector('#taskCards .task-card:not([style*="display: none"]), #otherTaskCard:not([style*="display: none"])');if(e){var t=e.querySelector('[data-role="comment"]');t&&"function"==typeof t.focus&&t.focus()}},100)}function Ce(){return De.apply(this,arguments)}function De(){return De=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(null!==T&&"new"!==T){e.n=1;break}throw new Error("No row to delete");case 1:return e.n=2,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var n;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("Sheet TASK MANAGER FORM not found");case 2:return n.getRange("".concat(T,":").concat(T)).delete(Excel.DeleteShiftDirection.up),e.n=3,t.sync();case 3:console.log("Deleted row",T);case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e)})),De.apply(this,arguments)}function Me(){return Ne.apply(this,arguments)}function Ne(){return Ne=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var n,r,a,o,c,s,i,g,y,h,w,b,S,_,A,L,E,C,D,M,N,x,O,R,I,G,j,q,H,F,U,B,K,J;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return console.error("Sheet TASK MANAGER FORM not found"),e.a(2);case 2:return(r=n.getRange("A2:A1000")).load("values"),e.n=3,t.sync();case 3:a=2,o=r.values||[],c=0;case 4:if(!(c<o.length)){e.n=7;break}if(!o[c][0]||""===String(o[c][0]).trim()){e.n=5;break}a=c+3,e.n=6;break;case 5:return a=c+2,e.a(3,7);case 6:c++,e.n=4;break;case 7:return s=u?u.value.trim():"",i=se().join(", "),g=ie(),y=l?l.value:"",h=ke().join(", "),n.getRange("A".concat(a)).values=[[s]],n.getRange("B".concat(a)).values=[[i]],n.getRange("C".concat(a)).values=[[h]],n.getRange("D".concat(a)).values=[[y]],w=ce(d?d.value:""),b=ce(f?f.value:""),S=ce(v?v.value:""),n.getRange("E".concat(a,":G").concat(a)).values=[[w,b,S]],n.getRange("J".concat(a)).values=[[m?m.value:""]],n.getRange("K".concat(a)).values=[[p?p.value:""]],_=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))}(),A=[],g?(L=ue("__other__"),(E=k?k.value.trim():"")&&(C=fe(L)||"To Do",D=L?L.querySelector('[data-role="comment"]'):null,M=L?L.querySelector('[data-role="deadline"]'):null,N=L?L.querySelector('[data-role="task-assignee"]'):null,x=N&&N.value?N.value:h,O="",R="",I="","to do"===(G=C.toLowerCase())?O=_:"in progress"===G?R=_:"done"===G&&(I=_),j={name:E,status:C,assignees:x,comment:D?D.value.trim():"",giveUpId:"",initiated:O,updated:R,completed:I,deadline:M?M.value:""},A.push(Se(j)))):(q=pe(),H=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],q.forEach(function(e){if(H.includes(e)){var t=ue(e);if(t){var n=fe(t)||"To Do",r=t.querySelector('[data-role="comment"]'),a=t.querySelector('[data-role="deadline"]'),o=t.querySelector('[data-role="giveUpId"]'),c=t.querySelector('[data-role="task-assignee"]'),s=c&&c.value?c.value:h,i="",u="",l="",d=n.toLowerCase();"to do"===d?i=_:"in progress"===d?u=_:"done"===d&&(l=_);var f={name:e,status:n,assignees:s,comment:r?r.value.trim():"",giveUpId:o?o.value.trim():"",initiated:i,updated:u,completed:l,deadline:a?a.value:""};A.push(Se(f))}}})),(F=n.getRange("H".concat(a))).values=[[A.join("\n")]],A.length>0&&(U=!1,B=!1,K=!1,A.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?U=!0:t.includes(": to do")?B=!0:t.includes(": done")&&(K=!0)}),J=U?"#ff9900":B?"#34a853":K?"#cc6666":"#34a853",F.format.font.color=J),e.n=8,t.sync();case 8:return n.getRange("A".concat(a)).select(),e.n=9,t.sync();case 9:T=a;case 10:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),Ne.apply(this,arguments)}function xe(){[{input:"#initialRequest",display:"#initialRequestDisplay"},{input:"#introEmail",display:"#introEmailDisplay"},{input:"#remindersStart",display:"#remindersStartDisplay"}].forEach(function(t){var n=t.input,r=t.display,a=e(n),o=e(r);if(a&&o){var c=oe(a.value);o.textContent=c?"â†’ ".concat(c):""}})}t("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){ve(),me()})}),document.querySelectorAll("#assignees").forEach(function(e){e.addEventListener("change",function(e){"checkbox"===e.target.type&&we()})});var Oe=e("#viewEmailSummaryBtn"),Re=e("#emailSummarySection"),Ie=e("#emailSummaryList"),Ge=e("#emailSummaryCount"),je=e("#closeEmailSummaryBtn");function qe(){var e=u?u.value.trim():"";Oe&&(Oe.disabled=!e)}function He(){return Fe.apply(this,arguments)}function Fe(){return(Fe=_asyncToGenerator(_regenerator().m(function e(){var t,n,r,c,i;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=u?u.value.trim():""){e.n=1;break}return o("No company name entered","error"),e.a(2);case 1:return Re&&Re.classList.add("visible"),Ie&&(Ie.innerHTML='<div class="email-loading">Loading summaries...</div>'),e.p=2,e.n=3,fetch("".concat(a,"/api/task-manager/summaries/").concat(encodeURIComponent(t),"?include_drafts=true"));case 3:if((n=e.v).ok){e.n=4;break}throw new Error("Server returned ".concat(n.status));case 4:return e.n=5,n.json();case 5:if(r=e.v,c=r.summaries||[],Ge&&(Ge.textContent=c.length),0!==c.length){e.n=6;break}return Ie.innerHTML='<div class="email-no-summaries">No email summaries found for this company.</div>',e.a(2);case 6:Ie.innerHTML=c.map(function(e){return'\n        <div class="email-summary-item '.concat(e.is_draft?"draft":"confirmed",'" data-id="').concat(e.id,'">\n          <div class="email-summary-subject">\n            ').concat(s(e.subject||"No subject"),"\n            ").concat(e.is_draft?'<span class="draft-badge">Draft</span>':"",'\n          </div>\n          <div class="email-summary-meta">\n            From: ').concat(s(e.from||"Unknown")," | ").concat(Ue(e.date),'\n          </div>\n          <div class="email-summary-text">').concat(s(e.summary||"No summary available"),"</div>\n          ").concat(e.is_draft?'\n            <div class="email-summary-actions">\n              <button class="btn-confirm-summary" onclick="window.confirmEmailSummary('.concat(e.id,')">\n                âœ“ Confirm & Link to Task\n              </button>\n            </div>\n          '):"","\n        </div>\n      ")}).join(""),e.n=8;break;case 7:e.p=7,i=e.v,console.error("Error loading email summaries:",i),Ie&&(Ie.innerHTML='<div class="email-no-summaries">Error loading summaries: '.concat(s(i.message),"<br><small>Make sure the Email Summarizer service is running.</small></div>"));case 8:return e.a(2)}},e,null,[[2,7]])}))).apply(this,arguments)}function Ue(e){if(!e)return"Unknown date";try{var t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch(t){return e}}u&&(u.addEventListener("input",qe),u.addEventListener("change",qe)),Oe&&Oe.addEventListener("click",_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,He();case 1:return e.a(2)}},e)}))),je&&je.addEventListener("click",function(){Re&&Re.classList.remove("visible")}),window.confirmEmailSummary=function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var n,r;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==T&&"new"!==T){e.n=1;break}return o("Please save the task first","error"),e.a(2);case 1:return e.p=1,e.n=2,fetch("".concat(a,"/api/task-manager/confirm/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_row:T})});case 2:if((n=e.v).ok){e.n=3;break}throw new Error("Server returned ".concat(n.status));case 3:return e.n=4,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(n){var r,a,o,c;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}throw new Error("Sheet not found");case 2:return(a=r.getRange("L".concat(T))).load("values"),e.n=3,n.sync();case 3:return o=a.values&&a.values[0]&&a.values[0][0]?String(a.values[0][0]):"",c="[Email Summary #".concat(t,"]"),a.values=[[o?"".concat(o," ").concat(c):c]],e.n=4,n.sync();case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return o("Summary confirmed and linked!","success"),e.n=5,He();case 5:e.n=7;break;case 6:e.p=6,r=e.v,console.error("Error confirming summary:",r),o("Error confirming summary: "+r.message,"error");case 7:return e.a(2)}},e,null,[[1,6]])}));return function(t){return e.apply(this,arguments)}}(),"undefined"!=typeof Office&&"function"==typeof Office.onReady&&Office.onReady(function(n){n.host===Office.HostType.Excel&&(t('#taskCards [data-role="status-chips"] .chip, #otherTaskCard [data-role="status-chips"] .chip').forEach(function(e){e.addEventListener("click",function(){var t=e.closest('[data-role="status-chips"]');t&&Array.from(t.querySelectorAll(".chip")).forEach(function(t){t.classList.toggle("active",t===e)})})}),["#initialRequest","#introEmail","#remindersStart"].forEach(function(t){var n=e(t);n&&n.addEventListener("change",xe)}),t('[data-role="deadline"]').forEach(function(e){e.addEventListener("change",function(){i()})}),t("input, select, textarea").forEach(function(e){e.addEventListener("change",function(){return c(!0)}),e.addEventListener("input",function(){return c(!0)})}),t(".chip").forEach(function(e){e.addEventListener("click",function(){return c(!0)})}),t("#tasksChecklist .task-toggle").forEach(function(e){e.addEventListener("change",function(){return ve()})}),t("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){return ve()})}),_e().then(function(){c(!1),X()}))})}();