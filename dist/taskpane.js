/*! For license information please see taskpane.js.LICENSE.txt */
!function(){function e(e){if(null!=e){var n=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}}}throw new TypeError(t(e)+" is not iterable")}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o,c,s=[],i=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(a=o.call(n)).done)&&(s.push(a.value),s.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw r}}return s}}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",c=n.toStringTag||"@@toStringTag";function s(n,a,o,c){var s=a&&a.prototype instanceof u?a:u,l=Object.create(s.prototype);return r(l,"_invoke",function(n,a,r){var o,c,s,u=0,l=r||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,c=0,s=e,f.n=n,i}};function m(n,a){for(c=n,s=a,t=0;!d&&u&&!r&&t<l.length;t++){var r,o=l[t],m=f.p,p=o[2];n>3?(r=p===a)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=m&&((r=n<2&&m<o[1])?(c=0,f.v=a,f.n=o[1]):m<p&&(r=n<3||o[0]>a||a>p)&&(o[4]=n,o[5]=a,f.n=p,c=0))}if(r||n>1)return i;throw d=!0,a}return function(r,l,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&m(l,p),c=l,s=p;(t=c<2?e:s)||!d;){o||(c?c<3?(c>1&&(f.n=-1),m(c,s)):f.n=s:f.v=s);try{if(u=2,o){if(c||(r="next"),t=o[r]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),c=1);o=e}else if((t=(d=f.n<0)?s:n.call(a,f))!==i)break}catch(t){o=e,c=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,o,c),!0),l}var i={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][o]?t(t([][o]())):(r(t={},o,function(){return this}),t),m=d.prototype=u.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,r(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=d,r(m,"constructor",d),r(d,"constructor",l),l.displayName="GeneratorFunction",r(d,c,"GeneratorFunction"),r(m),r(m,c,"Generator"),r(m,o,function(){return this}),r(m,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:p}})()}function r(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}r=function(e,t,n,a){function c(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(c("next",0),c("throw",1),c("return",2))},r(e,t,n,a)}function o(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function i(e,t,n,a,r,o,c){try{var s=e[o](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(a,r)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function c(e){i(o,a,r,c,s,"next",e)}function s(e){i(o,a,r,c,s,"throw",e)}c(void 0)})}}!function(){var r=function(e){return document.querySelector(e)},c=function(e){return Array.from(document.querySelectorAll(e))},s=!1,i=!1,l=new Map;function d(){return f.apply(this,arguments)}function f(){return f=u(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=u(a().m(function e(t){var n,r,o,c,s,i;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(n&&!n.isNullObject){e.n=2;break}return e.a(2);case 2:l.clear(),r=2;case 3:if(!(r<=1e3)){e.n=7;break}return(o=n.getRange("H".concat(r))).load("values"),o.load("text"),e.n=4,t.sync();case 4:if(c=o.values&&o.values[0]&&o.values[0][0],s=o.text&&o.text[0]&&o.text[0][0],c||s){e.n=5;break}return e.a(3,6);case 5:"string"==typeof(i=o.values[0][0]||o.text[0][0])&&i.split("\n").forEach(function(e){e.trim()&&e.split(";").forEach(function(e){var t=e.indexOf(":");if(-1!==t){var n=e.substring(0,t).trim();if(n){var a=e.match(/Assigned to ([^|]+)/);if(a){var r=a[1].trim();if(r&&""!==r){l.has(n)||l.set(n,new Map);var o=l.get(n);o.set(r,(o.get(r)||0)+1)}}}}})});case 6:r++,e.n=3;break;case 7:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("Error building task-assignee patterns:",t);case 3:return e.a(2)}},e,null,[[0,2]])})),f.apply(this,arguments)}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,a=r("#toast");a&&(a.textContent=e,a.className="toast "+t+" show",setTimeout(function(){a.classList.remove("show")},n))}function p(){var e=[],t=r("#companyName");t&&t.value.trim()||e.push("Company Name"),0===Array.from(document.querySelectorAll(".category-toggle:checked")).length&&e.push("Task Category");var n=r("#brokerLead");n&&n.value||e.push("Broker Lead"),0===Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).length&&e.push("Assigned To"),Array.from(document.querySelectorAll(".task-card")).filter(function(e){return"none"!==e.style.display&&"otherTaskCard"!==e.id}).forEach(function(t){var n=t.dataset.task||"Task",a=t.querySelector(".chip.active"),r=t.querySelector('[data-role="deadline"]');a||e.push("".concat(n,": Status")),r&&r.value||e.push("".concat(n,": Deadline"))});var a=r("#otherTaskCard");if(a&&"none"!==a.style.display){var o=r("#taskName");o&&o.value.trim()||e.push("Other Task: Task Name"),a.querySelector(".chip.active")||e.push("Other Task: Status");var c=a.querySelector('[data-role="deadline"]');c&&c.value||e.push("Other Task: Deadline")}var s=r("#emailFrequency");return s&&("SELECT"===s.tagName?s.selectedIndex<=0||!s.value:!s.value||""===s.value.trim())&&e.push("üïê Email Frequency"),e}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=document.createElement("div");n.className="confirm-overlay",n.id="missingFieldsOverlay";var a=document.createElement("div");if(a.className="confirm-box",a.style.maxWidth="320px",a.style.textAlign="left",0===e.length&&t){var r=document.createElement("p");r.innerHTML='<strong style="color:#10b981;">'.concat(t,"</strong>"),r.style.marginBottom="12px",r.style.textAlign="center",a.appendChild(r)}else{var o=document.createElement("p");o.innerHTML='<strong style="color:#f59e0b;">‚ö†Ô∏è Missing Fields</strong>',o.style.marginBottom="12px",o.style.textAlign="center",a.appendChild(o);var c=document.createElement("p");c.textContent=t||"The following fields are empty:",c.style.fontSize="12px",c.style.color="#64748b",c.style.marginBottom="8px",a.appendChild(c);var s=document.createElement("ul");s.style.cssText="margin:0 0 16px 0;padding-left:20px;font-size:12px;color:#334155;max-height:150px;overflow-y:auto;",e.forEach(function(e){var t=document.createElement("li");t.textContent=e,t.style.marginBottom="4px",s.appendChild(t)}),a.appendChild(s)}var i=document.createElement("div");i.style.textAlign="center";var u=document.createElement("button");u.textContent="Got it",u.style.cssText="padding:8px 24px;font-size:13px;font-weight:500;border:none;border-radius:6px;background:#1e40af;color:#fff;cursor:pointer;",u.addEventListener("click",function(){n.remove()}),i.appendChild(u),a.appendChild(i),n.appendChild(a),document.body.appendChild(n)}function g(e){i=e;var t=r("#unsavedIndicator");t&&t.classList.toggle("visible",e)}function h(e){return!!e&&String(e).trim().toLowerCase().endsWith("@lcmcommodities.com")}function y(e){var t=[],n=e.match(/## PARTICIPANTS\n([\s\S]*?)(?=\n## |$)/);return n&&n[1].split("\n").filter(function(e){return e.trim().startsWith("-")}).forEach(function(e){var n=e.match(/^-\s*(.+?)(?:\s*\(([^)]+)\))?\s*$/);if(n){var a=n[1].trim(),r=n[2]?n[2].trim():"";a&&t.push({name:a,email:r})}}),t}function k(e){var t=e.match(/## SUMMARY\n([\s\S]*?)(?=\n## |$)/);return t?t[1].trim():e.split("\n").slice(1).join("\n").trim()}function b(e){var t=e.toLowerCase();return t.includes("onboarding")||t.includes("new client")||t.includes("new account")||t.includes("account opening")?"Onboarding":t.includes("kyc")||t.includes("know your customer")||t.includes("compliance")||t.includes("documents")||t.includes("documentation")?"KYC update":t.includes("rate")||t.includes("pricing")||t.includes("amendment")||t.includes("amended")||t.includes("fee")||t.includes("commission")?"Amended Product/Rate":t.includes("give-up")||t.includes("giveup")||t.includes("give up")?"Give-up":null}function w(e){var t=(e||"").toLowerCase(),n=[];return[{keywords:["give-up","giveup","give up"],task:"Give-up Agreement"},{keywords:["broker agreement","brokerage agreement","brokerage"],task:"Broker Agreement"},{keywords:["annex a","amend annex","amendment"],task:"Amend Annex A"},{keywords:["kyc","know your client","due diligence"],task:"KYC (produced by LCMC)"},{keywords:["external kyc","third party kyc","counterparty kyc"],task:"KYC External"}].forEach(function(e){e.keywords.some(function(e){return t.includes(e)})&&n.push(e.task)}),o(new Set(n))}function S(e){console.log("=== SMARTBRIEF MATCH DEBUG ==="),console.log("Total participants found:",e.length),console.log("All participants:",e),m("SmartBrief: Processing ".concat(e.length," participants"),"info");var t=Array.from(document.querySelectorAll("#assignees input[type=checkbox]")).filter(function(e){return e.dataset.email&&e.dataset.email.trim().length>0}).map(function(e){var t=String(e.value||""),n=String(e.dataset.email||"").toLowerCase(),a=String(t||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim(),r=a.split(" ").filter(Boolean);return{cb:e,raw:t,norm:a,email:n,first:r[0]||"",last:r.length>1?r[r.length-1]:"",isSingleToken:r.length<=1}}),n=[],a=e.filter(function(e){return h(e.email)});return console.log("[SmartBrief] LCM participants:",a.map(function(e){return{name:e.name,email:e.email}})),console.log("[SmartBrief] Team entries:",t.map(function(e){return{raw:e.raw,norm:e.norm,first:e.first,last:e.last,isSingleToken:e.isSingleToken}})),a.forEach(function(e){var a=(e.email||"").toLowerCase(),r=null,o="";a&&(r=t.find(function(e){return e.email&&e.email===a}))&&(o="exact email"),r?(console.log('[SmartBrief] Matched participant "'.concat(e.name,'" (').concat(e.email,') -> team "').concat(r.raw,'" via ').concat(o)),n.push(r.raw)):console.log('[SmartBrief] No match for participant "'.concat(e.name,'" (').concat(e.email,") - no email match found"))}),o(new Set(n))}var A=null;function E(e,t,n,a){return C.apply(this,arguments)}function C(){return C=u(a().m(function e(n,r,o,c){var s,i,l,d,f,p,v,g,h,y,k,b,w,S,A;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return s="undefined"!=typeof window&&window.location&&"localhost"===window.location.hostname,i="".concat(s?"":"http://192.168.1.141:5002","/api/task-manager/summaries/").concat(encodeURIComponent(n)),e.p=1,l={threshold:.5},r&&(l.initial_request=r),o&&(l.intro_email=o),c&&(l.reminders_start=c),d=function(){var e=u(a().m(function e(n){var r,o,c,s,u,l;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 1:if(!(r=e.v).ok){e.n=3;break}return s=r.status,e.n=2,r.json();case 2:return u=e.v,e.a(2,{ok:!0,status:s,data:u});case 3:return o="",e.p=4,e.n=5,r.json();case 5:(c=e.v)&&"object"===t(c)&&(o=String(c.error||c.message||"")),e.n=10;break;case 6:return e.p=6,e.v,e.p=7,l=String,e.n=8,r.text();case 8:o=l(e.v),e.n=10;break;case 9:e.p=9,e.v,o="";case 10:return e.a(2,{ok:!1,status:r.status,serverMsg:o})}},e,null,[[7,9],[4,6]])}));return function(t){return e.apply(this,arguments)}}(),e.n=2,d(l);case 2:if(f=e.v,p=Boolean(l.initial_request||l.intro_email||l.reminders_start),f.ok||500!==f.status||!p){e.n=4;break}return e.n=3,d({threshold:.5});case 3:f=e.v;case 4:if(f.ok){e.n=5;break}throw v=f.serverMsg?": ".concat(f.serverMsg):"",new Error("Server returned ".concat(f.status).concat(v));case 5:if(g=f.data,0!==(h=Array.isArray(g.summaries)?g.summaries:[]).length){e.n=6;break}return e.a(2,"");case 6:if(y=h[0]||{},k=String(y.subject||"No subject"),b=String(y.summary||"").trim(),w="number"==typeof y.match_score?y.match_score:parseFloat(y.match_score),S=Number.isFinite(w)?Math.round(100*w):0,b){e.n=7;break}return e.a(2,"");case 7:return e.a(2,"[".concat(S,"% match] ").concat(k,"\n\n").concat(b));case 8:return e.p=8,m("SmartBrief API error: "+((A=e.v)&&A.message?A.message:String(A)),"error"),e.a(2,"")}},e,null,[[1,8]])})),C.apply(this,arguments)}function L(e){var t=document.createElement("div");return t.textContent=String(e||""),t.innerHTML}function x(e){var t=String(e||"").replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"),n=[],a=!1;return t.forEach(function(e){var t=e.match(/^##\s*(.+?)\s*$/);if(t){var r=t[1].trim();return n.push('<div style="margin-top:10px;margin-bottom:6px;color:var(--primary);font-weight:700;font-size:11px;letter-spacing:.6px;text-transform:uppercase;">'.concat(L(r),"</div>")),void(a=!1)}var o=String(e).replace(/^(\s*-\s*)\[(?:\s|x|X)\]\s+/,"$1");o.trim()?(n.push("<div>".concat(L(o),"</div>")),a=!1):a||(n.push('<div style="height:8px"></div>'),a=!0)}),n.join("")}function T(){c(".task-card").forEach(function(e){var t=e.querySelector('[data-role="deadline"]');if(t){var n=function(e){if(!e)return"";var t=new Date(e);if(isNaN(t.getTime()))return"";var n=new Date;n.setHours(0,0,0,0),t.setHours(0,0,0,0);var a=Math.ceil((t-n)/864e5);return a<0?"overdue":a<=3?"warning":""}(t.value);e.classList.remove("deadline-warning","deadline-overdue"),"overdue"===n?e.classList.add("deadline-overdue"):"warning"===n&&e.classList.add("deadline-warning")}})}window.addEventListener("beforeunload",function(e){if(i)return e.preventDefault(),e.returnValue="",""});var M=r("#companyName"),N=r("#brokerLead"),O=r("#initialRequest"),R=r("#introEmail"),D=r("#remindersStart"),q=r("#emailFrequency"),I=r("#extraNote"),j=r("#auditText"),F=r("#tasksRow"),B=r("#taskCards"),H=r("#taskName"),G=r("#saveBtn"),U=r("#newTaskBtn"),_=r("#loadSelectedBtn"),K=r("#openKycPortal"),P=null;function J(e){return new Promise(function(t){var n=r("#confirmDialog"),a=r("#confirmMessage"),o=r("#confirmCancel"),c=r("#confirmOk");if(n&&a&&o&&c){a.textContent=e,n.style.display="flex";var s=function(){n.style.display="none",o.removeEventListener("click",i),c.removeEventListener("click",u)},i=function(){s(),t(!1)},u=function(){s(),t(!0)};o.addEventListener("click",i),c.addEventListener("click",u)}else t(!1)})}G&&G.addEventListener("click",u(a().m(function e(){var t,n;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t=p(),null!==P&&"new"!==P){e.n=2;break}return e.n=1,We();case 1:0===t.length?v([],"üéâ Excellent! Task completed with all required fields properly filled."):v(t,"‚úÖ New task added successfully!"),e.n=4;break;case 2:return e.n=3,Je();case 3:0===t.length?v([],"üéâ Perfect! All task details are complete and saved successfully."):v(t,"‚úÖ Changes saved to row ".concat(P,"!"));case 4:g(!1),d(),e.n=6;break;case 5:e.p=5,n=e.v,console.error("Save error:",n),m("‚ùå Save failed: "+n.message,"error");case 6:return e.a(2)}},e,null,[[0,5]])}))),_&&_.addEventListener("click",u(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Ke();case 1:m("‚úÖ Loaded row "+P,"success"),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Load error:",t),m("‚ùå Failed to load row","error");case 3:return e.a(2)}},e,null,[[0,2]])}))),U&&U.addEventListener("click",function(){ze()});var Y=r("#deleteTaskBtn");Y&&Y.addEventListener("click",u(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(null!==P&&"new"!==P){e.n=1;break}return m("No task to delete - this is a new task","error"),e.a(2);case 1:return e.n=2,J("Are you sure you want to delete this Task?");case 2:if(e.v){e.n=3;break}return e.a(2);case 3:return e.p=3,e.n=4,$e();case 4:m("‚úÖ Task deleted successfully","success"),ze(),e.n=6;break;case 5:e.p=5,t=e.v,console.error("Delete error:",t),m("‚ùå Failed to delete task: "+t.message,"error");case 6:return e.a(2)}},e,null,[[3,5]])}))),K&&"1"!==K.dataset.kycListenerAttached&&(K.dataset.kycListenerAttached="1",K.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),"1"!==K.dataset.kycOpening&&(K.dataset.kycOpening="1",window.open("http://192.168.1.141:8080/","_blank"),setTimeout(function(){K.dataset.kycOpening="0"},1e3))}));var z=r("#tasksView"),$=r("#statsView"),Z=r("#tasksHeader"),W=r("#statsHeader"),V=r("#openStatsBtn"),Q=r("#returnToTasksBtn"),X=r("#refreshStatsBtn");function ee(){return te.apply(this,arguments)}function te(){return te=u(a().m(function t(){var c;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Excel.run(function(){var t=u(a().m(function t(c){var s,i,u,l,d,f,m,p,v,g,h,y,k,b,w,S,A,E,C,x,T,M,N,O,R,D,q,I,j,F,B;return a().w(function(t){for(;;)switch(t.n){case 0:return(s=c.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),t.n=1,c.sync();case 1:if(!s.isNullObject){t.n=2;break}return console.error("Sheet not found for statistics"),t.a(2);case 2:return(i=s.getRange("A1:K5000")).load("values"),t.n=3,c.sync();case 3:if(!((u=i.values||[]).length<2)){t.n=4;break}return t.a(2);case 4:l=0,d=0,f=0,m={},p={},v={},g=0,h=0,y=[],k=[],b=[],(w=new Date).setHours(0,0,0,0),(S=new Date(w)).setDate(S.getDate()+7),(A=new Date(w)).setDate(A.getDate()-30),E=a().m(function e(){var t,n,r,o,c,s,i,E,L,x,T,M,N;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=u[C],n=t[0]?String(t[0]).trim():""){e.n=1;break}return e.a(2,1);case 1:t[1]&&String(t[1]).trim(),r=t[3]?String(t[3]).trim():"(none)",o=t[4],c=t[5],s=t[6],i=t[7]?String(t[7]).trim():"",E=null,L=ne(o),x=ne(c),T=ne(s),(M=[L,x,T].filter(function(e){return null!==e})).length>0&&(E=M.reduce(function(e,t){return t<e?t:e})),E&&(N="".concat(E.getFullYear(),"-").concat(String(E.getMonth()+1).padStart(2,"0")),p[N]=(p[N]||0)+1),m[r]||(m[r]={total:0,active:0,completed:0}),m[r].total++,i&&i.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes(": to do")?(l++,m[r].active++):t.includes(": in progress")?(d++,m[r].active++):t.includes(": done")&&(f++,m[r].completed++),t.includes("kyc")&&t.includes(": done")){var a=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(a){var o=ne(a[1]);if(o){var c="".concat(o.getFullYear(),"-").concat(String(o.getMonth()+1).padStart(2,"0"));v[c]=(v[c]||0)+1}}}var s=e.match(/^(.*?)\s*:\s*(to do|in progress|done)/i),i=e.match(/assigned to\s+([^|]+)/i),u=s?s[1].trim():"Unknown",p=i?i[1].trim():"",E=e.match(/deadline:\s*(\d{4}-\d{2}-\d{2}|\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(E&&!t.includes(": done")){var C=ne(E[1]);if(C){var L=Math.ceil((C-w)/864e5);C<w?y.push({company:n,task:u,assignee:p,detail:"".concat(Math.abs(L),"d overdue")}):C<=S&&k.push({company:n,task:u,assignee:p,detail:0===L?"Today":"".concat(L,"d left")})}}if(!t.includes(": done")){var x=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),T=e.match(/updated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),M=null;if(T?M=ne(T[1]):x&&(M=ne(x[1])),M&&M<A){var N=Math.ceil((w-M)/864e5);b.push({company:n,task:u,assignee:p,detail:"".concat(N,"d ago")})}}if(t.includes(": done")){var O=e.match(/initiated:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i),R=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);if(O&&R){var D=ne(O[1]),q=ne(R[1]);if(D&&q){var I=Math.ceil((q-D)/864e5);I>=0&&I<365&&(g+=I,h++)}}}});case 2:return e.a(2)}},e)}),C=1;case 5:if(!(C<u.length)){t.n=8;break}return t.d(e(E()),6);case 6:if(!t.v){t.n=7;break}return t.a(3,7);case 7:C++,t.n=5;break;case 8:x=l+d,r("#statActiveTasks").textContent=x,r("#statAvgDuration").textContent=h>0?Math.round(g/h):"-",(T=l+d+f)>0&&(r("#barToDo").style.width=l/T*100+"%",r("#barInProgress").style.width=d/T*100+"%",r("#barDone").style.width=f/T*100+"%"),r("#countToDo").textContent=l,r("#countInProgress").textContent=d,r("#countDone").textContent=f,M=function(e,t,n,a){var o=r("#".concat(t)),c=r("#".concat(n)),s=r("#".concat(a));if(s&&(s.textContent=e.length),o&&c){if(0===e.length)return o.classList.remove("has-items"),void(c.innerHTML="");o.classList.add("has-items"),c.innerHTML=e.slice(0,10).map(function(e){var t=e.assignee?' <span class="to-assignee">to '.concat(L(e.assignee),"</span>"):"";return'<div class="attention-item">\n              <span class="task-info" title="'.concat(L(e.company),": ").concat(L(e.task),'">').concat(L(e.company),": ").concat(L(e.task)).concat(t,'</span>\n              <span class="task-detail">').concat(L(e.detail),"</span>\n            </div>")}).join("")}},y.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),k.sort(function(e,t){return parseInt(e.detail)-parseInt(t.detail)}),b.sort(function(e,t){return parseInt(t.detail)-parseInt(e.detail)}),M(y,"overdueGroup","overdueList","statOverdue"),M(k,"upcomingGroup","upcomingList","statUpcoming"),M(b,"staleGroup","staleList","statStale"),(N=r("#monthlyChart"))&&(O=Object.keys(p).sort().reverse().slice(0,6).reverse(),R=Math.max.apply(Math,o(O.map(function(e){return p[e]||0})).concat([1])),D=Math.max.apply(Math,o(O.map(function(e){return v[e]||0})).concat([1])),q=Math.max(R,D),I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],N.innerHTML=O.map(function(e){var t=n(e.split("-"),2),a=(t[0],t[1]),r=I[parseInt(a)-1],o=p[e]||0,c=v[e]||0,s=q>0?c/q*80:0;return'<div class="month-bar-group">\n              <div class="month-bars">\n                <div class="month-bar tasks" style="height:'.concat(q>0?o/q*80:0,'px">\n                  ').concat(o>0?'<span class="month-bar-value">'.concat(o,"</span>"):"",'\n                </div>\n                <div class="month-bar kyc" style="height:').concat(s,'px">\n                  ').concat(c>0?'<span class="month-bar-value">'.concat(c,"</span>"):"",'\n                </div>\n              </div>\n              <div class="month-bar-label">').concat(r,"</div>\n            </div>")}).join("")),(j=r("#brokerChart"))&&(F=Object.entries(m).filter(function(e){var t=n(e,1)[0];return t&&"(none)"!==t&&""!==t.trim()}).sort(function(e,t){return t[1].active+t[1].completed-(e[1].active+e[1].completed)}),B=Math.max.apply(Math,o(F.map(function(e){var t=n(e,2)[1];return t.active+t.completed})).concat([1])),j.innerHTML=F.map(function(e){var t=n(e,2),a=t[0],r=t[1],o=B>0?r.active/B*100:0,c=B>0?r.completed/B*100:0;return'<div class="broker-row">\n              <span class="broker-name" title="'.concat(L(a),'">').concat(L(a),'</span>\n              <div class="broker-bar-track">\n                <div class="broker-bar-fill active" style="width:').concat(o,'%">').concat(r.active>0?'<span class="bar-num">'.concat(r.active,"</span>"):"",'</div>\n                <div class="broker-bar-fill completed" style="width:').concat(c,'%">').concat(r.completed>0?'<span class="bar-num">'.concat(r.completed,"</span>"):"","</div>\n              </div>\n            </div>")}).join(""));case 9:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 1:t.n=3;break;case 2:t.p=2,c=t.v,console.error("Error loading statistics:",c);case 3:return t.a(2)}},t,null,[[0,2]])})),te.apply(this,arguments)}function ne(e){if(!e)return null;if("number"==typeof e&&e>1&&e<1e5){var t=Date.UTC(1899,11,30),n=new Date(t+24*e*60*60*1e3),a=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate());if(!isNaN(a.getTime())&&a.getFullYear()>1970)return a}var r=String(e).trim(),o=r.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(o){var c=parseInt(o[1],10),s=parseInt(o[2],10)-1,i=parseInt(o[3],10);return new Date(c,s,i)}var u=r.match(/(\d{1,2})[-\s]([A-Za-z]{3})[-\s](\d{2,4})/);if(u){var l=parseInt(u[1]),d={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[u[2].toLowerCase()],f=parseInt(u[3]);if(f<100&&(f+=2e3),void 0!==d)return new Date(f,d,l)}var m=new Date(r);return!isNaN(m.getTime())&&m.getFullYear()>1970?m:null}V&&V.addEventListener("click",function(){z&&(z.style.display="none"),Z&&(Z.style.display="none"),$&&($.style.display=""),W&&(W.style.display="flex"),ee()}),Q&&Q.addEventListener("click",function(){z&&(z.style.display=""),Z&&(Z.style.display="flex"),$&&($.style.display="none"),W&&(W.style.display="none")}),X&&X.addEventListener("click",function(){ee()});var ae=r("#searchInput"),re=r("#searchInputWrap"),oe=r("#searchBtn"),ce=r("#searchResults"),se=r("#searchHint"),ie=c(".search-tab"),ue="active",le=r("#loadRowHint");function de(){se&&ae&&re&&("active"===ue?(re.style.display="none",le&&(le.style.display="none"),se.textContent="üí° Showing tasks with status: To Do or In Progress"):"company"===ue&&(re.style.display="flex",le&&(le.style.display="flex"),ae.placeholder="Type company name...",ae.type="text",se.textContent=""))}ie.forEach(function(e){e.addEventListener("click",u(a().m(function t(){return a().w(function(t){for(;;)switch(t.n){case 0:if(ie.forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),ue=e.getAttribute("data-search"),ae&&(ae.value=""),de(),"active"!==ue){t.n=2;break}return t.n=1,ke();case 1:t.n=3;break;case 2:ce&&(ce.classList.remove("visible"),ce.innerHTML="");case 3:return t.a(2)}},t)})))}),oe&&oe.addEventListener("click",u(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,ke();case 1:return e.a(2)}},e)}))),ae&&ae.addEventListener("keypress",function(){var e=u(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:if("Enter"!==t.key){e.n=1;break}return ye(),e.n=1,ke();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());var fe=r("#autocompleteDropdown"),me=[],pe=null;function ve(){return ge.apply(this,arguments)}function ge(){return ge=u(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(me.length>0)){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=u(a().m(function e(t){var n,r,o,c,s,i;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return e.a(2);case 2:return(r=n.getRange("A2:B5000")).load("values"),e.n=3,t.sync();case 3:for(o=r.values||[],me=[],c=0;c<o.length;c++)s=o[c][0]?String(o[c][0]).trim():"",i=o[c][1]?String(o[c][1]).trim():"",s&&me.push({name:s,category:i,rowNum:c+2});console.log("Loaded",me.length,"company rows for autocomplete");case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("Failed to load company list:",t);case 4:return e.a(2)}},e,null,[[1,3]])})),ge.apply(this,arguments)}function he(e){if(fe&&e&&"company"===ue){var t=e.toLowerCase(),n=me.filter(function(e){return e.name.toLowerCase().includes(t)}),r=n.filter(function(e){return e.name.toLowerCase().startsWith(t)}),c=n.filter(function(e){return!e.name.toLowerCase().startsWith(t)}),s=[].concat(o(r),o(c)).slice(0,15);0!==s.length?(fe.innerHTML=s.map(function(e){var t=e.category?" ¬∑ ".concat(L(e.category)):"";return'<div class="autocomplete-item" data-row="'.concat(e.rowNum,'" data-name="').concat(L(e.name),'">\n        <span class="company-name">').concat(L(e.name),'</span>\n        <span class="row-hint">Row ').concat(e.rowNum).concat(t,"</span>\n      </div>")}).join(""),fe.classList.add("visible"),fe.querySelectorAll(".autocomplete-item").forEach(function(e){e.addEventListener("click",u(a().m(function t(){var n,r;return a().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),r=e.getAttribute("data-name"),ae&&(ae.value=r),ye(),t.n=1,we(n);case 1:return t.a(2)}},t)})))})):ye()}else ye()}function ye(){fe&&(fe.classList.remove("visible"),fe.innerHTML="")}function ke(){return be.apply(this,arguments)}function be(){return be=u(a().m(function t(){var n;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(ce){t.n=1;break}return t.a(2);case 1:return ce.innerHTML='<div class="no-results">Searching...</div>',ce.classList.add("visible"),console.log("Search started, mode:",ue),t.p=2,t.n=3,Excel.run(function(){var t=u(a().m(function t(n){var r,o,c,s,i,l,d,f,m,p,v;return a().w(function(t){for(;;)switch(t.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),t.n=1,n.sync();case 1:if(console.log("Sheet found:",!r.isNullObject),!r.isNullObject){t.n=2;break}return ce.innerHTML='<div class="no-results">Sheet not found</div>',t.a(2);case 2:return(o=r.getRange("A1:K".concat(5e3))).load("values"),t.n=3,n.sync();case 3:c=o.values||[],console.log("Raw rows loaded (including header and blanks):",c.length),s=Array.isArray(c)?c:[],i=[],l=0,d=a().m(function e(){var t,n,r,o,c,u,d,m,p,v,g,h,y,k,b,w,S,A;return a().w(function(e){for(;;)switch(e.n){case 0:if(y=function(e){if(!e||0===e.length)return"";var t=null;if(e.forEach(function(e){if(e){var n=new Date(e);isNaN(n.getTime())||(!t||n>t)&&(t=n)}}),!t)return"";var n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r)},!(t=s[f]||[]).every(function(e){return null===e||""===e})){e.n=1;break}return e.a(2,1);case 1:l++,n=t[0]?String(t[0]).trim():"",r=t[1]?String(t[1]).trim():"",o=t[7]?String(t[7]).trim():"",c=!1,u="unknown",d=!1,m=!1,p=!1,v=[],g=[],h=[],o&&(o.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=Ue(e);if(t){var n=(t.status||"").toLowerCase();"to do"===n?(d=!0,t.initiated&&v.push(t.initiated)):"in progress"===n?(m=!0,t.updated&&g.push(t.updated)):"done"===n&&(p=!0,t.completed&&h.push(t.completed))}}),c=d||m,m?u="progress":d?u="todo":p&&(u="done")),k="",b="","progress"===u?(b=y(g),k=b?"Updated":""):"todo"===u?(b=y(v),k=b?"Initiated":""):"done"===u&&(b=y(h),k=b?"Completed":""),w=b?Ce(b):"",S=f+1,"company"===ue?(A=(ae?ae.value:"").toLowerCase().trim(),console.log("Checking row",S,"- Company:",n,"- Query:",A),A&&n.toLowerCase().includes(A)&&(console.log("Match found:",n),i.push({rowNum:S,companyName:n,taskCategory:r,dominantStatus:u,hasActiveTasks:c,statusDateLabel:k,statusDateDisplay:w}))):"active"===ue&&(console.log("Checking row",S,"- Company:",n,"- Active:",c),c&&i.push({rowNum:S,companyName:n,taskCategory:r,dominantStatus:u,hasActiveTasks:c,statusDateLabel:k,statusDateDisplay:w}));case 2:return e.a(2)}},e)}),f=1;case 4:if(!(f<s.length)){t.n=7;break}return t.d(e(d()),5);case 5:if(!t.v){t.n=6;break}return t.a(3,6);case 6:f++,t.n=4;break;case 7:m=l,p="company"===ue?"Company":"Active tasks",v=(ae?ae.value:"").trim(),console.log("Search complete, mode:",p,"rows scanned:",m,"matches:",i.length,"query:",v),0===i.length?ce.innerHTML='<div class="no-results">No results found</div>':(ce.innerHTML=i.map(function(e){var t="progress"===e.dominantStatus?'<span class="status-badge progress">In Progress</span>':"todo"===e.dominantStatus?'<span class="status-badge todo">To Do</span>':"done"===e.dominantStatus?'<span class="status-badge done">Done</span>':"",n=e.statusDateLabel&&e.statusDateDisplay?" ¬∑ ".concat(e.statusDateLabel," ").concat(L(e.statusDateDisplay)):"";return'<div class="search-result-item" data-row="'.concat(e.rowNum,'">\n              <div class="company">').concat(L(e.companyName||"(No name)")).concat(t,'</div>\n              <div class="meta">Row ').concat(e.rowNum," ¬∑ ").concat(L(e.taskCategory||"No category")).concat(n,"</div>\n            </div>")}).join(""),ce.querySelectorAll(".search-result-item").forEach(function(e){e.addEventListener("click",u(a().m(function t(){var n;return a().w(function(t){for(;;)switch(t.n){case 0:return n=parseInt(e.getAttribute("data-row"),10),t.n=1,we(n);case 1:ce.classList.remove("visible");case 2:return t.a(2)}},t)})))}));case 8:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 3:t.n=5;break;case 4:t.p=4,n=t.v,console.error("Search error:",n),ce.innerHTML='<div class="no-results">Search error</div>';case 5:return t.a(2)}},t,null,[[2,4]])})),be.apply(this,arguments)}function we(e){return Se.apply(this,arguments)}function Se(){return Se=u(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=u(a().m(function e(n){var r;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}return e.a(2);case 2:return r.getRange("A".concat(t)).select(),e.n=3,n.sync();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.n=2,Ke();case 2:return e.a(2)}},e)})),Se.apply(this,arguments)}function Ae(e){return Ee.apply(this,arguments)}function Ee(){return Ee=u(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=1;break}return e.a(2,null);case 1:return e.a(2,Excel.run(function(){var e=u(a().m(function e(n){var r,o,c,s,i,u,l,d;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}return e.a(2,null);case 2:return(o=r.getUsedRange()).load("values"),e.n=3,n.sync();case 3:for(c=o.values||[],s=null,i=1;i<c.length;i++)u=c[i],l=u[0]?String(u[0]).trim().toLowerCase():"",d=u[7]?String(u[7]).trim():"",l===t.toLowerCase()&&d&&d.split(/\r?\n/).filter(Boolean).forEach(function(e){var t=e.toLowerCase();if(t.includes("kyc")&&t.includes(": done")){var n=e.match(/completed:\s*(\d{1,2}[-\s][A-Za-z]{3}[-\s]\d{2,4})/i);n&&(s=n[1])}});return e.a(2,s)}},e)}));return function(t){return e.apply(this,arguments)}}()))}},e)})),Ee.apply(this,arguments)}function Ce(e){if(!e)return"";var t=String(e).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){var n=parseInt(t[1],10),a=parseInt(t[2],10)-1,r=parseInt(t[3],10);return"".concat(r,"-").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a],"-").concat(n)}var o=new Date(e);if(isNaN(o.getTime()))return"";var c=o.getDate(),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o.getMonth()],i=o.getFullYear();return"".concat(c,"-").concat(s,"-").concat(i)}ae&&(ae.addEventListener("input",function(e){if("company"===ue){clearTimeout(pe);var t=e.target.value.trim();t.length<1?ye():pe=setTimeout(function(){he(t)},150)}}),ae.addEventListener("focus",u(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if("company"!==ue){e.n=2;break}return e.n=1,ve();case 1:ae.value.trim().length>=1&&he(ae.value.trim());case 2:return e.a(2)}},e)}))),ae.addEventListener("blur",function(){setTimeout(ye,200)})),de();var Le=Ce;function xe(){return c("#taskCategories .category-toggle:checked").map(function(e){return e.value})}function Te(){var e=r('#taskCategories .category-toggle[value="Other Task"]');return e&&e.checked}function Me(e){return"__other__"===e?r("#otherTaskCard"):B?B.querySelector('.task-card[data-task="'.concat(e,'"]')):null}function Ne(e){if(!e)return[];var t=e.querySelector('[data-role="status-chips"]');return t?Array.from(t.querySelectorAll(".chip")):[]}function Oe(e,t){Ne(e).forEach(function(e){e.classList.toggle("active",e.getAttribute("data-value")===t)})}function Re(e){var t=Ne(e).find(function(e){return e.classList.contains("active")});return t?t.getAttribute("data-value"):"To Do"}function De(){if(F&&B){var e=Te(),t=r("#otherTaskCard"),n=xe().some(function(e){return"Other Task"!==e});F.style.display=n?"":"none";var a=new Set(Ie());c("#taskCards .task-card").forEach(function(e){var t=e.getAttribute("data-task");e.style.display=a.has(t)?"":"none"}),t&&(t.style.display=e?"":"none")}}function qe(){if(I){var e=xe().filter(function(e){return"Other Task"!==e});0===e.length?I.placeholder="General note about this task":1===e.length?I.placeholder="General note about this "+e[0]:I.placeholder="General note about these tasks"}}function Ie(){return c("#tasksChecklist .task-toggle:checked").map(function(e){return e.value})}function je(e){var t=r(e);if(t){var n=Array.from(t.children);if(0!==n.length){var a=[],o=[];n.forEach(function(e){var t=e.querySelector("input[type=checkbox]")||e.querySelector('input[type="checkbox"]');t&&t.checked?a.push(e):o.push(e)}),[].concat(a,o).forEach(function(e){return t.appendChild(e)})}}}function Fe(){return Be.apply(this,arguments)}function Be(){return Be=u(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.n){case 0:if(!s){e.n=1;break}return e.a(2);case 1:if(s=!0,t=r("#assignees")){e.n=2;break}return e.a(2);case 2:if("1"!==t.dataset.initialized){e.n=3;break}return e.a(2);case 3:return t.dataset.initialized="1",t.innerHTML="",e.n=4,Excel.run(function(){var e=u(a().m(function e(n){var r,o,c,s,i;return a().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.worksheets.getItemOrNullObject("Team members")).load("name"),e.n=1,n.sync();case 1:if(!r.isNullObject){e.n=2;break}return console.error("Team members sheet not found"),e.a(2);case 2:return(o=r.getUsedRange()).load("values"),e.n=3,n.sync();case 3:c=o.values||[],s=c.slice(1).map(function(e){return{name:e[0]?String(e[0]).trim():"",email:e[1]?String(e[1]).trim().toLowerCase():""}}).filter(function(e){return e.name&&e.name.length>0}),console.log("Team members loaded from columns A and B:",s),s.forEach(function(e){var n=document.createElement("div");n.innerHTML='<label><input type="checkbox" value="'.concat(e.name,'" data-email="').concat(e.email,'"> ').concat(e.name,"</label>"),t.appendChild(n)}),N&&(N.innerHTML="",(i=document.createElement("option")).value="",i.textContent="(none)",N.appendChild(i),s.forEach(function(e){var t=document.createElement("option");t.value=e.name,t.textContent=e.name,N.appendChild(t)}));case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:return e.a(2)}},e)})),Be.apply(this,arguments)}function He(){return Array.from(document.querySelectorAll("#assignees input[type=checkbox]:checked")).map(function(e){return e.value})}function Ge(){var e=He();c(".task-assignee-select").forEach(function(t){var n=t.value;t.innerHTML="";var a=document.createElement("option");a.value="",a.textContent="(Select assignee)",t.appendChild(a),e.forEach(function(e){var n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),1===e.length?t.value=e[0]:e.includes(n)&&(t.value=n)})}function Ue(e){if(!e)return null;var t=/^(.*?)\s*:\s*(to do|in progress|done)\s*\|\|\s*assigned to\s+([^|]+)/i.exec(e);if(!t)return null;var n={name:t[1].trim(),status:t[2],assignee:t[3].trim(),comment:"",giveUpId:"",initiated:"",updated:"",completed:"",deadline:""},a=/\|\|\s*comment:\s*([^|]+)/i.exec(e);a&&(n.comment=a[1].trim());var r=/\|\|\s*give-up id:\s*([^|]+)/i.exec(e);r&&(n.giveUpId=r[1].trim());var o=/\|\|\s*task initiated:\s*([^|]+)/i.exec(e);o&&(n.initiated=o[1].trim());var c=/\|\|\s*status updated:\s*([^|]+)/i.exec(e);c&&(n.updated=c[1].trim());var s=/\|\|\s*completed:\s*([^|]+)/i.exec(e);s&&(n.completed=s[1].trim());var i=/\|\|\s*deadline:\s*([^|]+)/i.exec(e);return i&&(n.deadline=i[1].trim()),n}function _e(e){var t=[],n=e.status||"To Do";return t.push("".concat(e.name,": ").concat(n)),t.push("Assigned to ".concat(e.assignees)),e.comment&&t.push("Comment: ".concat(e.comment)),e.giveUpId&&t.push("Give-up ID: ".concat(e.giveUpId)),e.initiated&&t.push("Task initiated: ".concat(e.initiated)),e.updated&&t.push("Status updated: ".concat(e.updated)),e.completed&&t.push("Completed: ".concat(e.completed)),e.deadline&&t.push("Deadline: ".concat(e.deadline)),t.join(" || ")}function Ke(){return Pe.apply(this,arguments)}function Pe(){return Pe=u(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Fe();case 1:return e.n=2,Excel.run(function(){var e=u(a().m(function e(t){var n,o,s,i,u,l,d,f,m,p,v,g,h,y,k,b,w,S,A,E,C,L,x,F,B,G,U,_,K,J,Y,z,$,Z,W,V,Q,X;return a().w(function(e){for(;;)switch(e.n){case 0:return A=function(e){if(null==e||""===e)return"";if("number"==typeof e){var t=Date.UTC(1899,11,30),n=new Date(t+864e5*e),a=n.getUTCFullYear(),r=String(n.getUTCMonth()+1).padStart(2,"0"),o=String(n.getUTCDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(o)}if(e instanceof Date){var c=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return"".concat(c,"-").concat(s,"-").concat(i)}var u=String(e).trim();if(u.match(/^(\d{4})-(\d{2})-(\d{2})$/))return u;var l=u.match(/^(\d{1,2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{4})$/i);if(l){var d=parseInt(l[1],10),f={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}[l[2].toLowerCase()],m=parseInt(l[3],10),p=String(d).padStart(2,"0"),v=String(f+1).padStart(2,"0");return"".concat(m,"-").concat(v,"-").concat(p)}var g=new Date(e);if(!isNaN(g.getTime())){var h=g.getFullYear(),y=String(g.getMonth()+1).padStart(2,"0"),k=String(g.getDate()).padStart(2,"0");return"".concat(h,"-").concat(y,"-").concat(k)}return u.length>=10?u.slice(0,10):""},(n=t.workbook.getSelectedRange()).load("rowIndex"),e.n=1,t.sync();case 1:return o=n.rowIndex+1,(s=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=2,t.sync();case 2:if(!s.isNullObject){e.n=3;break}return e.a(2);case 3:return i=s.getRange("A".concat(o)),u=s.getRange("B".concat(o)),l=s.getRange("C".concat(o)),d=s.getRange("D".concat(o)),f=s.getRange("E".concat(o,":G").concat(o)),m=s.getRange("H".concat(o)),p=s.getRange("J".concat(o)),v=s.getRange("K".concat(o)),i.load("values"),u.load("values"),l.load("values"),d.load("values"),f.load("values"),m.load("values"),p.load("values"),v.load("values"),e.n=4,t.sync();case 4:for(g=i.values&&i.values[0]&&i.values[0][0]?String(i.values[0][0]):"",M&&(M.value=g),h=u.values&&u.values[0]&&u.values[0][0]?String(u.values[0][0]):"",y=h.split(",").map(function(e){return e.trim()}).filter(Boolean),c("#taskCategories .category-toggle").forEach(function(e){var t=y.some(function(t){return t.toLowerCase()===e.value.toLowerCase()});e.checked=t}),k=d.values&&d.values[0]&&d.values[0][0]?String(d.values[0][0]):"",N&&(N.value=k),b=l.values&&l.values[0]&&l.values[0][0]?String(l.values[0][0]):"",w=b.split(/[,;]+/).map(function(e){return e.trim().toLowerCase()}).filter(Boolean),console.log("Assignees from column C:",w),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=w.includes(e.value.toLowerCase())}),S=f.values&&f.values[0]?f.values[0]:[null,null,null],console.log("Date values from Excel:",S),O&&(O.value=A(S[0])),R&&(R.value=A(S[1])),D&&(D.value=A(S[2])),console.log("Parsed dates:",null==O?void 0:O.value,null==R?void 0:R.value,null==D?void 0:D.value),E=p.values&&p.values[0]&&p.values[0][0]?String(p.values[0][0]):"",q&&(q.value=E),C=v.values&&v.values[0]&&v.values[0][0]?String(v.values[0][0]):"",I&&(I.value=C),L=m.values&&m.values[0]&&m.values[0][0]?String(m.values[0][0]):"",x=L.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),F=[],B=[],G=0;G<x.length;G++)(U=Ue(x[G]))?F.push(U):B.push(x[G]);_={"to do":1,"in progress":2,done:3},F.sort(function(e,t){return(_[(e.status||"").toLowerCase()]||4)-(_[(t.status||"").toLowerCase()]||4)}),console.log("Parsed tasks:",F),Ge(),c("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),c("#taskCards .task-card, #otherTaskCard").forEach(function(e){Ne(e).forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]'),n=e.querySelector('[data-role="deadline"]'),a=e.querySelector('[data-role="giveUpId"]'),r=e.querySelector('[data-role="task-assignee"]');t&&(t.value=""),n&&(n.value=""),a&&(a.value=""),r&&(r.value="")}),Te()?(K=Me("__other__"))&&(J=F[0]||null,H&&(H.value=J&&J.name?J.name:""),J&&(Y=(J.status||"").toLowerCase(),Oe(K,"in progress"===Y?"In Progress":"done"===Y?"Done":"To Do"),z=K.querySelector('[data-role="comment"]'),$=K.querySelector('[data-role="deadline"]'),Z=K.querySelector('[data-role="task-assignee"]'),z&&(z.value=J.comment||""),$&&($.value=(J.deadline||"").slice(0,10)),Z&&J.assignee&&(Z.value=J.assignee.trim()))):c("#tasksChecklist .task-toggle").forEach(function(e){var t=e.value,n=F.find(function(e){var n=(e.name||"").toLowerCase(),a=t.toLowerCase();return n===a||"kyc (produced by lcmc)"===a&&"kyc (internal)"===n});e.checked=!!n;var a=Me(t);if(a&&n){var r=(n.status||"").toLowerCase();Oe(a,"in progress"===r?"In Progress":"done"===r?"Done":"To Do");var o=a.querySelector('[data-role="comment"]'),c=a.querySelector('[data-role="deadline"]'),s=a.querySelector('[data-role="giveUpId"]'),i=a.querySelector('[data-role="task-assignee"]');o&&(o.value=n.comment||""),c&&(c.value=(n.deadline||"").slice(0,10)),s&&(s.value=n.giveUpId||""),i&&n.assignee&&(i.value=n.assignee.trim())}}),j&&(W=null,F.length>0&&(W=F[0]),W?(V=[],W.initiated&&V.push("Task initiated: ".concat(W.initiated)),W.updated&&V.push("Status updated: ".concat(W.updated)),W.completed&&V.push("Completed: ".concat(W.completed)),j.textContent=V.join(" | ")):j.textContent=""),(Q=r("#lastKycDate"))&&g?(X=null,F.forEach(function(e){e.name&&e.name.toLowerCase().includes("kyc")&&e.status&&"done"===e.status.toLowerCase()&&e.completed&&(X=e.completed)}),X?Q.textContent=X:Ae(g).then(function(e){Q.textContent=e||"‚Äî"})):Q&&(Q.textContent="‚Äî"),De(),Qe(),qe(),je("#assignees"),je("#tasksChecklist"),je("#taskCategories"),P=o,T(),at(),et&&et.classList.remove("visible");case 5:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e)})),Pe.apply(this,arguments)}function Je(){return Ye.apply(this,arguments)}function Ye(){return Ye=u(a().m(function e(){var t,n,r;return a().w(function(e){for(;;)switch(e.n){case 0:return t=xe().join(", "),n=He().join(", "),r=Te(),console.log("Saving - Categories:",t,"Assignees:",n,"IsOther:",r),e.n=1,Excel.run(function(){var e=u(a().m(function e(o){var c,s,i,u,l,d,f,m,p,v,g,h,y,k,b,w,S,A,E,C,L,x,T,j,F,B,G,U,_,K,P,J,Y,z,$,Z,W,V,Q;return a().w(function(e){for(;;)switch(e.n){case 0:return(c=o.workbook.getSelectedRange()).load("rowIndex"),e.n=1,o.sync();case 1:return s=c.rowIndex+1,(i=o.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=2,o.sync();case 2:if(!i.isNullObject){e.n=3;break}return e.a(2);case 3:return(u=i.getRange("E".concat(s,":G").concat(s))).load("values"),l=i.getRange("A".concat(s)),d=i.getRange("B".concat(s)),f=i.getRange("C".concat(s)),m=i.getRange("D".concat(s)),p=i.getRange("H".concat(s)),v=i.getRange("J".concat(s)),g=i.getRange("K".concat(s)),p.load("values"),e.n=4,o.sync();case 4:return h=u.values&&u.values[0]?u.values[0]:[null,null,null],O&&(h[0]=Le(O.value)),R&&(h[1]=Le(R.value)),D&&(h[2]=Le(D.value)),u.values=[h],d.values=[[t]],N&&(m.values=[[N.value||""]]),M&&(l.values=[[M.value||""]]),f.values=[[n]],console.log("Saving assignees to column C:",n),q&&(v.values=[[q.value||""]]),I&&(g.values=[[I.value||""]]),y=p.values&&p.values[0]&&p.values[0][0]?String(p.values[0][0]):"",k=y.split(/\r?\n/).map(function(e){return e.trim()}).filter(Boolean),b=k.filter(function(e){return!Ue(e)}),w=[],S={},k.forEach(function(e){var t=Ue(e);t&&(S[t.name.toLowerCase()]=t)}),A=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))},E=function(e,t,n){var a=A(),r=n?(n.status||"").toLowerCase():"",o=(t||"").toLowerCase(),c=n&&n.initiated?n.initiated:"",s=n&&n.updated?n.updated:"",i=n&&n.completed?n.completed:"",u=c||s||i;return"to do"===o?(c=c||a,s="",i=""):"in progress"===o?(u&&r===o||(s=a),c="",i=""):"done"===o&&(u&&i&&r===o||(i=a),c="",s=""),{initiated:c,updated:s,completed:i}},r?(C=Me("__other__"),(L=H?H.value.trim():"")&&(x=Re(C)||"To Do",T=C?C.querySelector('[data-role="comment"]'):null,j=C?C.querySelector('[data-role="deadline"]'):null,F=C?C.querySelector('[data-role="task-assignee"]'):null,B=F&&F.value?F.value:n,G=S[L.toLowerCase()],U=E(0,x,G),_={name:L,status:x,assignees:B,comment:T?T.value.trim():"",giveUpId:"",initiated:U.initiated,updated:U.updated,completed:U.completed,deadline:j?j.value:""},K=_e(_),w.push({line:K,status:x}))):(P=Ie(),J=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],P.forEach(function(e){if(J.includes(e)){var t=Me(e);if(t){var a=Re(t),r=t.querySelector('[data-role="comment"]'),o=t.querySelector('[data-role="deadline"]'),c=t.querySelector('[data-role="giveUpId"]'),s=t.querySelector('[data-role="task-assignee"]'),i=s&&s.value?s.value:n,u=S[e.toLowerCase()];u||"kyc (produced by lcmc)"!==e.toLowerCase()||(u=S["kyc (internal)"]);var l=E(0,a,u),d={name:e,status:a,assignees:i,comment:r?r.value.trim():"",giveUpId:c?c.value.trim():"",initiated:l.initiated,updated:l.updated,completed:l.completed,deadline:o?o.value:""};w.push({line:_e(d),status:a})}}})),Y={"to do":1,"in progress":2,done:3},w.sort(function(e,t){return(Y[(e.status||"").toLowerCase()]||4)-(Y[(t.status||"").toLowerCase()]||4)}),z=w.map(function(e){return e.line}),$=b.concat(z).filter(Boolean).join("\n"),console.log("Saving to H - newTaskLines:",z,"newValue:",$),p.values=[[$]],z.length>0&&(Z=!1,W=!1,V=!1,z.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?Z=!0:t.includes(": to do")?W=!0:t.includes(": done")&&(V=!0)}),Q=Z?"#ff9900":W?"#34a853":V?"#cc6666":"#34a853",p.format.font.color=Q),e.n=5,o.sync();case 5:console.log("Save completed successfully for row",s);case 6:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),Ye.apply(this,arguments)}function ze(){M&&(M.value=""),c("#taskCategories .category-toggle").forEach(function(e){e.checked=!1}),N&&(N.value=""),document.querySelectorAll("#assignees input[type=checkbox]").forEach(function(e){e.checked=!1}),O&&(O.value=""),R&&(R.value=""),D&&(D.value=""),q&&(q.value=""),I&&(I.value=""),c("#tasksChecklist .task-toggle").forEach(function(e){e.checked=!1}),c("#taskCards .task-card, #otherTaskCard").forEach(function(e){e.querySelectorAll('[data-role="status-chips"] .chip').forEach(function(e){return e.classList.remove("active")});var t=e.querySelector('[data-role="comment"]');t&&(t.value="");var n=e.querySelector('[data-role="deadline"]');n&&(n.value="");var a=e.querySelector('[data-role="giveUpId"]');a&&(a.value="");var r=e.querySelector('[data-role="task-assignee"]');r&&(r.value="")}),H&&(H.value=""),j&&(j.textContent="");var e=r("#lastKycDate");e&&(e.textContent="‚Äî"),ce&&(ce.classList.remove("visible"),ce.innerHTML=""),et&&et.classList.remove("visible"),P="new",at(),Qe(),De(),qe(),setTimeout(function(){var e=document.querySelector('#taskCards .task-card:not([style*="display: none"]), #otherTaskCard:not([style*="display: none"])');if(e){var t=e.querySelector('[data-role="comment"]');t&&"function"==typeof t.focus&&t.focus()}},100)}function $e(){return Ze.apply(this,arguments)}function Ze(){return Ze=u(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if(null!==P&&"new"!==P){e.n=1;break}throw new Error("No row to delete");case 1:return e.n=2,Excel.run(function(){var e=u(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("Sheet TASK MANAGER FORM not found");case 2:return n.getRange("".concat(P,":").concat(P)).delete(Excel.DeleteShiftDirection.up),e.n=3,t.sync();case 3:console.log("Deleted row",P);case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2)}},e)})),Ze.apply(this,arguments)}function We(){return Ve.apply(this,arguments)}function Ve(){return Ve=u(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=u(a().m(function e(t){var n,r,o,c,s,i,u,l,d,f,m,p,v,g,h,y,k,b,w,S,A,E,C,L,x,T,j,F,B,G,U,_,K,J;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}return console.error("Sheet TASK MANAGER FORM not found"),e.a(2);case 2:return(r=n.getRange("A2:A1000")).load("values"),e.n=3,t.sync();case 3:o=2,c=r.values||[],s=0;case 4:if(!(s<c.length)){e.n=7;break}if(!c[s][0]||""===String(c[s][0]).trim()){e.n=5;break}o=s+3,e.n=6;break;case 5:return o=s+2,e.a(3,7);case 6:s++,e.n=4;break;case 7:return i=M?M.value.trim():"",u=xe().join(", "),l=Te(),d=N?N.value:"",f=He().join(", "),n.getRange("A".concat(o)).values=[[i]],n.getRange("B".concat(o)).values=[[u]],n.getRange("C".concat(o)).values=[[f]],n.getRange("D".concat(o)).values=[[d]],m=Le(O?O.value:""),p=Le(R?R.value:""),v=Le(D?D.value:""),n.getRange("E".concat(o,":G").concat(o)).values=[[m,p,v]],n.getRange("J".concat(o)).values=[[q?q.value:""]],n.getRange("K".concat(o)).values=[[I?I.value:""]],g=function(){var e=new Date;return"".concat(String(e.getDate()).padStart(2,"0")," ").concat(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]," ").concat(String(e.getFullYear()).slice(-2))}(),h=[],l?(y=Me("__other__"),(k=H?H.value.trim():"")&&(b=Re(y)||"To Do",w=y?y.querySelector('[data-role="comment"]'):null,S=y?y.querySelector('[data-role="deadline"]'):null,A=y?y.querySelector('[data-role="task-assignee"]'):null,E=A&&A.value?A.value:f,C="",L="",x="","to do"===(T=b.toLowerCase())?C=g:"in progress"===T?L=g:"done"===T&&(x=g),j={name:k,status:b,assignees:E,comment:w?w.value.trim():"",giveUpId:"",initiated:C,updated:L,completed:x,deadline:S?S.value:""},h.push(_e(j)))):(F=Ie(),B=["Broker Agreement","Give-up Agreement","Amend Annex A","KYC (produced by LCMC)","KYC External"],F.forEach(function(e){if(B.includes(e)){var t=Me(e);if(t){var n=Re(t)||"To Do",a=t.querySelector('[data-role="comment"]'),r=t.querySelector('[data-role="deadline"]'),o=t.querySelector('[data-role="giveUpId"]'),c=t.querySelector('[data-role="task-assignee"]'),s=c&&c.value?c.value:f,i="",u="",l="",d=n.toLowerCase();"to do"===d?i=g:"in progress"===d?u=g:"done"===d&&(l=g);var m={name:e,status:n,assignees:s,comment:a?a.value.trim():"",giveUpId:o?o.value.trim():"",initiated:i,updated:u,completed:l,deadline:r?r.value:""};h.push(_e(m))}}})),(G=n.getRange("H".concat(o))).values=[[h.join("\n")]],h.length>0&&(U=!1,_=!1,K=!1,h.forEach(function(e){var t=e.toLowerCase();t.includes(": in progress")?U=!0:t.includes(": to do")?_=!0:t.includes(": done")&&(K=!0)}),J=U?"#ff9900":_?"#34a853":K?"#cc6666":"#34a853",G.format.font.color=J),e.n=8,t.sync();case 8:return n.getRange("A".concat(o)).select(),e.n=9,t.sync();case 9:P=o;case 10:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),Ve.apply(this,arguments)}function Qe(){[{input:"#initialRequest",display:"#initialRequestDisplay"},{input:"#introEmail",display:"#introEmailDisplay"},{input:"#remindersStart",display:"#remindersStartDisplay"}].forEach(function(e){var t=e.input,n=e.display,a=r(t),o=r(n);if(a&&o){var c=Ce(a.value);o.textContent=c?"‚Üí ".concat(c):""}})}c("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){De(),qe()})}),document.querySelectorAll("#assignees").forEach(function(e){e.addEventListener("change",function(e){"checkbox"===e.target.type&&Ge()})});var Xe=r("#viewEmailSummaryBtn"),et=r("#emailSummarySection"),tt=(r("#emailSummaryList"),r("#emailSummaryCount")),nt=r("#closeEmailSummaryBtn");function at(){var e=M?M.value.trim():"";Xe&&(Xe.disabled=!e)}function rt(){return ot.apply(this,arguments)}function ot(){return ot=u(a().m(function e(){var t,n,o,c,s,i,l,d,f,p,v,g,C,T,N,q,I,j,F,B,H,G,U,_,K,J,Y;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("=== LOADING EMAIL SUMMARIES ==="),t=r("#emailSummaryList")){e.n=1;break}return console.log("emailSummaryList element not found"),e.a(2);case 1:if(n=M?M.value.trim():""){e.n=2;break}return m("No company name entered","error"),e.a(2);case 2:if(null!==P&&"new"!==P){e.n=3;break}return m("Please save the task first or select an existing row","error"),e.a(2);case 3:return et&&et.classList.add("visible"),t&&(t.innerHTML='<div class="email-loading">Loading summary from spreadsheet...</div>'),e.p=4,o="",e.n=5,Excel.run(function(){var e=u(a().m(function e(t){var n,r;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("TASK MANAGER FORM sheet not found");case 2:return(r=n.getRange("L".concat(P))).load("values"),e.n=3,t.sync();case 3:o=r.values&&r.values[0]&&r.values[0][0]?String(r.values[0][0]).trim():"";case 4:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 5:if(o&&(o=o.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),o){e.n=7;break}if("undefined"==typeof window||!window.location||"localhost"!==window.location.hostname){e.n=7;break}return t&&(t.innerHTML='<div class="email-loading">Fetching summary from API...</div>'),c=O?String(O.value||""):"",s=R?String(R.value||""):"",i=D?String(D.value||""):"",e.n=6,E(n,c,s,i);case 6:if(l=e.v,(o=l||"")&&(o=o.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),!o){e.n=7;break}return e.n=7,Excel.run(function(){var e=u(a().m(function e(t){var n;return a().w(function(e){for(;;)switch(e.n){case 0:return(n=t.workbook.worksheets.getItemOrNullObject("TASK MANAGER FORM")).load("name"),e.n=1,t.sync();case 1:if(!n.isNullObject){e.n=2;break}throw new Error("TASK MANAGER FORM sheet not found");case 2:return n.getRange("L".concat(P)).values=[[o]],e.n=3,t.sync();case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 7:if(tt&&(tt.textContent=o?"1":"0"),o){e.n=8;break}return t&&(t.innerHTML='\n            <div class="email-no-summaries">\n              No email summary found for this row.<br>\n              <small>Run the SmartBrief macro (Alt+F8 ‚Üí SmartBrief) to fetch summaries.</small>\n            </div>'),e.a(2);case 8:d=o.split(/\n/),f=(d[0]||"").trim(),p=d.slice(1).join("\n").replace(/^\n+/,"").trim(),v=f.match(/^\[(\d+)%\s*match\]\s*(.*)$/),g=100,C="Email Summary",T=o,v?(g=parseInt(v[1],10),C=(v[2]||"").trim()||"Email Summary",T=p):d.length>1?(C=f||"Email Summary",T=p):(C="Email Summary",T=o.trim()),N="match-high",g<70&&(N="match-medium"),g<50&&(N="match-low"),q=y(o),I=b(o),j=S(q),F=k(o),B=w(o),A={participants:q,detectedCategory:I,matchedAssignees:j,summaryNotes:F,suggestedTasks:B,matchPercent:g,subject:C},H="",q.length>0&&(G=q.map(function(e){var t=h(e.email)?"participant-chip matched":"participant-chip",n=e.email?e.email:e.name;return'<span class="'.concat(t,'" title="').concat(L(n),'">').concat(L(e.name),"</span>")}).join(""),H='\n          <div class="participants-section">\n            <div class="participants-label">Participants:</div>\n            <div class="participants-chips">'.concat(G,"</div>\n          </div>\n        ")),U="",g<50&&(U='\n          <div class="match-warning">\n            ‚ö†Ô∏è Low confidence match ('.concat(g,"%) ‚Äî verify this is the correct email thread\n          </div>\n        ")),_="",(I||j.length>0||F)&&(_='\n          <div class="smartbrief-actions">\n            <button id="applySmartBriefBtn" class="btn-apply-smartbrief">\n              ‚ú® Review & Apply to Task\n            </button>\n          </div>\n        '),K=(K=(K=T).replace(/## PARTICIPANTS[\s\S]*?(?=## |$)/,"").trim()).replace(/^\n+/,"").replace(/\n{3,}/g,"\n\n"),t&&(t.innerHTML="\n          ".concat(U,'\n          <div class="email-summary-item">\n            <div class="email-summary-subject">\n              ').concat(L(C),'\n              <span class="match-score ').concat(N,'" title="Match score from SmartBrief">\n                ').concat(g,"% match\n              </span>\n            </div>\n            ").concat(H,'\n            <div class="email-summary-text">').concat(x(K),"</div>\n          </div>\n          ").concat(_,"\n        "),(J=r("#applySmartBriefBtn"))&&J.addEventListener("click",function(){return ct()})),e.n=10;break;case 9:e.p=9,Y=e.v,console.error("Error loading email summary from column L:",Y),t&&(t.innerHTML='<div class="email-no-summaries">Error reading summary: '.concat(L(Y.message),"</div>"));case 10:return e.a(2)}},e,null,[[4,9]])})),ot.apply(this,arguments)}function ct(){if(A){var e=A,t=e.detectedCategory,a=e.matchedAssignees,s=(e.summaryNotes,e.suggestedTasks),i="",u=!1;if(t&&(u=!0,i+='\n        <div class="smartbrief-suggestion-item">\n          <label>\n            <input type="checkbox" id="sbApplyCategory" checked>\n            <span class="suggestion-label">Task Category:</span>\n            <span class="suggestion-value">'.concat(L(t),"</span>\n          </label>\n        </div>\n      ")),a&&a.length>0){u=!0;var d=a.map(function(e,t){return'\n        <label class="assignee-checkbox-item">\n          <input type="checkbox" class="sb-assignee-checkbox" data-assignee="'.concat(L(e),'" checked>\n          <span>').concat(L(e),"</span>\n        </label>\n      ")}).join("");i+='\n        <div class="smartbrief-suggestion-item smartbrief-assignees-group">\n          <div class="suggestion-label">Assignees:</div>\n          <div class="assignee-checkboxes-list">\n            '.concat(d,"\n          </div>\n        </div>\n      ")}if(s&&s.length>0){u=!0;var f=s.map(function(e){var t=function(e){var t=l.get(e);if(!t||0===t.size)return null;var n=0,a=null;return t.forEach(function(e,t){e>n&&(n=e,a=t)}),a}(e),n="";return t&&(n='\n            <span class="task-assignee-suggestion">\n              ‚Üí <input type="checkbox" class="sb-assignee-suggest" data-task="'.concat(L(e),'" data-assignee="').concat(L(t),'" checked>\n              <span style="color:#1e40af;font-weight:500;">').concat(L(t),"</span>\n            </span>\n          ")),'\n          <label class="assignee-checkbox-item">\n            <input type="checkbox" class="sb-task-checkbox" data-task="'.concat(L(e),'" checked>\n            <span>').concat(L(e)).concat(n,"</span>\n          </label>\n        ")}).join("");i+='\n        <div class="smartbrief-suggestion-item smartbrief-assignees-group">\n          <div class="suggestion-label">Suggested Tasks <span style="font-size:11px;color:#64748b;">(with pattern-based assignees)</span>:</div>\n          <div class="assignee-checkboxes-list">\n            '.concat(f,"\n          </div>\n        </div>\n      ")}if(!u){m("No suggestions available - but check for missing fields","info");var p=[];O&&!O.value&&p.push("Initial Request Date"),D&&!D.value&&p.push("Reminders Start Date"),N&&!N.value&&p.push("Broker Lead");var v=r("#emailFrequency");return v&&("SELECT"===v.tagName?v.selectedIndex<=0||!v.value:!v.value||""===v.value.trim())&&p.push("Email Frequency"),0===document.querySelectorAll("#tasksChecklist .task-toggle:checked").length&&p.push("Task Selection"),0===document.querySelectorAll("#assignees input[type=checkbox]:checked").length&&p.push("Assignees"),void(p.length>0&&setTimeout(function(){m("‚ö†Ô∏è Still needed: ".concat(p.join(", "),". Click Save when done!"),"info",1e4)},2e3))}var h=document.createElement("div");h.className="confirm-overlay",h.id="smartbriefConfirmOverlay";var y=document.createElement("div");y.className="confirm-box smartbrief-confirm-box",y.innerHTML='\n      <div class="smartbrief-confirm-header">\n        <span class="sparkle">‚ú®</span> Review Suggestions\n      </div>\n      <p class="smartbrief-confirm-desc">Select which items to apply to the task:</p>\n      <div class="smartbrief-suggestions">\n        '.concat(i,'\n      </div>\n      <div class="smartbrief-confirm-buttons">\n        <button class="btn-confirm-cancel" id="sbCancel">Cancel</button>\n        <button class="btn-apply-confirmed" id="sbApply">Apply Selected</button>\n      </div>\n    '),h.appendChild(y),document.body.appendChild(h);var k=h.querySelector("#sbCancel"),b=h.querySelector("#sbApply");k.addEventListener("click",function(){return h.remove()}),b.addEventListener("click",function(){var e,t,a=null===(e=h.querySelector("#sbApplyCategory"))||void 0===e?void 0:e.checked,s=null===(t=h.querySelector("#sbApplyNotes"))||void 0===t?void 0:t.checked,i=[];h.querySelectorAll(".sb-assignee-checkbox:checked").forEach(function(e){i.push(e.getAttribute("data-assignee"))});var u=[];h.querySelectorAll(".sb-task-checkbox:checked").forEach(function(e){u.push(e.getAttribute("data-task"))});var l={};h.querySelectorAll(".sb-assignee-suggest:checked").forEach(function(e){var t=e.getAttribute("data-task"),n=e.getAttribute("data-assignee");l[t]||(l[t]=[]),l[t].push(n)}),h.remove(),function(e,t,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(A){var u=A,l=u.detectedCategory,d=(u.summaryNotes,u.matchedAssignees,[]);e&&l&&(document.querySelectorAll("#taskCategories .category-toggle").forEach(function(e){e.value===l&&(e.checked=!0,d.push("Category: ".concat(l)))}),De());var f=[];document.querySelectorAll("#smartbriefConfirmOverlay .sb-assignee-checkbox:checked").forEach(function(e){f.push(e.value)});var p=new Map,v=new Set;Object.entries(i).forEach(function(e){var t=n(e,2),a=t[0],r=t[1];p.set(a,r),r.forEach(function(e){return v.add(e)})});var h=new Set([].concat(f,o(v)));h.size>0&&(c("#assignees input[type=checkbox]").forEach(function(e){h.has(e.value)&&(e.checked=!0)}),Ge(),je("#assignees"),d.push("Assignees: ".concat(o(h).join(", ")))),s&&s.length>0&&(document.querySelectorAll("#tasksChecklist .task-toggle").forEach(function(e){s.includes(e.value)&&(e.checked=!0,e.dispatchEvent(new Event("change",{bubbles:!0})))}),Ge(),setTimeout(function(){s.forEach(function(e){var t=p.get(e)||[],n=t.length>0?t[0]:null;if(n){var a=document.querySelector('#taskCards .task-card[data-task="'.concat(e,'"]'));if(a){var r=a.querySelector(".task-assignee-select");r&&Array.from(r.options).find(function(e){return e.value===n})&&(r.value=n,r.style.backgroundColor="#f0f9ff",r.title="Auto-suggested based on pattern: ".concat(e," ‚Üí ").concat(n))}}})},100),document.querySelectorAll("#taskCards .task-card").forEach(function(e){var t=e.querySelectorAll('.chip[data-value="To Do"]');t.length>0&&(e.querySelectorAll(".chip").forEach(function(e){return e.classList.remove("active")}),t.forEach(function(e){return e.classList.add("active")}))}),d.push("Tasks: ".concat(s.join(", "))));var y=[];O&&!O.value&&y.push("Initial Request Date"),D&&!D.value&&y.push("Reminders Start Date"),N&&!N.value&&y.push("Broker Lead");var k=r("#emailFrequency");if(k&&("SELECT"===k.tagName?k.selectedIndex<=0||!k.value:!k.value||""===k.value.trim())&&y.push("Email Frequency"),0===document.querySelectorAll("#tasksChecklist .task-toggle:checked").length&&y.push("Task Selection"),0===document.querySelectorAll("#assignees input[type=checkbox]:checked").length&&y.push("Assignees"),d.length>0){g(!0);var b="";y.length>0&&(b="‚ö†Ô∏è Still needed: ".concat(y.join(", "),". ")),m(b+='‚ú® Applied to form - Click "Save Changes" to confirm!',"success",1e4);var w=document.getElementById("saveBtn");w&&(w.style.animation="pulse 2s ease-in-out 3",setTimeout(function(){w.style.animation=""},6e3))}else m("No items selected","info")}}(a,i,s,u,l)}),h.addEventListener("click",function(e){e.target===h&&h.remove()})}else m("No SmartBrief data available","error")}M&&(M.addEventListener("input",at),M.addEventListener("change",at)),Xe&&Xe.addEventListener("click",u(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,rt();case 1:return e.a(2)}},e)}))),nt&&nt.addEventListener("click",function(){et&&et.classList.remove("visible")}),"undefined"!=typeof Office&&"function"==typeof Office.onReady&&Office.onReady(function(e){e.host===Office.HostType.Excel&&(c('#taskCards [data-role="status-chips"] .chip, #otherTaskCard [data-role="status-chips"] .chip').forEach(function(e){e.addEventListener("click",function(){var t=e.closest('[data-role="status-chips"]');t&&Array.from(t.querySelectorAll(".chip")).forEach(function(t){t.classList.toggle("active",t===e)})})}),["#initialRequest","#introEmail","#remindersStart"].forEach(function(e){var t=r(e);t&&t.addEventListener("change",Qe)}),c('[data-role="deadline"]').forEach(function(e){e.addEventListener("change",function(){T()})}),c("input, select, textarea").forEach(function(e){e.addEventListener("change",function(){return g(!0)}),e.addEventListener("input",function(){return g(!0)})}),c(".chip").forEach(function(e){e.addEventListener("click",function(){return g(!0)})}),c("#tasksChecklist .task-toggle").forEach(function(e){e.addEventListener("change",function(){return De()})}),c("#taskCategories .category-toggle").forEach(function(e){e.addEventListener("change",function(){return De()})}),Ke().then(function(){g(!1),d(),ke()}))})}()}();
//# sourceMappingURL=taskpane.js.map