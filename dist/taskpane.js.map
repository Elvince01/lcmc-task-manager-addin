{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./src/taskpane/taskpane.js"],"sourcesContent":["// Task Manager task pane logic, wired to Excel via Office.js\n// Based on the scaffold in Task Manager Excel/addin/taskpane.js\n\n/* global document, Excel, Office */\n\n(function(){\n  const qs = (s)=>document.querySelector(s);\n  const qsa = (s)=>Array.from(document.querySelectorAll(s));\n  let teamMembersLoaded = false;\n  let hasUnsavedChanges = false;\n\n  // SmartBrief Integration\n  // Email summaries are fetched by VBA macro (SmartBrief.bas) and written to column L\n  // The add-in reads from column L to display summaries (no direct API calls from JS)\n\n  const EMAIL_SUMMARIZER_API_URL = 'http://192.168.1.141:5002';\n  const SMARTBRIEF_MATCH_THRESHOLD = 0.5;\n\n  // Toast notification helper\n  function showToast(message, type = 'success') {\n    const toast = qs('#toast');\n    if (!toast) return;\n    toast.textContent = message;\n    toast.className = 'toast ' + type + ' show';\n    setTimeout(() => {\n      toast.classList.remove('show');\n    }, 3000);\n  }\n\n  // Check for missing fields and return array of missing field names\n  function checkMissingFields() {\n    const missing = [];\n\n    // Check company name\n    const companyName = qs('#companyName');\n    if (!companyName || !companyName.value.trim()) {\n      missing.push('Company Name');\n    }\n\n    // Check task category\n    const selectedCategories = Array.from(document.querySelectorAll('.category-toggle:checked'));\n    if (selectedCategories.length === 0) {\n      missing.push('Task Category');\n    }\n\n    // Check broker lead\n    const brokerLead = qs('#brokerLead');\n    if (!brokerLead || !brokerLead.value) {\n      missing.push('Broker Lead');\n    }\n\n    // Check assignees\n    const selectedAssignees = Array.from(document.querySelectorAll('#assignees input[type=checkbox]:checked'));\n    if (selectedAssignees.length === 0) {\n      missing.push('Assigned To');\n    }\n\n    // Check visible task cards for status and deadline\n    const visibleTaskCards = Array.from(document.querySelectorAll('.task-card')).filter(card => {\n      return card.style.display !== 'none' && card.id !== 'otherTaskCard';\n    });\n\n    visibleTaskCards.forEach(card => {\n      const taskName = card.dataset.task || 'Task';\n      const activeChip = card.querySelector('.chip.active');\n      const deadlineInput = card.querySelector('[data-role=\"deadline\"]');\n\n      if (!activeChip) {\n        missing.push(`${taskName}: Status`);\n      }\n      if (!deadlineInput || !deadlineInput.value) {\n        missing.push(`${taskName}: Deadline`);\n      }\n    });\n\n    // Check \"Other Task\" card if visible\n    const otherTaskCard = qs('#otherTaskCard');\n    if (otherTaskCard && otherTaskCard.style.display !== 'none') {\n      const taskNameInput = qs('#taskName');\n      if (!taskNameInput || !taskNameInput.value.trim()) {\n        missing.push('Other Task: Task Name');\n      }\n      const activeChip = otherTaskCard.querySelector('.chip.active');\n      if (!activeChip) {\n        missing.push('Other Task: Status');\n      }\n      const deadlineInput = otherTaskCard.querySelector('[data-role=\"deadline\"]');\n      if (!deadlineInput || !deadlineInput.value) {\n        missing.push('Other Task: Deadline');\n      }\n    }\n\n    return missing;\n  }\n\n  // Show missing fields warning in a styled popup\n  function showMissingFieldsWarning(missingFields) {\n    // Create overlay\n    const overlay = document.createElement('div');\n    overlay.className = 'confirm-overlay';\n    overlay.id = 'missingFieldsOverlay';\n\n    // Create box\n    const box = document.createElement('div');\n    box.className = 'confirm-box';\n    box.style.maxWidth = '320px';\n    box.style.textAlign = 'left';\n\n    // Title\n    const title = document.createElement('p');\n    title.innerHTML = '<strong style=\"color:#f59e0b;\"> Missing Fields</strong>';\n    title.style.marginBottom = '12px';\n    title.style.textAlign = 'center';\n    box.appendChild(title);\n\n    // Description\n    const desc = document.createElement('p');\n    desc.textContent = 'The following fields are empty:';\n    desc.style.fontSize = '12px';\n    desc.style.color = '#64748b';\n    desc.style.marginBottom = '8px';\n    box.appendChild(desc);\n\n    // List of missing fields\n    const list = document.createElement('ul');\n    list.style.cssText = 'margin:0 0 16px 0;padding-left:20px;font-size:12px;color:#334155;max-height:150px;overflow-y:auto;';\n    missingFields.forEach(field => {\n      const li = document.createElement('li');\n      li.textContent = field;\n      li.style.marginBottom = '4px';\n      list.appendChild(li);\n    });\n    box.appendChild(list);\n\n    // Close button\n    const btnWrap = document.createElement('div');\n    btnWrap.style.textAlign = 'center';\n    const closeBtn = document.createElement('button');\n    closeBtn.textContent = 'Got it';\n    closeBtn.style.cssText = 'padding:8px 24px;font-size:13px;font-weight:500;border:none;border-radius:6px;background:#1e40af;color:#fff;cursor:pointer;';\n    closeBtn.addEventListener('click', () => {\n      overlay.remove();\n    });\n    btnWrap.appendChild(closeBtn);\n    box.appendChild(btnWrap);\n\n    overlay.appendChild(box);\n    document.body.appendChild(overlay);\n  }\n\n  // Unsaved changes indicator\n  function setUnsavedChanges(unsaved) {\n    hasUnsavedChanges = unsaved;\n    const indicator = qs('#unsavedIndicator');\n    if (indicator) {\n      indicator.classList.toggle('visible', unsaved);\n    }\n  }\n\n  // ============== SmartBrief Parsing Helpers ==============\n\n  // Parse participants from SmartBrief summary\n  // Format: \"## PARTICIPANTS\\n- Name (email@domain.com)\\n- Name2 (email2@domain.com)\"\n  function parseParticipantsFromSummary(summaryText) {\n    const participants = [];\n    const participantsMatch = summaryText.match(/## PARTICIPANTS\\n([\\s\\S]*?)(?=\\n## |$)/);\n    if (participantsMatch) {\n      const participantsBlock = participantsMatch[1];\n      const lines = participantsBlock.split('\\n').filter(l => l.trim().startsWith('-'));\n      lines.forEach(line => {\n        // Parse \"- Name (email@domain.com)\" or \"- Name\"\n        const match = line.match(/^-\\s*(.+?)(?:\\s*\\(([^)]+)\\))?\\s*$/);\n        if (match) {\n          const name = match[1].trim();\n          const email = match[2] ? match[2].trim() : '';\n          if (name) {\n            participants.push({ name, email });\n          }\n        }\n      });\n    }\n    return participants;\n  }\n\n  // Parse summary body from SmartBrief (the ## SUMMARY section)\n  function parseSummaryBodyFromSummary(summaryText) {\n    const summaryMatch = summaryText.match(/## SUMMARY\\n([\\s\\S]*?)(?=\\n## |$)/);\n    if (summaryMatch) {\n      return summaryMatch[1].trim();\n    }\n    // Fallback: return everything after the first line\n    const lines = summaryText.split('\\n');\n    return lines.slice(1).join('\\n').trim();\n  }\n\n  // Detect task category from summary text using keywords\n  function detectCategoryFromSummary(summaryText) {\n    const text = summaryText.toLowerCase();\n    \n    // Check for specific keywords\n    if (text.includes('onboarding') || text.includes('new client') || text.includes('new account') || text.includes('account opening')) {\n      return 'Onboarding';\n    }\n    if (text.includes('kyc') || text.includes('know your customer') || text.includes('compliance') || text.includes('documents') || text.includes('documentation')) {\n      return 'KYC update';\n    }\n    if (text.includes('rate') || text.includes('pricing') || text.includes('amendment') || text.includes('amended') || text.includes('fee') || text.includes('commission')) {\n      return 'Amended Product/Rate';\n    }\n    if (text.includes('give-up') || text.includes('giveup') || text.includes('give up')) {\n      return 'Give-up';\n    }\n    \n    return null; // No clear category detected\n  }\n\n  // Match participants to team members (fuzzy match by name)\n  // IMPORTANT: Only LCMCommodities employees can be assignees\n  // External participants (non-lcmcommodities.com emails) are excluded\n  function matchParticipantsToTeamMembers(participants) {\n    const teamCheckboxes = Array.from(document.querySelectorAll('#assignees input[type=checkbox]'));\n    const teamNames = teamCheckboxes.map(cb => cb.value.toLowerCase());\n    const matched = [];\n    \n    // Filter to only LCMCommodities participants first\n    const lcmParticipants = participants.filter(p => {\n      if (!p.email) return false; // No email = can't verify, skip\n      const emailLower = p.email.toLowerCase();\n      return emailLower.endsWith('@lcmcommodities.com') || emailLower.endsWith('@lcmc.com');\n    });\n    \n    lcmParticipants.forEach(p => {\n      const pNameLower = p.name.toLowerCase();\n      // Try exact match first\n      let idx = teamNames.findIndex(t => t === pNameLower);\n      // Try partial match (first name)\n      if (idx === -1) {\n        const firstName = pNameLower.split(' ')[0];\n        idx = teamNames.findIndex(t => t.startsWith(firstName) || t.includes(firstName));\n      }\n      // Try email prefix match\n      if (idx === -1 && p.email) {\n        const emailPrefix = p.email.split('@')[0].toLowerCase();\n        idx = teamNames.findIndex(t => {\n          const tFirstName = t.split(' ')[0];\n          return emailPrefix.includes(tFirstName) || tFirstName.includes(emailPrefix);\n        });\n      }\n      if (idx !== -1) {\n        matched.push(teamCheckboxes[idx].value);\n      }\n    });\n    \n    return [...new Set(matched)]; // dedupe\n  }\n\n  // Store parsed SmartBrief data for \"Apply to Task\" action\n  let lastParsedSmartBrief = null;\n\n  async function fetchSmartBriefSummaryFromApi(company, initialRequest, introEmail, remindersStart) {\n    // Always use the direct API URL - this function is only called from localhost dev\n    const url = `${EMAIL_SUMMARIZER_API_URL}/api/task-manager/summaries/${encodeURIComponent(company)}`;\n\n    try {\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          initial_request: initialRequest,\n          intro_email: introEmail,\n          reminders_start: remindersStart,\n          threshold: SMARTBRIEF_MATCH_THRESHOLD\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Server returned ${response.status}`);\n      }\n\n      const data = await response.json();\n      const summaries = Array.isArray(data.summaries) ? data.summaries : [];\n      if (summaries.length === 0) return '';\n\n      const best = summaries[0] || {};\n      const subject = String(best.subject || 'No subject');\n      const summary = String(best.summary || '').trim();\n      const matchScore = typeof best.match_score === 'number' ? best.match_score : parseFloat(best.match_score);\n      const matchPercent = Number.isFinite(matchScore) ? Math.round(matchScore * 100) : 0;\n\n      if (!summary) return '';\n      return `[${matchPercent}% match] ${subject}\\n\\n${summary}`;\n    } catch (err) {\n      // Common failure modes: mixed content (https add-in calling http API) or CORS\n      const msg = err && err.message ? err.message : String(err);\n      showToast('SmartBrief API error: ' + msg, 'error');\n      return '';\n    }\n  }\n\n  // Track form changes\n  function wireChangeTracking() {\n    const formElements = qsa('input, select, textarea');\n    formElements.forEach(el => {\n      el.addEventListener('change', () => setUnsavedChanges(true));\n      el.addEventListener('input', () => setUnsavedChanges(true));\n    });\n    // Also track chip clicks\n    qsa('.chip').forEach(chip => {\n      chip.addEventListener('click', () => setUnsavedChanges(true));\n    });\n  }\n\n  // Warn before leaving with unsaved changes\n  window.addEventListener('beforeunload', (e) => {\n    if (hasUnsavedChanges) {\n      e.preventDefault();\n      e.returnValue = '';\n      return '';\n    }\n  });\n\n  // Escape HTML helper\n  function escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = String(text || '');\n    return div.innerHTML;\n  }\n\n  // Due date warning helper\n  function getDueDateWarningClass(deadlineStr) {\n    if (!deadlineStr) return '';\n    const deadline = new Date(deadlineStr);\n    if (isNaN(deadline.getTime())) return '';\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    deadline.setHours(0, 0, 0, 0);\n    const diffDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));\n    if (diffDays < 0) return 'overdue';\n    if (diffDays <= 3) return 'warning';\n    return '';\n  }\n\n  function formatDeadlineBadge(deadlineStr) {\n    const warningClass = getDueDateWarningClass(deadlineStr);\n    if (!warningClass) return '';\n    if (warningClass === 'overdue') {\n      return '<span class=\"deadline-badge overdue\"> Overdue</span>';\n    }\n    const deadline = new Date(deadlineStr);\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    deadline.setHours(0, 0, 0, 0);\n    const diffDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));\n    if (diffDays === 0) return '<span class=\"deadline-badge warning\"> Due today</span>';\n    if (diffDays === 1) return '<span class=\"deadline-badge warning\"> Due tomorrow</span>';\n    return `<span class=\"deadline-badge warning\"> ${diffDays} days left</span>`;\n  }\n\n  // Apply deadline warnings to task cards\n  function applyDeadlineWarnings() {\n    qsa('.task-card').forEach(card => {\n      const deadlineInput = card.querySelector('[data-role=\"deadline\"]');\n      if (!deadlineInput) return;\n      const deadline = deadlineInput.value;\n      const warningClass = getDueDateWarningClass(deadline);\n      card.classList.remove('deadline-warning', 'deadline-overdue');\n      if (warningClass === 'overdue') {\n        card.classList.add('deadline-overdue');\n      } else if (warningClass === 'warning') {\n        card.classList.add('deadline-warning');\n      }\n    });\n  }\n\n  const companyNameInput = qs('#companyName');\n  // taskDescriptionEl is now a container with checkboxes, not a select\n  const brokerLeadEl = qs('#brokerLead');\n  const initialRequestInput = qs('#initialRequest');\n  const introEmailInput = qs('#introEmail');\n  const remindersStartInput = qs('#remindersStart');\n  const emailFrequencyEl = qs('#emailFrequency');\n  const extraNoteEl = qs('#extraNote');\n  const auditTextEl = qs('#auditText');\n  const tasksRowEl = qs('#tasksRow');\n  const taskCardsContainer = qs('#taskCards');\n  const taskNameInput = qs('#taskName'); // only for __other__ card\n\n  // Wire Save, New Task, Load Selected, and KYC Portal buttons\n  const saveBtn = qs('#saveBtn');\n  const newTaskBtn = qs('#newTaskBtn');\n  const loadSelectedBtn = qs('#loadSelectedBtn');\n  const openKycPortalBtn = qs('#openKycPortal');\n\n  // Track current row for display\n  let currentRowNum = null;\n\n  if (saveBtn) {\n    saveBtn.addEventListener('click', async () => {\n      try {\n        // Check for missing fields before saving\n        const missingFields = checkMissingFields();\n\n        if (currentRowNum === null || currentRowNum === 'new') {\n          await addNewTask();\n          showToast(' New task added successfully!', 'success');\n        } else {\n          await saveToActiveRow();\n          showToast(' Changes saved to row ' + currentRowNum, 'success');\n        }\n        setUnsavedChanges(false);\n\n        // Show missing fields warning after successful save\n        if (missingFields.length > 0) {\n          setTimeout(() => {\n            showMissingFieldsWarning(missingFields);\n          }, 500); // Delay to let the success toast show first\n        }\n      } catch (e) {\n        console.error('Save error:', e);\n        showToast(' Save failed: ' + e.message, 'error');\n      }\n    });\n  }\n\n  // Load Selected Row button (in By Row tab)\n  if (loadSelectedBtn) {\n    loadSelectedBtn.addEventListener('click', async () => {\n      try {\n        await loadFromActiveRow();\n        showToast(' Loaded row ' + currentRowNum, 'success');\n      } catch (e) {\n        console.error('Load error:', e);\n        showToast(' Failed to load row', 'error');\n      }\n    });\n  }\n\n  if (newTaskBtn) {\n    newTaskBtn.addEventListener('click', () => {\n      clearFormForNewTask();\n    });\n  }\n\n  // Custom confirm dialog (since window.confirm is not supported in Office Add-ins)\n  function showConfirmDialog(message) {\n    return new Promise((resolve) => {\n      const dialog = qs('#confirmDialog');\n      const msgEl = qs('#confirmMessage');\n      const cancelBtn = qs('#confirmCancel');\n      const okBtn = qs('#confirmOk');\n      \n      if (!dialog || !msgEl || !cancelBtn || !okBtn) {\n        resolve(false);\n        return;\n      }\n      \n      msgEl.textContent = message;\n      dialog.style.display = 'flex';\n      \n      const cleanup = () => {\n        dialog.style.display = 'none';\n        cancelBtn.removeEventListener('click', onCancel);\n        okBtn.removeEventListener('click', onOk);\n      };\n      \n      const onCancel = () => {\n        cleanup();\n        resolve(false);\n      };\n      \n      const onOk = () => {\n        cleanup();\n        resolve(true);\n      };\n      \n      cancelBtn.addEventListener('click', onCancel);\n      okBtn.addEventListener('click', onOk);\n    });\n  }\n\n  // Delete Task button\n  const deleteTaskBtn = qs('#deleteTaskBtn');\n  if (deleteTaskBtn) {\n    deleteTaskBtn.addEventListener('click', async () => {\n      // Don't allow delete if this is a new unsaved task\n      if (currentRowNum === null || currentRowNum === 'new') {\n        showToast('No task to delete - this is a new task', 'error');\n        return;\n      }\n      \n      // Confirm before deleting\n      const confirmed = await showConfirmDialog('Are you sure you want to delete this Task?');\n      if (!confirmed) return;\n      \n      try {\n        await deleteCurrentRow();\n        showToast(' Task deleted successfully', 'success');\n        clearFormForNewTask();\n      } catch (e) {\n        console.error('Delete error:', e);\n        showToast(' Failed to delete task: ' + e.message, 'error');\n      }\n    });\n  }\n\n  // Guard on the DOM element so we don't wire multiple listeners or open twice\n  if (openKycPortalBtn && openKycPortalBtn.dataset.kycListenerAttached !== '1') {\n    openKycPortalBtn.dataset.kycListenerAttached = '1';\n    openKycPortalBtn.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      if (openKycPortalBtn.dataset.kycOpening === '1') return;\n      openKycPortalBtn.dataset.kycOpening = '1';\n      window.open('http://192.168.1.141:8080/', '_blank');\n      setTimeout(() => { openKycPortalBtn.dataset.kycOpening = '0'; }, 1000);\n    });\n  }\n\n  // Statistics Navigation\n  const tasksView = qs('#tasksView');\n  const statsView = qs('#statsView');\n  const tasksHeader = qs('#tasksHeader');\n  const statsHeader = qs('#statsHeader');\n  const openStatsBtn = qs('#openStatsBtn');\n  const returnToTasksBtn = qs('#returnToTasksBtn');\n  const refreshStatsBtn = qs('#refreshStatsBtn');\n\n  if (openStatsBtn) {\n    openStatsBtn.addEventListener('click', () => {\n      if (tasksView) tasksView.style.display = 'none';\n      if (tasksHeader) tasksHeader.style.display = 'none';\n      if (statsView) statsView.style.display = '';\n      if (statsHeader) statsHeader.style.display = 'flex';\n      loadStatistics();\n    });\n  }\n\n  if (returnToTasksBtn) {\n    returnToTasksBtn.addEventListener('click', () => {\n      if (tasksView) tasksView.style.display = '';\n      if (tasksHeader) tasksHeader.style.display = 'flex';\n      if (statsView) statsView.style.display = 'none';\n      if (statsHeader) statsHeader.style.display = 'none';\n    });\n  }\n\n  if (refreshStatsBtn) {\n    refreshStatsBtn.addEventListener('click', () => {\n      loadStatistics();\n    });\n  }\n\n  // Statistics calculation\n  async function loadStatistics() {\n    try {\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n        if (sheet.isNullObject) {\n          console.error('Sheet not found for statistics');\n          return;\n        }\n\n        // Load all data\n        const dataRange = sheet.getRange('A1:K5000');\n        dataRange.load('values');\n        await context.sync();\n\n        const rows = dataRange.values || [];\n        if (rows.length < 2) return;\n\n        // Parse all tasks\n        const tasks = [];\n        let todoCount = 0, inProgressCount = 0, doneCount = 0;\n        const brokerStats = {};\n        const monthlyStats = {};\n        const kycMonthly = {};\n        let totalDuration = 0, durationCount = 0;\n        \n        // Attention items with details\n        const overdueItems = [];\n        const upcomingItems = [];\n        const staleItems = [];\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const sevenDaysFromNow = new Date(today);\n        sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7);\n        const thirtyDaysAgo = new Date(today);\n        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n        for (let i = 1; i < rows.length; i++) {\n          const row = rows[i];\n          const company = row[0] ? String(row[0]).trim() : '';\n          if (!company) continue;\n\n          const category = row[1] ? String(row[1]).trim() : '';\n          const broker = row[3] ? String(row[3]).trim() : '(none)';\n          const initialRequest = row[4]; // Column E - Initial Request Date\n          const introEmail = row[5]; // Column F - Intro Email Date\n          const remindersStart = row[6]; // Column G - Reminders Start Date\n          const taskSummary = row[7] ? String(row[7]).trim() : '';\n\n          // Parse dates from columns E, F, G for monthly stats\n          // Use the earliest available date as the task creation date\n          let taskDate = null;\n          const dateE = parseDate(initialRequest);\n          const dateF = parseDate(introEmail);\n          const dateG = parseDate(remindersStart);\n          \n          // Pick the earliest non-null date\n          const availableDates = [dateE, dateF, dateG].filter(d => d !== null);\n          if (availableDates.length > 0) {\n            taskDate = availableDates.reduce((min, d) => d < min ? d : min);\n          }\n          \n          if (taskDate) {\n            const monthKey = `${taskDate.getFullYear()}-${String(taskDate.getMonth() + 1).padStart(2, '0')}`;\n            monthlyStats[monthKey] = (monthlyStats[monthKey] || 0) + 1;\n          }\n\n          // Broker stats\n          if (!brokerStats[broker]) {\n            brokerStats[broker] = { total: 0, active: 0, completed: 0 };\n          }\n          brokerStats[broker].total++;\n\n          // Parse task summary for status\n          if (taskSummary) {\n            const lines = taskSummary.split(/\\r?\\n/).filter(Boolean);\n            lines.forEach(line => {\n              const lower = line.toLowerCase();\n              \n              // Count statuses\n              if (lower.includes(': to do')) {\n                todoCount++;\n                brokerStats[broker].active++;\n              } else if (lower.includes(': in progress')) {\n                inProgressCount++;\n                brokerStats[broker].active++;\n              } else if (lower.includes(': done')) {\n                doneCount++;\n                brokerStats[broker].completed++;\n              }\n\n              // Check for KYC completed\n              if (lower.includes('kyc') && lower.includes(': done')) {\n                const completedMatch = line.match(/completed:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                if (completedMatch) {\n                  const kycDate = parseDate(completedMatch[1]);\n                  if (kycDate) {\n                    const monthKey = `${kycDate.getFullYear()}-${String(kycDate.getMonth() + 1).padStart(2, '0')}`;\n                    kycMonthly[monthKey] = (kycMonthly[monthKey] || 0) + 1;\n                  }\n                }\n              }\n\n              // Extract task name and assignee for attention items\n              const taskNameMatch = line.match(/^(.*?)\\s*:\\s*(to do|in progress|done)/i);\n              const assigneeMatch = line.match(/assigned to\\s+([^|]+)/i);\n              const taskName = taskNameMatch ? taskNameMatch[1].trim() : 'Unknown';\n              const assignee = assigneeMatch ? assigneeMatch[1].trim() : '';\n\n              // Check deadlines (support both formats)\n              const deadlineMatch = line.match(/deadline:\\s*(\\d{4}-\\d{2}-\\d{2}|\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n              if (deadlineMatch && !lower.includes(': done')) {\n                const deadline = parseDate(deadlineMatch[1]);\n                if (deadline) {\n                  const daysUntil = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));\n                  if (deadline < today) {\n                    overdueItems.push({\n                      company,\n                      task: taskName,\n                      assignee,\n                      detail: `${Math.abs(daysUntil)}d overdue`\n                    });\n                  } else if (deadline <= sevenDaysFromNow) {\n                    upcomingItems.push({\n                      company,\n                      task: taskName,\n                      assignee,\n                      detail: daysUntil === 0 ? 'Today' : `${daysUntil}d left`\n                    });\n                  }\n                }\n              }\n\n              // Check for stale tasks (no status update for 30+ days, not Done)\n              if (!lower.includes(': done')) {\n                // Look for the last action date (initiated, updated, or completed)\n                const initiatedMatch = line.match(/initiated:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                const updatedMatch = line.match(/updated:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                \n                let lastActionDate = null;\n                if (updatedMatch) {\n                  lastActionDate = parseDate(updatedMatch[1]);\n                } else if (initiatedMatch) {\n                  lastActionDate = parseDate(initiatedMatch[1]);\n                }\n                \n                if (lastActionDate && lastActionDate < thirtyDaysAgo) {\n                  const daysSince = Math.ceil((today - lastActionDate) / (1000 * 60 * 60 * 24));\n                  staleItems.push({\n                    company,\n                    task: taskName,\n                    assignee,\n                    detail: `${daysSince}d ago`\n                  });\n                }\n              }\n\n              // Calculate duration for completed tasks\n              if (lower.includes(': done')) {\n                const initiatedMatch = line.match(/initiated:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                const completedMatch = line.match(/completed:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                if (initiatedMatch && completedMatch) {\n                  const initiated = parseDate(initiatedMatch[1]);\n                  const completed = parseDate(completedMatch[1]);\n                  if (initiated && completed) {\n                    const days = Math.ceil((completed - initiated) / (1000 * 60 * 60 * 24));\n                    if (days >= 0 && days < 365) {\n                      totalDuration += days;\n                      durationCount++;\n                    }\n                  }\n                }\n              }\n            });\n          }\n        }\n\n        // Update UI\n        const activeTasks = todoCount + inProgressCount;\n        qs('#statActiveTasks').textContent = activeTasks;\n        qs('#statAvgDuration').textContent = durationCount > 0 ? Math.round(totalDuration / durationCount) : '-';\n\n        // Status bars\n        const totalStatus = todoCount + inProgressCount + doneCount;\n        if (totalStatus > 0) {\n          qs('#barToDo').style.width = (todoCount / totalStatus * 100) + '%';\n          qs('#barInProgress').style.width = (inProgressCount / totalStatus * 100) + '%';\n          qs('#barDone').style.width = (doneCount / totalStatus * 100) + '%';\n        }\n        qs('#countToDo').textContent = todoCount;\n        qs('#countInProgress').textContent = inProgressCount;\n        qs('#countDone').textContent = doneCount;\n\n        // Attention Required section - render counts and task lists\n        // Helper to render attention items and show/hide group\n        const renderAttentionGroup = (items, groupId, listId, countId) => {\n          const group = qs(`#${groupId}`);\n          const container = qs(`#${listId}`);\n          const countEl = qs(`#${countId}`);\n          \n          if (countEl) countEl.textContent = items.length;\n          \n          if (!group || !container) return;\n          \n          if (items.length === 0) {\n            group.classList.remove('has-items');\n            container.innerHTML = '';\n            return;\n          }\n          \n          group.classList.add('has-items');\n          // Format: \"Company: Task to Assignee\" with detail on right\n          container.innerHTML = items.slice(0, 10).map(item => {\n            const assigneePart = item.assignee ? ` <span class=\"to-assignee\">to ${escapeHtml(item.assignee)}</span>` : '';\n            return `<div class=\"attention-item\">\n              <span class=\"task-info\" title=\"${escapeHtml(item.company)}: ${escapeHtml(item.task)}\">${escapeHtml(item.company)}: ${escapeHtml(item.task)}${assigneePart}</span>\n              <span class=\"task-detail\">${escapeHtml(item.detail)}</span>\n            </div>`;\n          }).join('');\n        };\n        \n        // Sort and render each list\n        overdueItems.sort((a, b) => parseInt(b.detail) - parseInt(a.detail)); // Most overdue first\n        upcomingItems.sort((a, b) => parseInt(a.detail) - parseInt(b.detail)); // Soonest first\n        staleItems.sort((a, b) => parseInt(b.detail) - parseInt(a.detail)); // Oldest first\n        \n        renderAttentionGroup(overdueItems, 'overdueGroup', 'overdueList', 'statOverdue');\n        renderAttentionGroup(upcomingItems, 'upcomingGroup', 'upcomingList', 'statUpcoming');\n        renderAttentionGroup(staleItems, 'staleGroup', 'staleList', 'statStale');\n\n        // Monthly Activity Visual Chart\n        const monthlyChart = qs('#monthlyChart');\n        if (monthlyChart) {\n          const sortedMonths = Object.keys(monthlyStats).sort().reverse().slice(0, 6).reverse();\n          const maxTasks = Math.max(...sortedMonths.map(m => monthlyStats[m] || 0), 1);\n          const maxKyc = Math.max(...sortedMonths.map(m => kycMonthly[m] || 0), 1);\n          const maxVal = Math.max(maxTasks, maxKyc);\n          \n          const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n          monthlyChart.innerHTML = sortedMonths.map(month => {\n            const [year, m] = month.split('-');\n            const shortMonth = monthNames[parseInt(m) - 1];\n            const tasks = monthlyStats[month] || 0;\n            const kyc = kycMonthly[month] || 0;\n            const taskHeight = maxVal > 0 ? (tasks / maxVal * 80) : 0;\n            const kycHeight = maxVal > 0 ? (kyc / maxVal * 80) : 0;\n            return `<div class=\"month-bar-group\">\n              <div class=\"month-bars\">\n                <div class=\"month-bar tasks\" style=\"height:${taskHeight}px\">\n                  ${tasks > 0 ? `<span class=\"month-bar-value\">${tasks}</span>` : ''}\n                </div>\n                <div class=\"month-bar kyc\" style=\"height:${kycHeight}px\">\n                  ${kyc > 0 ? `<span class=\"month-bar-value\">${kyc}</span>` : ''}\n                </div>\n              </div>\n              <div class=\"month-bar-label\">${shortMonth}</div>\n            </div>`;\n          }).join('');\n        }\n\n        // Broker Activity Visual Chart - Horizontal Bars like Status Distribution\n        const brokerChart = qs('#brokerChart');\n        if (brokerChart) {\n          const sortedBrokers = Object.entries(brokerStats)\n            .filter(([name]) => name && name !== '(none)' && name.trim() !== '')\n            .sort((a, b) => (b[1].active + b[1].completed) - (a[1].active + a[1].completed));\n          // Find max for scaling (active + completed combined)\n          const maxTasks = Math.max(...sortedBrokers.map(([,s]) => s.active + s.completed), 1);\n          \n          brokerChart.innerHTML = sortedBrokers.map(([name, stats]) => {\n            const activeWidth = maxTasks > 0 ? (stats.active / maxTasks * 100) : 0;\n            const completedWidth = maxTasks > 0 ? (stats.completed / maxTasks * 100) : 0;\n            return `<div class=\"broker-row\">\n              <span class=\"broker-name\" title=\"${escapeHtml(name)}\">${escapeHtml(name)}</span>\n              <div class=\"broker-bar-track\">\n                <div class=\"broker-bar-fill active\" style=\"width:${activeWidth}%\">${stats.active > 0 ? `<span class=\"bar-num\">${stats.active}</span>` : ''}</div>\n                <div class=\"broker-bar-fill completed\" style=\"width:${completedWidth}%\">${stats.completed > 0 ? `<span class=\"bar-num\">${stats.completed}</span>` : ''}</div>\n              </div>\n            </div>`;\n          }).join('');\n        }\n      });\n    } catch (e) {\n      console.error('Error loading statistics:', e);\n    }\n  }\n\n  // Helper to parse various date formats including Excel serial numbers\n  // Fix for timezone-related date parsing bug\n  // When parsing yyyy-MM-dd strings, JavaScript interprets them as UTC midnight.\n  // This can cause day shifts when the local timezone is behind UTC.\n  function parseDate(dateVal) {\n    if (!dateVal) return null;\n    \n    // Check if it's an Excel serial number (numeric value)\n    // Excel dates are days since Jan 1, 1900 (with a bug for 1900 leap year)\n    if (typeof dateVal === 'number' && dateVal > 1 && dateVal < 100000) {\n      // Excel serial date: days since Dec 30, 1899 (accounting for Excel's leap year bug)\n      // Use UTC to avoid timezone issues, then create local date\n      const excelEpoch = Date.UTC(1899, 11, 30); // Dec 30, 1899 in UTC\n      const utcDate = new Date(excelEpoch + dateVal * 24 * 60 * 60 * 1000);\n      // Create a local date with the same year/month/day\n      const result = new Date(utcDate.getUTCFullYear(), utcDate.getUTCMonth(), utcDate.getUTCDate());\n      if (!isNaN(result.getTime()) && result.getFullYear() > 1970) {\n        return result;\n      }\n    }\n    \n    // Try as string\n    const dateStr = String(dateVal).trim();\n    \n    // Handle yyyy-MM-dd format (ISO) - parse directly to avoid timezone issues\n    const isoMatch = dateStr.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (isoMatch) {\n      const year = parseInt(isoMatch[1], 10);\n      const month = parseInt(isoMatch[2], 10) - 1; // 0-indexed\n      const day = parseInt(isoMatch[3], 10);\n      return new Date(year, month, day);\n    }\n    \n    // Try d-MMM-yyyy format (e.g., \"15-Nov-2025\")\n    const match = dateStr.match(/(\\d{1,2})[-\\s]([A-Za-z]{3})[-\\s](\\d{2,4})/);\n    if (match) {\n      const months = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};\n      const day = parseInt(match[1]);\n      const month = months[match[2].toLowerCase()];\n      let year = parseInt(match[3]);\n      if (year < 100) year += 2000;\n      if (month !== undefined) {\n        return new Date(year, month, day);\n      }\n    }\n    \n    // Fallback: try native parsing (but this may have timezone issues)\n    let d = new Date(dateStr);\n    if (!isNaN(d.getTime()) && d.getFullYear() > 1970) return d;\n    \n    return null;\n  }\n\n  // Search functionality\n  const searchInput = qs('#searchInput');\n  const searchInputWrap = qs('#searchInputWrap');\n  const searchBtn = qs('#searchBtn');\n  const searchResults = qs('#searchResults');\n  const searchHint = qs('#searchHint');\n  const searchTabs = qsa('.search-tab');\n  let currentSearchMode = 'active'; // Default to active tasks\n\n  // Update search UI based on mode\n  const loadRowHint = qs('#loadRowHint');\n  \n  function updateSearchUI() {\n    if (!searchHint || !searchInput || !searchInputWrap) return;\n    \n    if (currentSearchMode === 'active') {\n      searchInputWrap.style.display = 'none'; // No input needed\n      if (loadRowHint) loadRowHint.style.display = 'none';\n      searchHint.textContent = ' Showing tasks with status: To Do or In Progress';\n    } else if (currentSearchMode === 'company') {\n      searchInputWrap.style.display = 'flex';\n      if (loadRowHint) loadRowHint.style.display = 'flex';\n      searchInput.placeholder = 'Type company name...';\n      searchInput.type = 'text';\n      searchHint.textContent = '';\n    }\n  }\n\n  // Search tab switching\n  searchTabs.forEach(tab => {\n    tab.addEventListener('click', async () => {\n      searchTabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentSearchMode = tab.getAttribute('data-search');\n      if (searchInput) {\n        searchInput.value = '';\n      }\n      updateSearchUI();\n      \n      // Auto-load active tasks when that tab is selected\n      if (currentSearchMode === 'active') {\n        await performSearch();\n      } else {\n        // Clear results for other modes until user searches\n        if (searchResults) {\n          searchResults.classList.remove('visible');\n          searchResults.innerHTML = '';\n        }\n      }\n    });\n  });\n\n  // Search button click\n  if (searchBtn) {\n    searchBtn.addEventListener('click', async () => {\n      await performSearch();\n    });\n  }\n\n  // Enter key in search input\n  if (searchInput) {\n    searchInput.addEventListener('keypress', async (e) => {\n      if (e.key === 'Enter') {\n        hideAutocomplete();\n        await performSearch();\n      }\n    });\n  }\n\n  // Autocomplete for company search\n  const autocompleteDropdown = qs('#autocompleteDropdown');\n  let companyList = []; // Cache of all companies with row numbers\n  let autocompleteTimeout = null;\n\n  // Load all companies for autocomplete (includes ALL rows, not just unique companies)\n  async function loadCompanyList() {\n    if (companyList.length > 0) return; // Already loaded\n    try {\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n        if (sheet.isNullObject) return;\n\n        // Load columns A (company) and B (task category) to differentiate multiple rows\n        const dataRange = sheet.getRange('A2:B5000');\n        dataRange.load('values');\n        await context.sync();\n\n        const values = dataRange.values || [];\n        companyList = [];\n        for (let i = 0; i < values.length; i++) {\n          const name = values[i][0] ? String(values[i][0]).trim() : '';\n          const category = values[i][1] ? String(values[i][1]).trim() : '';\n          if (name) {\n            companyList.push({ name, category, rowNum: i + 2 });\n          }\n        }\n        // Keep ALL entries - don't remove duplicates so users can see all tasks for a company\n        console.log('Loaded', companyList.length, 'company rows for autocomplete');\n      });\n    } catch (e) {\n      console.error('Failed to load company list:', e);\n    }\n  }\n\n  function showAutocomplete(query) {\n    if (!autocompleteDropdown || !query || currentSearchMode !== 'company') {\n      hideAutocomplete();\n      return;\n    }\n    const q = query.toLowerCase();\n    \n    // Filter matches and sort: companies starting with query first, then contains\n    const allMatches = companyList.filter(c => c.name.toLowerCase().includes(q));\n    const startsWithMatches = allMatches.filter(c => c.name.toLowerCase().startsWith(q));\n    const containsMatches = allMatches.filter(c => !c.name.toLowerCase().startsWith(q));\n    const sortedMatches = [...startsWithMatches, ...containsMatches].slice(0, 15);\n    \n    if (sortedMatches.length === 0) {\n      hideAutocomplete();\n      return;\n    }\n    autocompleteDropdown.innerHTML = sortedMatches.map(c => {\n      const categoryHint = c.category ? `  ${escapeHtml(c.category)}` : '';\n      return `<div class=\"autocomplete-item\" data-row=\"${c.rowNum}\" data-name=\"${escapeHtml(c.name)}\">\n        <span class=\"company-name\">${escapeHtml(c.name)}</span>\n        <span class=\"row-hint\">Row ${c.rowNum}${categoryHint}</span>\n      </div>`;\n    }).join('');\n    autocompleteDropdown.classList.add('visible');\n\n    // Wire click handlers\n    autocompleteDropdown.querySelectorAll('.autocomplete-item').forEach(item => {\n      item.addEventListener('click', async () => {\n        const rowNum = parseInt(item.getAttribute('data-row'), 10);\n        const name = item.getAttribute('data-name');\n        if (searchInput) searchInput.value = name;\n        hideAutocomplete();\n        await selectAndLoadRow(rowNum);\n      });\n    });\n  }\n\n  function hideAutocomplete() {\n    if (autocompleteDropdown) {\n      autocompleteDropdown.classList.remove('visible');\n      autocompleteDropdown.innerHTML = '';\n    }\n  }\n\n  // Wire autocomplete on input\n  if (searchInput) {\n    searchInput.addEventListener('input', (e) => {\n      if (currentSearchMode !== 'company') return;\n      clearTimeout(autocompleteTimeout);\n      const val = e.target.value.trim();\n      if (val.length < 1) {\n        hideAutocomplete();\n        return;\n      }\n      // Debounce to avoid too many updates\n      autocompleteTimeout = setTimeout(() => {\n        showAutocomplete(val);\n      }, 150);\n    });\n\n    searchInput.addEventListener('focus', async () => {\n      if (currentSearchMode === 'company') {\n        await loadCompanyList();\n        if (searchInput.value.trim().length >= 1) {\n          showAutocomplete(searchInput.value.trim());\n        }\n      }\n    });\n\n    searchInput.addEventListener('blur', () => {\n      // Delay hide to allow click on dropdown\n      setTimeout(hideAutocomplete, 200);\n    });\n  }\n\n  // Initialize search UI on load\n  updateSearchUI();\n\n  async function performSearch() {\n    if (!searchResults) return;\n    \n    searchResults.innerHTML = '<div class=\"no-results\">Searching...</div>';\n    searchResults.classList.add('visible');\n    console.log('Search started, mode:', currentSearchMode);\n\n    try {\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n        console.log('Sheet found:', !sheet.isNullObject);\n        if (sheet.isNullObject) {\n          searchResults.innerHTML = '<div class=\"no-results\">Sheet not found</div>';\n          return;\n        }\n\n        // Read a fixed block of rows to avoid issues with usedRange returning too small an area.\n        const maxRows = 5000;\n        const dataRange = sheet.getRange(`A1:K${maxRows}`);\n        dataRange.load('values');\n        await context.sync();\n\n        const rawValues = dataRange.values || [];\n        console.log('Raw rows loaded (including header and blanks):', rawValues.length);\n\n        const values = Array.isArray(rawValues) ? rawValues : [];\n        const results = [];\n        let scannedRows = 0;\n\n        for (let i = 1; i < values.length; i++) { // Skip header row\n          const row = values[i] || [];\n          const isEmpty = row.every(c => c === null || c === '');\n          if (isEmpty) continue;\n          scannedRows++;\n          const companyName = row[0] ? String(row[0]).trim() : '';\n          const taskCategory = row[1] ? String(row[1]).trim() : '';\n          const taskSummary = row[7] ? String(row[7]).trim() : ''; // Column H\n\n          // Determine status and dates from Column H\n          let hasActiveTasks = false;\n          let dominantStatus = 'unknown';\n          let hasTodo = false, hasProgress = false, hasDone = false;\n          let todoDates = [];\n          let progressDates = [];\n          let doneDates = [];\n\n          if (taskSummary) {\n            const lines = taskSummary.split(/\\r?\\n/).filter(Boolean);\n            lines.forEach(line => {\n              const parsed = parseTaskLine(line);\n              if (!parsed) return;\n              const st = (parsed.status || '').toLowerCase();\n              if (st === 'to do') {\n                hasTodo = true;\n                if (parsed.initiated) todoDates.push(parsed.initiated);\n              } else if (st === 'in progress') {\n                hasProgress = true;\n                if (parsed.updated) progressDates.push(parsed.updated);\n              } else if (st === 'done') {\n                hasDone = true;\n                if (parsed.completed) doneDates.push(parsed.completed);\n              }\n            });\n            hasActiveTasks = hasTodo || hasProgress;\n            if (hasProgress) dominantStatus = 'progress';\n            else if (hasTodo) dominantStatus = 'todo';\n            else if (hasDone) dominantStatus = 'done';\n          }\n\n          // Choose a status-specific date to display\n          function mostRecentDate(dateArr) {\n            if (!dateArr || dateArr.length === 0) return '';\n            let best = null;\n            dateArr.forEach(dStr => {\n              if (!dStr) return;\n              const d = new Date(dStr);\n              if (isNaN(d.getTime())) return;\n              if (!best || d > best) best = d;\n            });\n            if (!best) return '';\n            const yyyy = best.getFullYear();\n            const mm = String(best.getMonth() + 1).padStart(2,'0');\n            const dd = String(best.getDate()).padStart(2,'0');\n            return `${yyyy}-${mm}-${dd}`; // normalized for display formatter\n          }\n\n          let statusDateLabel = '';\n          let statusDateRaw = '';\n          if (dominantStatus === 'progress') {\n            statusDateRaw = mostRecentDate(progressDates);\n            statusDateLabel = statusDateRaw ? 'Updated' : '';\n          } else if (dominantStatus === 'todo') {\n            statusDateRaw = mostRecentDate(todoDates);\n            statusDateLabel = statusDateRaw ? 'Initiated' : '';\n          } else if (dominantStatus === 'done') {\n            statusDateRaw = mostRecentDate(doneDates);\n            statusDateLabel = statusDateRaw ? 'Completed' : '';\n          }\n\n          const statusDateDisplay = statusDateRaw ? formatDateForDisplay(statusDateRaw) : '';\n\n          const rowNum = i + 1; // 1-based row number\n\n          if (currentSearchMode === 'company') {\n            const query = (searchInput ? searchInput.value : '').toLowerCase().trim();\n            console.log('Checking row', rowNum, '- Company:', companyName, '- Query:', query);\n            if (query && companyName.toLowerCase().includes(query)) {\n              console.log('Match found:', companyName);\n              results.push({ rowNum, companyName, taskCategory, dominantStatus, hasActiveTasks, statusDateLabel, statusDateDisplay });\n            }\n          } else if (currentSearchMode === 'active') {\n            console.log('Checking row', rowNum, '- Company:', companyName, '- Active:', hasActiveTasks);\n            if (hasActiveTasks) {\n              results.push({ rowNum, companyName, taskCategory, dominantStatus, hasActiveTasks, statusDateLabel, statusDateDisplay });\n            }\n          }\n        }\n\n        const totalRows = scannedRows;\n        const modeLabel = currentSearchMode === 'company' ? 'Company' : 'Active tasks';\n        const rawQuery = (searchInput ? searchInput.value : '').trim();\n        console.log('Search complete, mode:', modeLabel, 'rows scanned:', totalRows, 'matches:', results.length, 'query:', rawQuery);\n        if (results.length === 0) {\n          searchResults.innerHTML = '<div class=\"no-results\">No results found</div>';\n        } else {\n          searchResults.innerHTML = results.map(r => {\n            const statusBadge = r.dominantStatus === 'progress' \n              ? '<span class=\"status-badge progress\">In Progress</span>'\n              : r.dominantStatus === 'todo'\n              ? '<span class=\"status-badge todo\">To Do</span>'\n              : r.dominantStatus === 'done'\n              ? '<span class=\"status-badge done\">Done</span>'\n              : '';\n\n            const datePart = (r.statusDateLabel && r.statusDateDisplay)\n              ? `  ${r.statusDateLabel} ${escapeHtml(r.statusDateDisplay)}`\n              : '';\n\n            return `<div class=\"search-result-item\" data-row=\"${r.rowNum}\">\n              <div class=\"company\">${escapeHtml(r.companyName || '(No name)')}${statusBadge}</div>\n              <div class=\"meta\">Row ${r.rowNum}  ${escapeHtml(r.taskCategory || 'No category')}${datePart}</div>\n            </div>`;\n          }).join('');\n\n          // Wire click handlers\n          searchResults.querySelectorAll('.search-result-item').forEach(item => {\n            item.addEventListener('click', async () => {\n              const rowNum = parseInt(item.getAttribute('data-row'), 10);\n              await selectAndLoadRow(rowNum);\n              searchResults.classList.remove('visible');\n            });\n          });\n        }\n      });\n    } catch (e) {\n      console.error('Search error:', e);\n      searchResults.innerHTML = '<div class=\"no-results\">Search error</div>';\n    }\n  }\n\n  async function selectAndLoadRow(rowNum) {\n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return;\n\n      const targetRange = sheet.getRange(`A${rowNum}`);\n      targetRange.select();\n      await context.sync();\n    });\n    await loadFromActiveRow();\n  }\n\n  // Find Last KYC Produced date for a company\n  async function findLastKycDate(companyName) {\n    if (!companyName) return null;\n    \n    return Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return null;\n\n      const usedRange = sheet.getUsedRange();\n      usedRange.load('values');\n      await context.sync();\n\n      const values = usedRange.values || [];\n      let lastKycDate = null;\n\n      for (let i = 1; i < values.length; i++) {\n        const row = values[i];\n        const rowCompany = row[0] ? String(row[0]).trim().toLowerCase() : '';\n        const taskSummary = row[7] ? String(row[7]).trim() : ''; // Column H\n\n        if (rowCompany === companyName.toLowerCase() && taskSummary) {\n          // Look for KYC task with Done status\n          const lines = taskSummary.split(/\\r?\\n/).filter(Boolean);\n          lines.forEach(line => {\n            const lower = line.toLowerCase();\n            if ((lower.includes('kyc') && lower.includes(': done'))) {\n              // Try to extract completed date\n              const completedMatch = line.match(/completed:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n              if (completedMatch) {\n                lastKycDate = completedMatch[1];\n              }\n            }\n          });\n        }\n      }\n      return lastKycDate;\n    });\n  }\n\n  // Format date as d-MMM-yyyy (e.g., 1-Jul-2025)\n  // Fix for timezone-related date shift bug\n  // When parsing yyyy-MM-dd strings, JavaScript interprets them as UTC midnight.\n  // This can cause day shifts when converting back to local time.\n  function formatDateForDisplay(dateStr) {\n    if (!dateStr) return '';\n    \n    // Handle yyyy-MM-dd format specially to avoid timezone issues\n    const ymdMatch = String(dateStr).match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (ymdMatch) {\n      // Parse components directly to avoid UTC interpretation\n      const year = parseInt(ymdMatch[1], 10);\n      const month = parseInt(ymdMatch[2], 10) - 1; // 0-indexed\n      const day = parseInt(ymdMatch[3], 10);\n      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n      return `${day}-${months[month]}-${year}`;\n    }\n    \n    // For other formats, use Date parsing\n    const d = new Date(dateStr);\n    if (isNaN(d.getTime())) return '';\n    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    const day = d.getDate();\n    const month = months[d.getMonth()];\n    const year = d.getFullYear();\n    return `${day}-${month}-${year}`;\n  }\n  \n  // Alias for Excel output (same format)\n  const formatDateForExcel = formatDateForDisplay;\n\n  // Get selected task categories\n  function getSelectedCategories() {\n    return qsa('#taskCategories .category-toggle:checked').map(cb => cb.value);\n  }\n\n  // Check if \"Other Task\" is selected\n  function isOtherTaskSelected() {\n    const cb = qs('#taskCategories .category-toggle[value=\"Other Task\"]');\n    return cb && cb.checked;\n  }\n\n  function getTaskCard(taskName){\n    // __other__ card is now outside #taskCards\n    if (taskName === '__other__') {\n      return qs('#otherTaskCard');\n    }\n    return taskCardsContainer ? taskCardsContainer.querySelector(`.task-card[data-task=\"${taskName}\"]`) : null;\n  }\n\n  function getTaskStatusChips(card){\n    if (!card) return [];\n    const container = card.querySelector('[data-role=\"status-chips\"]');\n    return container ? Array.from(container.querySelectorAll('.chip')) : [];\n  }\n\n  function setCardStatus(card, val){\n    const chips = getTaskStatusChips(card);\n    chips.forEach(c=>{\n      c.classList.toggle('active', c.getAttribute('data-value')===val);\n    });\n  }\n\n  function getCardStatus(card){\n    const chips = getTaskStatusChips(card);\n    const active = chips.find(c=>c.classList.contains('active'));\n    return active ? active.getAttribute('data-value') : 'To Do';\n  }\n\n  function wireCardChips(){\n    // Wire chips in #taskCards and #otherTaskCard\n    qsa('#taskCards [data-role=\"status-chips\"] .chip, #otherTaskCard [data-role=\"status-chips\"] .chip').forEach(chip => {\n      chip.addEventListener('click', () => {\n        const container = chip.closest('[data-role=\"status-chips\"]');\n        if (!container) return;\n        const siblings = Array.from(container.querySelectorAll('.chip'));\n        siblings.forEach(c=>{\n          c.classList.toggle('active', c === chip);\n        });\n      });\n    });\n  }\n\n  function syncTasksVisibility(){\n    if (!tasksRowEl || !taskCardsContainer) return;\n    const isOther = isOtherTaskSelected();\n    const otherCard = qs('#otherTaskCard'); // Now outside #taskCards\n    const selectedCategories = getSelectedCategories();\n    const hasNonOtherCategory = selectedCategories.some(c => c !== 'Other Task');\n\n    // Show tasks section if any non-\"Other Task\" category is selected\n    if (hasNonOtherCategory) {\n      tasksRowEl.style.display = '';\n    } else {\n      tasksRowEl.style.display = 'none';\n    }\n\n    // Show/hide fixed task cards based on task toggles\n    const selected = new Set(getSelectedTaskToggles());\n    const fixedCards = qsa('#taskCards .task-card');\n    fixedCards.forEach(card => {\n      const name = card.getAttribute('data-task');\n      card.style.display = selected.has(name) ? '' : 'none';\n    });\n\n    // Show __other__ card if \"Other Task\" category is selected\n    if (otherCard) {\n      otherCard.style.display = isOther ? '' : 'none';\n    }\n  }\n\n  // Update Extra Note placeholder based on selected categories\n  function updateExtraNotePlaceholder() {\n    if (!extraNoteEl) return;\n    const categories = getSelectedCategories().filter(c => c !== 'Other Task');\n    if (categories.length === 0) {\n      extraNoteEl.placeholder = 'General note about this task';\n    } else if (categories.length === 1) {\n      extraNoteEl.placeholder = 'General note about this ' + categories[0];\n    } else {\n      extraNoteEl.placeholder = 'General note about these tasks';\n    }\n  }\n\n  // Wire category checkboxes to update visibility and placeholder\n  qsa('#taskCategories .category-toggle').forEach(cb => {\n    cb.addEventListener('change', () => {\n      syncTasksVisibility();\n      updateExtraNotePlaceholder();\n    });\n  });\n\n  function getSelectedTaskToggles(){\n    return qsa('#tasksChecklist .task-toggle:checked').map(cb => cb.value);\n  }\n\n  // Reorder checkboxes so checked ones appear at the top\n  function reorderCheckboxesToTop(containerSelector) {\n    const container = qs(containerSelector);\n    if (!container) return;\n    \n    // Get all items - could be direct children (div wrappers) or labels\n    const items = Array.from(container.children);\n    if (items.length === 0) return;\n    \n    // Sort: checked items first, then unchecked (maintain original order within each group)\n    const checked = [];\n    const unchecked = [];\n    items.forEach(item => {\n      const cb = item.querySelector('input[type=checkbox]') || item.querySelector('input[type=\"checkbox\"]');\n      if (cb && cb.checked) {\n        checked.push(item);\n      } else {\n        unchecked.push(item);\n      }\n    });\n    \n    // Re-append in sorted order: checked first, then unchecked\n    [...checked, ...unchecked].forEach(item => container.appendChild(item));\n  }\n\n  async function loadTeamMembers(){\n    if (teamMembersLoaded) return;\n    teamMembersLoaded = true; // guard immediately to avoid overlapping calls\n    const box = qs('#assignees');\n    if (!box) return;\n    // Additional DOM-level guard in case the script is evaluated more than once\n    if (box.dataset.initialized === '1') {\n      return;\n    }\n    box.dataset.initialized = '1';\n    box.innerHTML='';\n\n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('Team members');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) {\n        console.error('Team members sheet not found');\n        return;\n      }\n\n      // Read column A only for team member names\n      const usedRange = sheet.getUsedRange();\n      usedRange.load('values');\n      await context.sync();\n\n      const values = usedRange.values || [];\n      const namesRaw = values.slice(1) // skip header row\n        .map(row => row[0])\n        .filter(n => n && String(n).trim().length > 0)\n        .map(n => String(n).trim());\n\n      const names = Array.from(new Set(namesRaw)); // dedupe\n      console.log('Team members loaded from column A:', names); // Debug log\n\n      names.forEach(n => {\n        const w = document.createElement('div');\n        w.innerHTML = `<label><input type=\"checkbox\" value=\"${n}\"> ${n}</label>`;\n        box.appendChild(w);\n      });\n\n      if (brokerLeadEl) {\n        brokerLeadEl.innerHTML = '';\n        const noneOpt = document.createElement('option');\n        noneOpt.value = '';\n        noneOpt.textContent = '(none)';\n        brokerLeadEl.appendChild(noneOpt);\n        names.forEach(n => {\n          const opt = document.createElement('option');\n          opt.value = n;\n          opt.textContent = n;\n          brokerLeadEl.appendChild(opt);\n        });\n      }\n    });\n  }\n\n  function getSelectedAssignees(){\n    return Array.from(document.querySelectorAll('#assignees input[type=checkbox]:checked')).map(i=>i.value);\n  }\n\n  // Populate per-task assignee dropdowns with selected assignees\n  function updateTaskAssigneeDropdowns() {\n    const selectedAssignees = getSelectedAssignees();\n    const dropdowns = qsa('.task-assignee-select');\n    \n    dropdowns.forEach(dropdown => {\n      const currentValue = dropdown.value;\n      dropdown.innerHTML = '';\n      \n      // Add empty option\n      const emptyOpt = document.createElement('option');\n      emptyOpt.value = '';\n      emptyOpt.textContent = '(Select assignee)';\n      dropdown.appendChild(emptyOpt);\n      \n      // Add selected assignees as options\n      selectedAssignees.forEach(name => {\n        const opt = document.createElement('option');\n        opt.value = name;\n        opt.textContent = name;\n        dropdown.appendChild(opt);\n      });\n      \n      // Auto-select if only one assignee\n      if (selectedAssignees.length === 1) {\n        dropdown.value = selectedAssignees[0];\n      } else if (selectedAssignees.includes(currentValue)) {\n        // Restore previous selection if still valid\n        dropdown.value = currentValue;\n      }\n    });\n  }\n\n  // Wire assignee checkboxes to update per-task dropdowns\n  document.querySelectorAll('#assignees').forEach(container => {\n    container.addEventListener('change', (e) => {\n      if (e.target.type === 'checkbox') {\n        updateTaskAssigneeDropdowns();\n      }\n    });\n  });\n\n  async function getActiveRowIndex(){\n    return Excel.run(async (context) => {\n      // Use the currently selected range in the workbook\n      const range = context.workbook.getSelectedRange();\n      range.load('rowIndex');\n      await context.sync();\n      // rowIndex is 0-based; UI shows 1-based row numbers\n      return range.rowIndex + 1;\n    });\n  }\n\n  function parseTaskLine(raw){\n    // More flexible parsing that handles fields in any order\n    if (!raw) return null;\n    \n    // First, check basic structure: \"TaskName: Status || Assigned to ...\"\n    const basicMatch = /^(.*?)\\s*:\\s*(to do|in progress|done)\\s*\\|\\|\\s*assigned to\\s+([^|]+)/i.exec(raw);\n    if (!basicMatch) return null;\n    \n    const result = {\n      name: basicMatch[1].trim(),\n      status: basicMatch[2],\n      assignee: basicMatch[3].trim(),\n      comment: '',\n      giveUpId: '',\n      initiated: '',\n      updated: '',\n      completed: '',\n      deadline: ''\n    };\n    \n    // Extract optional fields in any order\n    const commentMatch = /\\|\\|\\s*comment:\\s*([^|]+)/i.exec(raw);\n    if (commentMatch) result.comment = commentMatch[1].trim();\n    \n    const giveUpMatch = /\\|\\|\\s*give-up id:\\s*([^|]+)/i.exec(raw);\n    if (giveUpMatch) result.giveUpId = giveUpMatch[1].trim();\n    \n    const initiatedMatch = /\\|\\|\\s*task initiated:\\s*([^|]+)/i.exec(raw);\n    if (initiatedMatch) result.initiated = initiatedMatch[1].trim();\n    \n    const updatedMatch = /\\|\\|\\s*status updated:\\s*([^|]+)/i.exec(raw);\n    if (updatedMatch) result.updated = updatedMatch[1].trim();\n    \n    const completedMatch = /\\|\\|\\s*completed:\\s*([^|]+)/i.exec(raw);\n    if (completedMatch) result.completed = completedMatch[1].trim();\n    \n    const deadlineMatch = /\\|\\|\\s*deadline:\\s*([^|]+)/i.exec(raw);\n    if (deadlineMatch) result.deadline = deadlineMatch[1].trim();\n    \n    return result;\n  }\n\n  function buildSummaryLine(v){\n    const parts = [];\n    const status = v.status || 'To Do';\n    // First segment must match parseTaskLine: \"<TaskName>: <Status>\"\n    parts.push(`${v.name}: ${status}`);\n    parts.push(`Assigned to ${v.assignees}`);\n    if (v.comment) parts.push(`Comment: ${v.comment}`);\n    if (v.giveUpId) parts.push(`Give-up ID: ${v.giveUpId}`);\n    // Only one date field will be set based on status (last action)\n    if (v.initiated) parts.push(`Task initiated: ${v.initiated}`);\n    if (v.updated) parts.push(`Status updated: ${v.updated}`);\n    if (v.completed) parts.push(`Completed: ${v.completed}`);\n    if (v.deadline) parts.push(`Deadline: ${v.deadline}`);\n    return parts.join(' || ');\n  }\n\n  async function loadFromActiveRow(){\n    await loadTeamMembers();\n    await Excel.run(async (context) => {\n      // Get active row within the same context to avoid sync issues\n      const selectedRange = context.workbook.getSelectedRange();\n      selectedRange.load('rowIndex');\n      await context.sync();\n      const uiRow = selectedRange.rowIndex + 1;\n\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return;\n\n      // Load row-level metadata and Column H, J, K in one go\n      const companyRange = sheet.getRange(`A${uiRow}`);\n      const descRange = sheet.getRange(`B${uiRow}`);\n      const assigneesRange = sheet.getRange(`C${uiRow}`);\n      const brokerRange = sheet.getRange(`D${uiRow}`);\n      const datesRange = sheet.getRange(`E${uiRow}:G${uiRow}`);\n      const hRange = sheet.getRange(`H${uiRow}`);\n      const jRange = sheet.getRange(`J${uiRow}`);\n      const kRange = sheet.getRange(`K${uiRow}`);\n      companyRange.load('values');\n      descRange.load('values');\n      assigneesRange.load('values');\n      brokerRange.load('values');\n      datesRange.load('values');\n      hRange.load('values');\n      jRange.load('values');\n      kRange.load('values');\n      await context.sync();\n\n      // Company name from column A\n      const companyVal = (companyRange.values && companyRange.values[0] && companyRange.values[0][0])\n        ? String(companyRange.values[0][0])\n        : '';\n      if (companyNameInput) companyNameInput.value = companyVal;\n\n      const descVal = (descRange.values && descRange.values[0] && descRange.values[0][0])\n        ? String(descRange.values[0][0])\n        : '';\n      // Parse comma-separated categories and check the corresponding checkboxes\n      const categories = descVal.split(',').map(s => s.trim()).filter(Boolean);\n      const allowedDescs = ['Onboarding', 'Amended Product/Rate', 'KYC update', 'Other Task'];\n      qsa('#taskCategories .category-toggle').forEach(cb => {\n        const match = categories.some(cat => cat.toLowerCase() === cb.value.toLowerCase());\n        cb.checked = match;\n      });\n\n      const brokerVal = (brokerRange.values && brokerRange.values[0] && brokerRange.values[0][0])\n        ? String(brokerRange.values[0][0])\n        : '';\n\n      if (brokerLeadEl) {\n        brokerLeadEl.value = brokerVal;\n      }\n\n      // Assignees from column C\n      const assigneesVal = (assigneesRange.values && assigneesRange.values[0] && assigneesRange.values[0][0])\n        ? String(assigneesRange.values[0][0])\n        : '';\n      const assigneesList = assigneesVal.split(/[,;]+/).map(s => s.trim().toLowerCase()).filter(Boolean);\n      console.log('Assignees from column C:', assigneesList);\n      document.querySelectorAll('#assignees input[type=checkbox]').forEach(cb => {\n        cb.checked = assigneesList.includes(cb.value.toLowerCase());\n      });\n\n      const datesRow = (datesRange.values && datesRange.values[0]) ? datesRange.values[0] : [null, null, null];\n\n      // Fix for timezone-related date shift bug in toInputDate\n      // When parsing yyyy-MM-dd strings, JavaScript interprets them as UTC midnight.\n      // This can cause day shifts when converting back to local time.\n      function toInputDate(v){\n        if (v == null || v === '') return '';\n        \n        // Excel serial number (days since 1900-01-01, with Excel's leap year bug)\n        if (typeof v === 'number') {\n          // Excel serial date: 1 = Jan 1, 1900\n          // Use UTC to avoid timezone issues\n          const excelEpoch = Date.UTC(1899, 11, 30); // Dec 30, 1899 (Excel's day 0) in UTC\n          const d = new Date(excelEpoch + v * 86400000);\n          const yyyy = d.getUTCFullYear();\n          const mm = String(d.getUTCMonth() + 1).padStart(2,'0');\n          const dd = String(d.getUTCDate()).padStart(2,'0');\n          return `${yyyy}-${mm}-${dd}`;\n        }\n        \n        // Excel usually returns Date objects for date cells\n        if (v instanceof Date) {\n          const yyyy = v.getFullYear();\n          const mm = String(v.getMonth() + 1).padStart(2,'0');\n          const dd = String(v.getDate()).padStart(2,'0');\n          return `${yyyy}-${mm}-${dd}`;\n        }\n        \n        const s = String(v).trim();\n        \n        // Handle yyyy-MM-dd format (ISO) - parse directly to avoid timezone issues\n        const ymdMatch = s.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n        if (ymdMatch) {\n          return s; // Already in correct format, return as-is\n        }\n        \n        // Handle d-MMM-yyyy format (e.g., \"1-Jul-2025\")\n        const dmmyMatch = s.match(/^(\\d{1,2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\\d{4})$/i);\n        if (dmmyMatch) {\n          const months = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};\n          const day = parseInt(dmmyMatch[1], 10);\n          const mon = months[dmmyMatch[2].toLowerCase()];\n          const year = parseInt(dmmyMatch[3], 10);\n          const dd = String(day).padStart(2,'0');\n          const mm = String(mon + 1).padStart(2,'0');\n          return `${year}-${mm}-${dd}`;\n        }\n        \n        // Try to parse strings / other values as dates\n        // But be careful with timezone issues\n        const d = new Date(v);\n        if (!isNaN(d.getTime())) {\n          const yyyy = d.getFullYear();\n          const mm = String(d.getMonth() + 1).padStart(2,'0');\n          const dd = String(d.getDate()).padStart(2,'0');\n          return `${yyyy}-${mm}-${dd}`;\n        }\n        \n        // Fallback: attempt to slice a yyyy-MM-dd looking prefix\n        return s.length >= 10 ? s.slice(0,10) : '';\n      }\n\n      console.log('Date values from Excel:', datesRow); // Debug log\n      if (initialRequestInput) initialRequestInput.value = toInputDate(datesRow[0]);\n      if (introEmailInput) introEmailInput.value = toInputDate(datesRow[1]);\n      if (remindersStartInput) remindersStartInput.value = toInputDate(datesRow[2]);\n      console.log('Parsed dates:', initialRequestInput?.value, introEmailInput?.value, remindersStartInput?.value); // Debug log\n\n      // Email Frequency from column J\n      const freqVal = (jRange.values && jRange.values[0] && jRange.values[0][0])\n        ? String(jRange.values[0][0])\n        : '';\n      if (emailFrequencyEl) emailFrequencyEl.value = freqVal;\n\n      // Extra Note from column K\n      const noteVal = (kRange.values && kRange.values[0] && kRange.values[0][0])\n        ? String(kRange.values[0][0])\n        : '';\n      if (extraNoteEl) extraNoteEl.value = noteVal;\n\n      const summary = (hRange.values && hRange.values[0] && hRange.values[0][0])\n        ? String(hRange.values[0][0])\n        : '';\n\n      // Parse all task lines in H\n      const lines = summary\n        .split(/\\r?\\n/)\n        .map(s => s.trim())\n        .filter(Boolean);\n      const parsedTasks = [];\n      const nonTaskLines = [];\n      for (let i = 0; i < lines.length; i++) {\n        const cand = parseTaskLine(lines[i]);\n        if (cand) {\n          parsedTasks.push(cand);\n        } else {\n          nonTaskLines.push(lines[i]);\n        }\n      }\n\n      // Sort tasks by status priority: To Do > In Progress > Done\n      const statusPriority = { 'to do': 1, 'in progress': 2, 'done': 3 };\n      parsedTasks.sort((a, b) => {\n        const aPriority = statusPriority[(a.status || '').toLowerCase()] || 4;\n        const bPriority = statusPriority[(b.status || '').toLowerCase()] || 4;\n        return aPriority - bPriority;\n      });\n\n      // Note: Assignees are already loaded from Column C (lines 1297-1305)\n      // Column C contains ALL assignees including \"passive\" ones not assigned to specific tasks\n      // We don't overwrite here - the checkboxes are already correctly set from Column C\n      console.log('Parsed tasks:', parsedTasks); // Debug log\n\n      // Update per-task assignee dropdowns with selected assignees\n      updateTaskAssigneeDropdowns();\n\n      // Reset all cards and task selections\n      qsa('#tasksChecklist .task-toggle').forEach(cb => { cb.checked = false; });\n      qsa('#taskCards .task-card, #otherTaskCard').forEach(card => {\n        const statusChips = getTaskStatusChips(card);\n        statusChips.forEach(c => c.classList.remove('active'));\n        const commentEl = card.querySelector('[data-role=\"comment\"]');\n        const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n        const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n        const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n        if (commentEl) commentEl.value = '';\n        if (deadlineEl) deadlineEl.value = '';\n        if (giveUpIdEl) giveUpIdEl.value = '';\n        if (taskAssigneeEl) taskAssigneeEl.value = '';\n      });\n\n      const isOther = isOtherTaskSelected();\n      if (isOther) {\n        // Use __other__ card with first parsed task if present\n        const otherCard = getTaskCard('__other__');\n        if (otherCard) {\n          const t = parsedTasks[0] || null;\n          if (taskNameInput) taskNameInput.value = t && t.name ? t.name : '';\n          if (t) {\n            const sNorm = (t.status || '').toLowerCase();\n            const displayStatus = sNorm === 'in progress' ? 'In Progress'\n              : sNorm === 'done' ? 'Done'\n              : 'To Do';\n            setCardStatus(otherCard, displayStatus);\n            const commentEl = otherCard.querySelector('[data-role=\"comment\"]');\n            const deadlineEl = otherCard.querySelector('[data-role=\"deadline\"]');\n            const taskAssigneeEl = otherCard.querySelector('[data-role=\"task-assignee\"]');\n            if (commentEl) commentEl.value = t.comment || '';\n            if (deadlineEl) deadlineEl.value = (t.deadline || '').slice(0,10);\n            // Set per-task assignee from parsed task\n            if (taskAssigneeEl && t.assignee) {\n              taskAssigneeEl.value = t.assignee.trim();\n            }\n          }\n        }\n      } else {\n        // Fixed tasks: tick checkboxes and populate corresponding cards\n        const toggles = qsa('#tasksChecklist .task-toggle');\n        toggles.forEach(cb => {\n          const name = cb.value;\n          // Map legacy \"KYC (Internal)\" to \"KYC (produced by LCMC)\"\n          const t = parsedTasks.find(pt => {\n            const ptName = (pt.name || '').toLowerCase();\n            const cbName = name.toLowerCase();\n            if (ptName === cbName) return true;\n            // Legacy mapping\n            if (cbName === 'kyc (produced by lcmc)' && ptName === 'kyc (internal)') return true;\n            return false;\n          });\n          cb.checked = !!t;\n          const card = getTaskCard(name);\n          if (card && t) {\n            const sNorm = (t.status || '').toLowerCase();\n            const displayStatus = sNorm === 'in progress' ? 'In Progress'\n              : sNorm === 'done' ? 'Done'\n              : 'To Do';\n            setCardStatus(card, displayStatus);\n            const commentEl = card.querySelector('[data-role=\"comment\"]');\n            const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n            const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n            const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n            if (commentEl) commentEl.value = t.comment || '';\n            if (deadlineEl) deadlineEl.value = (t.deadline || '').slice(0,10);\n            if (giveUpIdEl) giveUpIdEl.value = t.giveUpId || '';\n            // Set per-task assignee from parsed task\n            if (taskAssigneeEl && t.assignee) {\n              taskAssigneeEl.value = t.assignee.trim();\n            }\n          }\n        });\n      }\n\n      // Audit info from the most recently completed/updated task if available\n      if (auditTextEl) {\n        let chosenAudit = null;\n        if (parsedTasks.length > 0) {\n          chosenAudit = parsedTasks[0];\n        }\n        if (chosenAudit) {\n          const parts = [];\n          if (chosenAudit.initiated) parts.push(`Task initiated: ${chosenAudit.initiated}`);\n          if (chosenAudit.updated) parts.push(`Status updated: ${chosenAudit.updated}`);\n          if (chosenAudit.completed) parts.push(`Completed: ${chosenAudit.completed}`);\n          auditTextEl.textContent = parts.join(' | ');\n        } else {\n          auditTextEl.textContent = '';\n        }\n      }\n\n      // Update Last KYC Produced date\n      const lastKycEl = qs('#lastKycDate');\n      if (lastKycEl && companyVal) {\n        // Look for KYC Done status in current row's tasks\n        let kycCompletedDate = null;\n        parsedTasks.forEach(t => {\n          if (t.name && t.name.toLowerCase().includes('kyc') && \n              t.status && t.status.toLowerCase() === 'done' && t.completed) {\n            kycCompletedDate = t.completed;\n          }\n        });\n        if (kycCompletedDate) {\n          lastKycEl.textContent = kycCompletedDate;\n        } else {\n          // Search all rows for this company's last KYC\n          findLastKycDate(companyVal).then(date => {\n            lastKycEl.textContent = date || '';\n          });\n        }\n      } else if (lastKycEl) {\n        lastKycEl.textContent = '';\n      }\n\n      syncTasksVisibility();\n      updateDateDisplays();\n      updateExtraNotePlaceholder();\n      \n      // Reorder checked items to top\n      reorderCheckboxesToTop('#assignees');\n      reorderCheckboxesToTop('#tasksChecklist');\n      reorderCheckboxesToTop('#taskCategories');\n\n      // Track current row number for save logic\n      currentRowNum = uiRow;\n\n      // Apply deadline warnings to task cards\n      applyDeadlineWarnings();\n\n      // Update email summary button state\n      updateEmailSummaryButton();\n\n      // Close email summary section when switching rows\n      if (emailSummarySection) {\n        emailSummarySection.classList.remove('visible');\n      }\n    });\n  }\n\n  async function saveToActiveRow(){\n    const descVal = getSelectedCategories().join(', ');\n    const assignees = getSelectedAssignees().join(', ');\n    const isOther = isOtherTaskSelected();\n    console.log('Saving - Categories:', descVal, 'Assignees:', assignees, 'IsOther:', isOther);\n    await Excel.run(async (context) => {\n      // Get active row within the same context to avoid sync issues\n      const selectedRange = context.workbook.getSelectedRange();\n      selectedRange.load('rowIndex');\n      await context.sync();\n      const uiRow = selectedRange.rowIndex + 1;\n\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return;\n\n      // Persist row-level dates (E-G)\n      const datesRange = sheet.getRange(`E${uiRow}:G${uiRow}`);\n      datesRange.load('values');\n\n      // Persist company name (A), task category (B), assignees (C), broker lead (D)\n      const companyRange = sheet.getRange(`A${uiRow}`);\n      const descRange = sheet.getRange(`B${uiRow}`);\n      const assigneesRange = sheet.getRange(`C${uiRow}`);\n      const brokerRange = sheet.getRange(`D${uiRow}`);\n\n      const hRange = sheet.getRange(`H${uiRow}`);\n      const jRange = sheet.getRange(`J${uiRow}`);\n      const kRange = sheet.getRange(`K${uiRow}`);\n      hRange.load('values');\n      await context.sync();\n\n      const datesRow = (datesRange.values && datesRange.values[0]) ? datesRange.values[0] : [null,null,null];\n\n      // Format dates as d-MMM-yyyy for Excel display\n      if (initialRequestInput) datesRow[0] = formatDateForExcel(initialRequestInput.value);\n      if (introEmailInput) datesRow[1] = formatDateForExcel(introEmailInput.value);\n      if (remindersStartInput) datesRow[2] = formatDateForExcel(remindersStartInput.value);\n\n      datesRange.values = [datesRow];\n\n      descRange.values = [[descVal]];\n\n      if (brokerLeadEl) {\n        brokerRange.values = [[brokerLeadEl.value || '']];\n      }\n\n      if (companyNameInput) {\n        companyRange.values = [[companyNameInput.value || '']];\n      }\n\n      // Save assignees to Column C\n      assigneesRange.values = [[assignees]];\n      console.log('Saving assignees to column C:', assignees);\n\n      // Save Email Frequency (J) and Extra Note (K)\n      if (emailFrequencyEl) {\n        jRange.values = [[emailFrequencyEl.value || '']];\n      }\n      if (extraNoteEl) {\n        kRange.values = [[extraNoteEl.value || '']];\n      }\n\n      const existing = (hRange.values && hRange.values[0] && hRange.values[0][0])\n        ? String(hRange.values[0][0])\n        : '';\n\n      const lines = existing\n        .split(/\\r?\\n/)\n        .map(s => s.trim())\n        .filter(Boolean);\n\n      const nonTaskLines = lines.filter(l => !parseTaskLine(l));\n      const newTaskLines = [];\n\n      // Parse existing tasks to preserve dates\n      const existingTasks = {};\n      lines.forEach(l => {\n        const parsed = parseTaskLine(l);\n        if (parsed) {\n          existingTasks[parsed.name.toLowerCase()] = parsed;\n        }\n      });\n\n      // Helper to get today's date in d-MMM-yyyy format\n      const getTodayFormatted = () => {\n        const d = new Date();\n        const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n        return `${String(d.getDate()).padStart(2,'0')} ${months[d.getMonth()]} ${String(d.getFullYear()).slice(-2)}`;\n      };\n\n      // Helper to compute dates based on status and existing task\n      // Only show ONE date field based on current status (last action):\n      // - To Do: Task initiated\n      // - In Progress: Status updated\n      // - Done: Completed\n      const computeDates = (name, newStatus, existingTask) => {\n        const today = getTodayFormatted();\n        const oldStatus = existingTask ? (existingTask.status || '').toLowerCase() : '';\n        const newStatusLower = (newStatus || '').toLowerCase();\n        \n        // Preserve existing dates (use empty string if not present)\n        let initiated = (existingTask && existingTask.initiated) ? existingTask.initiated : '';\n        let updated = (existingTask && existingTask.updated) ? existingTask.updated : '';\n        let completed = (existingTask && existingTask.completed) ? existingTask.completed : '';\n        \n        // Check if this task has ANY date - if not, it's effectively new\n        const hasAnyDate = initiated || updated || completed;\n\n        // Update the relevant date based on status\n        // We show only ONE date field based on current status (last action)\n        if (newStatusLower === 'to do') {\n          // For To Do: always show initiated date\n          initiated = initiated || today;\n          // Clear other dates for display\n          updated = '';\n          completed = '';\n        } else if (newStatusLower === 'in progress') {\n          // For In Progress: set updated date if new or status changed\n          if (!hasAnyDate || oldStatus !== newStatusLower) {\n            updated = today;\n          }\n          // Clear other dates for display\n          initiated = '';\n          completed = '';\n        } else if (newStatusLower === 'done') {\n          // For Done: set completed date if new or status changed\n          if (!hasAnyDate || !completed || oldStatus !== newStatusLower) {\n            completed = today;\n          }\n          // Clear other dates for display\n          initiated = '';\n          updated = '';\n        }\n\n        return { initiated, updated, completed };\n      };\n\n      if (isOther) {\n        const otherCard = getTaskCard('__other__');\n        const name = taskNameInput ? taskNameInput.value.trim() : '';\n        if (name) {\n          const status = getCardStatus(otherCard) || 'To Do';\n          const commentEl = otherCard ? otherCard.querySelector('[data-role=\"comment\"]') : null;\n          const deadlineEl = otherCard ? otherCard.querySelector('[data-role=\"deadline\"]') : null;\n          const taskAssigneeEl = otherCard ? otherCard.querySelector('[data-role=\"task-assignee\"]') : null;\n          // Use per-task assignee if set, otherwise fall back to global assignees\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Look up existing task to preserve dates\n          const existingTask = existingTasks[name.toLowerCase()];\n          const dates = computeDates(name, status, existingTask);\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: '',\n            initiated: dates.initiated,\n            updated: dates.updated,\n            completed: dates.completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          const builtLine = buildSummaryLine(payload);\n          newTaskLines.push({ line: builtLine, status });\n        }\n      } else {\n        const toggles = getSelectedTaskToggles();\n        const fixedNames = ['Broker Agreement','Give-up Agreement','Amend Annex A','KYC (produced by LCMC)','KYC External'];\n        toggles.forEach(name => {\n          if (!fixedNames.includes(name)) return;\n          const card = getTaskCard(name);\n          if (!card) return;\n          const status = getCardStatus(card);\n          const commentEl = card.querySelector('[data-role=\"comment\"]');\n          const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n          const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n          const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n          // Use per-task assignee if set, otherwise fall back to global assignees\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Look up existing task to preserve dates (handle legacy KYC name)\n          let existingTask = existingTasks[name.toLowerCase()];\n          if (!existingTask && name.toLowerCase() === 'kyc (produced by lcmc)') {\n            existingTask = existingTasks['kyc (internal)'];\n          }\n          const dates = computeDates(name, status, existingTask);\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: giveUpIdEl ? giveUpIdEl.value.trim() : '',\n            initiated: dates.initiated,\n            updated: dates.updated,\n            completed: dates.completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          newTaskLines.push({ line: buildSummaryLine(payload), status });\n        });\n      }\n\n      // Sort task lines by status priority: To Do > In Progress > Done\n      const statusPriority = { 'to do': 1, 'in progress': 2, 'done': 3 };\n      newTaskLines.sort((a, b) => {\n        const aPriority = statusPriority[(a.status || '').toLowerCase()] || 4;\n        const bPriority = statusPriority[(b.status || '').toLowerCase()] || 4;\n        return aPriority - bPriority;\n      });\n      const sortedLines = newTaskLines.map(t => t.line);\n\n      const newValue = nonTaskLines.concat(sortedLines).filter(Boolean).join('\\n');\n      console.log('Saving to H - newTaskLines:', sortedLines, 'newValue:', newValue);\n\n      hRange.values = [[newValue]];\n\n      // Apply font color based on status priority: In Progress > To Do > Done\n      // Since Excel.js can't do per-line colors, use the \"most urgent\" status\n      if (sortedLines.length > 0) {\n        let hasInProgress = false;\n        let hasToDo = false;\n        let hasDone = false;\n        \n        sortedLines.forEach(line => {\n          const lower = line.toLowerCase();\n          if (lower.includes(': in progress')) hasInProgress = true;\n          else if (lower.includes(': to do')) hasToDo = true;\n          else if (lower.includes(': done')) hasDone = true;\n        });\n        \n        // Priority: In Progress (orange) > To Do (green) > Done (red)\n        // Use original Google Sheet colours: To Do #34a853, In Progress #ff9900, Done #cc6666\n        let fontColor;\n        if (hasInProgress) {\n          fontColor = '#ff9900'; // In Progress (orange)\n        } else if (hasToDo) {\n          fontColor = '#34a853'; // To Do (green)\n        } else if (hasDone) {\n          fontColor = '#cc6666'; // Done (soft red)\n        } else {\n          fontColor = '#34a853'; // default green\n        }\n        hRange.format.font.color = fontColor;\n      }\n\n      await context.sync();\n      console.log('Save completed successfully for row', uiRow);\n    });\n  }\n\n  // Clear form for a fresh new task entry\n  function clearFormForNewTask() {\n    // Clear company name\n    if (companyNameInput) companyNameInput.value = '';\n    \n    // Reset task category checkboxes\n    qsa('#taskCategories .category-toggle').forEach(cb => {\n      cb.checked = false;\n    });\n    \n    // Clear broker lead\n    if (brokerLeadEl) brokerLeadEl.value = '';\n    \n    // Clear all assignee checkboxes\n    document.querySelectorAll('#assignees input[type=checkbox]').forEach(cb => {\n      cb.checked = false;\n    });\n    \n    // Clear dates\n    if (initialRequestInput) initialRequestInput.value = '';\n    if (introEmailInput) introEmailInput.value = '';\n    if (remindersStartInput) remindersStartInput.value = '';\n    \n    // Clear email frequency and extra note\n    if (emailFrequencyEl) emailFrequencyEl.value = '';\n    if (extraNoteEl) extraNoteEl.value = '';\n    \n    // Uncheck all task toggles\n    qsa('#tasksChecklist .task-toggle').forEach(cb => {\n      cb.checked = false;\n    });\n    \n    // Reset all task cards (including Other Task card)\n    qsa('#taskCards .task-card, #otherTaskCard').forEach(card => {\n      // Reset status chips\n      const chips = card.querySelectorAll('[data-role=\"status-chips\"] .chip');\n      chips.forEach(c => c.classList.remove('active'));\n      \n      // Clear comment\n      const commentEl = card.querySelector('[data-role=\"comment\"]');\n      if (commentEl) commentEl.value = '';\n      \n      // Clear deadline\n      const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n      if (deadlineEl) deadlineEl.value = '';\n      \n      // Clear give-up ID\n      const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n      if (giveUpIdEl) giveUpIdEl.value = '';\n      \n      // Clear per-task assignee\n      const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n      if (taskAssigneeEl) taskAssigneeEl.value = '';\n    });\n    \n    // Clear other task name\n    if (taskNameInput) taskNameInput.value = '';\n    \n    // Clear audit text\n    if (auditTextEl) auditTextEl.textContent = '';\n    \n    // Clear Last KYC date\n    const lastKycEl = qs('#lastKycDate');\n    if (lastKycEl) lastKycEl.textContent = '';\n    \n    // Clear search results\n    if (searchResults) {\n      searchResults.classList.remove('visible');\n      searchResults.innerHTML = '';\n    }\n\n    // Close email summary section\n    if (emailSummarySection) {\n      emailSummarySection.classList.remove('visible');\n    }\n\n    // Mark as new task for save logic\n    currentRowNum = 'new';\n\n    // Update email summary button state\n    updateEmailSummaryButton();\n    \n    // Clear date displays\n    updateDateDisplays();\n    \n    // Update visibility and placeholder\n    syncTasksVisibility();\n    updateExtraNotePlaceholder();\n\n    // Autofocus first visible task comment field after a short delay\n    setTimeout(() => {\n      const visibleCard = document.querySelector('#taskCards .task-card:not([style*=\"display: none\"]), #otherTaskCard:not([style*=\"display: none\"])');\n      if (visibleCard) {\n        const commentEl = visibleCard.querySelector('[data-role=\"comment\"]');\n        if (commentEl && typeof commentEl.focus === 'function') {\n          commentEl.focus();\n        }\n      }\n    }, 100);\n  }\n\n  // Delete the current row from Excel\n  async function deleteCurrentRow() {\n    if (currentRowNum === null || currentRowNum === 'new') {\n      throw new Error('No row to delete');\n    }\n    \n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      \n      if (sheet.isNullObject) {\n        throw new Error('Sheet TASK MANAGER FORM not found');\n      }\n      \n      // Delete the entire row\n      const rowRange = sheet.getRange(`${currentRowNum}:${currentRowNum}`);\n      rowRange.delete(Excel.DeleteShiftDirection.up);\n      \n      await context.sync();\n      console.log('Deleted row', currentRowNum);\n    });\n  }\n\n  // Add a new task to the next available row\n  async function addNewTask() {\n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) {\n        console.error('Sheet TASK MANAGER FORM not found');\n        return;\n      }\n\n      // Find the first empty row by scanning column A from row 2 onwards\n      const colA = sheet.getRange('A2:A1000');\n      colA.load('values');\n      await context.sync();\n\n      let nextRow = 2; // Start from row 2 (after header)\n      const values = colA.values || [];\n      for (let i = 0; i < values.length; i++) {\n        if (values[i][0] && String(values[i][0]).trim() !== '') {\n          nextRow = i + 3; // i is 0-indexed, row 2 is first data row, so next empty is i+2+1\n        } else {\n          // Found an empty cell\n          nextRow = i + 2; // i is 0-indexed from row 2\n          break;\n        }\n      }\n\n      // Collect current form data\n      const companyVal = companyNameInput ? companyNameInput.value.trim() : '';\n      const descVal = getSelectedCategories().join(', ');\n      const isOther = isOtherTaskSelected();\n      const brokerVal = brokerLeadEl ? brokerLeadEl.value : '';\n      const assignees = getSelectedAssignees().join(', ');\n\n      // Write company name to column A\n      sheet.getRange(`A${nextRow}`).values = [[companyVal]];\n      // Write task category to column B\n      sheet.getRange(`B${nextRow}`).values = [[descVal]];\n      // Write assignees to column C\n      sheet.getRange(`C${nextRow}`).values = [[assignees]];\n      // Write broker lead to column D\n      sheet.getRange(`D${nextRow}`).values = [[brokerVal]];\n\n      // Write dates to columns E, F, G\n      const dateE = formatDateForExcel(initialRequestInput ? initialRequestInput.value : '');\n      const dateF = formatDateForExcel(introEmailInput ? introEmailInput.value : '');\n      const dateG = formatDateForExcel(remindersStartInput ? remindersStartInput.value : '');\n      sheet.getRange(`E${nextRow}:G${nextRow}`).values = [[dateE, dateF, dateG]];\n\n      // Write Email Frequency (J) and Extra Note (K)\n      sheet.getRange(`J${nextRow}`).values = [[emailFrequencyEl ? emailFrequencyEl.value : '']];\n      sheet.getRange(`K${nextRow}`).values = [[extraNoteEl ? extraNoteEl.value : '']];\n\n      // Helper to get today's date in d-MMM-yy format\n      const getTodayFormatted = () => {\n        const d = new Date();\n        const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n        return `${String(d.getDate()).padStart(2,'0')} ${months[d.getMonth()]} ${String(d.getFullYear()).slice(-2)}`;\n      };\n      const today = getTodayFormatted();\n\n      // Build Column H from selected tasks\n      const newTaskLines = [];\n      if (isOther) {\n        const otherCard = getTaskCard('__other__');\n        const name = taskNameInput ? taskNameInput.value.trim() : '';\n        if (name) {\n          const status = getCardStatus(otherCard) || 'To Do';\n          const commentEl = otherCard ? otherCard.querySelector('[data-role=\"comment\"]') : null;\n          const deadlineEl = otherCard ? otherCard.querySelector('[data-role=\"deadline\"]') : null;\n          const taskAssigneeEl = otherCard ? otherCard.querySelector('[data-role=\"task-assignee\"]') : null;\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Set date based on status for new task\n          let initiated = '', updated = '', completed = '';\n          const statusLower = status.toLowerCase();\n          if (statusLower === 'to do') {\n            initiated = today;\n          } else if (statusLower === 'in progress') {\n            updated = today;\n          } else if (statusLower === 'done') {\n            completed = today;\n          }\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: '',\n            initiated,\n            updated,\n            completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          newTaskLines.push(buildSummaryLine(payload));\n        }\n      } else {\n        const toggles = getSelectedTaskToggles();\n        const fixedNames = ['Broker Agreement','Give-up Agreement','Amend Annex A','KYC (produced by LCMC)','KYC External'];\n        toggles.forEach(name => {\n          if (!fixedNames.includes(name)) return;\n          const card = getTaskCard(name);\n          if (!card) return;\n          const status = getCardStatus(card) || 'To Do';\n          const commentEl = card.querySelector('[data-role=\"comment\"]');\n          const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n          const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n          const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Set date based on status for new task\n          let initiated = '', updated = '', completed = '';\n          const statusLower = status.toLowerCase();\n          if (statusLower === 'to do') {\n            initiated = today;\n          } else if (statusLower === 'in progress') {\n            updated = today;\n          } else if (statusLower === 'done') {\n            completed = today;\n          }\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: giveUpIdEl ? giveUpIdEl.value.trim() : '',\n            initiated,\n            updated,\n            completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          newTaskLines.push(buildSummaryLine(payload));\n        });\n      }\n\n      const hRangeNew = sheet.getRange(`H${nextRow}`);\n      hRangeNew.values = [[newTaskLines.join('\\n')]];\n\n      // Apply font color based on status priority: In Progress > To Do > Done\n      // Use original Google Sheet colours: To Do #34a853, In Progress #ff9900, Done #cc6666\n      if (newTaskLines.length > 0) {\n        let hasInProgress = false;\n        let hasToDo = false;\n        let hasDone = false;\n        \n        newTaskLines.forEach(line => {\n          const lower = line.toLowerCase();\n          if (lower.includes(': in progress')) hasInProgress = true;\n          else if (lower.includes(': to do')) hasToDo = true;\n          else if (lower.includes(': done')) hasDone = true;\n        });\n        \n        let fontColor;\n        if (hasInProgress) {\n          fontColor = '#ff9900'; // In Progress (orange)\n        } else if (hasToDo) {\n          fontColor = '#34a853'; // To Do (green)\n        } else if (hasDone) {\n          fontColor = '#cc6666'; // Done (soft red)\n        } else {\n          fontColor = '#34a853'; // default green\n        }\n        hRangeNew.format.font.color = fontColor;\n      }\n\n      await context.sync();\n\n      // Select the new row so user can see it\n      const newRowRange = sheet.getRange(`A${nextRow}`);\n      newRowRange.select();\n      await context.sync();\n\n      // Update current row number for save logic\n      currentRowNum = nextRow;\n    });\n  }\n\n  // Update date display helpers to show d-MMM-yyyy format\n  function updateDateDisplays() {\n    const dateFields = [\n      { input: '#initialRequest', display: '#initialRequestDisplay' },\n      { input: '#introEmail', display: '#introEmailDisplay' },\n      { input: '#remindersStart', display: '#remindersStartDisplay' }\n    ];\n    dateFields.forEach(({ input, display }) => {\n      const inputEl = qs(input);\n      const displayEl = qs(display);\n      if (inputEl && displayEl) {\n        const formatted = formatDateForDisplay(inputEl.value);\n        displayEl.textContent = formatted ? ` ${formatted}` : '';\n      }\n    });\n  }\n\n  // Wire date inputs to update displays\n  function wireDateInputs() {\n    const dateInputs = ['#initialRequest', '#introEmail', '#remindersStart'];\n    dateInputs.forEach(selector => {\n      const el = qs(selector);\n      if (el) {\n        el.addEventListener('change', updateDateDisplays);\n      }\n    });\n  }\n\n  // Wire deadline inputs to update warnings\n  function wireDeadlineInputs() {\n    qsa('[data-role=\"deadline\"]').forEach(input => {\n      input.addEventListener('change', () => {\n        applyDeadlineWarnings();\n      });\n    });\n  }\n\n  // ============== Email Summary Integration ==============\n\n  const emailSummaryBtn = qs('#viewEmailSummaryBtn');\n  const emailSummarySection = qs('#emailSummarySection');\n  const emailSummaryList = qs('#emailSummaryList');\n  const emailSummaryCount = qs('#emailSummaryCount');\n  const closeEmailSummaryBtn = qs('#closeEmailSummaryBtn');\n\n  // Update email summary button state based on company name\n  function updateEmailSummaryButton() {\n    const company = companyNameInput ? companyNameInput.value.trim() : '';\n    if (emailSummaryBtn) {\n      emailSummaryBtn.disabled = !company;\n    }\n  }\n\n  // Wire company name input to update button state\n  if (companyNameInput) {\n    companyNameInput.addEventListener('input', updateEmailSummaryButton);\n    companyNameInput.addEventListener('change', updateEmailSummaryButton);\n  }\n\n  // Wire email summary button click\n  if (emailSummaryBtn) {\n    emailSummaryBtn.addEventListener('click', async () => {\n      await loadEmailSummaries();\n    });\n  }\n\n  // Wire close button\n  if (closeEmailSummaryBtn) {\n    closeEmailSummaryBtn.addEventListener('click', () => {\n      if (emailSummarySection) {\n        emailSummarySection.classList.remove('visible');\n      }\n    });\n  }\n\n  // Load email summaries from Column L (populated by VBA SmartBrief macro)\n  // The VBA macro calls the API and writes the summary to column L\n  // This function reads that pre-fetched summary and displays it\n  async function loadEmailSummaries() {\n    const company = companyNameInput ? companyNameInput.value.trim() : '';\n    if (!company) {\n      showToast('No company name entered', 'error');\n      return;\n    }\n\n    // Must have a valid row to read from\n    if (currentRowNum === null || currentRowNum === 'new') {\n      showToast('Please save the task first or select an existing row', 'error');\n      return;\n    }\n\n    // Show the section with loading state\n    if (emailSummarySection) {\n      emailSummarySection.classList.add('visible');\n    }\n    if (emailSummaryList) {\n      emailSummaryList.innerHTML = '<div class=\"email-loading\">Loading summary from spreadsheet...</div>';\n    }\n\n    try {\n      // Read from Excel - extract data only, no DOM manipulation inside Excel.run\n      let summaryText = '';\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n\n        if (sheet.isNullObject) {\n          throw new Error('TASK MANAGER FORM sheet not found');\n        }\n\n        // Read column L for the current row (SmartBrief summary)\n        const cell = sheet.getRange(`L${currentRowNum}`);\n        cell.load('values');\n        await context.sync();\n\n        summaryText = (cell.values && cell.values[0] && cell.values[0][0])\n          ? String(cell.values[0][0]).trim()\n          : '';\n      });\n\n      // Excel can store in-cell line breaks as \"\\r\" on some platforms (not \"\\n\");\n      // normalize so parsing + rendering works consistently.\n      if (summaryText) {\n        summaryText = summaryText.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n      }\n\n      // If column L is empty, try to fetch from API (only works in localhost dev due to mixed-content)\n      // In production, VBA macro should have already populated column L\n      if (!summaryText) {\n        // Only attempt API call in localhost development (HTTPS add-in can't call HTTP API in production)\n        const isLocalhost = typeof window !== 'undefined' \n          && window.location \n          && window.location.hostname === 'localhost';\n        \n        if (isLocalhost) {\n          if (emailSummaryList) {\n            emailSummaryList.innerHTML = '<div class=\"email-loading\">Fetching summary from API...</div>';\n          }\n\n          const initialRequest = initialRequestInput ? String(initialRequestInput.value || '') : '';\n          const introEmail = introEmailInput ? String(introEmailInput.value || '') : '';\n          const remindersStart = remindersStartInput ? String(remindersStartInput.value || '') : '';\n\n          const apiSummary = await fetchSmartBriefSummaryFromApi(company, initialRequest, introEmail, remindersStart);\n          summaryText = apiSummary || '';\n\n          if (summaryText) {\n            summaryText = summaryText.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n          }\n\n          if (summaryText) {\n            await Excel.run(async (context) => {\n              const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n              sheet.load('name');\n              await context.sync();\n\n              if (sheet.isNullObject) {\n                throw new Error('TASK MANAGER FORM sheet not found');\n              }\n\n              const cell = sheet.getRange(`L${currentRowNum}`);\n              cell.values = [[summaryText]];\n              await context.sync();\n            });\n          }\n        }\n      }\n\n      // Now do DOM updates outside of Excel.run\n      // Update count badge (1 if we have a summary, 0 if not)\n      if (emailSummaryCount) {\n        emailSummaryCount.textContent = summaryText ? '1' : '0';\n      }\n\n      // Display the summary\n      if (!summaryText) {\n        if (emailSummaryList) {\n          emailSummaryList.innerHTML = `\n            <div class=\"email-no-summaries\">\n              No email summary found for this row.<br>\n              <small>Run the SmartBrief macro (Alt+F8  SmartBrief) to fetch summaries.</small>\n            </div>`;\n        }\n        return;\n      }\n\n      // Parse the summary text from VBA format:\n      // \"[XX% match] Subject\\n\\nSummary text\"\n      const lines = summaryText.split(/\\n/);\n      const firstLine = (lines[0] || '').trim();\n      const restText = lines.slice(1).join('\\n').replace(/^\\n+/, '').trim();\n\n      const headerMatch = firstLine.match(/^\\[(\\d+)%\\s*match\\]\\s*(.*)$/);\n      let matchPercent = 100;\n      let subject = 'Email Summary';\n      let summaryBody = summaryText;\n\n      if (headerMatch) {\n        matchPercent = parseInt(headerMatch[1], 10);\n        subject = (headerMatch[2] || '').trim() || 'Email Summary';\n        summaryBody = restText;\n      } else if (lines.length > 1) {\n        subject = firstLine || 'Email Summary';\n        summaryBody = restText;\n      } else {\n        subject = 'Email Summary';\n        summaryBody = summaryText.trim();\n      }\n\n      // Color code by match quality\n      let matchClass = 'match-high';\n      if (matchPercent < 70) matchClass = 'match-medium';\n      if (matchPercent < 50) matchClass = 'match-low';\n\n      // Parse participants and detect category for \"Apply to Task\" feature\n      const participants = parseParticipantsFromSummary(summaryText);\n      const detectedCategory = detectCategoryFromSummary(summaryText);\n      const matchedAssignees = matchParticipantsToTeamMembers(participants);\n      const summaryNotes = parseSummaryBodyFromSummary(summaryText);\n\n      // Store for \"Apply to Task\" button\n      lastParsedSmartBrief = {\n        participants,\n        detectedCategory,\n        matchedAssignees,\n        summaryNotes,\n        matchPercent,\n        subject\n      };\n\n      // Build participant chips HTML\n      let participantChipsHtml = '';\n      if (participants.length > 0) {\n        const chips = participants.map(p => {\n          const isMatched = matchedAssignees.some(a => a.toLowerCase().includes(p.name.split(' ')[0].toLowerCase()));\n          const chipClass = isMatched ? 'participant-chip matched' : 'participant-chip';\n          const title = p.email ? p.email : p.name;\n          return `<span class=\"${chipClass}\" title=\"${escapeHtml(title)}\">${escapeHtml(p.name)}</span>`;\n        }).join('');\n        participantChipsHtml = `\n          <div class=\"participants-section\">\n            <div class=\"participants-label\">Participants:</div>\n            <div class=\"participants-chips\">${chips}</div>\n          </div>\n        `;\n      }\n\n      // Build match warning HTML (if < 50%)\n      let matchWarningHtml = '';\n      if (matchPercent < 50) {\n        matchWarningHtml = `\n          <div class=\"match-warning\">\n             Low confidence match (${matchPercent}%)  verify this is the correct email thread\n          </div>\n        `;\n      }\n\n      // Build \"Apply to Task\" button HTML\n      let applyButtonHtml = '';\n      if (detectedCategory || matchedAssignees.length > 0 || summaryNotes) {\n        applyButtonHtml = `\n          <div class=\"smartbrief-actions\">\n            <button id=\"applySmartBriefBtn\" class=\"btn-apply-smartbrief\">\n               Review & Apply to Task\n            </button>\n          </div>\n        `;\n      }\n\n      // Remove participant names from summary body to avoid redundancy with chips\n      let cleanedSummaryBody = summaryBody;\n      // Remove the PARTICIPANTS section if present (already shown as chips)\n      cleanedSummaryBody = cleanedSummaryBody.replace(/## PARTICIPANTS[\\s\\S]*?(?=## |$)/, '').trim();\n      // Clean up any leading/trailing whitespace or empty lines\n      cleanedSummaryBody = cleanedSummaryBody.replace(/^\\n+/, '').replace(/\\n{3,}/g, '\\n\\n');\n\n      if (emailSummaryList) {\n        emailSummaryList.innerHTML = `\n          ${matchWarningHtml}\n          <div class=\"email-summary-item\">\n            <div class=\"email-summary-subject\">\n              ${escapeHtml(subject)}\n              <span class=\"match-score ${matchClass}\" title=\"Match score from SmartBrief\">\n                ${matchPercent}% match\n              </span>\n            </div>\n            ${participantChipsHtml}\n            <div class=\"email-summary-text\">${escapeHtml(cleanedSummaryBody).replace(/\\n/g, '<br>')}</div>\n          </div>\n          ${applyButtonHtml}\n        `;\n\n        // Wire \"Apply to Task\" button to show confirmation modal\n        const applyBtn = qs('#applySmartBriefBtn');\n        if (applyBtn) {\n          applyBtn.addEventListener('click', () => showSmartBriefConfirmation());\n        }\n      }\n\n    } catch (err) {\n      console.error('Error loading email summary from column L:', err);\n      if (emailSummaryList) {\n        emailSummaryList.innerHTML = `<div class=\"email-no-summaries\">Error reading summary: ${escapeHtml(err.message)}</div>`;\n      }\n    }\n  }\n\n  // Show confirmation modal for SmartBrief suggestions\n  function showSmartBriefConfirmation() {\n    if (!lastParsedSmartBrief) {\n      showToast('No SmartBrief data to apply', 'error');\n      return;\n    }\n\n    const { detectedCategory, matchedAssignees, summaryNotes } = lastParsedSmartBrief;\n    \n    // Build suggestion items with checkboxes\n    let suggestionsHtml = '';\n    let hasSuggestions = false;\n\n    if (detectedCategory) {\n      hasSuggestions = true;\n      suggestionsHtml += `\n        <div class=\"smartbrief-suggestion-item\">\n          <label>\n            <input type=\"checkbox\" id=\"sbApplyCategory\" checked>\n            <span class=\"suggestion-label\">Task Category:</span>\n            <span class=\"suggestion-value\">${escapeHtml(detectedCategory)}</span>\n          </label>\n        </div>\n      `;\n    }\n\n    // Individual checkboxes for each assignee (so users can uncheck irrelevant ones)\n    if (matchedAssignees && matchedAssignees.length > 0) {\n      hasSuggestions = true;\n      const assigneeCheckboxes = matchedAssignees.map((assignee, idx) => `\n        <label class=\"assignee-checkbox-item\">\n          <input type=\"checkbox\" class=\"sb-assignee-checkbox\" data-assignee=\"${escapeHtml(assignee)}\" checked>\n          <span>${escapeHtml(assignee)}</span>\n        </label>\n      `).join('');\n      \n      suggestionsHtml += `\n        <div class=\"smartbrief-suggestion-item smartbrief-assignees-group\">\n          <div class=\"suggestion-label\">Assignees:</div>\n          <div class=\"assignee-checkboxes-list\">\n            ${assigneeCheckboxes}\n          </div>\n        </div>\n      `;\n    }\n\n    if (summaryNotes) {\n      hasSuggestions = true;\n      const truncatedPreview = summaryNotes.length > 100 ? summaryNotes.substring(0, 100) + '...' : summaryNotes;\n      suggestionsHtml += `\n        <div class=\"smartbrief-suggestion-item\">\n          <label>\n            <input type=\"checkbox\" id=\"sbApplyNotes\">\n            <span class=\"suggestion-label\">Add to Notes:</span>\n            <span class=\"suggestion-value suggestion-notes\">${escapeHtml(truncatedPreview)}</span>\n          </label>\n        </div>\n      `;\n    }\n\n    if (!hasSuggestions) {\n      showToast('No suggestions available', 'info');\n      return;\n    }\n\n    // Create modal overlay\n    const overlay = document.createElement('div');\n    overlay.className = 'confirm-overlay';\n    overlay.id = 'smartbriefConfirmOverlay';\n\n    const box = document.createElement('div');\n    box.className = 'confirm-box smartbrief-confirm-box';\n    box.innerHTML = `\n      <div class=\"smartbrief-confirm-header\">\n        <span class=\"sparkle\"></span> Review Suggestions\n      </div>\n      <p class=\"smartbrief-confirm-desc\">Select which items to apply to the task:</p>\n      <div class=\"smartbrief-suggestions\">\n        ${suggestionsHtml}\n      </div>\n      <div class=\"smartbrief-confirm-buttons\">\n        <button class=\"btn-confirm-cancel\" id=\"sbCancel\">Cancel</button>\n        <button class=\"btn-apply-confirmed\" id=\"sbApply\">Apply Selected</button>\n      </div>\n    `;\n\n    overlay.appendChild(box);\n    document.body.appendChild(overlay);\n\n    // Wire buttons\n    const cancelBtn = overlay.querySelector('#sbCancel');\n    const applyBtn = overlay.querySelector('#sbApply');\n\n    cancelBtn.addEventListener('click', () => overlay.remove());\n    \n    applyBtn.addEventListener('click', () => {\n      const applyCategory = overlay.querySelector('#sbApplyCategory')?.checked;\n      const applyNotes = overlay.querySelector('#sbApplyNotes')?.checked;\n      \n      // Collect individually selected assignees\n      const selectedAssignees = [];\n      overlay.querySelectorAll('.sb-assignee-checkbox:checked').forEach(cb => {\n        selectedAssignees.push(cb.getAttribute('data-assignee'));\n      });\n      \n      overlay.remove();\n      applySmartBriefSelections(applyCategory, selectedAssignees, applyNotes);\n    });\n\n    // Close on overlay click\n    overlay.addEventListener('click', (e) => {\n      if (e.target === overlay) overlay.remove();\n    });\n  }\n\n  // Apply selected SmartBrief suggestions to the task form\n  // applyAssignees is now an array of selected assignee names (not a boolean)\n  function applySmartBriefSelections(applyCategory, selectedAssignees, applyNotes) {\n    if (!lastParsedSmartBrief) return;\n\n    const { detectedCategory, summaryNotes } = lastParsedSmartBrief;\n    let appliedItems = [];\n\n    // 1. Apply detected category\n    if (applyCategory && detectedCategory) {\n      const categoryCheckboxes = document.querySelectorAll('#taskCategories .category-toggle');\n      categoryCheckboxes.forEach(cb => {\n        if (cb.value === detectedCategory) {\n          cb.checked = true;\n          appliedItems.push(`Category: ${detectedCategory}`);\n        }\n      });\n      // Trigger visibility sync for task cards\n      syncTasksVisibility();\n    }\n\n    // 2. Apply selected assignees (now receives array of individually selected assignees)\n    if (selectedAssignees && Array.isArray(selectedAssignees) && selectedAssignees.length > 0) {\n      const assigneeCheckboxes = document.querySelectorAll('#assignees input[type=checkbox]');\n      assigneeCheckboxes.forEach(cb => {\n        if (selectedAssignees.includes(cb.value)) {\n          cb.checked = true;\n        }\n      });\n      // Update per-task dropdowns\n      updateTaskAssigneeDropdowns();\n      // Reorder checked to top\n      reorderCheckboxesToTop('#assignees');\n      appliedItems.push(`Assignees: ${selectedAssignees.join(', ')}`);\n    }\n\n    // 3. Apply summary notes to Extra Note field (append, don't overwrite)\n    if (applyNotes && summaryNotes && extraNoteEl) {\n      const existingNote = extraNoteEl.value.trim();\n      const notePrefix = '[From SmartBrief] ';\n      // Only add if not already present\n      if (!existingNote.includes(notePrefix)) {\n        const truncatedNotes = summaryNotes.length > 500 ? summaryNotes.substring(0, 500) + '...' : summaryNotes;\n        extraNoteEl.value = existingNote \n          ? `${existingNote}\\n\\n${notePrefix}${truncatedNotes}`\n          : `${notePrefix}${truncatedNotes}`;\n        appliedItems.push('Notes added');\n      }\n    }\n\n    // Mark form as having unsaved changes\n    if (appliedItems.length > 0) {\n      setUnsavedChanges(true);\n      showToast(` Applied: ${appliedItems.join(', ')}`, 'success');\n    } else {\n      showToast('No items selected', 'info');\n    }\n  }\n\n  // Format date for display\n  function formatEmailDate(dateStr) {\n    if (!dateStr) return 'Unknown date';\n    try {\n      const d = new Date(dateStr);\n      if (isNaN(d.getTime())) return dateStr;\n      return d.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });\n    } catch (e) {\n      return dateStr;\n    }\n  }\n\n  // Note: Email summaries are now populated by VBA SmartBrief macro into column L\n  // The add-in reads from column L instead of calling the API directly\n\n  // Initial load when Office host is ready\n  if (typeof Office !== 'undefined' && typeof Office.onReady === 'function') {\n  \n      Office.onReady((info) => {\n        if (info.host === Office.HostType.Excel) {\n          wireCardChips();\n          wireDateInputs();\n          wireDeadlineInputs(); // Wire deadline warnings\n          wireChangeTracking(); // Track unsaved changes\n        // Wire task checkbox visibility\n        qsa('#tasksChecklist .task-toggle').forEach(cb => {\n          cb.addEventListener('change', () => syncTasksVisibility());\n        });\n        // Wire category checkbox visibility\n        qsa('#taskCategories .category-toggle').forEach(cb => {\n          cb.addEventListener('change', () => syncTasksVisibility());\n        });\n        loadFromActiveRow().then(() => {\n          // Reset unsaved indicator after initial load\n          setUnsavedChanges(false);\n          // Auto-load active tasks on startup\n          performSearch();\n        });\n      }\n    });\n  }\n})();\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_toConsumableArray","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","toString","slice","constructor","name","test","qs","s","document","querySelector","qsa","querySelectorAll","teamMembersLoaded","hasUnsavedChanges","showToast","message","type","undefined","toast","textContent","className","setTimeout","classList","remove","checkMissingFields","missing","companyName","trim","push","brokerLead","filter","card","style","display","id","forEach","taskName","dataset","task","activeChip","deadlineInput","concat","otherTaskCard","taskNameInput","showMissingFieldsWarning","missingFields","overlay","createElement","box","maxWidth","textAlign","title","innerHTML","marginBottom","appendChild","desc","fontSize","color","list","cssText","field","li","btnWrap","closeBtn","addEventListener","body","setUnsavedChanges","unsaved","indicator","toggle","parseParticipantsFromSummary","summaryText","participants","participantsMatch","match","split","startsWith","line","email","parseSummaryBodyFromSummary","summaryMatch","join","detectCategoryFromSummary","text","toLowerCase","includes","matchParticipantsToTeamMembers","teamCheckboxes","teamNames","map","cb","matched","emailLower","endsWith","pNameLower","idx","findIndex","firstName","emailPrefix","tFirstName","Set","lastParsedSmartBrief","fetchSmartBriefSummaryFromApi","_x","_x2","_x3","_x4","_fetchSmartBriefSummaryFromApi","_callee0","company","initialRequest","introEmail","remindersStart","url","response","data","summaries","best","subject","summary","matchScore","matchPercent","_t4","_context0","encodeURIComponent","fetch","method","headers","JSON","stringify","initial_request","intro_email","reminders_start","threshold","ok","Error","status","json","String","match_score","parseFloat","Number","isFinite","Math","round","escapeHtml","div","applyDeadlineWarnings","warningClass","deadlineStr","deadline","Date","isNaN","getTime","today","setHours","diffDays","ceil","getDueDateWarningClass","add","window","preventDefault","returnValue","companyNameInput","brokerLeadEl","initialRequestInput","introEmailInput","remindersStartInput","emailFrequencyEl","extraNoteEl","auditTextEl","tasksRowEl","taskCardsContainer","saveBtn","newTaskBtn","loadSelectedBtn","openKycPortalBtn","currentRowNum","showConfirmDialog","dialog","msgEl","cancelBtn","okBtn","cleanup","removeEventListener","onCancel","onOk","_callee","_t","_context","addNewTask","saveToActiveRow","console","error","_callee2","_t2","_context2","loadFromActiveRow","clearFormForNewTask","deleteTaskBtn","_callee3","_t3","_context3","deleteCurrentRow","kycListenerAttached","stopPropagation","kycOpening","open","tasksView","statsView","tasksHeader","statsHeader","openStatsBtn","returnToTasksBtn","refreshStatsBtn","loadStatistics","_loadStatistics","_callee10","_t5","_context11","Excel","run","_ref1","_callee1","context","sheet","dataRange","rows","todoCount","inProgressCount","doneCount","brokerStats","monthlyStats","kycMonthly","totalDuration","durationCount","overdueItems","upcomingItems","staleItems","sevenDaysFromNow","thirtyDaysAgo","_loop","activeTasks","totalStatus","renderAttentionGroup","monthlyChart","sortedMonths","maxTasks","maxKyc","maxVal","monthNames","brokerChart","sortedBrokers","_maxTasks","_context10","workbook","worksheets","getItemOrNullObject","load","sync","isNullObject","getRange","values","setDate","getDate","row","broker","taskSummary","taskDate","dateE","dateF","dateG","availableDates","monthKey","_context1","parseDate","reduce","min","getFullYear","getMonth","padStart","total","active","completed","Boolean","lower","completedMatch","kycDate","taskNameMatch","assigneeMatch","assignee","deadlineMatch","daysUntil","detail","abs","initiatedMatch","updatedMatch","lastActionDate","daysSince","initiated","days","_regeneratorValues","width","items","groupId","listId","countId","group","container","countEl","item","assigneePart","sort","b","parseInt","keys","reverse","max","month","_month$split2","_slicedToArray","shortMonth","tasks","kyc","kycHeight","entries","_ref10","_ref12","_ref14","_ref15","stats","activeWidth","completedWidth","_x8","dateVal","excelEpoch","UTC","utcDate","result","getUTCFullYear","getUTCMonth","getUTCDate","dateStr","isoMatch","year","day","jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec","searchInput","searchInputWrap","searchBtn","searchResults","searchHint","searchTabs","currentSearchMode","loadRowHint","updateSearchUI","placeholder","tab","_callee4","_context4","getAttribute","performSearch","_callee5","_context5","_ref6","_callee6","_context6","key","hideAutocomplete","_x5","autocompleteDropdown","companyList","autocompleteTimeout","loadCompanyList","_loadCompanyList","_callee12","_t6","_context13","_ref16","_callee11","category","_context12","rowNum","log","_x9","showAutocomplete","query","q","allMatches","startsWithMatches","containsMatches","sortedMatches","categoryHint","_callee7","_context7","selectAndLoadRow","_performSearch","_callee15","_t7","_context17","_ref17","_callee14","rawValues","results","scannedRows","_loop2","totalRows","modeLabel","rawQuery","_context16","taskCategory","hasActiveTasks","dominantStatus","hasTodo","hasProgress","hasDone","todoDates","progressDates","doneDates","mostRecentDate","statusDateLabel","statusDateRaw","statusDateDisplay","_context15","dateArr","dStr","yyyy","mm","dd","every","parsed","parseTaskLine","st","updated","formatDateForDisplay","statusBadge","datePart","_callee13","_context14","_x0","_x6","_selectAndLoadRow","_callee17","_context19","_ref19","_callee16","_context18","select","_x1","findLastKycDate","_x7","_findLastKycDate","_callee19","_context21","_ref20","_callee18","usedRange","lastKycDate","rowCompany","_context20","getUsedRange","_x10","ymdMatch","clearTimeout","val","target","_callee8","_context8","formatDateForExcel","getSelectedCategories","isOtherTaskSelected","checked","getTaskCard","getTaskStatusChips","setCardStatus","getCardStatus","find","contains","syncTasksVisibility","isOther","otherCard","hasNonOtherCategory","some","selected","getSelectedTaskToggles","has","updateExtraNotePlaceholder","categories","reorderCheckboxesToTop","containerSelector","children","unchecked","loadTeamMembers","_loadTeamMembers","_callee21","_context23","initialized","_ref21","_callee20","namesRaw","names","noneOpt","_context22","opt","_x11","getSelectedAssignees","updateTaskAssigneeDropdowns","selectedAssignees","dropdown","currentValue","emptyOpt","raw","basicMatch","exec","comment","giveUpId","commentMatch","giveUpMatch","buildSummaryLine","parts","assignees","_loadFromActiveRow","_callee25","_context27","_ref23","_callee24","selectedRange","uiRow","companyRange","descRange","assigneesRange","brokerRange","datesRange","hRange","jRange","kRange","companyVal","descVal","brokerVal","assigneesVal","assigneesList","datesRow","toInputDate","freqVal","noteVal","lines","parsedTasks","nonTaskLines","cand","statusPriority","sNorm","commentEl","deadlineEl","taskAssigneeEl","chosenAudit","lastKycEl","kycCompletedDate","_context26","dmmyMatch","mon","getSelectedRange","rowIndex","cat","giveUpIdEl","pt","ptName","cbName","date","updateDateDisplays","updateEmailSummaryButton","emailSummarySection","_x13","_saveToActiveRow","_callee27","_context29","_ref24","_callee26","existing","newTaskLines","existingTasks","getTodayFormatted","computeDates","taskAssignee","existingTask","dates","payload","builtLine","toggles","fixedNames","sortedLines","newValue","hasInProgress","hasToDo","fontColor","_context28","newStatus","oldStatus","newStatusLower","hasAnyDate","format","font","_x14","visibleCard","focus","_deleteCurrentRow","_callee29","_context31","_ref25","_callee28","_context30","delete","DeleteShiftDirection","up","_x15","_addNewTask","_callee31","_context33","_ref26","_callee30","colA","nextRow","statusLower","hRangeNew","_context32","_x16","input","_ref9","inputEl","displayEl","formatted","emailSummaryBtn","emailSummaryList","emailSummaryCount","closeEmailSummaryBtn","disabled","loadEmailSummaries","_loadEmailSummaries","_callee34","apiSummary","firstLine","restText","headerMatch","summaryBody","matchClass","detectedCategory","matchedAssignees","summaryNotes","participantChipsHtml","chips","matchWarningHtml","applyButtonHtml","cleanedSummaryBody","applyBtn","_t8","_context36","_ref27","_callee32","cell","_context34","_x17","replace","location","hostname","_ref28","_callee33","_context35","_x18","chipClass","showSmartBriefConfirmation","_lastParsedSmartBrief","suggestionsHtml","hasSuggestions","assigneeCheckboxes","truncatedPreview","substring","_overlay$querySelecto","_overlay$querySelecto2","applyCategory","applyNotes","_lastParsedSmartBrief2","appliedItems","existingNote","notePrefix","truncatedNotes","applySmartBriefSelections","_callee9","_context9","Office","onReady","info","host","HostType","chip","closest","selector","el"],"ignoreList":[],"sourceRoot":""}