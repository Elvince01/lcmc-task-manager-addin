{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./src/taskpane/taskpane.js"],"sourcesContent":["// Task Manager task pane logic, wired to Excel via Office.js\n// Based on the scaffold in Task Manager Excel/addin/taskpane.js\n\n/* global document, Excel, Office */\n\n(function(){\n  const qs = (s)=>document.querySelector(s);\n  const qsa = (s)=>Array.from(document.querySelectorAll(s));\n  let teamMembersLoaded = false;\n  let hasUnsavedChanges = false;\n\n  // SmartBrief Integration\n  // Email summaries are fetched by VBA macro (SmartBrief.bas) and written to column L\n  // The add-in reads from column L to display summaries (no direct API calls from JS)\n\n  const EMAIL_SUMMARIZER_API_URL = 'http://192.168.1.141:5002';\n  const SMARTBRIEF_MATCH_THRESHOLD = 0.5;\n\n  // Toast notification helper\n  function showToast(message, type = 'success') {\n    const toast = qs('#toast');\n    if (!toast) return;\n    toast.textContent = message;\n    toast.className = 'toast ' + type + ' show';\n    setTimeout(() => {\n      toast.classList.remove('show');\n    }, 3000);\n  }\n\n  // Check for missing fields and return array of missing field names\n  function checkMissingFields() {\n    const missing = [];\n\n    // Check company name\n    const companyName = qs('#companyName');\n    if (!companyName || !companyName.value.trim()) {\n      missing.push('Company Name');\n    }\n\n    // Check task category\n    const selectedCategories = Array.from(document.querySelectorAll('.category-toggle:checked'));\n    if (selectedCategories.length === 0) {\n      missing.push('Task Category');\n    }\n\n    // Check broker lead\n    const brokerLead = qs('#brokerLead');\n    if (!brokerLead || !brokerLead.value) {\n      missing.push('Broker Lead');\n    }\n\n    // Check assignees\n    const selectedAssignees = Array.from(document.querySelectorAll('#assignees input[type=checkbox]:checked'));\n    if (selectedAssignees.length === 0) {\n      missing.push('Assigned To');\n    }\n\n    // Check visible task cards for status and deadline\n    const visibleTaskCards = Array.from(document.querySelectorAll('.task-card')).filter(card => {\n      return card.style.display !== 'none' && card.id !== 'otherTaskCard';\n    });\n\n    visibleTaskCards.forEach(card => {\n      const taskName = card.dataset.task || 'Task';\n      const activeChip = card.querySelector('.chip.active');\n      const deadlineInput = card.querySelector('[data-role=\"deadline\"]');\n\n      if (!activeChip) {\n        missing.push(`${taskName}: Status`);\n      }\n      if (!deadlineInput || !deadlineInput.value) {\n        missing.push(`${taskName}: Deadline`);\n      }\n    });\n\n    // Check \"Other Task\" card if visible\n    const otherTaskCard = qs('#otherTaskCard');\n    if (otherTaskCard && otherTaskCard.style.display !== 'none') {\n      const taskNameInput = qs('#taskName');\n      if (!taskNameInput || !taskNameInput.value.trim()) {\n        missing.push('Other Task: Task Name');\n      }\n      const activeChip = otherTaskCard.querySelector('.chip.active');\n      if (!activeChip) {\n        missing.push('Other Task: Status');\n      }\n      const deadlineInput = otherTaskCard.querySelector('[data-role=\"deadline\"]');\n      if (!deadlineInput || !deadlineInput.value) {\n        missing.push('Other Task: Deadline');\n      }\n    }\n\n    return missing;\n  }\n\n  // Show missing fields warning in a styled popup\n  function showMissingFieldsWarning(missingFields) {\n    // Create overlay\n    const overlay = document.createElement('div');\n    overlay.className = 'confirm-overlay';\n    overlay.id = 'missingFieldsOverlay';\n\n    // Create box\n    const box = document.createElement('div');\n    box.className = 'confirm-box';\n    box.style.maxWidth = '320px';\n    box.style.textAlign = 'left';\n\n    // Title\n    const title = document.createElement('p');\n    title.innerHTML = '<strong style=\"color:#f59e0b;\"> Missing Fields</strong>';\n    title.style.marginBottom = '12px';\n    title.style.textAlign = 'center';\n    box.appendChild(title);\n\n    // Description\n    const desc = document.createElement('p');\n    desc.textContent = 'The following fields are empty:';\n    desc.style.fontSize = '12px';\n    desc.style.color = '#64748b';\n    desc.style.marginBottom = '8px';\n    box.appendChild(desc);\n\n    // List of missing fields\n    const list = document.createElement('ul');\n    list.style.cssText = 'margin:0 0 16px 0;padding-left:20px;font-size:12px;color:#334155;max-height:150px;overflow-y:auto;';\n    missingFields.forEach(field => {\n      const li = document.createElement('li');\n      li.textContent = field;\n      li.style.marginBottom = '4px';\n      list.appendChild(li);\n    });\n    box.appendChild(list);\n\n    // Close button\n    const btnWrap = document.createElement('div');\n    btnWrap.style.textAlign = 'center';\n    const closeBtn = document.createElement('button');\n    closeBtn.textContent = 'Got it';\n    closeBtn.style.cssText = 'padding:8px 24px;font-size:13px;font-weight:500;border:none;border-radius:6px;background:#1e40af;color:#fff;cursor:pointer;';\n    closeBtn.addEventListener('click', () => {\n      overlay.remove();\n    });\n    btnWrap.appendChild(closeBtn);\n    box.appendChild(btnWrap);\n\n    overlay.appendChild(box);\n    document.body.appendChild(overlay);\n  }\n\n  // Unsaved changes indicator\n  function setUnsavedChanges(unsaved) {\n    hasUnsavedChanges = unsaved;\n    const indicator = qs('#unsavedIndicator');\n    if (indicator) {\n      indicator.classList.toggle('visible', unsaved);\n    }\n  }\n\n  // ============== SmartBrief Parsing Helpers ==============\n\n  // Parse participants from SmartBrief summary\n  // Format: \"## PARTICIPANTS\\n- Name (email@domain.com)\\n- Name2 (email2@domain.com)\"\n  function parseParticipantsFromSummary(summaryText) {\n    const participants = [];\n    const participantsMatch = summaryText.match(/## PARTICIPANTS\\n([\\s\\S]*?)(?=\\n## |$)/);\n    if (participantsMatch) {\n      const participantsBlock = participantsMatch[1];\n      const lines = participantsBlock.split('\\n').filter(l => l.trim().startsWith('-'));\n      lines.forEach(line => {\n        // Parse \"- Name (email@domain.com)\" or \"- Name\"\n        const match = line.match(/^-\\s*(.+?)(?:\\s*\\(([^)]+)\\))?\\s*$/);\n        if (match) {\n          const name = match[1].trim();\n          const email = match[2] ? match[2].trim() : '';\n          if (name) {\n            participants.push({ name, email });\n          }\n        }\n      });\n    }\n    return participants;\n  }\n\n  // Parse summary body from SmartBrief (the ## SUMMARY section)\n  function parseSummaryBodyFromSummary(summaryText) {\n    const summaryMatch = summaryText.match(/## SUMMARY\\n([\\s\\S]*?)(?=\\n## |$)/);\n    if (summaryMatch) {\n      return summaryMatch[1].trim();\n    }\n    // Fallback: return everything after the first line\n    const lines = summaryText.split('\\n');\n    return lines.slice(1).join('\\n').trim();\n  }\n\n  // Detect task category from summary text using keywords\n  function detectCategoryFromSummary(summaryText) {\n    const text = summaryText.toLowerCase();\n    \n    // Check for specific keywords\n    if (text.includes('onboarding') || text.includes('new client') || text.includes('new account') || text.includes('account opening')) {\n      return 'Onboarding';\n    }\n    if (text.includes('kyc') || text.includes('know your customer') || text.includes('compliance') || text.includes('documents') || text.includes('documentation')) {\n      return 'KYC update';\n    }\n    if (text.includes('rate') || text.includes('pricing') || text.includes('amendment') || text.includes('amended') || text.includes('fee') || text.includes('commission')) {\n      return 'Amended Product/Rate';\n    }\n    if (text.includes('give-up') || text.includes('giveup') || text.includes('give up')) {\n      return 'Give-up';\n    }\n    \n    return null; // No clear category detected\n  }\n\n  // Match participants to team members (fuzzy match by name)\n  // IMPORTANT: Only LCMCommodities employees can be assignees\n  // External participants (non-lcmcommodities.com emails) are excluded\n  function matchParticipantsToTeamMembers(participants) {\n    const teamCheckboxes = Array.from(document.querySelectorAll('#assignees input[type=checkbox]'));\n    const teamNames = teamCheckboxes.map(cb => cb.value.toLowerCase());\n    const matched = [];\n    \n    // Filter to only LCMCommodities participants first\n    const lcmParticipants = participants.filter(p => {\n      if (!p.email) return false; // No email = can't verify, skip\n      const emailLower = p.email.toLowerCase();\n      return emailLower.endsWith('@lcmcommodities.com') || emailLower.endsWith('@lcmc.com');\n    });\n    \n    lcmParticipants.forEach(p => {\n      const pNameLower = p.name.toLowerCase();\n      // Try exact match first\n      let idx = teamNames.findIndex(t => t === pNameLower);\n      // Try partial match (first name)\n      if (idx === -1) {\n        const firstName = pNameLower.split(' ')[0];\n        idx = teamNames.findIndex(t => t.startsWith(firstName) || t.includes(firstName));\n      }\n      // Try email prefix match\n      if (idx === -1 && p.email) {\n        const emailPrefix = p.email.split('@')[0].toLowerCase();\n        idx = teamNames.findIndex(t => {\n          const tFirstName = t.split(' ')[0];\n          return emailPrefix.includes(tFirstName) || tFirstName.includes(emailPrefix);\n        });\n      }\n      if (idx !== -1) {\n        matched.push(teamCheckboxes[idx].value);\n      }\n    });\n    \n    return [...new Set(matched)]; // dedupe\n  }\n\n  // Store parsed SmartBrief data for \"Apply to Task\" action\n  let lastParsedSmartBrief = null;\n\n  async function fetchSmartBriefSummaryFromApi(company, initialRequest, introEmail, remindersStart) {\n    const useLocalProxy = typeof window !== 'undefined'\n      && window.location\n      && window.location.hostname === 'localhost'\n      && window.location.protocol === 'https:';\n\n    const baseUrl = useLocalProxy ? '' : EMAIL_SUMMARIZER_API_URL;\n    const url = `${baseUrl}/api/task-manager/summaries/${encodeURIComponent(company)}`;\n\n    try {\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          initial_request: initialRequest,\n          intro_email: introEmail,\n          reminders_start: remindersStart,\n          threshold: SMARTBRIEF_MATCH_THRESHOLD\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Server returned ${response.status}`);\n      }\n\n      const data = await response.json();\n      const summaries = Array.isArray(data.summaries) ? data.summaries : [];\n      if (summaries.length === 0) return '';\n\n      const best = summaries[0] || {};\n      const subject = String(best.subject || 'No subject');\n      const summary = String(best.summary || '').trim();\n      const matchScore = typeof best.match_score === 'number' ? best.match_score : parseFloat(best.match_score);\n      const matchPercent = Number.isFinite(matchScore) ? Math.round(matchScore * 100) : 0;\n\n      if (!summary) return '';\n      return `[${matchPercent}% match] ${subject}\\n\\n${summary}`;\n    } catch (err) {\n      // Common failure modes: mixed content (https add-in calling http API) or CORS\n      const msg = err && err.message ? err.message : String(err);\n      showToast('SmartBrief API error: ' + msg, 'error');\n      return '';\n    }\n  }\n\n  // Track form changes\n  function wireChangeTracking() {\n    const formElements = qsa('input, select, textarea');\n    formElements.forEach(el => {\n      el.addEventListener('change', () => setUnsavedChanges(true));\n      el.addEventListener('input', () => setUnsavedChanges(true));\n    });\n    // Also track chip clicks\n    qsa('.chip').forEach(chip => {\n      chip.addEventListener('click', () => setUnsavedChanges(true));\n    });\n  }\n\n  // Warn before leaving with unsaved changes\n  window.addEventListener('beforeunload', (e) => {\n    if (hasUnsavedChanges) {\n      e.preventDefault();\n      e.returnValue = '';\n      return '';\n    }\n  });\n\n  // Escape HTML helper\n  function escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = String(text || '');\n    return div.innerHTML;\n  }\n\n  // Due date warning helper\n  function getDueDateWarningClass(deadlineStr) {\n    if (!deadlineStr) return '';\n    const deadline = new Date(deadlineStr);\n    if (isNaN(deadline.getTime())) return '';\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    deadline.setHours(0, 0, 0, 0);\n    const diffDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));\n    if (diffDays < 0) return 'overdue';\n    if (diffDays <= 3) return 'warning';\n    return '';\n  }\n\n  function formatDeadlineBadge(deadlineStr) {\n    const warningClass = getDueDateWarningClass(deadlineStr);\n    if (!warningClass) return '';\n    if (warningClass === 'overdue') {\n      return '<span class=\"deadline-badge overdue\"> Overdue</span>';\n    }\n    const deadline = new Date(deadlineStr);\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    deadline.setHours(0, 0, 0, 0);\n    const diffDays = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));\n    if (diffDays === 0) return '<span class=\"deadline-badge warning\"> Due today</span>';\n    if (diffDays === 1) return '<span class=\"deadline-badge warning\"> Due tomorrow</span>';\n    return `<span class=\"deadline-badge warning\"> ${diffDays} days left</span>`;\n  }\n\n  // Apply deadline warnings to task cards\n  function applyDeadlineWarnings() {\n    qsa('.task-card').forEach(card => {\n      const deadlineInput = card.querySelector('[data-role=\"deadline\"]');\n      if (!deadlineInput) return;\n      const deadline = deadlineInput.value;\n      const warningClass = getDueDateWarningClass(deadline);\n      card.classList.remove('deadline-warning', 'deadline-overdue');\n      if (warningClass === 'overdue') {\n        card.classList.add('deadline-overdue');\n      } else if (warningClass === 'warning') {\n        card.classList.add('deadline-warning');\n      }\n    });\n  }\n\n  const companyNameInput = qs('#companyName');\n  // taskDescriptionEl is now a container with checkboxes, not a select\n  const brokerLeadEl = qs('#brokerLead');\n  const initialRequestInput = qs('#initialRequest');\n  const introEmailInput = qs('#introEmail');\n  const remindersStartInput = qs('#remindersStart');\n  const emailFrequencyEl = qs('#emailFrequency');\n  const extraNoteEl = qs('#extraNote');\n  const auditTextEl = qs('#auditText');\n  const tasksRowEl = qs('#tasksRow');\n  const taskCardsContainer = qs('#taskCards');\n  const taskNameInput = qs('#taskName'); // only for __other__ card\n\n  // Wire Save, New Task, Load Selected, and KYC Portal buttons\n  const saveBtn = qs('#saveBtn');\n  const newTaskBtn = qs('#newTaskBtn');\n  const loadSelectedBtn = qs('#loadSelectedBtn');\n  const openKycPortalBtn = qs('#openKycPortal');\n\n  // Track current row for display\n  let currentRowNum = null;\n\n  if (saveBtn) {\n    saveBtn.addEventListener('click', async () => {\n      try {\n        // Check for missing fields before saving\n        const missingFields = checkMissingFields();\n\n        if (currentRowNum === null || currentRowNum === 'new') {\n          await addNewTask();\n          showToast(' New task added successfully!', 'success');\n        } else {\n          await saveToActiveRow();\n          showToast(' Changes saved to row ' + currentRowNum, 'success');\n        }\n        setUnsavedChanges(false);\n\n        // Show missing fields warning after successful save\n        if (missingFields.length > 0) {\n          setTimeout(() => {\n            showMissingFieldsWarning(missingFields);\n          }, 500); // Delay to let the success toast show first\n        }\n      } catch (e) {\n        console.error('Save error:', e);\n        showToast(' Save failed: ' + e.message, 'error');\n      }\n    });\n  }\n\n  // Load Selected Row button (in By Row tab)\n  if (loadSelectedBtn) {\n    loadSelectedBtn.addEventListener('click', async () => {\n      try {\n        await loadFromActiveRow();\n        showToast(' Loaded row ' + currentRowNum, 'success');\n      } catch (e) {\n        console.error('Load error:', e);\n        showToast(' Failed to load row', 'error');\n      }\n    });\n  }\n\n  if (newTaskBtn) {\n    newTaskBtn.addEventListener('click', () => {\n      clearFormForNewTask();\n    });\n  }\n\n  // Custom confirm dialog (since window.confirm is not supported in Office Add-ins)\n  function showConfirmDialog(message) {\n    return new Promise((resolve) => {\n      const dialog = qs('#confirmDialog');\n      const msgEl = qs('#confirmMessage');\n      const cancelBtn = qs('#confirmCancel');\n      const okBtn = qs('#confirmOk');\n      \n      if (!dialog || !msgEl || !cancelBtn || !okBtn) {\n        resolve(false);\n        return;\n      }\n      \n      msgEl.textContent = message;\n      dialog.style.display = 'flex';\n      \n      const cleanup = () => {\n        dialog.style.display = 'none';\n        cancelBtn.removeEventListener('click', onCancel);\n        okBtn.removeEventListener('click', onOk);\n      };\n      \n      const onCancel = () => {\n        cleanup();\n        resolve(false);\n      };\n      \n      const onOk = () => {\n        cleanup();\n        resolve(true);\n      };\n      \n      cancelBtn.addEventListener('click', onCancel);\n      okBtn.addEventListener('click', onOk);\n    });\n  }\n\n  // Delete Task button\n  const deleteTaskBtn = qs('#deleteTaskBtn');\n  if (deleteTaskBtn) {\n    deleteTaskBtn.addEventListener('click', async () => {\n      // Don't allow delete if this is a new unsaved task\n      if (currentRowNum === null || currentRowNum === 'new') {\n        showToast('No task to delete - this is a new task', 'error');\n        return;\n      }\n      \n      // Confirm before deleting\n      const confirmed = await showConfirmDialog('Are you sure you want to delete this Task?');\n      if (!confirmed) return;\n      \n      try {\n        await deleteCurrentRow();\n        showToast(' Task deleted successfully', 'success');\n        clearFormForNewTask();\n      } catch (e) {\n        console.error('Delete error:', e);\n        showToast(' Failed to delete task: ' + e.message, 'error');\n      }\n    });\n  }\n\n  // Guard on the DOM element so we don't wire multiple listeners or open twice\n  if (openKycPortalBtn && openKycPortalBtn.dataset.kycListenerAttached !== '1') {\n    openKycPortalBtn.dataset.kycListenerAttached = '1';\n    openKycPortalBtn.addEventListener('click', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      if (openKycPortalBtn.dataset.kycOpening === '1') return;\n      openKycPortalBtn.dataset.kycOpening = '1';\n      window.open('http://192.168.1.141:8080/', '_blank');\n      setTimeout(() => { openKycPortalBtn.dataset.kycOpening = '0'; }, 1000);\n    });\n  }\n\n  // Statistics Navigation\n  const tasksView = qs('#tasksView');\n  const statsView = qs('#statsView');\n  const tasksHeader = qs('#tasksHeader');\n  const statsHeader = qs('#statsHeader');\n  const openStatsBtn = qs('#openStatsBtn');\n  const returnToTasksBtn = qs('#returnToTasksBtn');\n  const refreshStatsBtn = qs('#refreshStatsBtn');\n\n  if (openStatsBtn) {\n    openStatsBtn.addEventListener('click', () => {\n      if (tasksView) tasksView.style.display = 'none';\n      if (tasksHeader) tasksHeader.style.display = 'none';\n      if (statsView) statsView.style.display = '';\n      if (statsHeader) statsHeader.style.display = 'flex';\n      loadStatistics();\n    });\n  }\n\n  if (returnToTasksBtn) {\n    returnToTasksBtn.addEventListener('click', () => {\n      if (tasksView) tasksView.style.display = '';\n      if (tasksHeader) tasksHeader.style.display = 'flex';\n      if (statsView) statsView.style.display = 'none';\n      if (statsHeader) statsHeader.style.display = 'none';\n    });\n  }\n\n  if (refreshStatsBtn) {\n    refreshStatsBtn.addEventListener('click', () => {\n      loadStatistics();\n    });\n  }\n\n  // Statistics calculation\n  async function loadStatistics() {\n    try {\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n        if (sheet.isNullObject) {\n          console.error('Sheet not found for statistics');\n          return;\n        }\n\n        // Load all data\n        const dataRange = sheet.getRange('A1:K5000');\n        dataRange.load('values');\n        await context.sync();\n\n        const rows = dataRange.values || [];\n        if (rows.length < 2) return;\n\n        // Parse all tasks\n        const tasks = [];\n        let todoCount = 0, inProgressCount = 0, doneCount = 0;\n        const brokerStats = {};\n        const monthlyStats = {};\n        const kycMonthly = {};\n        let totalDuration = 0, durationCount = 0;\n        \n        // Attention items with details\n        const overdueItems = [];\n        const upcomingItems = [];\n        const staleItems = [];\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const sevenDaysFromNow = new Date(today);\n        sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7);\n        const thirtyDaysAgo = new Date(today);\n        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n        for (let i = 1; i < rows.length; i++) {\n          const row = rows[i];\n          const company = row[0] ? String(row[0]).trim() : '';\n          if (!company) continue;\n\n          const category = row[1] ? String(row[1]).trim() : '';\n          const broker = row[3] ? String(row[3]).trim() : '(none)';\n          const initialRequest = row[4]; // Column E - Initial Request Date\n          const introEmail = row[5]; // Column F - Intro Email Date\n          const remindersStart = row[6]; // Column G - Reminders Start Date\n          const taskSummary = row[7] ? String(row[7]).trim() : '';\n\n          // Parse dates from columns E, F, G for monthly stats\n          // Use the earliest available date as the task creation date\n          let taskDate = null;\n          const dateE = parseDate(initialRequest);\n          const dateF = parseDate(introEmail);\n          const dateG = parseDate(remindersStart);\n          \n          // Pick the earliest non-null date\n          const availableDates = [dateE, dateF, dateG].filter(d => d !== null);\n          if (availableDates.length > 0) {\n            taskDate = availableDates.reduce((min, d) => d < min ? d : min);\n          }\n          \n          if (taskDate) {\n            const monthKey = `${taskDate.getFullYear()}-${String(taskDate.getMonth() + 1).padStart(2, '0')}`;\n            monthlyStats[monthKey] = (monthlyStats[monthKey] || 0) + 1;\n          }\n\n          // Broker stats\n          if (!brokerStats[broker]) {\n            brokerStats[broker] = { total: 0, active: 0, completed: 0 };\n          }\n          brokerStats[broker].total++;\n\n          // Parse task summary for status\n          if (taskSummary) {\n            const lines = taskSummary.split(/\\r?\\n/).filter(Boolean);\n            lines.forEach(line => {\n              const lower = line.toLowerCase();\n              \n              // Count statuses\n              if (lower.includes(': to do')) {\n                todoCount++;\n                brokerStats[broker].active++;\n              } else if (lower.includes(': in progress')) {\n                inProgressCount++;\n                brokerStats[broker].active++;\n              } else if (lower.includes(': done')) {\n                doneCount++;\n                brokerStats[broker].completed++;\n              }\n\n              // Check for KYC completed\n              if (lower.includes('kyc') && lower.includes(': done')) {\n                const completedMatch = line.match(/completed:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                if (completedMatch) {\n                  const kycDate = parseDate(completedMatch[1]);\n                  if (kycDate) {\n                    const monthKey = `${kycDate.getFullYear()}-${String(kycDate.getMonth() + 1).padStart(2, '0')}`;\n                    kycMonthly[monthKey] = (kycMonthly[monthKey] || 0) + 1;\n                  }\n                }\n              }\n\n              // Extract task name and assignee for attention items\n              const taskNameMatch = line.match(/^(.*?)\\s*:\\s*(to do|in progress|done)/i);\n              const assigneeMatch = line.match(/assigned to\\s+([^|]+)/i);\n              const taskName = taskNameMatch ? taskNameMatch[1].trim() : 'Unknown';\n              const assignee = assigneeMatch ? assigneeMatch[1].trim() : '';\n\n              // Check deadlines (support both formats)\n              const deadlineMatch = line.match(/deadline:\\s*(\\d{4}-\\d{2}-\\d{2}|\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n              if (deadlineMatch && !lower.includes(': done')) {\n                const deadline = parseDate(deadlineMatch[1]);\n                if (deadline) {\n                  const daysUntil = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));\n                  if (deadline < today) {\n                    overdueItems.push({\n                      company,\n                      task: taskName,\n                      assignee,\n                      detail: `${Math.abs(daysUntil)}d overdue`\n                    });\n                  } else if (deadline <= sevenDaysFromNow) {\n                    upcomingItems.push({\n                      company,\n                      task: taskName,\n                      assignee,\n                      detail: daysUntil === 0 ? 'Today' : `${daysUntil}d left`\n                    });\n                  }\n                }\n              }\n\n              // Check for stale tasks (no status update for 30+ days, not Done)\n              if (!lower.includes(': done')) {\n                // Look for the last action date (initiated, updated, or completed)\n                const initiatedMatch = line.match(/initiated:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                const updatedMatch = line.match(/updated:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                \n                let lastActionDate = null;\n                if (updatedMatch) {\n                  lastActionDate = parseDate(updatedMatch[1]);\n                } else if (initiatedMatch) {\n                  lastActionDate = parseDate(initiatedMatch[1]);\n                }\n                \n                if (lastActionDate && lastActionDate < thirtyDaysAgo) {\n                  const daysSince = Math.ceil((today - lastActionDate) / (1000 * 60 * 60 * 24));\n                  staleItems.push({\n                    company,\n                    task: taskName,\n                    assignee,\n                    detail: `${daysSince}d ago`\n                  });\n                }\n              }\n\n              // Calculate duration for completed tasks\n              if (lower.includes(': done')) {\n                const initiatedMatch = line.match(/initiated:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                const completedMatch = line.match(/completed:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n                if (initiatedMatch && completedMatch) {\n                  const initiated = parseDate(initiatedMatch[1]);\n                  const completed = parseDate(completedMatch[1]);\n                  if (initiated && completed) {\n                    const days = Math.ceil((completed - initiated) / (1000 * 60 * 60 * 24));\n                    if (days >= 0 && days < 365) {\n                      totalDuration += days;\n                      durationCount++;\n                    }\n                  }\n                }\n              }\n            });\n          }\n        }\n\n        // Update UI\n        const activeTasks = todoCount + inProgressCount;\n        qs('#statActiveTasks').textContent = activeTasks;\n        qs('#statAvgDuration').textContent = durationCount > 0 ? Math.round(totalDuration / durationCount) : '-';\n\n        // Status bars\n        const totalStatus = todoCount + inProgressCount + doneCount;\n        if (totalStatus > 0) {\n          qs('#barToDo').style.width = (todoCount / totalStatus * 100) + '%';\n          qs('#barInProgress').style.width = (inProgressCount / totalStatus * 100) + '%';\n          qs('#barDone').style.width = (doneCount / totalStatus * 100) + '%';\n        }\n        qs('#countToDo').textContent = todoCount;\n        qs('#countInProgress').textContent = inProgressCount;\n        qs('#countDone').textContent = doneCount;\n\n        // Attention Required section - render counts and task lists\n        // Helper to render attention items and show/hide group\n        const renderAttentionGroup = (items, groupId, listId, countId) => {\n          const group = qs(`#${groupId}`);\n          const container = qs(`#${listId}`);\n          const countEl = qs(`#${countId}`);\n          \n          if (countEl) countEl.textContent = items.length;\n          \n          if (!group || !container) return;\n          \n          if (items.length === 0) {\n            group.classList.remove('has-items');\n            container.innerHTML = '';\n            return;\n          }\n          \n          group.classList.add('has-items');\n          // Format: \"Company: Task to Assignee\" with detail on right\n          container.innerHTML = items.slice(0, 10).map(item => {\n            const assigneePart = item.assignee ? ` <span class=\"to-assignee\">to ${escapeHtml(item.assignee)}</span>` : '';\n            return `<div class=\"attention-item\">\n              <span class=\"task-info\" title=\"${escapeHtml(item.company)}: ${escapeHtml(item.task)}\">${escapeHtml(item.company)}: ${escapeHtml(item.task)}${assigneePart}</span>\n              <span class=\"task-detail\">${escapeHtml(item.detail)}</span>\n            </div>`;\n          }).join('');\n        };\n        \n        // Sort and render each list\n        overdueItems.sort((a, b) => parseInt(b.detail) - parseInt(a.detail)); // Most overdue first\n        upcomingItems.sort((a, b) => parseInt(a.detail) - parseInt(b.detail)); // Soonest first\n        staleItems.sort((a, b) => parseInt(b.detail) - parseInt(a.detail)); // Oldest first\n        \n        renderAttentionGroup(overdueItems, 'overdueGroup', 'overdueList', 'statOverdue');\n        renderAttentionGroup(upcomingItems, 'upcomingGroup', 'upcomingList', 'statUpcoming');\n        renderAttentionGroup(staleItems, 'staleGroup', 'staleList', 'statStale');\n\n        // Monthly Activity Visual Chart\n        const monthlyChart = qs('#monthlyChart');\n        if (monthlyChart) {\n          const sortedMonths = Object.keys(monthlyStats).sort().reverse().slice(0, 6).reverse();\n          const maxTasks = Math.max(...sortedMonths.map(m => monthlyStats[m] || 0), 1);\n          const maxKyc = Math.max(...sortedMonths.map(m => kycMonthly[m] || 0), 1);\n          const maxVal = Math.max(maxTasks, maxKyc);\n          \n          const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n          monthlyChart.innerHTML = sortedMonths.map(month => {\n            const [year, m] = month.split('-');\n            const shortMonth = monthNames[parseInt(m) - 1];\n            const tasks = monthlyStats[month] || 0;\n            const kyc = kycMonthly[month] || 0;\n            const taskHeight = maxVal > 0 ? (tasks / maxVal * 80) : 0;\n            const kycHeight = maxVal > 0 ? (kyc / maxVal * 80) : 0;\n            return `<div class=\"month-bar-group\">\n              <div class=\"month-bars\">\n                <div class=\"month-bar tasks\" style=\"height:${taskHeight}px\">\n                  ${tasks > 0 ? `<span class=\"month-bar-value\">${tasks}</span>` : ''}\n                </div>\n                <div class=\"month-bar kyc\" style=\"height:${kycHeight}px\">\n                  ${kyc > 0 ? `<span class=\"month-bar-value\">${kyc}</span>` : ''}\n                </div>\n              </div>\n              <div class=\"month-bar-label\">${shortMonth}</div>\n            </div>`;\n          }).join('');\n        }\n\n        // Broker Activity Visual Chart - Horizontal Bars like Status Distribution\n        const brokerChart = qs('#brokerChart');\n        if (brokerChart) {\n          const sortedBrokers = Object.entries(brokerStats)\n            .filter(([name]) => name && name !== '(none)' && name.trim() !== '')\n            .sort((a, b) => (b[1].active + b[1].completed) - (a[1].active + a[1].completed));\n          // Find max for scaling (active + completed combined)\n          const maxTasks = Math.max(...sortedBrokers.map(([,s]) => s.active + s.completed), 1);\n          \n          brokerChart.innerHTML = sortedBrokers.map(([name, stats]) => {\n            const activeWidth = maxTasks > 0 ? (stats.active / maxTasks * 100) : 0;\n            const completedWidth = maxTasks > 0 ? (stats.completed / maxTasks * 100) : 0;\n            return `<div class=\"broker-row\">\n              <span class=\"broker-name\" title=\"${escapeHtml(name)}\">${escapeHtml(name)}</span>\n              <div class=\"broker-bar-track\">\n                <div class=\"broker-bar-fill active\" style=\"width:${activeWidth}%\">${stats.active > 0 ? `<span class=\"bar-num\">${stats.active}</span>` : ''}</div>\n                <div class=\"broker-bar-fill completed\" style=\"width:${completedWidth}%\">${stats.completed > 0 ? `<span class=\"bar-num\">${stats.completed}</span>` : ''}</div>\n              </div>\n            </div>`;\n          }).join('');\n        }\n      });\n    } catch (e) {\n      console.error('Error loading statistics:', e);\n    }\n  }\n\n  // Helper to parse various date formats including Excel serial numbers\n  // Fix for timezone-related date parsing bug\n  // When parsing yyyy-MM-dd strings, JavaScript interprets them as UTC midnight.\n  // This can cause day shifts when the local timezone is behind UTC.\n  function parseDate(dateVal) {\n    if (!dateVal) return null;\n    \n    // Check if it's an Excel serial number (numeric value)\n    // Excel dates are days since Jan 1, 1900 (with a bug for 1900 leap year)\n    if (typeof dateVal === 'number' && dateVal > 1 && dateVal < 100000) {\n      // Excel serial date: days since Dec 30, 1899 (accounting for Excel's leap year bug)\n      // Use UTC to avoid timezone issues, then create local date\n      const excelEpoch = Date.UTC(1899, 11, 30); // Dec 30, 1899 in UTC\n      const utcDate = new Date(excelEpoch + dateVal * 24 * 60 * 60 * 1000);\n      // Create a local date with the same year/month/day\n      const result = new Date(utcDate.getUTCFullYear(), utcDate.getUTCMonth(), utcDate.getUTCDate());\n      if (!isNaN(result.getTime()) && result.getFullYear() > 1970) {\n        return result;\n      }\n    }\n    \n    // Try as string\n    const dateStr = String(dateVal).trim();\n    \n    // Handle yyyy-MM-dd format (ISO) - parse directly to avoid timezone issues\n    const isoMatch = dateStr.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (isoMatch) {\n      const year = parseInt(isoMatch[1], 10);\n      const month = parseInt(isoMatch[2], 10) - 1; // 0-indexed\n      const day = parseInt(isoMatch[3], 10);\n      return new Date(year, month, day);\n    }\n    \n    // Try d-MMM-yyyy format (e.g., \"15-Nov-2025\")\n    const match = dateStr.match(/(\\d{1,2})[-\\s]([A-Za-z]{3})[-\\s](\\d{2,4})/);\n    if (match) {\n      const months = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};\n      const day = parseInt(match[1]);\n      const month = months[match[2].toLowerCase()];\n      let year = parseInt(match[3]);\n      if (year < 100) year += 2000;\n      if (month !== undefined) {\n        return new Date(year, month, day);\n      }\n    }\n    \n    // Fallback: try native parsing (but this may have timezone issues)\n    let d = new Date(dateStr);\n    if (!isNaN(d.getTime()) && d.getFullYear() > 1970) return d;\n    \n    return null;\n  }\n\n  // Search functionality\n  const searchInput = qs('#searchInput');\n  const searchInputWrap = qs('#searchInputWrap');\n  const searchBtn = qs('#searchBtn');\n  const searchResults = qs('#searchResults');\n  const searchHint = qs('#searchHint');\n  const searchTabs = qsa('.search-tab');\n  let currentSearchMode = 'active'; // Default to active tasks\n\n  // Update search UI based on mode\n  const loadRowHint = qs('#loadRowHint');\n  \n  function updateSearchUI() {\n    if (!searchHint || !searchInput || !searchInputWrap) return;\n    \n    if (currentSearchMode === 'active') {\n      searchInputWrap.style.display = 'none'; // No input needed\n      if (loadRowHint) loadRowHint.style.display = 'none';\n      searchHint.textContent = ' Showing tasks with status: To Do or In Progress';\n    } else if (currentSearchMode === 'company') {\n      searchInputWrap.style.display = 'flex';\n      if (loadRowHint) loadRowHint.style.display = 'flex';\n      searchInput.placeholder = 'Type company name...';\n      searchInput.type = 'text';\n      searchHint.textContent = '';\n    }\n  }\n\n  // Search tab switching\n  searchTabs.forEach(tab => {\n    tab.addEventListener('click', async () => {\n      searchTabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentSearchMode = tab.getAttribute('data-search');\n      if (searchInput) {\n        searchInput.value = '';\n      }\n      updateSearchUI();\n      \n      // Auto-load active tasks when that tab is selected\n      if (currentSearchMode === 'active') {\n        await performSearch();\n      } else {\n        // Clear results for other modes until user searches\n        if (searchResults) {\n          searchResults.classList.remove('visible');\n          searchResults.innerHTML = '';\n        }\n      }\n    });\n  });\n\n  // Search button click\n  if (searchBtn) {\n    searchBtn.addEventListener('click', async () => {\n      await performSearch();\n    });\n  }\n\n  // Enter key in search input\n  if (searchInput) {\n    searchInput.addEventListener('keypress', async (e) => {\n      if (e.key === 'Enter') {\n        hideAutocomplete();\n        await performSearch();\n      }\n    });\n  }\n\n  // Autocomplete for company search\n  const autocompleteDropdown = qs('#autocompleteDropdown');\n  let companyList = []; // Cache of all companies with row numbers\n  let autocompleteTimeout = null;\n\n  // Load all companies for autocomplete (includes ALL rows, not just unique companies)\n  async function loadCompanyList() {\n    if (companyList.length > 0) return; // Already loaded\n    try {\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n        if (sheet.isNullObject) return;\n\n        // Load columns A (company) and B (task category) to differentiate multiple rows\n        const dataRange = sheet.getRange('A2:B5000');\n        dataRange.load('values');\n        await context.sync();\n\n        const values = dataRange.values || [];\n        companyList = [];\n        for (let i = 0; i < values.length; i++) {\n          const name = values[i][0] ? String(values[i][0]).trim() : '';\n          const category = values[i][1] ? String(values[i][1]).trim() : '';\n          if (name) {\n            companyList.push({ name, category, rowNum: i + 2 });\n          }\n        }\n        // Keep ALL entries - don't remove duplicates so users can see all tasks for a company\n        console.log('Loaded', companyList.length, 'company rows for autocomplete');\n      });\n    } catch (e) {\n      console.error('Failed to load company list:', e);\n    }\n  }\n\n  function showAutocomplete(query) {\n    if (!autocompleteDropdown || !query || currentSearchMode !== 'company') {\n      hideAutocomplete();\n      return;\n    }\n    const q = query.toLowerCase();\n    \n    // Filter matches and sort: companies starting with query first, then contains\n    const allMatches = companyList.filter(c => c.name.toLowerCase().includes(q));\n    const startsWithMatches = allMatches.filter(c => c.name.toLowerCase().startsWith(q));\n    const containsMatches = allMatches.filter(c => !c.name.toLowerCase().startsWith(q));\n    const sortedMatches = [...startsWithMatches, ...containsMatches].slice(0, 15);\n    \n    if (sortedMatches.length === 0) {\n      hideAutocomplete();\n      return;\n    }\n    autocompleteDropdown.innerHTML = sortedMatches.map(c => {\n      const categoryHint = c.category ? `  ${escapeHtml(c.category)}` : '';\n      return `<div class=\"autocomplete-item\" data-row=\"${c.rowNum}\" data-name=\"${escapeHtml(c.name)}\">\n        <span class=\"company-name\">${escapeHtml(c.name)}</span>\n        <span class=\"row-hint\">Row ${c.rowNum}${categoryHint}</span>\n      </div>`;\n    }).join('');\n    autocompleteDropdown.classList.add('visible');\n\n    // Wire click handlers\n    autocompleteDropdown.querySelectorAll('.autocomplete-item').forEach(item => {\n      item.addEventListener('click', async () => {\n        const rowNum = parseInt(item.getAttribute('data-row'), 10);\n        const name = item.getAttribute('data-name');\n        if (searchInput) searchInput.value = name;\n        hideAutocomplete();\n        await selectAndLoadRow(rowNum);\n      });\n    });\n  }\n\n  function hideAutocomplete() {\n    if (autocompleteDropdown) {\n      autocompleteDropdown.classList.remove('visible');\n      autocompleteDropdown.innerHTML = '';\n    }\n  }\n\n  // Wire autocomplete on input\n  if (searchInput) {\n    searchInput.addEventListener('input', (e) => {\n      if (currentSearchMode !== 'company') return;\n      clearTimeout(autocompleteTimeout);\n      const val = e.target.value.trim();\n      if (val.length < 1) {\n        hideAutocomplete();\n        return;\n      }\n      // Debounce to avoid too many updates\n      autocompleteTimeout = setTimeout(() => {\n        showAutocomplete(val);\n      }, 150);\n    });\n\n    searchInput.addEventListener('focus', async () => {\n      if (currentSearchMode === 'company') {\n        await loadCompanyList();\n        if (searchInput.value.trim().length >= 1) {\n          showAutocomplete(searchInput.value.trim());\n        }\n      }\n    });\n\n    searchInput.addEventListener('blur', () => {\n      // Delay hide to allow click on dropdown\n      setTimeout(hideAutocomplete, 200);\n    });\n  }\n\n  // Initialize search UI on load\n  updateSearchUI();\n\n  async function performSearch() {\n    if (!searchResults) return;\n    \n    searchResults.innerHTML = '<div class=\"no-results\">Searching...</div>';\n    searchResults.classList.add('visible');\n    console.log('Search started, mode:', currentSearchMode);\n\n    try {\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n        console.log('Sheet found:', !sheet.isNullObject);\n        if (sheet.isNullObject) {\n          searchResults.innerHTML = '<div class=\"no-results\">Sheet not found</div>';\n          return;\n        }\n\n        // Read a fixed block of rows to avoid issues with usedRange returning too small an area.\n        const maxRows = 5000;\n        const dataRange = sheet.getRange(`A1:K${maxRows}`);\n        dataRange.load('values');\n        await context.sync();\n\n        const rawValues = dataRange.values || [];\n        console.log('Raw rows loaded (including header and blanks):', rawValues.length);\n\n        const values = Array.isArray(rawValues) ? rawValues : [];\n        const results = [];\n        let scannedRows = 0;\n\n        for (let i = 1; i < values.length; i++) { // Skip header row\n          const row = values[i] || [];\n          const isEmpty = row.every(c => c === null || c === '');\n          if (isEmpty) continue;\n          scannedRows++;\n          const companyName = row[0] ? String(row[0]).trim() : '';\n          const taskCategory = row[1] ? String(row[1]).trim() : '';\n          const taskSummary = row[7] ? String(row[7]).trim() : ''; // Column H\n\n          // Determine status and dates from Column H\n          let hasActiveTasks = false;\n          let dominantStatus = 'unknown';\n          let hasTodo = false, hasProgress = false, hasDone = false;\n          let todoDates = [];\n          let progressDates = [];\n          let doneDates = [];\n\n          if (taskSummary) {\n            const lines = taskSummary.split(/\\r?\\n/).filter(Boolean);\n            lines.forEach(line => {\n              const parsed = parseTaskLine(line);\n              if (!parsed) return;\n              const st = (parsed.status || '').toLowerCase();\n              if (st === 'to do') {\n                hasTodo = true;\n                if (parsed.initiated) todoDates.push(parsed.initiated);\n              } else if (st === 'in progress') {\n                hasProgress = true;\n                if (parsed.updated) progressDates.push(parsed.updated);\n              } else if (st === 'done') {\n                hasDone = true;\n                if (parsed.completed) doneDates.push(parsed.completed);\n              }\n            });\n            hasActiveTasks = hasTodo || hasProgress;\n            if (hasProgress) dominantStatus = 'progress';\n            else if (hasTodo) dominantStatus = 'todo';\n            else if (hasDone) dominantStatus = 'done';\n          }\n\n          // Choose a status-specific date to display\n          function mostRecentDate(dateArr) {\n            if (!dateArr || dateArr.length === 0) return '';\n            let best = null;\n            dateArr.forEach(dStr => {\n              if (!dStr) return;\n              const d = new Date(dStr);\n              if (isNaN(d.getTime())) return;\n              if (!best || d > best) best = d;\n            });\n            if (!best) return '';\n            const yyyy = best.getFullYear();\n            const mm = String(best.getMonth() + 1).padStart(2,'0');\n            const dd = String(best.getDate()).padStart(2,'0');\n            return `${yyyy}-${mm}-${dd}`; // normalized for display formatter\n          }\n\n          let statusDateLabel = '';\n          let statusDateRaw = '';\n          if (dominantStatus === 'progress') {\n            statusDateRaw = mostRecentDate(progressDates);\n            statusDateLabel = statusDateRaw ? 'Updated' : '';\n          } else if (dominantStatus === 'todo') {\n            statusDateRaw = mostRecentDate(todoDates);\n            statusDateLabel = statusDateRaw ? 'Initiated' : '';\n          } else if (dominantStatus === 'done') {\n            statusDateRaw = mostRecentDate(doneDates);\n            statusDateLabel = statusDateRaw ? 'Completed' : '';\n          }\n\n          const statusDateDisplay = statusDateRaw ? formatDateForDisplay(statusDateRaw) : '';\n\n          const rowNum = i + 1; // 1-based row number\n\n          if (currentSearchMode === 'company') {\n            const query = (searchInput ? searchInput.value : '').toLowerCase().trim();\n            console.log('Checking row', rowNum, '- Company:', companyName, '- Query:', query);\n            if (query && companyName.toLowerCase().includes(query)) {\n              console.log('Match found:', companyName);\n              results.push({ rowNum, companyName, taskCategory, dominantStatus, hasActiveTasks, statusDateLabel, statusDateDisplay });\n            }\n          } else if (currentSearchMode === 'active') {\n            console.log('Checking row', rowNum, '- Company:', companyName, '- Active:', hasActiveTasks);\n            if (hasActiveTasks) {\n              results.push({ rowNum, companyName, taskCategory, dominantStatus, hasActiveTasks, statusDateLabel, statusDateDisplay });\n            }\n          }\n        }\n\n        const totalRows = scannedRows;\n        const modeLabel = currentSearchMode === 'company' ? 'Company' : 'Active tasks';\n        const rawQuery = (searchInput ? searchInput.value : '').trim();\n        console.log('Search complete, mode:', modeLabel, 'rows scanned:', totalRows, 'matches:', results.length, 'query:', rawQuery);\n        if (results.length === 0) {\n          searchResults.innerHTML = '<div class=\"no-results\">No results found</div>';\n        } else {\n          searchResults.innerHTML = results.map(r => {\n            const statusBadge = r.dominantStatus === 'progress' \n              ? '<span class=\"status-badge progress\">In Progress</span>'\n              : r.dominantStatus === 'todo'\n              ? '<span class=\"status-badge todo\">To Do</span>'\n              : r.dominantStatus === 'done'\n              ? '<span class=\"status-badge done\">Done</span>'\n              : '';\n\n            const datePart = (r.statusDateLabel && r.statusDateDisplay)\n              ? `  ${r.statusDateLabel} ${escapeHtml(r.statusDateDisplay)}`\n              : '';\n\n            return `<div class=\"search-result-item\" data-row=\"${r.rowNum}\">\n              <div class=\"company\">${escapeHtml(r.companyName || '(No name)')}${statusBadge}</div>\n              <div class=\"meta\">Row ${r.rowNum}  ${escapeHtml(r.taskCategory || 'No category')}${datePart}</div>\n            </div>`;\n          }).join('');\n\n          // Wire click handlers\n          searchResults.querySelectorAll('.search-result-item').forEach(item => {\n            item.addEventListener('click', async () => {\n              const rowNum = parseInt(item.getAttribute('data-row'), 10);\n              await selectAndLoadRow(rowNum);\n              searchResults.classList.remove('visible');\n            });\n          });\n        }\n      });\n    } catch (e) {\n      console.error('Search error:', e);\n      searchResults.innerHTML = '<div class=\"no-results\">Search error</div>';\n    }\n  }\n\n  async function selectAndLoadRow(rowNum) {\n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return;\n\n      const targetRange = sheet.getRange(`A${rowNum}`);\n      targetRange.select();\n      await context.sync();\n    });\n    await loadFromActiveRow();\n  }\n\n  // Find Last KYC Produced date for a company\n  async function findLastKycDate(companyName) {\n    if (!companyName) return null;\n    \n    return Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return null;\n\n      const usedRange = sheet.getUsedRange();\n      usedRange.load('values');\n      await context.sync();\n\n      const values = usedRange.values || [];\n      let lastKycDate = null;\n\n      for (let i = 1; i < values.length; i++) {\n        const row = values[i];\n        const rowCompany = row[0] ? String(row[0]).trim().toLowerCase() : '';\n        const taskSummary = row[7] ? String(row[7]).trim() : ''; // Column H\n\n        if (rowCompany === companyName.toLowerCase() && taskSummary) {\n          // Look for KYC task with Done status\n          const lines = taskSummary.split(/\\r?\\n/).filter(Boolean);\n          lines.forEach(line => {\n            const lower = line.toLowerCase();\n            if ((lower.includes('kyc') && lower.includes(': done'))) {\n              // Try to extract completed date\n              const completedMatch = line.match(/completed:\\s*(\\d{1,2}[-\\s][A-Za-z]{3}[-\\s]\\d{2,4})/i);\n              if (completedMatch) {\n                lastKycDate = completedMatch[1];\n              }\n            }\n          });\n        }\n      }\n      return lastKycDate;\n    });\n  }\n\n  // Format date as d-MMM-yyyy (e.g., 1-Jul-2025)\n  // Fix for timezone-related date shift bug\n  // When parsing yyyy-MM-dd strings, JavaScript interprets them as UTC midnight.\n  // This can cause day shifts when converting back to local time.\n  function formatDateForDisplay(dateStr) {\n    if (!dateStr) return '';\n    \n    // Handle yyyy-MM-dd format specially to avoid timezone issues\n    const ymdMatch = String(dateStr).match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n    if (ymdMatch) {\n      // Parse components directly to avoid UTC interpretation\n      const year = parseInt(ymdMatch[1], 10);\n      const month = parseInt(ymdMatch[2], 10) - 1; // 0-indexed\n      const day = parseInt(ymdMatch[3], 10);\n      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n      return `${day}-${months[month]}-${year}`;\n    }\n    \n    // For other formats, use Date parsing\n    const d = new Date(dateStr);\n    if (isNaN(d.getTime())) return '';\n    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    const day = d.getDate();\n    const month = months[d.getMonth()];\n    const year = d.getFullYear();\n    return `${day}-${month}-${year}`;\n  }\n  \n  // Alias for Excel output (same format)\n  const formatDateForExcel = formatDateForDisplay;\n\n  // Get selected task categories\n  function getSelectedCategories() {\n    return qsa('#taskCategories .category-toggle:checked').map(cb => cb.value);\n  }\n\n  // Check if \"Other Task\" is selected\n  function isOtherTaskSelected() {\n    const cb = qs('#taskCategories .category-toggle[value=\"Other Task\"]');\n    return cb && cb.checked;\n  }\n\n  function getTaskCard(taskName){\n    // __other__ card is now outside #taskCards\n    if (taskName === '__other__') {\n      return qs('#otherTaskCard');\n    }\n    return taskCardsContainer ? taskCardsContainer.querySelector(`.task-card[data-task=\"${taskName}\"]`) : null;\n  }\n\n  function getTaskStatusChips(card){\n    if (!card) return [];\n    const container = card.querySelector('[data-role=\"status-chips\"]');\n    return container ? Array.from(container.querySelectorAll('.chip')) : [];\n  }\n\n  function setCardStatus(card, val){\n    const chips = getTaskStatusChips(card);\n    chips.forEach(c=>{\n      c.classList.toggle('active', c.getAttribute('data-value')===val);\n    });\n  }\n\n  function getCardStatus(card){\n    const chips = getTaskStatusChips(card);\n    const active = chips.find(c=>c.classList.contains('active'));\n    return active ? active.getAttribute('data-value') : 'To Do';\n  }\n\n  function wireCardChips(){\n    // Wire chips in #taskCards and #otherTaskCard\n    qsa('#taskCards [data-role=\"status-chips\"] .chip, #otherTaskCard [data-role=\"status-chips\"] .chip').forEach(chip => {\n      chip.addEventListener('click', () => {\n        const container = chip.closest('[data-role=\"status-chips\"]');\n        if (!container) return;\n        const siblings = Array.from(container.querySelectorAll('.chip'));\n        siblings.forEach(c=>{\n          c.classList.toggle('active', c === chip);\n        });\n      });\n    });\n  }\n\n  function syncTasksVisibility(){\n    if (!tasksRowEl || !taskCardsContainer) return;\n    const isOther = isOtherTaskSelected();\n    const otherCard = qs('#otherTaskCard'); // Now outside #taskCards\n    const selectedCategories = getSelectedCategories();\n    const hasNonOtherCategory = selectedCategories.some(c => c !== 'Other Task');\n\n    // Show tasks section if any non-\"Other Task\" category is selected\n    if (hasNonOtherCategory) {\n      tasksRowEl.style.display = '';\n    } else {\n      tasksRowEl.style.display = 'none';\n    }\n\n    // Show/hide fixed task cards based on task toggles\n    const selected = new Set(getSelectedTaskToggles());\n    const fixedCards = qsa('#taskCards .task-card');\n    fixedCards.forEach(card => {\n      const name = card.getAttribute('data-task');\n      card.style.display = selected.has(name) ? '' : 'none';\n    });\n\n    // Show __other__ card if \"Other Task\" category is selected\n    if (otherCard) {\n      otherCard.style.display = isOther ? '' : 'none';\n    }\n  }\n\n  // Update Extra Note placeholder based on selected categories\n  function updateExtraNotePlaceholder() {\n    if (!extraNoteEl) return;\n    const categories = getSelectedCategories().filter(c => c !== 'Other Task');\n    if (categories.length === 0) {\n      extraNoteEl.placeholder = 'General note about this task';\n    } else if (categories.length === 1) {\n      extraNoteEl.placeholder = 'General note about this ' + categories[0];\n    } else {\n      extraNoteEl.placeholder = 'General note about these tasks';\n    }\n  }\n\n  // Wire category checkboxes to update visibility and placeholder\n  qsa('#taskCategories .category-toggle').forEach(cb => {\n    cb.addEventListener('change', () => {\n      syncTasksVisibility();\n      updateExtraNotePlaceholder();\n    });\n  });\n\n  function getSelectedTaskToggles(){\n    return qsa('#tasksChecklist .task-toggle:checked').map(cb => cb.value);\n  }\n\n  // Reorder checkboxes so checked ones appear at the top\n  function reorderCheckboxesToTop(containerSelector) {\n    const container = qs(containerSelector);\n    if (!container) return;\n    \n    // Get all items - could be direct children (div wrappers) or labels\n    const items = Array.from(container.children);\n    if (items.length === 0) return;\n    \n    // Sort: checked items first, then unchecked (maintain original order within each group)\n    const checked = [];\n    const unchecked = [];\n    items.forEach(item => {\n      const cb = item.querySelector('input[type=checkbox]') || item.querySelector('input[type=\"checkbox\"]');\n      if (cb && cb.checked) {\n        checked.push(item);\n      } else {\n        unchecked.push(item);\n      }\n    });\n    \n    // Re-append in sorted order: checked first, then unchecked\n    [...checked, ...unchecked].forEach(item => container.appendChild(item));\n  }\n\n  async function loadTeamMembers(){\n    if (teamMembersLoaded) return;\n    teamMembersLoaded = true; // guard immediately to avoid overlapping calls\n    const box = qs('#assignees');\n    if (!box) return;\n    // Additional DOM-level guard in case the script is evaluated more than once\n    if (box.dataset.initialized === '1') {\n      return;\n    }\n    box.dataset.initialized = '1';\n    box.innerHTML='';\n\n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('Team members');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) {\n        console.error('Team members sheet not found');\n        return;\n      }\n\n      // Read column A only for team member names\n      const usedRange = sheet.getUsedRange();\n      usedRange.load('values');\n      await context.sync();\n\n      const values = usedRange.values || [];\n      const namesRaw = values.slice(1) // skip header row\n        .map(row => row[0])\n        .filter(n => n && String(n).trim().length > 0)\n        .map(n => String(n).trim());\n\n      const names = Array.from(new Set(namesRaw)); // dedupe\n      console.log('Team members loaded from column A:', names); // Debug log\n\n      names.forEach(n => {\n        const w = document.createElement('div');\n        w.innerHTML = `<label><input type=\"checkbox\" value=\"${n}\"> ${n}</label>`;\n        box.appendChild(w);\n      });\n\n      if (brokerLeadEl) {\n        brokerLeadEl.innerHTML = '';\n        const noneOpt = document.createElement('option');\n        noneOpt.value = '';\n        noneOpt.textContent = '(none)';\n        brokerLeadEl.appendChild(noneOpt);\n        names.forEach(n => {\n          const opt = document.createElement('option');\n          opt.value = n;\n          opt.textContent = n;\n          brokerLeadEl.appendChild(opt);\n        });\n      }\n    });\n  }\n\n  function getSelectedAssignees(){\n    return Array.from(document.querySelectorAll('#assignees input[type=checkbox]:checked')).map(i=>i.value);\n  }\n\n  // Populate per-task assignee dropdowns with selected assignees\n  function updateTaskAssigneeDropdowns() {\n    const selectedAssignees = getSelectedAssignees();\n    const dropdowns = qsa('.task-assignee-select');\n    \n    dropdowns.forEach(dropdown => {\n      const currentValue = dropdown.value;\n      dropdown.innerHTML = '';\n      \n      // Add empty option\n      const emptyOpt = document.createElement('option');\n      emptyOpt.value = '';\n      emptyOpt.textContent = '(Select assignee)';\n      dropdown.appendChild(emptyOpt);\n      \n      // Add selected assignees as options\n      selectedAssignees.forEach(name => {\n        const opt = document.createElement('option');\n        opt.value = name;\n        opt.textContent = name;\n        dropdown.appendChild(opt);\n      });\n      \n      // Auto-select if only one assignee\n      if (selectedAssignees.length === 1) {\n        dropdown.value = selectedAssignees[0];\n      } else if (selectedAssignees.includes(currentValue)) {\n        // Restore previous selection if still valid\n        dropdown.value = currentValue;\n      }\n    });\n  }\n\n  // Wire assignee checkboxes to update per-task dropdowns\n  document.querySelectorAll('#assignees').forEach(container => {\n    container.addEventListener('change', (e) => {\n      if (e.target.type === 'checkbox') {\n        updateTaskAssigneeDropdowns();\n      }\n    });\n  });\n\n  async function getActiveRowIndex(){\n    return Excel.run(async (context) => {\n      // Use the currently selected range in the workbook\n      const range = context.workbook.getSelectedRange();\n      range.load('rowIndex');\n      await context.sync();\n      // rowIndex is 0-based; UI shows 1-based row numbers\n      return range.rowIndex + 1;\n    });\n  }\n\n  function parseTaskLine(raw){\n    // More flexible parsing that handles fields in any order\n    if (!raw) return null;\n    \n    // First, check basic structure: \"TaskName: Status || Assigned to ...\"\n    const basicMatch = /^(.*?)\\s*:\\s*(to do|in progress|done)\\s*\\|\\|\\s*assigned to\\s+([^|]+)/i.exec(raw);\n    if (!basicMatch) return null;\n    \n    const result = {\n      name: basicMatch[1].trim(),\n      status: basicMatch[2],\n      assignee: basicMatch[3].trim(),\n      comment: '',\n      giveUpId: '',\n      initiated: '',\n      updated: '',\n      completed: '',\n      deadline: ''\n    };\n    \n    // Extract optional fields in any order\n    const commentMatch = /\\|\\|\\s*comment:\\s*([^|]+)/i.exec(raw);\n    if (commentMatch) result.comment = commentMatch[1].trim();\n    \n    const giveUpMatch = /\\|\\|\\s*give-up id:\\s*([^|]+)/i.exec(raw);\n    if (giveUpMatch) result.giveUpId = giveUpMatch[1].trim();\n    \n    const initiatedMatch = /\\|\\|\\s*task initiated:\\s*([^|]+)/i.exec(raw);\n    if (initiatedMatch) result.initiated = initiatedMatch[1].trim();\n    \n    const updatedMatch = /\\|\\|\\s*status updated:\\s*([^|]+)/i.exec(raw);\n    if (updatedMatch) result.updated = updatedMatch[1].trim();\n    \n    const completedMatch = /\\|\\|\\s*completed:\\s*([^|]+)/i.exec(raw);\n    if (completedMatch) result.completed = completedMatch[1].trim();\n    \n    const deadlineMatch = /\\|\\|\\s*deadline:\\s*([^|]+)/i.exec(raw);\n    if (deadlineMatch) result.deadline = deadlineMatch[1].trim();\n    \n    return result;\n  }\n\n  function buildSummaryLine(v){\n    const parts = [];\n    const status = v.status || 'To Do';\n    // First segment must match parseTaskLine: \"<TaskName>: <Status>\"\n    parts.push(`${v.name}: ${status}`);\n    parts.push(`Assigned to ${v.assignees}`);\n    if (v.comment) parts.push(`Comment: ${v.comment}`);\n    if (v.giveUpId) parts.push(`Give-up ID: ${v.giveUpId}`);\n    // Only one date field will be set based on status (last action)\n    if (v.initiated) parts.push(`Task initiated: ${v.initiated}`);\n    if (v.updated) parts.push(`Status updated: ${v.updated}`);\n    if (v.completed) parts.push(`Completed: ${v.completed}`);\n    if (v.deadline) parts.push(`Deadline: ${v.deadline}`);\n    return parts.join(' || ');\n  }\n\n  async function loadFromActiveRow(){\n    await loadTeamMembers();\n    await Excel.run(async (context) => {\n      // Get active row within the same context to avoid sync issues\n      const selectedRange = context.workbook.getSelectedRange();\n      selectedRange.load('rowIndex');\n      await context.sync();\n      const uiRow = selectedRange.rowIndex + 1;\n\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return;\n\n      // Load row-level metadata and Column H, J, K in one go\n      const companyRange = sheet.getRange(`A${uiRow}`);\n      const descRange = sheet.getRange(`B${uiRow}`);\n      const assigneesRange = sheet.getRange(`C${uiRow}`);\n      const brokerRange = sheet.getRange(`D${uiRow}`);\n      const datesRange = sheet.getRange(`E${uiRow}:G${uiRow}`);\n      const hRange = sheet.getRange(`H${uiRow}`);\n      const jRange = sheet.getRange(`J${uiRow}`);\n      const kRange = sheet.getRange(`K${uiRow}`);\n      companyRange.load('values');\n      descRange.load('values');\n      assigneesRange.load('values');\n      brokerRange.load('values');\n      datesRange.load('values');\n      hRange.load('values');\n      jRange.load('values');\n      kRange.load('values');\n      await context.sync();\n\n      // Company name from column A\n      const companyVal = (companyRange.values && companyRange.values[0] && companyRange.values[0][0])\n        ? String(companyRange.values[0][0])\n        : '';\n      if (companyNameInput) companyNameInput.value = companyVal;\n\n      const descVal = (descRange.values && descRange.values[0] && descRange.values[0][0])\n        ? String(descRange.values[0][0])\n        : '';\n      // Parse comma-separated categories and check the corresponding checkboxes\n      const categories = descVal.split(',').map(s => s.trim()).filter(Boolean);\n      const allowedDescs = ['Onboarding', 'Amended Product/Rate', 'KYC update', 'Other Task'];\n      qsa('#taskCategories .category-toggle').forEach(cb => {\n        const match = categories.some(cat => cat.toLowerCase() === cb.value.toLowerCase());\n        cb.checked = match;\n      });\n\n      const brokerVal = (brokerRange.values && brokerRange.values[0] && brokerRange.values[0][0])\n        ? String(brokerRange.values[0][0])\n        : '';\n\n      if (brokerLeadEl) {\n        brokerLeadEl.value = brokerVal;\n      }\n\n      // Assignees from column C\n      const assigneesVal = (assigneesRange.values && assigneesRange.values[0] && assigneesRange.values[0][0])\n        ? String(assigneesRange.values[0][0])\n        : '';\n      const assigneesList = assigneesVal.split(/[,;]+/).map(s => s.trim().toLowerCase()).filter(Boolean);\n      console.log('Assignees from column C:', assigneesList);\n      document.querySelectorAll('#assignees input[type=checkbox]').forEach(cb => {\n        cb.checked = assigneesList.includes(cb.value.toLowerCase());\n      });\n\n      const datesRow = (datesRange.values && datesRange.values[0]) ? datesRange.values[0] : [null, null, null];\n\n      // Fix for timezone-related date shift bug in toInputDate\n      // When parsing yyyy-MM-dd strings, JavaScript interprets them as UTC midnight.\n      // This can cause day shifts when converting back to local time.\n      function toInputDate(v){\n        if (v == null || v === '') return '';\n        \n        // Excel serial number (days since 1900-01-01, with Excel's leap year bug)\n        if (typeof v === 'number') {\n          // Excel serial date: 1 = Jan 1, 1900\n          // Use UTC to avoid timezone issues\n          const excelEpoch = Date.UTC(1899, 11, 30); // Dec 30, 1899 (Excel's day 0) in UTC\n          const d = new Date(excelEpoch + v * 86400000);\n          const yyyy = d.getUTCFullYear();\n          const mm = String(d.getUTCMonth() + 1).padStart(2,'0');\n          const dd = String(d.getUTCDate()).padStart(2,'0');\n          return `${yyyy}-${mm}-${dd}`;\n        }\n        \n        // Excel usually returns Date objects for date cells\n        if (v instanceof Date) {\n          const yyyy = v.getFullYear();\n          const mm = String(v.getMonth() + 1).padStart(2,'0');\n          const dd = String(v.getDate()).padStart(2,'0');\n          return `${yyyy}-${mm}-${dd}`;\n        }\n        \n        const s = String(v).trim();\n        \n        // Handle yyyy-MM-dd format (ISO) - parse directly to avoid timezone issues\n        const ymdMatch = s.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n        if (ymdMatch) {\n          return s; // Already in correct format, return as-is\n        }\n        \n        // Handle d-MMM-yyyy format (e.g., \"1-Jul-2025\")\n        const dmmyMatch = s.match(/^(\\d{1,2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\\d{4})$/i);\n        if (dmmyMatch) {\n          const months = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};\n          const day = parseInt(dmmyMatch[1], 10);\n          const mon = months[dmmyMatch[2].toLowerCase()];\n          const year = parseInt(dmmyMatch[3], 10);\n          const dd = String(day).padStart(2,'0');\n          const mm = String(mon + 1).padStart(2,'0');\n          return `${year}-${mm}-${dd}`;\n        }\n        \n        // Try to parse strings / other values as dates\n        // But be careful with timezone issues\n        const d = new Date(v);\n        if (!isNaN(d.getTime())) {\n          const yyyy = d.getFullYear();\n          const mm = String(d.getMonth() + 1).padStart(2,'0');\n          const dd = String(d.getDate()).padStart(2,'0');\n          return `${yyyy}-${mm}-${dd}`;\n        }\n        \n        // Fallback: attempt to slice a yyyy-MM-dd looking prefix\n        return s.length >= 10 ? s.slice(0,10) : '';\n      }\n\n      console.log('Date values from Excel:', datesRow); // Debug log\n      if (initialRequestInput) initialRequestInput.value = toInputDate(datesRow[0]);\n      if (introEmailInput) introEmailInput.value = toInputDate(datesRow[1]);\n      if (remindersStartInput) remindersStartInput.value = toInputDate(datesRow[2]);\n      console.log('Parsed dates:', initialRequestInput?.value, introEmailInput?.value, remindersStartInput?.value); // Debug log\n\n      // Email Frequency from column J\n      const freqVal = (jRange.values && jRange.values[0] && jRange.values[0][0])\n        ? String(jRange.values[0][0])\n        : '';\n      if (emailFrequencyEl) emailFrequencyEl.value = freqVal;\n\n      // Extra Note from column K\n      const noteVal = (kRange.values && kRange.values[0] && kRange.values[0][0])\n        ? String(kRange.values[0][0])\n        : '';\n      if (extraNoteEl) extraNoteEl.value = noteVal;\n\n      const summary = (hRange.values && hRange.values[0] && hRange.values[0][0])\n        ? String(hRange.values[0][0])\n        : '';\n\n      // Parse all task lines in H\n      const lines = summary\n        .split(/\\r?\\n/)\n        .map(s => s.trim())\n        .filter(Boolean);\n      const parsedTasks = [];\n      const nonTaskLines = [];\n      for (let i = 0; i < lines.length; i++) {\n        const cand = parseTaskLine(lines[i]);\n        if (cand) {\n          parsedTasks.push(cand);\n        } else {\n          nonTaskLines.push(lines[i]);\n        }\n      }\n\n      // Sort tasks by status priority: To Do > In Progress > Done\n      const statusPriority = { 'to do': 1, 'in progress': 2, 'done': 3 };\n      parsedTasks.sort((a, b) => {\n        const aPriority = statusPriority[(a.status || '').toLowerCase()] || 4;\n        const bPriority = statusPriority[(b.status || '').toLowerCase()] || 4;\n        return aPriority - bPriority;\n      });\n\n      // Note: Assignees are already loaded from Column C (lines 1297-1305)\n      // Column C contains ALL assignees including \"passive\" ones not assigned to specific tasks\n      // We don't overwrite here - the checkboxes are already correctly set from Column C\n      console.log('Parsed tasks:', parsedTasks); // Debug log\n\n      // Update per-task assignee dropdowns with selected assignees\n      updateTaskAssigneeDropdowns();\n\n      // Reset all cards and task selections\n      qsa('#tasksChecklist .task-toggle').forEach(cb => { cb.checked = false; });\n      qsa('#taskCards .task-card, #otherTaskCard').forEach(card => {\n        const statusChips = getTaskStatusChips(card);\n        statusChips.forEach(c => c.classList.remove('active'));\n        const commentEl = card.querySelector('[data-role=\"comment\"]');\n        const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n        const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n        const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n        if (commentEl) commentEl.value = '';\n        if (deadlineEl) deadlineEl.value = '';\n        if (giveUpIdEl) giveUpIdEl.value = '';\n        if (taskAssigneeEl) taskAssigneeEl.value = '';\n      });\n\n      const isOther = isOtherTaskSelected();\n      if (isOther) {\n        // Use __other__ card with first parsed task if present\n        const otherCard = getTaskCard('__other__');\n        if (otherCard) {\n          const t = parsedTasks[0] || null;\n          if (taskNameInput) taskNameInput.value = t && t.name ? t.name : '';\n          if (t) {\n            const sNorm = (t.status || '').toLowerCase();\n            const displayStatus = sNorm === 'in progress' ? 'In Progress'\n              : sNorm === 'done' ? 'Done'\n              : 'To Do';\n            setCardStatus(otherCard, displayStatus);\n            const commentEl = otherCard.querySelector('[data-role=\"comment\"]');\n            const deadlineEl = otherCard.querySelector('[data-role=\"deadline\"]');\n            const taskAssigneeEl = otherCard.querySelector('[data-role=\"task-assignee\"]');\n            if (commentEl) commentEl.value = t.comment || '';\n            if (deadlineEl) deadlineEl.value = (t.deadline || '').slice(0,10);\n            // Set per-task assignee from parsed task\n            if (taskAssigneeEl && t.assignee) {\n              taskAssigneeEl.value = t.assignee.trim();\n            }\n          }\n        }\n      } else {\n        // Fixed tasks: tick checkboxes and populate corresponding cards\n        const toggles = qsa('#tasksChecklist .task-toggle');\n        toggles.forEach(cb => {\n          const name = cb.value;\n          // Map legacy \"KYC (Internal)\" to \"KYC (produced by LCMC)\"\n          const t = parsedTasks.find(pt => {\n            const ptName = (pt.name || '').toLowerCase();\n            const cbName = name.toLowerCase();\n            if (ptName === cbName) return true;\n            // Legacy mapping\n            if (cbName === 'kyc (produced by lcmc)' && ptName === 'kyc (internal)') return true;\n            return false;\n          });\n          cb.checked = !!t;\n          const card = getTaskCard(name);\n          if (card && t) {\n            const sNorm = (t.status || '').toLowerCase();\n            const displayStatus = sNorm === 'in progress' ? 'In Progress'\n              : sNorm === 'done' ? 'Done'\n              : 'To Do';\n            setCardStatus(card, displayStatus);\n            const commentEl = card.querySelector('[data-role=\"comment\"]');\n            const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n            const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n            const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n            if (commentEl) commentEl.value = t.comment || '';\n            if (deadlineEl) deadlineEl.value = (t.deadline || '').slice(0,10);\n            if (giveUpIdEl) giveUpIdEl.value = t.giveUpId || '';\n            // Set per-task assignee from parsed task\n            if (taskAssigneeEl && t.assignee) {\n              taskAssigneeEl.value = t.assignee.trim();\n            }\n          }\n        });\n      }\n\n      // Audit info from the most recently completed/updated task if available\n      if (auditTextEl) {\n        let chosenAudit = null;\n        if (parsedTasks.length > 0) {\n          chosenAudit = parsedTasks[0];\n        }\n        if (chosenAudit) {\n          const parts = [];\n          if (chosenAudit.initiated) parts.push(`Task initiated: ${chosenAudit.initiated}`);\n          if (chosenAudit.updated) parts.push(`Status updated: ${chosenAudit.updated}`);\n          if (chosenAudit.completed) parts.push(`Completed: ${chosenAudit.completed}`);\n          auditTextEl.textContent = parts.join(' | ');\n        } else {\n          auditTextEl.textContent = '';\n        }\n      }\n\n      // Update Last KYC Produced date\n      const lastKycEl = qs('#lastKycDate');\n      if (lastKycEl && companyVal) {\n        // Look for KYC Done status in current row's tasks\n        let kycCompletedDate = null;\n        parsedTasks.forEach(t => {\n          if (t.name && t.name.toLowerCase().includes('kyc') && \n              t.status && t.status.toLowerCase() === 'done' && t.completed) {\n            kycCompletedDate = t.completed;\n          }\n        });\n        if (kycCompletedDate) {\n          lastKycEl.textContent = kycCompletedDate;\n        } else {\n          // Search all rows for this company's last KYC\n          findLastKycDate(companyVal).then(date => {\n            lastKycEl.textContent = date || '';\n          });\n        }\n      } else if (lastKycEl) {\n        lastKycEl.textContent = '';\n      }\n\n      syncTasksVisibility();\n      updateDateDisplays();\n      updateExtraNotePlaceholder();\n      \n      // Reorder checked items to top\n      reorderCheckboxesToTop('#assignees');\n      reorderCheckboxesToTop('#tasksChecklist');\n      reorderCheckboxesToTop('#taskCategories');\n\n      // Track current row number for save logic\n      currentRowNum = uiRow;\n\n      // Apply deadline warnings to task cards\n      applyDeadlineWarnings();\n\n      // Update email summary button state\n      updateEmailSummaryButton();\n\n      // Close email summary section when switching rows\n      if (emailSummarySection) {\n        emailSummarySection.classList.remove('visible');\n      }\n    });\n  }\n\n  async function saveToActiveRow(){\n    const descVal = getSelectedCategories().join(', ');\n    const assignees = getSelectedAssignees().join(', ');\n    const isOther = isOtherTaskSelected();\n    console.log('Saving - Categories:', descVal, 'Assignees:', assignees, 'IsOther:', isOther);\n    await Excel.run(async (context) => {\n      // Get active row within the same context to avoid sync issues\n      const selectedRange = context.workbook.getSelectedRange();\n      selectedRange.load('rowIndex');\n      await context.sync();\n      const uiRow = selectedRange.rowIndex + 1;\n\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) return;\n\n      // Persist row-level dates (E-G)\n      const datesRange = sheet.getRange(`E${uiRow}:G${uiRow}`);\n      datesRange.load('values');\n\n      // Persist company name (A), task category (B), assignees (C), broker lead (D)\n      const companyRange = sheet.getRange(`A${uiRow}`);\n      const descRange = sheet.getRange(`B${uiRow}`);\n      const assigneesRange = sheet.getRange(`C${uiRow}`);\n      const brokerRange = sheet.getRange(`D${uiRow}`);\n\n      const hRange = sheet.getRange(`H${uiRow}`);\n      const jRange = sheet.getRange(`J${uiRow}`);\n      const kRange = sheet.getRange(`K${uiRow}`);\n      hRange.load('values');\n      await context.sync();\n\n      const datesRow = (datesRange.values && datesRange.values[0]) ? datesRange.values[0] : [null,null,null];\n\n      // Format dates as d-MMM-yyyy for Excel display\n      if (initialRequestInput) datesRow[0] = formatDateForExcel(initialRequestInput.value);\n      if (introEmailInput) datesRow[1] = formatDateForExcel(introEmailInput.value);\n      if (remindersStartInput) datesRow[2] = formatDateForExcel(remindersStartInput.value);\n\n      datesRange.values = [datesRow];\n\n      descRange.values = [[descVal]];\n\n      if (brokerLeadEl) {\n        brokerRange.values = [[brokerLeadEl.value || '']];\n      }\n\n      if (companyNameInput) {\n        companyRange.values = [[companyNameInput.value || '']];\n      }\n\n      // Save assignees to Column C\n      assigneesRange.values = [[assignees]];\n      console.log('Saving assignees to column C:', assignees);\n\n      // Save Email Frequency (J) and Extra Note (K)\n      if (emailFrequencyEl) {\n        jRange.values = [[emailFrequencyEl.value || '']];\n      }\n      if (extraNoteEl) {\n        kRange.values = [[extraNoteEl.value || '']];\n      }\n\n      const existing = (hRange.values && hRange.values[0] && hRange.values[0][0])\n        ? String(hRange.values[0][0])\n        : '';\n\n      const lines = existing\n        .split(/\\r?\\n/)\n        .map(s => s.trim())\n        .filter(Boolean);\n\n      const nonTaskLines = lines.filter(l => !parseTaskLine(l));\n      const newTaskLines = [];\n\n      // Parse existing tasks to preserve dates\n      const existingTasks = {};\n      lines.forEach(l => {\n        const parsed = parseTaskLine(l);\n        if (parsed) {\n          existingTasks[parsed.name.toLowerCase()] = parsed;\n        }\n      });\n\n      // Helper to get today's date in d-MMM-yyyy format\n      const getTodayFormatted = () => {\n        const d = new Date();\n        const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n        return `${String(d.getDate()).padStart(2,'0')} ${months[d.getMonth()]} ${String(d.getFullYear()).slice(-2)}`;\n      };\n\n      // Helper to compute dates based on status and existing task\n      // Only show ONE date field based on current status (last action):\n      // - To Do: Task initiated\n      // - In Progress: Status updated\n      // - Done: Completed\n      const computeDates = (name, newStatus, existingTask) => {\n        const today = getTodayFormatted();\n        const oldStatus = existingTask ? (existingTask.status || '').toLowerCase() : '';\n        const newStatusLower = (newStatus || '').toLowerCase();\n        \n        // Preserve existing dates (use empty string if not present)\n        let initiated = (existingTask && existingTask.initiated) ? existingTask.initiated : '';\n        let updated = (existingTask && existingTask.updated) ? existingTask.updated : '';\n        let completed = (existingTask && existingTask.completed) ? existingTask.completed : '';\n        \n        // Check if this task has ANY date - if not, it's effectively new\n        const hasAnyDate = initiated || updated || completed;\n\n        // Update the relevant date based on status\n        // We show only ONE date field based on current status (last action)\n        if (newStatusLower === 'to do') {\n          // For To Do: always show initiated date\n          initiated = initiated || today;\n          // Clear other dates for display\n          updated = '';\n          completed = '';\n        } else if (newStatusLower === 'in progress') {\n          // For In Progress: set updated date if new or status changed\n          if (!hasAnyDate || oldStatus !== newStatusLower) {\n            updated = today;\n          }\n          // Clear other dates for display\n          initiated = '';\n          completed = '';\n        } else if (newStatusLower === 'done') {\n          // For Done: set completed date if new or status changed\n          if (!hasAnyDate || !completed || oldStatus !== newStatusLower) {\n            completed = today;\n          }\n          // Clear other dates for display\n          initiated = '';\n          updated = '';\n        }\n\n        return { initiated, updated, completed };\n      };\n\n      if (isOther) {\n        const otherCard = getTaskCard('__other__');\n        const name = taskNameInput ? taskNameInput.value.trim() : '';\n        if (name) {\n          const status = getCardStatus(otherCard) || 'To Do';\n          const commentEl = otherCard ? otherCard.querySelector('[data-role=\"comment\"]') : null;\n          const deadlineEl = otherCard ? otherCard.querySelector('[data-role=\"deadline\"]') : null;\n          const taskAssigneeEl = otherCard ? otherCard.querySelector('[data-role=\"task-assignee\"]') : null;\n          // Use per-task assignee if set, otherwise fall back to global assignees\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Look up existing task to preserve dates\n          const existingTask = existingTasks[name.toLowerCase()];\n          const dates = computeDates(name, status, existingTask);\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: '',\n            initiated: dates.initiated,\n            updated: dates.updated,\n            completed: dates.completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          const builtLine = buildSummaryLine(payload);\n          newTaskLines.push({ line: builtLine, status });\n        }\n      } else {\n        const toggles = getSelectedTaskToggles();\n        const fixedNames = ['Broker Agreement','Give-up Agreement','Amend Annex A','KYC (produced by LCMC)','KYC External'];\n        toggles.forEach(name => {\n          if (!fixedNames.includes(name)) return;\n          const card = getTaskCard(name);\n          if (!card) return;\n          const status = getCardStatus(card);\n          const commentEl = card.querySelector('[data-role=\"comment\"]');\n          const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n          const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n          const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n          // Use per-task assignee if set, otherwise fall back to global assignees\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Look up existing task to preserve dates (handle legacy KYC name)\n          let existingTask = existingTasks[name.toLowerCase()];\n          if (!existingTask && name.toLowerCase() === 'kyc (produced by lcmc)') {\n            existingTask = existingTasks['kyc (internal)'];\n          }\n          const dates = computeDates(name, status, existingTask);\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: giveUpIdEl ? giveUpIdEl.value.trim() : '',\n            initiated: dates.initiated,\n            updated: dates.updated,\n            completed: dates.completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          newTaskLines.push({ line: buildSummaryLine(payload), status });\n        });\n      }\n\n      // Sort task lines by status priority: To Do > In Progress > Done\n      const statusPriority = { 'to do': 1, 'in progress': 2, 'done': 3 };\n      newTaskLines.sort((a, b) => {\n        const aPriority = statusPriority[(a.status || '').toLowerCase()] || 4;\n        const bPriority = statusPriority[(b.status || '').toLowerCase()] || 4;\n        return aPriority - bPriority;\n      });\n      const sortedLines = newTaskLines.map(t => t.line);\n\n      const newValue = nonTaskLines.concat(sortedLines).filter(Boolean).join('\\n');\n      console.log('Saving to H - newTaskLines:', sortedLines, 'newValue:', newValue);\n\n      hRange.values = [[newValue]];\n\n      // Apply font color based on status priority: In Progress > To Do > Done\n      // Since Excel.js can't do per-line colors, use the \"most urgent\" status\n      if (sortedLines.length > 0) {\n        let hasInProgress = false;\n        let hasToDo = false;\n        let hasDone = false;\n        \n        sortedLines.forEach(line => {\n          const lower = line.toLowerCase();\n          if (lower.includes(': in progress')) hasInProgress = true;\n          else if (lower.includes(': to do')) hasToDo = true;\n          else if (lower.includes(': done')) hasDone = true;\n        });\n        \n        // Priority: In Progress (orange) > To Do (green) > Done (red)\n        // Use original Google Sheet colours: To Do #34a853, In Progress #ff9900, Done #cc6666\n        let fontColor;\n        if (hasInProgress) {\n          fontColor = '#ff9900'; // In Progress (orange)\n        } else if (hasToDo) {\n          fontColor = '#34a853'; // To Do (green)\n        } else if (hasDone) {\n          fontColor = '#cc6666'; // Done (soft red)\n        } else {\n          fontColor = '#34a853'; // default green\n        }\n        hRange.format.font.color = fontColor;\n      }\n\n      await context.sync();\n      console.log('Save completed successfully for row', uiRow);\n    });\n  }\n\n  // Clear form for a fresh new task entry\n  function clearFormForNewTask() {\n    // Clear company name\n    if (companyNameInput) companyNameInput.value = '';\n    \n    // Reset task category checkboxes\n    qsa('#taskCategories .category-toggle').forEach(cb => {\n      cb.checked = false;\n    });\n    \n    // Clear broker lead\n    if (brokerLeadEl) brokerLeadEl.value = '';\n    \n    // Clear all assignee checkboxes\n    document.querySelectorAll('#assignees input[type=checkbox]').forEach(cb => {\n      cb.checked = false;\n    });\n    \n    // Clear dates\n    if (initialRequestInput) initialRequestInput.value = '';\n    if (introEmailInput) introEmailInput.value = '';\n    if (remindersStartInput) remindersStartInput.value = '';\n    \n    // Clear email frequency and extra note\n    if (emailFrequencyEl) emailFrequencyEl.value = '';\n    if (extraNoteEl) extraNoteEl.value = '';\n    \n    // Uncheck all task toggles\n    qsa('#tasksChecklist .task-toggle').forEach(cb => {\n      cb.checked = false;\n    });\n    \n    // Reset all task cards (including Other Task card)\n    qsa('#taskCards .task-card, #otherTaskCard').forEach(card => {\n      // Reset status chips\n      const chips = card.querySelectorAll('[data-role=\"status-chips\"] .chip');\n      chips.forEach(c => c.classList.remove('active'));\n      \n      // Clear comment\n      const commentEl = card.querySelector('[data-role=\"comment\"]');\n      if (commentEl) commentEl.value = '';\n      \n      // Clear deadline\n      const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n      if (deadlineEl) deadlineEl.value = '';\n      \n      // Clear give-up ID\n      const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n      if (giveUpIdEl) giveUpIdEl.value = '';\n      \n      // Clear per-task assignee\n      const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n      if (taskAssigneeEl) taskAssigneeEl.value = '';\n    });\n    \n    // Clear other task name\n    if (taskNameInput) taskNameInput.value = '';\n    \n    // Clear audit text\n    if (auditTextEl) auditTextEl.textContent = '';\n    \n    // Clear Last KYC date\n    const lastKycEl = qs('#lastKycDate');\n    if (lastKycEl) lastKycEl.textContent = '';\n    \n    // Clear search results\n    if (searchResults) {\n      searchResults.classList.remove('visible');\n      searchResults.innerHTML = '';\n    }\n\n    // Close email summary section\n    if (emailSummarySection) {\n      emailSummarySection.classList.remove('visible');\n    }\n\n    // Mark as new task for save logic\n    currentRowNum = 'new';\n\n    // Update email summary button state\n    updateEmailSummaryButton();\n    \n    // Clear date displays\n    updateDateDisplays();\n    \n    // Update visibility and placeholder\n    syncTasksVisibility();\n    updateExtraNotePlaceholder();\n\n    // Autofocus first visible task comment field after a short delay\n    setTimeout(() => {\n      const visibleCard = document.querySelector('#taskCards .task-card:not([style*=\"display: none\"]), #otherTaskCard:not([style*=\"display: none\"])');\n      if (visibleCard) {\n        const commentEl = visibleCard.querySelector('[data-role=\"comment\"]');\n        if (commentEl && typeof commentEl.focus === 'function') {\n          commentEl.focus();\n        }\n      }\n    }, 100);\n  }\n\n  // Delete the current row from Excel\n  async function deleteCurrentRow() {\n    if (currentRowNum === null || currentRowNum === 'new') {\n      throw new Error('No row to delete');\n    }\n    \n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      \n      if (sheet.isNullObject) {\n        throw new Error('Sheet TASK MANAGER FORM not found');\n      }\n      \n      // Delete the entire row\n      const rowRange = sheet.getRange(`${currentRowNum}:${currentRowNum}`);\n      rowRange.delete(Excel.DeleteShiftDirection.up);\n      \n      await context.sync();\n      console.log('Deleted row', currentRowNum);\n    });\n  }\n\n  // Add a new task to the next available row\n  async function addNewTask() {\n    await Excel.run(async (context) => {\n      const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n      sheet.load('name');\n      await context.sync();\n      if (sheet.isNullObject) {\n        console.error('Sheet TASK MANAGER FORM not found');\n        return;\n      }\n\n      // Find the first empty row by scanning column A from row 2 onwards\n      const colA = sheet.getRange('A2:A1000');\n      colA.load('values');\n      await context.sync();\n\n      let nextRow = 2; // Start from row 2 (after header)\n      const values = colA.values || [];\n      for (let i = 0; i < values.length; i++) {\n        if (values[i][0] && String(values[i][0]).trim() !== '') {\n          nextRow = i + 3; // i is 0-indexed, row 2 is first data row, so next empty is i+2+1\n        } else {\n          // Found an empty cell\n          nextRow = i + 2; // i is 0-indexed from row 2\n          break;\n        }\n      }\n\n      // Collect current form data\n      const companyVal = companyNameInput ? companyNameInput.value.trim() : '';\n      const descVal = getSelectedCategories().join(', ');\n      const isOther = isOtherTaskSelected();\n      const brokerVal = brokerLeadEl ? brokerLeadEl.value : '';\n      const assignees = getSelectedAssignees().join(', ');\n\n      // Write company name to column A\n      sheet.getRange(`A${nextRow}`).values = [[companyVal]];\n      // Write task category to column B\n      sheet.getRange(`B${nextRow}`).values = [[descVal]];\n      // Write assignees to column C\n      sheet.getRange(`C${nextRow}`).values = [[assignees]];\n      // Write broker lead to column D\n      sheet.getRange(`D${nextRow}`).values = [[brokerVal]];\n\n      // Write dates to columns E, F, G\n      const dateE = formatDateForExcel(initialRequestInput ? initialRequestInput.value : '');\n      const dateF = formatDateForExcel(introEmailInput ? introEmailInput.value : '');\n      const dateG = formatDateForExcel(remindersStartInput ? remindersStartInput.value : '');\n      sheet.getRange(`E${nextRow}:G${nextRow}`).values = [[dateE, dateF, dateG]];\n\n      // Write Email Frequency (J) and Extra Note (K)\n      sheet.getRange(`J${nextRow}`).values = [[emailFrequencyEl ? emailFrequencyEl.value : '']];\n      sheet.getRange(`K${nextRow}`).values = [[extraNoteEl ? extraNoteEl.value : '']];\n\n      // Helper to get today's date in d-MMM-yy format\n      const getTodayFormatted = () => {\n        const d = new Date();\n        const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n        return `${String(d.getDate()).padStart(2,'0')} ${months[d.getMonth()]} ${String(d.getFullYear()).slice(-2)}`;\n      };\n      const today = getTodayFormatted();\n\n      // Build Column H from selected tasks\n      const newTaskLines = [];\n      if (isOther) {\n        const otherCard = getTaskCard('__other__');\n        const name = taskNameInput ? taskNameInput.value.trim() : '';\n        if (name) {\n          const status = getCardStatus(otherCard) || 'To Do';\n          const commentEl = otherCard ? otherCard.querySelector('[data-role=\"comment\"]') : null;\n          const deadlineEl = otherCard ? otherCard.querySelector('[data-role=\"deadline\"]') : null;\n          const taskAssigneeEl = otherCard ? otherCard.querySelector('[data-role=\"task-assignee\"]') : null;\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Set date based on status for new task\n          let initiated = '', updated = '', completed = '';\n          const statusLower = status.toLowerCase();\n          if (statusLower === 'to do') {\n            initiated = today;\n          } else if (statusLower === 'in progress') {\n            updated = today;\n          } else if (statusLower === 'done') {\n            completed = today;\n          }\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: '',\n            initiated,\n            updated,\n            completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          newTaskLines.push(buildSummaryLine(payload));\n        }\n      } else {\n        const toggles = getSelectedTaskToggles();\n        const fixedNames = ['Broker Agreement','Give-up Agreement','Amend Annex A','KYC (produced by LCMC)','KYC External'];\n        toggles.forEach(name => {\n          if (!fixedNames.includes(name)) return;\n          const card = getTaskCard(name);\n          if (!card) return;\n          const status = getCardStatus(card) || 'To Do';\n          const commentEl = card.querySelector('[data-role=\"comment\"]');\n          const deadlineEl = card.querySelector('[data-role=\"deadline\"]');\n          const giveUpIdEl = card.querySelector('[data-role=\"giveUpId\"]');\n          const taskAssigneeEl = card.querySelector('[data-role=\"task-assignee\"]');\n          const taskAssignee = taskAssigneeEl && taskAssigneeEl.value ? taskAssigneeEl.value : assignees;\n          \n          // Set date based on status for new task\n          let initiated = '', updated = '', completed = '';\n          const statusLower = status.toLowerCase();\n          if (statusLower === 'to do') {\n            initiated = today;\n          } else if (statusLower === 'in progress') {\n            updated = today;\n          } else if (statusLower === 'done') {\n            completed = today;\n          }\n          \n          const payload = {\n            name,\n            status,\n            assignees: taskAssignee,\n            comment: commentEl ? commentEl.value.trim() : '',\n            giveUpId: giveUpIdEl ? giveUpIdEl.value.trim() : '',\n            initiated,\n            updated,\n            completed,\n            deadline: deadlineEl ? deadlineEl.value : ''\n          };\n          newTaskLines.push(buildSummaryLine(payload));\n        });\n      }\n\n      const hRangeNew = sheet.getRange(`H${nextRow}`);\n      hRangeNew.values = [[newTaskLines.join('\\n')]];\n\n      // Apply font color based on status priority: In Progress > To Do > Done\n      // Use original Google Sheet colours: To Do #34a853, In Progress #ff9900, Done #cc6666\n      if (newTaskLines.length > 0) {\n        let hasInProgress = false;\n        let hasToDo = false;\n        let hasDone = false;\n        \n        newTaskLines.forEach(line => {\n          const lower = line.toLowerCase();\n          if (lower.includes(': in progress')) hasInProgress = true;\n          else if (lower.includes(': to do')) hasToDo = true;\n          else if (lower.includes(': done')) hasDone = true;\n        });\n        \n        let fontColor;\n        if (hasInProgress) {\n          fontColor = '#ff9900'; // In Progress (orange)\n        } else if (hasToDo) {\n          fontColor = '#34a853'; // To Do (green)\n        } else if (hasDone) {\n          fontColor = '#cc6666'; // Done (soft red)\n        } else {\n          fontColor = '#34a853'; // default green\n        }\n        hRangeNew.format.font.color = fontColor;\n      }\n\n      await context.sync();\n\n      // Select the new row so user can see it\n      const newRowRange = sheet.getRange(`A${nextRow}`);\n      newRowRange.select();\n      await context.sync();\n\n      // Update current row number for save logic\n      currentRowNum = nextRow;\n    });\n  }\n\n  // Update date display helpers to show d-MMM-yyyy format\n  function updateDateDisplays() {\n    const dateFields = [\n      { input: '#initialRequest', display: '#initialRequestDisplay' },\n      { input: '#introEmail', display: '#introEmailDisplay' },\n      { input: '#remindersStart', display: '#remindersStartDisplay' }\n    ];\n    dateFields.forEach(({ input, display }) => {\n      const inputEl = qs(input);\n      const displayEl = qs(display);\n      if (inputEl && displayEl) {\n        const formatted = formatDateForDisplay(inputEl.value);\n        displayEl.textContent = formatted ? ` ${formatted}` : '';\n      }\n    });\n  }\n\n  // Wire date inputs to update displays\n  function wireDateInputs() {\n    const dateInputs = ['#initialRequest', '#introEmail', '#remindersStart'];\n    dateInputs.forEach(selector => {\n      const el = qs(selector);\n      if (el) {\n        el.addEventListener('change', updateDateDisplays);\n      }\n    });\n  }\n\n  // Wire deadline inputs to update warnings\n  function wireDeadlineInputs() {\n    qsa('[data-role=\"deadline\"]').forEach(input => {\n      input.addEventListener('change', () => {\n        applyDeadlineWarnings();\n      });\n    });\n  }\n\n  // ============== Email Summary Integration ==============\n\n  const emailSummaryBtn = qs('#viewEmailSummaryBtn');\n  const emailSummarySection = qs('#emailSummarySection');\n  const emailSummaryList = qs('#emailSummaryList');\n  const emailSummaryCount = qs('#emailSummaryCount');\n  const closeEmailSummaryBtn = qs('#closeEmailSummaryBtn');\n\n  // Update email summary button state based on company name\n  function updateEmailSummaryButton() {\n    const company = companyNameInput ? companyNameInput.value.trim() : '';\n    if (emailSummaryBtn) {\n      emailSummaryBtn.disabled = !company;\n    }\n  }\n\n  // Wire company name input to update button state\n  if (companyNameInput) {\n    companyNameInput.addEventListener('input', updateEmailSummaryButton);\n    companyNameInput.addEventListener('change', updateEmailSummaryButton);\n  }\n\n  // Wire email summary button click\n  if (emailSummaryBtn) {\n    emailSummaryBtn.addEventListener('click', async () => {\n      await loadEmailSummaries();\n    });\n  }\n\n  // Wire close button\n  if (closeEmailSummaryBtn) {\n    closeEmailSummaryBtn.addEventListener('click', () => {\n      if (emailSummarySection) {\n        emailSummarySection.classList.remove('visible');\n      }\n    });\n  }\n\n  // Load email summaries from Column L (populated by VBA SmartBrief macro)\n  // The VBA macro calls the API and writes the summary to column L\n  // This function reads that pre-fetched summary and displays it\n  async function loadEmailSummaries() {\n    const company = companyNameInput ? companyNameInput.value.trim() : '';\n    if (!company) {\n      showToast('No company name entered', 'error');\n      return;\n    }\n\n    // Must have a valid row to read from\n    if (currentRowNum === null || currentRowNum === 'new') {\n      showToast('Please save the task first or select an existing row', 'error');\n      return;\n    }\n\n    // Show the section with loading state\n    if (emailSummarySection) {\n      emailSummarySection.classList.add('visible');\n    }\n    if (emailSummaryList) {\n      emailSummaryList.innerHTML = '<div class=\"email-loading\">Loading summary from spreadsheet...</div>';\n    }\n\n    try {\n      // Read from Excel - extract data only, no DOM manipulation inside Excel.run\n      let summaryText = '';\n      await Excel.run(async (context) => {\n        const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n        sheet.load('name');\n        await context.sync();\n\n        if (sheet.isNullObject) {\n          throw new Error('TASK MANAGER FORM sheet not found');\n        }\n\n        // Read column L for the current row (SmartBrief summary)\n        const cell = sheet.getRange(`L${currentRowNum}`);\n        cell.load('values');\n        await context.sync();\n\n        summaryText = (cell.values && cell.values[0] && cell.values[0][0])\n          ? String(cell.values[0][0]).trim()\n          : '';\n      });\n\n      // Excel can store in-cell line breaks as \"\\r\" on some platforms (not \"\\n\");\n      // normalize so parsing + rendering works consistently.\n      if (summaryText) {\n        summaryText = summaryText.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n      }\n\n      // If column L is empty, try to fetch from API (only works in localhost dev due to mixed-content)\n      // In production, VBA macro should have already populated column L\n      if (!summaryText) {\n        // Only attempt API call in localhost development (HTTPS add-in can't call HTTP API in production)\n        const isLocalhost = typeof window !== 'undefined' \n          && window.location \n          && window.location.hostname === 'localhost';\n        \n        if (isLocalhost) {\n          if (emailSummaryList) {\n            emailSummaryList.innerHTML = '<div class=\"email-loading\">Fetching summary from API...</div>';\n          }\n\n          const initialRequest = initialRequestInput ? String(initialRequestInput.value || '') : '';\n          const introEmail = introEmailInput ? String(introEmailInput.value || '') : '';\n          const remindersStart = remindersStartInput ? String(remindersStartInput.value || '') : '';\n\n          const apiSummary = await fetchSmartBriefSummaryFromApi(company, initialRequest, introEmail, remindersStart);\n          summaryText = apiSummary || '';\n\n          if (summaryText) {\n            summaryText = summaryText.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n          }\n\n          if (summaryText) {\n            await Excel.run(async (context) => {\n              const sheet = context.workbook.worksheets.getItemOrNullObject('TASK MANAGER FORM');\n              sheet.load('name');\n              await context.sync();\n\n              if (sheet.isNullObject) {\n                throw new Error('TASK MANAGER FORM sheet not found');\n              }\n\n              const cell = sheet.getRange(`L${currentRowNum}`);\n              cell.values = [[summaryText]];\n              await context.sync();\n            });\n          }\n        }\n      }\n\n      // Now do DOM updates outside of Excel.run\n      // Update count badge (1 if we have a summary, 0 if not)\n      if (emailSummaryCount) {\n        emailSummaryCount.textContent = summaryText ? '1' : '0';\n      }\n\n      // Display the summary\n      if (!summaryText) {\n        if (emailSummaryList) {\n          emailSummaryList.innerHTML = `\n            <div class=\"email-no-summaries\">\n              No email summary found for this row.<br>\n              <small>Run the SmartBrief macro (Alt+F8  SmartBrief) to fetch summaries.</small>\n            </div>`;\n        }\n        return;\n      }\n\n      // Parse the summary text from VBA format:\n      // \"[XX% match] Subject\\n\\nSummary text\"\n      const lines = summaryText.split(/\\n/);\n      const firstLine = (lines[0] || '').trim();\n      const restText = lines.slice(1).join('\\n').replace(/^\\n+/, '').trim();\n\n      const headerMatch = firstLine.match(/^\\[(\\d+)%\\s*match\\]\\s*(.*)$/);\n      let matchPercent = 100;\n      let subject = 'Email Summary';\n      let summaryBody = summaryText;\n\n      if (headerMatch) {\n        matchPercent = parseInt(headerMatch[1], 10);\n        subject = (headerMatch[2] || '').trim() || 'Email Summary';\n        summaryBody = restText;\n      } else if (lines.length > 1) {\n        subject = firstLine || 'Email Summary';\n        summaryBody = restText;\n      } else {\n        subject = 'Email Summary';\n        summaryBody = summaryText.trim();\n      }\n\n      // Color code by match quality\n      let matchClass = 'match-high';\n      if (matchPercent < 70) matchClass = 'match-medium';\n      if (matchPercent < 50) matchClass = 'match-low';\n\n      // Parse participants and detect category for \"Apply to Task\" feature\n      const participants = parseParticipantsFromSummary(summaryText);\n      const detectedCategory = detectCategoryFromSummary(summaryText);\n      const matchedAssignees = matchParticipantsToTeamMembers(participants);\n      const summaryNotes = parseSummaryBodyFromSummary(summaryText);\n\n      // Store for \"Apply to Task\" button\n      lastParsedSmartBrief = {\n        participants,\n        detectedCategory,\n        matchedAssignees,\n        summaryNotes,\n        matchPercent,\n        subject\n      };\n\n      // Build participant chips HTML\n      let participantChipsHtml = '';\n      if (participants.length > 0) {\n        const chips = participants.map(p => {\n          const isMatched = matchedAssignees.some(a => a.toLowerCase().includes(p.name.split(' ')[0].toLowerCase()));\n          const chipClass = isMatched ? 'participant-chip matched' : 'participant-chip';\n          const title = p.email ? p.email : p.name;\n          return `<span class=\"${chipClass}\" title=\"${escapeHtml(title)}\">${escapeHtml(p.name)}</span>`;\n        }).join('');\n        participantChipsHtml = `\n          <div class=\"participants-section\">\n            <div class=\"participants-label\">Participants:</div>\n            <div class=\"participants-chips\">${chips}</div>\n          </div>\n        `;\n      }\n\n      // Build match warning HTML (if < 50%)\n      let matchWarningHtml = '';\n      if (matchPercent < 50) {\n        matchWarningHtml = `\n          <div class=\"match-warning\">\n             Low confidence match (${matchPercent}%)  verify this is the correct email thread\n          </div>\n        `;\n      }\n\n      // Build \"Apply to Task\" button HTML\n      let applyButtonHtml = '';\n      if (detectedCategory || matchedAssignees.length > 0 || summaryNotes) {\n        applyButtonHtml = `\n          <div class=\"smartbrief-actions\">\n            <button id=\"applySmartBriefBtn\" class=\"btn-apply-smartbrief\">\n               Review & Apply to Task\n            </button>\n          </div>\n        `;\n      }\n\n      // Remove participant names from summary body to avoid redundancy with chips\n      let cleanedSummaryBody = summaryBody;\n      // Remove the PARTICIPANTS section if present (already shown as chips)\n      cleanedSummaryBody = cleanedSummaryBody.replace(/## PARTICIPANTS[\\s\\S]*?(?=## |$)/, '').trim();\n      // Clean up any leading/trailing whitespace or empty lines\n      cleanedSummaryBody = cleanedSummaryBody.replace(/^\\n+/, '').replace(/\\n{3,}/g, '\\n\\n');\n\n      if (emailSummaryList) {\n        emailSummaryList.innerHTML = `\n          ${matchWarningHtml}\n          <div class=\"email-summary-item\">\n            <div class=\"email-summary-subject\">\n              ${escapeHtml(subject)}\n              <span class=\"match-score ${matchClass}\" title=\"Match score from SmartBrief\">\n                ${matchPercent}% match\n              </span>\n            </div>\n            ${participantChipsHtml}\n            <div class=\"email-summary-text\">${escapeHtml(cleanedSummaryBody).replace(/\\n/g, '<br>')}</div>\n          </div>\n          ${applyButtonHtml}\n        `;\n\n        // Wire \"Apply to Task\" button to show confirmation modal\n        const applyBtn = qs('#applySmartBriefBtn');\n        if (applyBtn) {\n          applyBtn.addEventListener('click', () => showSmartBriefConfirmation());\n        }\n      }\n\n    } catch (err) {\n      console.error('Error loading email summary from column L:', err);\n      if (emailSummaryList) {\n        emailSummaryList.innerHTML = `<div class=\"email-no-summaries\">Error reading summary: ${escapeHtml(err.message)}</div>`;\n      }\n    }\n  }\n\n  // Show confirmation modal for SmartBrief suggestions\n  function showSmartBriefConfirmation() {\n    if (!lastParsedSmartBrief) {\n      showToast('No SmartBrief data to apply', 'error');\n      return;\n    }\n\n    const { detectedCategory, matchedAssignees, summaryNotes } = lastParsedSmartBrief;\n    \n    // Build suggestion items with checkboxes\n    let suggestionsHtml = '';\n    let hasSuggestions = false;\n\n    if (detectedCategory) {\n      hasSuggestions = true;\n      suggestionsHtml += `\n        <div class=\"smartbrief-suggestion-item\">\n          <label>\n            <input type=\"checkbox\" id=\"sbApplyCategory\" checked>\n            <span class=\"suggestion-label\">Task Category:</span>\n            <span class=\"suggestion-value\">${escapeHtml(detectedCategory)}</span>\n          </label>\n        </div>\n      `;\n    }\n\n    // Individual checkboxes for each assignee (so users can uncheck irrelevant ones)\n    if (matchedAssignees && matchedAssignees.length > 0) {\n      hasSuggestions = true;\n      const assigneeCheckboxes = matchedAssignees.map((assignee, idx) => `\n        <label class=\"assignee-checkbox-item\">\n          <input type=\"checkbox\" class=\"sb-assignee-checkbox\" data-assignee=\"${escapeHtml(assignee)}\" checked>\n          <span>${escapeHtml(assignee)}</span>\n        </label>\n      `).join('');\n      \n      suggestionsHtml += `\n        <div class=\"smartbrief-suggestion-item smartbrief-assignees-group\">\n          <div class=\"suggestion-label\">Assignees:</div>\n          <div class=\"assignee-checkboxes-list\">\n            ${assigneeCheckboxes}\n          </div>\n        </div>\n      `;\n    }\n\n    if (summaryNotes) {\n      hasSuggestions = true;\n      const truncatedPreview = summaryNotes.length > 100 ? summaryNotes.substring(0, 100) + '...' : summaryNotes;\n      suggestionsHtml += `\n        <div class=\"smartbrief-suggestion-item\">\n          <label>\n            <input type=\"checkbox\" id=\"sbApplyNotes\">\n            <span class=\"suggestion-label\">Add to Notes:</span>\n            <span class=\"suggestion-value suggestion-notes\">${escapeHtml(truncatedPreview)}</span>\n          </label>\n        </div>\n      `;\n    }\n\n    if (!hasSuggestions) {\n      showToast('No suggestions available', 'info');\n      return;\n    }\n\n    // Create modal overlay\n    const overlay = document.createElement('div');\n    overlay.className = 'confirm-overlay';\n    overlay.id = 'smartbriefConfirmOverlay';\n\n    const box = document.createElement('div');\n    box.className = 'confirm-box smartbrief-confirm-box';\n    box.innerHTML = `\n      <div class=\"smartbrief-confirm-header\">\n        <span class=\"sparkle\"></span> Review Suggestions\n      </div>\n      <p class=\"smartbrief-confirm-desc\">Select which items to apply to the task:</p>\n      <div class=\"smartbrief-suggestions\">\n        ${suggestionsHtml}\n      </div>\n      <div class=\"smartbrief-confirm-buttons\">\n        <button class=\"btn-confirm-cancel\" id=\"sbCancel\">Cancel</button>\n        <button class=\"btn-apply-confirmed\" id=\"sbApply\">Apply Selected</button>\n      </div>\n    `;\n\n    overlay.appendChild(box);\n    document.body.appendChild(overlay);\n\n    // Wire buttons\n    const cancelBtn = overlay.querySelector('#sbCancel');\n    const applyBtn = overlay.querySelector('#sbApply');\n\n    cancelBtn.addEventListener('click', () => overlay.remove());\n    \n    applyBtn.addEventListener('click', () => {\n      const applyCategory = overlay.querySelector('#sbApplyCategory')?.checked;\n      const applyNotes = overlay.querySelector('#sbApplyNotes')?.checked;\n      \n      // Collect individually selected assignees\n      const selectedAssignees = [];\n      overlay.querySelectorAll('.sb-assignee-checkbox:checked').forEach(cb => {\n        selectedAssignees.push(cb.getAttribute('data-assignee'));\n      });\n      \n      overlay.remove();\n      applySmartBriefSelections(applyCategory, selectedAssignees, applyNotes);\n    });\n\n    // Close on overlay click\n    overlay.addEventListener('click', (e) => {\n      if (e.target === overlay) overlay.remove();\n    });\n  }\n\n  // Apply selected SmartBrief suggestions to the task form\n  // applyAssignees is now an array of selected assignee names (not a boolean)\n  function applySmartBriefSelections(applyCategory, selectedAssignees, applyNotes) {\n    if (!lastParsedSmartBrief) return;\n\n    const { detectedCategory, summaryNotes } = lastParsedSmartBrief;\n    let appliedItems = [];\n\n    // 1. Apply detected category\n    if (applyCategory && detectedCategory) {\n      const categoryCheckboxes = document.querySelectorAll('#taskCategories .category-toggle');\n      categoryCheckboxes.forEach(cb => {\n        if (cb.value === detectedCategory) {\n          cb.checked = true;\n          appliedItems.push(`Category: ${detectedCategory}`);\n        }\n      });\n      // Trigger visibility sync for task cards\n      syncTasksVisibility();\n    }\n\n    // 2. Apply selected assignees (now receives array of individually selected assignees)\n    if (selectedAssignees && Array.isArray(selectedAssignees) && selectedAssignees.length > 0) {\n      const assigneeCheckboxes = document.querySelectorAll('#assignees input[type=checkbox]');\n      assigneeCheckboxes.forEach(cb => {\n        if (selectedAssignees.includes(cb.value)) {\n          cb.checked = true;\n        }\n      });\n      // Update per-task dropdowns\n      updateTaskAssigneeDropdowns();\n      // Reorder checked to top\n      reorderCheckboxesToTop('#assignees');\n      appliedItems.push(`Assignees: ${selectedAssignees.join(', ')}`);\n    }\n\n    // 3. Apply summary notes to Extra Note field (append, don't overwrite)\n    if (applyNotes && summaryNotes && extraNoteEl) {\n      const existingNote = extraNoteEl.value.trim();\n      const notePrefix = '[From SmartBrief] ';\n      // Only add if not already present\n      if (!existingNote.includes(notePrefix)) {\n        const truncatedNotes = summaryNotes.length > 500 ? summaryNotes.substring(0, 500) + '...' : summaryNotes;\n        extraNoteEl.value = existingNote \n          ? `${existingNote}\\n\\n${notePrefix}${truncatedNotes}`\n          : `${notePrefix}${truncatedNotes}`;\n        appliedItems.push('Notes added');\n      }\n    }\n\n    // Mark form as having unsaved changes\n    if (appliedItems.length > 0) {\n      setUnsavedChanges(true);\n      showToast(` Applied: ${appliedItems.join(', ')}`, 'success');\n    } else {\n      showToast('No items selected', 'info');\n    }\n  }\n\n  // Format date for display\n  function formatEmailDate(dateStr) {\n    if (!dateStr) return 'Unknown date';\n    try {\n      const d = new Date(dateStr);\n      if (isNaN(d.getTime())) return dateStr;\n      return d.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });\n    } catch (e) {\n      return dateStr;\n    }\n  }\n\n  // Note: Email summaries are now populated by VBA SmartBrief macro into column L\n  // The add-in reads from column L instead of calling the API directly\n\n  // Initial load when Office host is ready\n  if (typeof Office !== 'undefined' && typeof Office.onReady === 'function') {\n  \n      Office.onReady((info) => {\n        if (info.host === Office.HostType.Excel) {\n          wireCardChips();\n          wireDateInputs();\n          wireDeadlineInputs(); // Wire deadline warnings\n          wireChangeTracking(); // Track unsaved changes\n        // Wire task checkbox visibility\n        qsa('#tasksChecklist .task-toggle').forEach(cb => {\n          cb.addEventListener('change', () => syncTasksVisibility());\n        });\n        // Wire category checkbox visibility\n        qsa('#taskCategories .category-toggle').forEach(cb => {\n          cb.addEventListener('change', () => syncTasksVisibility());\n        });\n        loadFromActiveRow().then(() => {\n          // Reset unsaved indicator after initial load\n          setUnsavedChanges(false);\n          // Auto-load active tasks on startup\n          performSearch();\n        });\n      }\n    });\n  }\n})();\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_toConsumableArray","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","toString","slice","constructor","name","test","qs","s","document","querySelector","qsa","querySelectorAll","teamMembersLoaded","hasUnsavedChanges","showToast","message","type","undefined","toast","textContent","className","setTimeout","classList","remove","checkMissingFields","missing","companyName","trim","push","brokerLead","filter","card","style","display","id","forEach","taskName","dataset","task","activeChip","deadlineInput","concat","otherTaskCard","taskNameInput","showMissingFieldsWarning","missingFields","overlay","createElement","box","maxWidth","textAlign","title","innerHTML","marginBottom","appendChild","desc","fontSize","color","list","cssText","field","li","btnWrap","closeBtn","addEventListener","body","setUnsavedChanges","unsaved","indicator","toggle","parseParticipantsFromSummary","summaryText","participants","participantsMatch","match","split","startsWith","line","email","parseSummaryBodyFromSummary","summaryMatch","join","detectCategoryFromSummary","text","toLowerCase","includes","matchParticipantsToTeamMembers","teamCheckboxes","teamNames","map","cb","matched","emailLower","endsWith","pNameLower","idx","findIndex","firstName","emailPrefix","tFirstName","Set","lastParsedSmartBrief","fetchSmartBriefSummaryFromApi","_x","_x2","_x3","_x4","_fetchSmartBriefSummaryFromApi","_callee0","company","initialRequest","introEmail","remindersStart","useLocalProxy","url","response","data","summaries","best","subject","summary","matchScore","matchPercent","_t4","_context0","window","location","hostname","protocol","encodeURIComponent","fetch","method","headers","JSON","stringify","initial_request","intro_email","reminders_start","threshold","ok","Error","status","json","String","match_score","parseFloat","Number","isFinite","Math","round","escapeHtml","div","applyDeadlineWarnings","warningClass","deadlineStr","deadline","Date","isNaN","getTime","today","setHours","diffDays","ceil","getDueDateWarningClass","add","preventDefault","returnValue","companyNameInput","brokerLeadEl","initialRequestInput","introEmailInput","remindersStartInput","emailFrequencyEl","extraNoteEl","auditTextEl","tasksRowEl","taskCardsContainer","saveBtn","newTaskBtn","loadSelectedBtn","openKycPortalBtn","currentRowNum","showConfirmDialog","dialog","msgEl","cancelBtn","okBtn","cleanup","removeEventListener","onCancel","onOk","_callee","_t","_context","addNewTask","saveToActiveRow","console","error","_callee2","_t2","_context2","loadFromActiveRow","clearFormForNewTask","deleteTaskBtn","_callee3","_t3","_context3","deleteCurrentRow","kycListenerAttached","stopPropagation","kycOpening","open","tasksView","statsView","tasksHeader","statsHeader","openStatsBtn","returnToTasksBtn","refreshStatsBtn","loadStatistics","_loadStatistics","_callee10","_t5","_context11","Excel","run","_ref1","_callee1","context","sheet","dataRange","rows","todoCount","inProgressCount","doneCount","brokerStats","monthlyStats","kycMonthly","totalDuration","durationCount","overdueItems","upcomingItems","staleItems","sevenDaysFromNow","thirtyDaysAgo","_loop","activeTasks","totalStatus","renderAttentionGroup","monthlyChart","sortedMonths","maxTasks","maxKyc","maxVal","monthNames","brokerChart","sortedBrokers","_maxTasks","_context10","workbook","worksheets","getItemOrNullObject","load","sync","isNullObject","getRange","values","setDate","getDate","row","broker","taskSummary","taskDate","dateE","dateF","dateG","availableDates","monthKey","_context1","parseDate","reduce","min","getFullYear","getMonth","padStart","total","active","completed","Boolean","lower","completedMatch","kycDate","taskNameMatch","assigneeMatch","assignee","deadlineMatch","daysUntil","detail","abs","initiatedMatch","updatedMatch","lastActionDate","daysSince","initiated","days","_regeneratorValues","width","items","groupId","listId","countId","group","container","countEl","item","assigneePart","sort","b","parseInt","keys","reverse","max","month","_month$split2","_slicedToArray","shortMonth","tasks","kyc","kycHeight","entries","_ref10","_ref12","_ref14","_ref15","stats","activeWidth","completedWidth","_x8","dateVal","excelEpoch","UTC","utcDate","result","getUTCFullYear","getUTCMonth","getUTCDate","dateStr","isoMatch","year","day","jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec","searchInput","searchInputWrap","searchBtn","searchResults","searchHint","searchTabs","currentSearchMode","loadRowHint","updateSearchUI","placeholder","tab","_callee4","_context4","getAttribute","performSearch","_callee5","_context5","_ref6","_callee6","_context6","key","hideAutocomplete","_x5","autocompleteDropdown","companyList","autocompleteTimeout","loadCompanyList","_loadCompanyList","_callee12","_t6","_context13","_ref16","_callee11","category","_context12","rowNum","log","_x9","showAutocomplete","query","q","allMatches","startsWithMatches","containsMatches","sortedMatches","categoryHint","_callee7","_context7","selectAndLoadRow","_performSearch","_callee15","_t7","_context17","_ref17","_callee14","rawValues","results","scannedRows","_loop2","totalRows","modeLabel","rawQuery","_context16","taskCategory","hasActiveTasks","dominantStatus","hasTodo","hasProgress","hasDone","todoDates","progressDates","doneDates","mostRecentDate","statusDateLabel","statusDateRaw","statusDateDisplay","_context15","dateArr","dStr","yyyy","mm","dd","every","parsed","parseTaskLine","st","updated","formatDateForDisplay","statusBadge","datePart","_callee13","_context14","_x0","_x6","_selectAndLoadRow","_callee17","_context19","_ref19","_callee16","_context18","select","_x1","findLastKycDate","_x7","_findLastKycDate","_callee19","_context21","_ref20","_callee18","usedRange","lastKycDate","rowCompany","_context20","getUsedRange","_x10","ymdMatch","clearTimeout","val","target","_callee8","_context8","formatDateForExcel","getSelectedCategories","isOtherTaskSelected","checked","getTaskCard","getTaskStatusChips","setCardStatus","getCardStatus","find","contains","syncTasksVisibility","isOther","otherCard","hasNonOtherCategory","some","selected","getSelectedTaskToggles","has","updateExtraNotePlaceholder","categories","reorderCheckboxesToTop","containerSelector","children","unchecked","loadTeamMembers","_loadTeamMembers","_callee21","_context23","initialized","_ref21","_callee20","namesRaw","names","noneOpt","_context22","opt","_x11","getSelectedAssignees","updateTaskAssigneeDropdowns","selectedAssignees","dropdown","currentValue","emptyOpt","raw","basicMatch","exec","comment","giveUpId","commentMatch","giveUpMatch","buildSummaryLine","parts","assignees","_loadFromActiveRow","_callee25","_context27","_ref23","_callee24","selectedRange","uiRow","companyRange","descRange","assigneesRange","brokerRange","datesRange","hRange","jRange","kRange","companyVal","descVal","brokerVal","assigneesVal","assigneesList","datesRow","toInputDate","freqVal","noteVal","lines","parsedTasks","nonTaskLines","cand","statusPriority","sNorm","commentEl","deadlineEl","taskAssigneeEl","chosenAudit","lastKycEl","kycCompletedDate","_context26","dmmyMatch","mon","getSelectedRange","rowIndex","cat","giveUpIdEl","pt","ptName","cbName","date","updateDateDisplays","updateEmailSummaryButton","emailSummarySection","_x13","_saveToActiveRow","_callee27","_context29","_ref24","_callee26","existing","newTaskLines","existingTasks","getTodayFormatted","computeDates","taskAssignee","existingTask","dates","payload","builtLine","toggles","fixedNames","sortedLines","newValue","hasInProgress","hasToDo","fontColor","_context28","newStatus","oldStatus","newStatusLower","hasAnyDate","format","font","_x14","visibleCard","focus","_deleteCurrentRow","_callee29","_context31","_ref25","_callee28","_context30","delete","DeleteShiftDirection","up","_x15","_addNewTask","_callee31","_context33","_ref26","_callee30","colA","nextRow","statusLower","hRangeNew","_context32","_x16","input","_ref9","inputEl","displayEl","formatted","emailSummaryBtn","emailSummaryList","emailSummaryCount","closeEmailSummaryBtn","disabled","loadEmailSummaries","_loadEmailSummaries","_callee34","apiSummary","firstLine","restText","headerMatch","summaryBody","matchClass","detectedCategory","matchedAssignees","summaryNotes","participantChipsHtml","chips","matchWarningHtml","applyButtonHtml","cleanedSummaryBody","applyBtn","_t8","_context36","_ref27","_callee32","cell","_context34","_x17","replace","_ref28","_callee33","_context35","_x18","chipClass","showSmartBriefConfirmation","_lastParsedSmartBrief","suggestionsHtml","hasSuggestions","assigneeCheckboxes","truncatedPreview","substring","_overlay$querySelecto","_overlay$querySelecto2","applyCategory","applyNotes","_lastParsedSmartBrief2","appliedItems","existingNote","notePrefix","truncatedNotes","applySmartBriefSelections","_callee9","_context9","Office","onReady","info","host","HostType","chip","closest","selector","el"],"ignoreList":[],"sourceRoot":""}